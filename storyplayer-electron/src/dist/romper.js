/*! For license information please see romper.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Romper=t():e.Romper=t()}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="./src/romper.js")}({"./node_modules/browser-bunyan/lib/index.m.js":function(e,t,n){"use strict";n.r(t),n.d(t,"TRACE",(function(){return r})),n.d(t,"DEBUG",(function(){return i})),n.d(t,"INFO",(function(){return o})),n.d(t,"WARN",(function(){return a})),n.d(t,"ERROR",(function(){return s})),n.d(t,"FATAL",(function(){return u})),n.d(t,"resolveLevel",(function(){return d})),n.d(t,"levelFromName",(function(){return l})),n.d(t,"nameFromLevel",(function(){return c})),n.d(t,"stdSerializers",(function(){return x})),n.d(t,"Logger",(function(){return w})),n.d(t,"createLogger",(function(){return A})),n.d(t,"safeCycles",(function(){return _})),n.d(t,"ConsoleFormattedStream",(function(){return L})),n.d(t,"ConsoleRawStream",(function(){return E})),n.d(t,"ConsolePlainStream",(function(){return O}));var r=10,i=20,o=30,a=40,s=50,u=60,l={trace:r,debug:i,info:o,warn:a,error:s,fatal:u},c={};function d(e){return"string"==typeof e?l[e.toLowerCase()]:e}Object.keys(l).forEach((function(e){c[l[e]]=e}));function h(e){if(null==e)return e;if(Array.isArray(e))return e.slice();if("object"==typeof e){var t={};return Object.keys(e).forEach((function(n){t[n]=e[n]})),t}return e}function f(e){return void 0===e?"undefined":null===e?"null":Array.isArray(e)?"[ "+e.map((function(e){return f(e)})).join(", ")+" ]":"object"==typeof e?JSON.stringify(e):"function"==typeof e?"[Function: "+e.name+"]":"boolean"==typeof e||"number"==typeof e?e:"'"+e.toString()+"'"}function p(e){var t=arguments;if("string"!=typeof e){for(var n=new Array(arguments.length),r=0;r<arguments.length;r++)n[r]=f(t[r]);return n.join(" ")}for(var i=/%[sdj%]/g,o=1,a=arguments,s=a.length,u=String(e).replace(i,(function(e){if("%%"===e)return"%";if(o>=s)return e;switch(e){case"%s":return String(a[o++]);case"%d":return Number(a[o++]);case"%j":try{return JSON.stringify(a[o++])}catch(e){return"[Circular]"}default:return e}})),l=a[o];o<s;l=a[++o])u+=null===l||"object"!=typeof l?" "+l:" "+f(l);return u}function m(e,t){var n=e.split("\n");n[0]&&n[0].indexOf("call-stack-error")>=0&&n.shift();var r=n[t],i=null;if(r){var o=/^\s*(at|.*@)\s*(.+)?$/.exec(r);i=Array.isArray(o)&&o[2]?o[2]:r}return i}var v={};function g(e,t){if(t){if(v[t])return;v[t]=!0}console.error(e+"\n")}function y(e){return v[e]}function _(){var e=[];return function(t,n){return n&&"object"==typeof n?-1!==e.indexOf(n)?"[Circular]":(e.push(n),n):n}}var b={trace:10,debug:20,info:30,warn:40,error:50,fatal:60};Object.keys(b).forEach((function(e){}));var E=function(){};E.prototype.write=function(e){e.level<30?console.log(e):e.level<40?console.info(e):e.level<50?console.warn(e):console.error(e),e.err&&e.err.stack&&console.error(e.err.stack),e.obj&&console.log(e.obj)};var w=function e(t,n,r){var i,o,a,s,u=this;if(!(this instanceof e))return new e(t,n);if(void 0!==n&&(i=t,t=n,!(i instanceof e)))throw new TypeError("invalid Logger creation: do not pass a second arg");if(!t)throw new TypeError("options (object) is required");if(i){if(t.name)throw new TypeError("invalid options.name: child cannot set logger name")}else if(!t.name)throw new TypeError("options.name (string) is required");if(t.stream&&t.streams)throw new TypeError('cannot mix "streams" and "stream" options');if(t.streams&&!Array.isArray(t.streams))throw new TypeError("invalid options.streams: must be an array");if(t.serializers&&("object"!=typeof t.serializers||Array.isArray(t.serializers)))throw new TypeError("invalid options.serializers: must be an object");if(i&&r){this._level=i._level,this.streams=i.streams,this.serializers=i.serializers,this.src=i.src,o=this.fields={};var l=Object.keys(i.fields);for(s=0;s<l.length;s++)a=l[s],o[a]=i.fields[a];var c=Object.keys(t);for(s=0;s<c.length;s++)a=c[s],o[a]=t[a]}else{if(i){for(this._level=i._level,this.streams=[],s=0;s<i.streams.length;s++){var d=h(i.streams[s]);u.streams.push(d)}this.serializers=h(i.serializers),this.src=i.src,this.fields=h(i.fields),t.level&&this.level(t.level)}else this._level=Number.POSITIVE_INFINITY,this.streams=[],this.serializers=null,this.src=!1,this.fields={};t.stream?this.addStream({type:"stream",stream:t.stream,level:t.level}):t.streams?t.streams.forEach((function(e){u.addStream(e,t.level)})):i&&t.level?this.level(t.level):i||this.addStream({type:"raw",stream:new E,level:t.level}),t.serializers&&this.addSerializers(t.serializers),t.src&&(this.src=!0),delete(o=h(t)).stream,delete o.level,delete o.streams,delete o.serializers,delete o.src,this.serializers&&this._applySerializers(o),Object.keys(o).forEach((function(e){u.fields[e]=o[e]}))}};function T(e){return function(){var t=this;function n(n){var o;n[0]instanceof Error?(r={err:t.serializers&&t.serializers.err?t.serializers.err(n[0]):x.err(n[0])},o={err:!0},i=1===n.length?[r.err.message]:Array.prototype.slice.call(n,1)):"object"!=typeof n[0]&&null!==n[0]||Array.isArray(n[0])?(r=null,i=Array.prototype.slice.call(n)):(r=n[0],i=1===n.length&&r.err&&r.err instanceof Error?[r.err.message]:Array.prototype.slice.call(n,1));var a=h(t.fields);a.level=e;var s=r?h(r):null;if(s&&(t.serializers&&t._applySerializers(s,o),Object.keys(s).forEach((function(e){a[e]=s[e]}))),a.levelName=c[e],a.msg=i.length?p.apply(t,i):"",a.time||(a.time=new Date),t.src&&!a.src)try{throw new Error("call-stack-error")}catch(e){var u=e.stack?m(e.stack,2):"";u||y("src")||g("Unable to determine src line info","src"),a.src=u||""}return a.v=1,a}var r=null,i=arguments,o=null;if(0===arguments.length)return this._level<=e;this._level>e||(o=n(i),this._emit(o))}}function S(e){var t=e.stack||e.toString();if(e.cause&&"function"==typeof e.cause){var n=e.cause();n&&(t+="\nCaused by: "+S(n))}return t}w.prototype.addStream=function(e,t){void 0===t&&(t=o),(e=h(e)).type="raw",e.level=d(e.level||t),e.level<this._level&&(this._level=e.level),this.streams.push(e),delete this.haveNonRawStreams},w.prototype.addSerializers=function(e){var t=this;this.serializers||(this.serializers={}),Object.keys(e).forEach((function(n){var r=e[n];if("function"!=typeof r)throw new TypeError(p('invalid serializer for "%s" field: must be a function',n));t.serializers[n]=r}))},w.prototype.child=function(e,t){return new this.constructor(this,e||{},t)},w.prototype.level=function(e){if(void 0===e)return this._level;for(var t=d(e),n=this.streams.length,r=0;r<n;r++)this.streams[r].level=t;this._level=t},w.prototype.levels=function(e,t){var n;if(void 0===e)return this.streams.map((function(e){return e.level}));if("number"==typeof e){if(void 0===(n=this.streams[e]))throw new Error("invalid stream index: "+e)}else{for(var r=this.streams.length,i=0;i<r;i++){var o=this.streams[i];if(o.name===e){n=o;break}}if(!n)throw new Error(p('no stream with name "%s"',e))}if(void 0===t)return n.level;var a=d(t);n.level=a,a<this._level&&(this._level=a)},w.prototype._applySerializers=function(e,t){var n=this;Object.keys(this.serializers).forEach((function(r){if(!(void 0===e[r]||t&&t[r]))try{e[r]=n.serializers[r](e[r])}catch(t){g(p('bunyan: ERROR: Exception thrown from the "%s" Bunyan serializer. This should never happen. This is a bugin that serializer function.\n%s',r,t.stack||t)),e[r]=p('(Error in Bunyan log "%s" serializer broke field. See stderr for details.)',r)}}))},w.prototype._emit=function(e,t){var n,r;if(void 0===this.haveNonRawStreams)for(this.haveNonRawStreams=!1,n=0;n<this.streams.length;n++)if(!this.streams[n].raw){this.haveNonRawStreams=!0;break}if(t||this.haveNonRawStreams)try{r=JSON.stringify(e,_())+"\n"}catch(t){var i=t.stack.split(/\n/g,2).join("\n");g('bunyan: ERROR: Exception in `JSON.stringify(rec)`. You can install the "safe-json-stringify" module to have Bunyan fallback to safer stringification. Record:\n'+function(e,t){return t||(t="    "),t+e.split(/\r?\n/g).join("\n"+t)}(p("%s\n%s",e,t.stack)),i),r=p("(Exception in JSON.stringify(rec): %j. See stderr for details.)\n",t.message)}if(t)return r;var o=e.level;for(n=0;n<this.streams.length;n++){var a=this.streams[n];a.level<=o&&a.stream.write(e)}return r},w.prototype.trace=T(r),w.prototype.debug=T(i),w.prototype.info=T(o),w.prototype.warn=T(a),w.prototype.error=T(s),w.prototype.fatal=T(u);var x={err:function(e){return e&&e.stack?{message:e.message,name:e.name,stack:S(e),code:e.code,signal:e.signal}:e}};function A(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return new(Function.prototype.bind.apply(w,[null].concat(e)))}var M={trace:10,debug:20,info:30,warn:40,error:50,fatal:60},j={};Object.keys(M).forEach((function(e){j[M[e]]=e}));var R={levels:{trace:"color: DeepPink",debug:"color: GoldenRod",info:"color: DarkTurquoise",warn:"color: Purple",error:"color: Crimson",fatal:"color: Black"},def:"color: DimGray",msg:"color: SteelBlue",src:"color: DimGray; font-style: italic; font-size: 0.9em"},L=function(e){void 0===e&&(e={});var t=e.logByLevel;void 0===t&&(t=!1);var n=e.css;void 0===n&&(n=R),this.logByLevel=t,this.css=n};L.prototype.write=function(e){var t,n,r=this.css.def,i=this.css.msg,o=this.css.src,a=e.childName?e.name+"/"+e.childName:e.name,s=j[e.level],u=(Array(6-s.length).join(" ")+s).toUpperCase();this.logByLevel?(10===e.level?s="debug":60===e.level&&(s="error"),n="function"==typeof console[s]?console[s]:console.log):n=console.log,t=e.level<20?this.css.levels.trace:e.level<30?this.css.levels.debug:e.level<40?this.css.levels.info:e.level<50?this.css.levels.warn:e.level<60?this.css.levels.error:this.css.levels.fatal;var l=function(e,t){return Array(t+1-(e+"").length).join("0")+e},c=[];c.push("[%s:%s:%s:%s] %c%s%c: %s: %c%s "+(e.src?"%c%s":"")),c.push(l(e.time.getHours(),2)),c.push(l(e.time.getMinutes(),2)),c.push(l(e.time.getSeconds(),2)),c.push(l(e.time.getMilliseconds(),4)),c.push(t),c.push(u),c.push(r),c.push(a),c.push(i),c.push(e.msg),e.src&&(c.push(o),c.push(e.src)),n.apply(console,c),e.err&&e.err.stack&&n.call(console,"%c%s,",t,e.err.stack),e.obj&&n.call(console,e.obj)},L.getDefaultCss=function(){return R};var C={trace:10,debug:20,info:30,warn:40,error:50,fatal:60},k={};Object.keys(C).forEach((function(e){k[C[e]]=e}));var O=function(e){void 0===e&&(e={});var t=e.logByLevel;void 0===t&&(t=!1),this.logByLevel=t};O.prototype.write=function(e){var t,n=e.childName?e.name+"/"+e.childName:e.name,r=k[e.level],i=(Array(6-r.length).join(" ")+r).toUpperCase();this.logByLevel?(10===e.level?r="debug":60===e.level&&(r="error"),t="function"==typeof console[r]?console[r]:console.log):t=console.log;var o=function(e,t){return Array(t+1-(e+"").length).join("0")+e},a="["+o(e.time.getHours(),2)+":";a+=o(e.time.getMinutes(),2)+":",a+=o(e.time.getSeconds(),2)+":",a+=o(e.time.getMilliseconds(),4)+"] ",a+=i+": ",a+=n+": ",a+=e.msg,e.src&&(a+=" ("+e.src+")"),t.call(console,a),e.err&&e.err.stack&&t.call(console,e.err.stack),e.obj&&t.call(console,e.obj)}},"./node_modules/core-js/internals/a-function.js":function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e}},"./node_modules/core-js/internals/a-possible-prototype.js":function(e,t,n){var r=n("./node_modules/core-js/internals/is-object.js");e.exports=function(e){if(!r(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype");return e}},"./node_modules/core-js/internals/add-to-unscopables.js":function(e,t,n){var r=n("./node_modules/core-js/internals/well-known-symbol.js"),i=n("./node_modules/core-js/internals/object-create.js"),o=n("./node_modules/core-js/internals/object-define-property.js"),a=r("unscopables"),s=Array.prototype;null==s[a]&&o.f(s,a,{configurable:!0,value:i(null)}),e.exports=function(e){s[a][e]=!0}},"./node_modules/core-js/internals/advance-string-index.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/string-multibyte.js").charAt;e.exports=function(e,t,n){return t+(n?r(e,t).length:1)}},"./node_modules/core-js/internals/an-instance.js":function(e,t){e.exports=function(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e}},"./node_modules/core-js/internals/an-object.js":function(e,t,n){var r=n("./node_modules/core-js/internals/is-object.js");e.exports=function(e){if(!r(e))throw TypeError(String(e)+" is not an object");return e}},"./node_modules/core-js/internals/array-for-each.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/array-iteration.js").forEach,i=n("./node_modules/core-js/internals/sloppy-array-method.js");e.exports=i("forEach")?function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}:[].forEach},"./node_modules/core-js/internals/array-from.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/bind-context.js"),i=n("./node_modules/core-js/internals/to-object.js"),o=n("./node_modules/core-js/internals/call-with-safe-iteration-closing.js"),a=n("./node_modules/core-js/internals/is-array-iterator-method.js"),s=n("./node_modules/core-js/internals/to-length.js"),u=n("./node_modules/core-js/internals/create-property.js"),l=n("./node_modules/core-js/internals/get-iterator-method.js");e.exports=function(e){var t,n,c,d,h,f=i(e),p="function"==typeof this?this:Array,m=arguments.length,v=m>1?arguments[1]:void 0,g=void 0!==v,y=0,_=l(f);if(g&&(v=r(v,m>2?arguments[2]:void 0,2)),null==_||p==Array&&a(_))for(n=new p(t=s(f.length));t>y;y++)u(n,y,g?v(f[y],y):f[y]);else for(h=(d=_.call(f)).next,n=new p;!(c=h.call(d)).done;y++)u(n,y,g?o(d,v,[c.value,y],!0):c.value);return n.length=y,n}},"./node_modules/core-js/internals/array-includes.js":function(e,t,n){var r=n("./node_modules/core-js/internals/to-indexed-object.js"),i=n("./node_modules/core-js/internals/to-length.js"),o=n("./node_modules/core-js/internals/to-absolute-index.js"),a=function(e){return function(t,n,a){var s,u=r(t),l=i(u.length),c=o(a,l);if(e&&n!=n){for(;l>c;)if((s=u[c++])!=s)return!0}else for(;l>c;c++)if((e||c in u)&&u[c]===n)return e||c||0;return!e&&-1}};e.exports={includes:a(!0),indexOf:a(!1)}},"./node_modules/core-js/internals/array-iteration.js":function(e,t,n){var r=n("./node_modules/core-js/internals/bind-context.js"),i=n("./node_modules/core-js/internals/indexed-object.js"),o=n("./node_modules/core-js/internals/to-object.js"),a=n("./node_modules/core-js/internals/to-length.js"),s=n("./node_modules/core-js/internals/array-species-create.js"),u=[].push,l=function(e){var t=1==e,n=2==e,l=3==e,c=4==e,d=6==e,h=5==e||d;return function(f,p,m,v){for(var g,y,_=o(f),b=i(_),E=r(p,m,3),w=a(b.length),T=0,S=v||s,x=t?S(f,w):n?S(f,0):void 0;w>T;T++)if((h||T in b)&&(y=E(g=b[T],T,_),e))if(t)x[T]=y;else if(y)switch(e){case 3:return!0;case 5:return g;case 6:return T;case 2:u.call(x,g)}else if(c)return!1;return d?-1:l||c?c:x}};e.exports={forEach:l(0),map:l(1),filter:l(2),some:l(3),every:l(4),find:l(5),findIndex:l(6)}},"./node_modules/core-js/internals/array-method-has-species-support.js":function(e,t,n){var r=n("./node_modules/core-js/internals/fails.js"),i=n("./node_modules/core-js/internals/well-known-symbol.js"),o=n("./node_modules/core-js/internals/v8-version.js"),a=i("species");e.exports=function(e){return o>=51||!r((function(){var t=[];return(t.constructor={})[a]=function(){return{foo:1}},1!==t[e](Boolean).foo}))}},"./node_modules/core-js/internals/array-reduce.js":function(e,t,n){var r=n("./node_modules/core-js/internals/a-function.js"),i=n("./node_modules/core-js/internals/to-object.js"),o=n("./node_modules/core-js/internals/indexed-object.js"),a=n("./node_modules/core-js/internals/to-length.js"),s=function(e){return function(t,n,s,u){r(n);var l=i(t),c=o(l),d=a(l.length),h=e?d-1:0,f=e?-1:1;if(s<2)for(;;){if(h in c){u=c[h],h+=f;break}if(h+=f,e?h<0:d<=h)throw TypeError("Reduce of empty array with no initial value")}for(;e?h>=0:d>h;h+=f)h in c&&(u=n(u,c[h],h,l));return u}};e.exports={left:s(!1),right:s(!0)}},"./node_modules/core-js/internals/array-species-create.js":function(e,t,n){var r=n("./node_modules/core-js/internals/is-object.js"),i=n("./node_modules/core-js/internals/is-array.js"),o=n("./node_modules/core-js/internals/well-known-symbol.js")("species");e.exports=function(e,t){var n;return i(e)&&("function"!=typeof(n=e.constructor)||n!==Array&&!i(n.prototype)?r(n)&&null===(n=n[o])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===t?0:t)}},"./node_modules/core-js/internals/bind-context.js":function(e,t,n){var r=n("./node_modules/core-js/internals/a-function.js");e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},"./node_modules/core-js/internals/call-with-safe-iteration-closing.js":function(e,t,n){var r=n("./node_modules/core-js/internals/an-object.js");e.exports=function(e,t,n,i){try{return i?t(r(n)[0],n[1]):t(n)}catch(t){var o=e.return;throw void 0!==o&&r(o.call(e)),t}}},"./node_modules/core-js/internals/check-correctness-of-iteration.js":function(e,t,n){var r=n("./node_modules/core-js/internals/well-known-symbol.js")("iterator"),i=!1;try{var o=0,a={next:function(){return{done:!!o++}},return:function(){i=!0}};a[r]=function(){return this},Array.from(a,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var n=!1;try{var o={};o[r]=function(){return{next:function(){return{done:n=!0}}}},e(o)}catch(e){}return n}},"./node_modules/core-js/internals/classof-raw.js":function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},"./node_modules/core-js/internals/classof.js":function(e,t,n){var r=n("./node_modules/core-js/internals/to-string-tag-support.js"),i=n("./node_modules/core-js/internals/classof-raw.js"),o=n("./node_modules/core-js/internals/well-known-symbol.js")("toStringTag"),a="Arguments"==i(function(){return arguments}());e.exports=r?i:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),o))?n:a?i(t):"Object"==(r=i(t))&&"function"==typeof t.callee?"Arguments":r}},"./node_modules/core-js/internals/copy-constructor-properties.js":function(e,t,n){var r=n("./node_modules/core-js/internals/has.js"),i=n("./node_modules/core-js/internals/own-keys.js"),o=n("./node_modules/core-js/internals/object-get-own-property-descriptor.js"),a=n("./node_modules/core-js/internals/object-define-property.js");e.exports=function(e,t){for(var n=i(t),s=a.f,u=o.f,l=0;l<n.length;l++){var c=n[l];r(e,c)||s(e,c,u(t,c))}}},"./node_modules/core-js/internals/correct-is-regexp-logic.js":function(e,t,n){var r=n("./node_modules/core-js/internals/well-known-symbol.js")("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[r]=!1,"/./"[e](t)}catch(e){}}return!1}},"./node_modules/core-js/internals/correct-prototype-getter.js":function(e,t,n){var r=n("./node_modules/core-js/internals/fails.js");e.exports=!r((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},"./node_modules/core-js/internals/create-iterator-constructor.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/iterators-core.js").IteratorPrototype,i=n("./node_modules/core-js/internals/object-create.js"),o=n("./node_modules/core-js/internals/create-property-descriptor.js"),a=n("./node_modules/core-js/internals/set-to-string-tag.js"),s=n("./node_modules/core-js/internals/iterators.js"),u=function(){return this};e.exports=function(e,t,n){var l=t+" Iterator";return e.prototype=i(r,{next:o(1,n)}),a(e,l,!1,!0),s[l]=u,e}},"./node_modules/core-js/internals/create-non-enumerable-property.js":function(e,t,n){var r=n("./node_modules/core-js/internals/descriptors.js"),i=n("./node_modules/core-js/internals/object-define-property.js"),o=n("./node_modules/core-js/internals/create-property-descriptor.js");e.exports=r?function(e,t,n){return i.f(e,t,o(1,n))}:function(e,t,n){return e[t]=n,e}},"./node_modules/core-js/internals/create-property-descriptor.js":function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},"./node_modules/core-js/internals/create-property.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/to-primitive.js"),i=n("./node_modules/core-js/internals/object-define-property.js"),o=n("./node_modules/core-js/internals/create-property-descriptor.js");e.exports=function(e,t,n){var a=r(t);a in e?i.f(e,a,o(0,n)):e[a]=n}},"./node_modules/core-js/internals/define-iterator.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/export.js"),i=n("./node_modules/core-js/internals/create-iterator-constructor.js"),o=n("./node_modules/core-js/internals/object-get-prototype-of.js"),a=n("./node_modules/core-js/internals/object-set-prototype-of.js"),s=n("./node_modules/core-js/internals/set-to-string-tag.js"),u=n("./node_modules/core-js/internals/create-non-enumerable-property.js"),l=n("./node_modules/core-js/internals/redefine.js"),c=n("./node_modules/core-js/internals/well-known-symbol.js"),d=n("./node_modules/core-js/internals/is-pure.js"),h=n("./node_modules/core-js/internals/iterators.js"),f=n("./node_modules/core-js/internals/iterators-core.js"),p=f.IteratorPrototype,m=f.BUGGY_SAFARI_ITERATORS,v=c("iterator"),g=function(){return this};e.exports=function(e,t,n,c,f,y,_){i(n,t,c);var b,E,w,T=function(e){if(e===f&&j)return j;if(!m&&e in A)return A[e];switch(e){case"keys":case"values":case"entries":return function(){return new n(this,e)}}return function(){return new n(this)}},S=t+" Iterator",x=!1,A=e.prototype,M=A[v]||A["@@iterator"]||f&&A[f],j=!m&&M||T(f),R="Array"==t&&A.entries||M;if(R&&(b=o(R.call(new e)),p!==Object.prototype&&b.next&&(d||o(b)===p||(a?a(b,p):"function"!=typeof b[v]&&u(b,v,g)),s(b,S,!0,!0),d&&(h[S]=g))),"values"==f&&M&&"values"!==M.name&&(x=!0,j=function(){return M.call(this)}),d&&!_||A[v]===j||u(A,v,j),h[t]=j,f)if(E={values:T("values"),keys:y?j:T("keys"),entries:T("entries")},_)for(w in E)(m||x||!(w in A))&&l(A,w,E[w]);else r({target:t,proto:!0,forced:m||x},E);return E}},"./node_modules/core-js/internals/define-well-known-symbol.js":function(e,t,n){var r=n("./node_modules/core-js/internals/path.js"),i=n("./node_modules/core-js/internals/has.js"),o=n("./node_modules/core-js/internals/wrapped-well-known-symbol.js"),a=n("./node_modules/core-js/internals/object-define-property.js").f;e.exports=function(e){var t=r.Symbol||(r.Symbol={});i(t,e)||a(t,e,{value:o.f(e)})}},"./node_modules/core-js/internals/descriptors.js":function(e,t,n){var r=n("./node_modules/core-js/internals/fails.js");e.exports=!r((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},"./node_modules/core-js/internals/document-create-element.js":function(e,t,n){var r=n("./node_modules/core-js/internals/global.js"),i=n("./node_modules/core-js/internals/is-object.js"),o=r.document,a=i(o)&&i(o.createElement);e.exports=function(e){return a?o.createElement(e):{}}},"./node_modules/core-js/internals/dom-iterables.js":function(e,t){e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},"./node_modules/core-js/internals/enum-bug-keys.js":function(e,t){e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},"./node_modules/core-js/internals/export.js":function(e,t,n){var r=n("./node_modules/core-js/internals/global.js"),i=n("./node_modules/core-js/internals/object-get-own-property-descriptor.js").f,o=n("./node_modules/core-js/internals/create-non-enumerable-property.js"),a=n("./node_modules/core-js/internals/redefine.js"),s=n("./node_modules/core-js/internals/set-global.js"),u=n("./node_modules/core-js/internals/copy-constructor-properties.js"),l=n("./node_modules/core-js/internals/is-forced.js");e.exports=function(e,t){var n,c,d,h,f,p=e.target,m=e.global,v=e.stat;if(n=m?r:v?r[p]||s(p,{}):(r[p]||{}).prototype)for(c in t){if(h=t[c],d=e.noTargetGet?(f=i(n,c))&&f.value:n[c],!l(m?c:p+(v?".":"#")+c,e.forced)&&void 0!==d){if(typeof h==typeof d)continue;u(h,d)}(e.sham||d&&d.sham)&&o(h,"sham",!0),a(n,c,h,e)}}},"./node_modules/core-js/internals/fails.js":function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},"./node_modules/core-js/internals/fix-regexp-well-known-symbol-logic.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/redefine.js"),i=n("./node_modules/core-js/internals/fails.js"),o=n("./node_modules/core-js/internals/well-known-symbol.js"),a=n("./node_modules/core-js/internals/regexp-exec.js"),s=n("./node_modules/core-js/internals/create-non-enumerable-property.js"),u=o("species"),l=!i((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})),c="$0"==="a".replace(/./,"$0"),d=!i((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2!==n.length||"a"!==n[0]||"b"!==n[1]}));e.exports=function(e,t,n,h){var f=o(e),p=!i((function(){var t={};return t[f]=function(){return 7},7!=""[e](t)})),m=p&&!i((function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[u]=function(){return n},n.flags="",n[f]=/./[f]),n.exec=function(){return t=!0,null},n[f](""),!t}));if(!p||!m||"replace"===e&&(!l||!c)||"split"===e&&!d){var v=/./[f],g=n(f,""[e],(function(e,t,n,r,i){return t.exec===a?p&&!i?{done:!0,value:v.call(t,n,r)}:{done:!0,value:e.call(n,t,r)}:{done:!1}}),{REPLACE_KEEPS_$0:c}),y=g[0],_=g[1];r(String.prototype,e,y),r(RegExp.prototype,f,2==t?function(e,t){return _.call(e,this,t)}:function(e){return _.call(e,this)})}h&&s(RegExp.prototype[f],"sham",!0)}},"./node_modules/core-js/internals/get-built-in.js":function(e,t,n){var r=n("./node_modules/core-js/internals/path.js"),i=n("./node_modules/core-js/internals/global.js"),o=function(e){return"function"==typeof e?e:void 0};e.exports=function(e,t){return arguments.length<2?o(r[e])||o(i[e]):r[e]&&r[e][t]||i[e]&&i[e][t]}},"./node_modules/core-js/internals/get-iterator-method.js":function(e,t,n){var r=n("./node_modules/core-js/internals/classof.js"),i=n("./node_modules/core-js/internals/iterators.js"),o=n("./node_modules/core-js/internals/well-known-symbol.js")("iterator");e.exports=function(e){if(null!=e)return e[o]||e["@@iterator"]||i[r(e)]}},"./node_modules/core-js/internals/get-iterator.js":function(e,t,n){var r=n("./node_modules/core-js/internals/an-object.js"),i=n("./node_modules/core-js/internals/get-iterator-method.js");e.exports=function(e){var t=i(e);if("function"!=typeof t)throw TypeError(String(e)+" is not iterable");return r(t.call(e))}},"./node_modules/core-js/internals/global.js":function(e,t,n){(function(t){var n=function(e){return e&&e.Math==Math&&e};e.exports=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof t&&t)||Function("return this")()}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./node_modules/core-js/internals/has.js":function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},"./node_modules/core-js/internals/hidden-keys.js":function(e,t){e.exports={}},"./node_modules/core-js/internals/host-report-errors.js":function(e,t,n){var r=n("./node_modules/core-js/internals/global.js");e.exports=function(e,t){var n=r.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))}},"./node_modules/core-js/internals/html.js":function(e,t,n){var r=n("./node_modules/core-js/internals/get-built-in.js");e.exports=r("document","documentElement")},"./node_modules/core-js/internals/ie8-dom-define.js":function(e,t,n){var r=n("./node_modules/core-js/internals/descriptors.js"),i=n("./node_modules/core-js/internals/fails.js"),o=n("./node_modules/core-js/internals/document-create-element.js");e.exports=!r&&!i((function(){return 7!=Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a}))},"./node_modules/core-js/internals/indexed-object.js":function(e,t,n){var r=n("./node_modules/core-js/internals/fails.js"),i=n("./node_modules/core-js/internals/classof-raw.js"),o="".split;e.exports=r((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==i(e)?o.call(e,""):Object(e)}:Object},"./node_modules/core-js/internals/inherit-if-required.js":function(e,t,n){var r=n("./node_modules/core-js/internals/is-object.js"),i=n("./node_modules/core-js/internals/object-set-prototype-of.js");e.exports=function(e,t,n){var o,a;return i&&"function"==typeof(o=t.constructor)&&o!==n&&r(a=o.prototype)&&a!==n.prototype&&i(e,a),e}},"./node_modules/core-js/internals/inspect-source.js":function(e,t,n){var r=n("./node_modules/core-js/internals/shared-store.js"),i=Function.toString;"function"!=typeof r.inspectSource&&(r.inspectSource=function(e){return i.call(e)}),e.exports=r.inspectSource},"./node_modules/core-js/internals/internal-state.js":function(e,t,n){var r,i,o,a=n("./node_modules/core-js/internals/native-weak-map.js"),s=n("./node_modules/core-js/internals/global.js"),u=n("./node_modules/core-js/internals/is-object.js"),l=n("./node_modules/core-js/internals/create-non-enumerable-property.js"),c=n("./node_modules/core-js/internals/has.js"),d=n("./node_modules/core-js/internals/shared-key.js"),h=n("./node_modules/core-js/internals/hidden-keys.js"),f=s.WeakMap;if(a){var p=new f,m=p.get,v=p.has,g=p.set;r=function(e,t){return g.call(p,e,t),t},i=function(e){return m.call(p,e)||{}},o=function(e){return v.call(p,e)}}else{var y=d("state");h[y]=!0,r=function(e,t){return l(e,y,t),t},i=function(e){return c(e,y)?e[y]:{}},o=function(e){return c(e,y)}}e.exports={set:r,get:i,has:o,enforce:function(e){return o(e)?i(e):r(e,{})},getterFor:function(e){return function(t){var n;if(!u(t)||(n=i(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}}},"./node_modules/core-js/internals/is-array-iterator-method.js":function(e,t,n){var r=n("./node_modules/core-js/internals/well-known-symbol.js"),i=n("./node_modules/core-js/internals/iterators.js"),o=r("iterator"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(i.Array===e||a[o]===e)}},"./node_modules/core-js/internals/is-array.js":function(e,t,n){var r=n("./node_modules/core-js/internals/classof-raw.js");e.exports=Array.isArray||function(e){return"Array"==r(e)}},"./node_modules/core-js/internals/is-forced.js":function(e,t,n){var r=n("./node_modules/core-js/internals/fails.js"),i=/#|\.prototype\./,o=function(e,t){var n=s[a(e)];return n==l||n!=u&&("function"==typeof t?r(t):!!t)},a=o.normalize=function(e){return String(e).replace(i,".").toLowerCase()},s=o.data={},u=o.NATIVE="N",l=o.POLYFILL="P";e.exports=o},"./node_modules/core-js/internals/is-ios.js":function(e,t,n){var r=n("./node_modules/core-js/internals/user-agent.js");e.exports=/(iphone|ipod|ipad).*applewebkit/i.test(r)},"./node_modules/core-js/internals/is-object.js":function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},"./node_modules/core-js/internals/is-pure.js":function(e,t){e.exports=!1},"./node_modules/core-js/internals/is-regexp.js":function(e,t,n){var r=n("./node_modules/core-js/internals/is-object.js"),i=n("./node_modules/core-js/internals/classof-raw.js"),o=n("./node_modules/core-js/internals/well-known-symbol.js")("match");e.exports=function(e){var t;return r(e)&&(void 0!==(t=e[o])?!!t:"RegExp"==i(e))}},"./node_modules/core-js/internals/iterate.js":function(e,t,n){var r=n("./node_modules/core-js/internals/an-object.js"),i=n("./node_modules/core-js/internals/is-array-iterator-method.js"),o=n("./node_modules/core-js/internals/to-length.js"),a=n("./node_modules/core-js/internals/bind-context.js"),s=n("./node_modules/core-js/internals/get-iterator-method.js"),u=n("./node_modules/core-js/internals/call-with-safe-iteration-closing.js"),l=function(e,t){this.stopped=e,this.result=t};(e.exports=function(e,t,n,c,d){var h,f,p,m,v,g,y,_=a(t,n,c?2:1);if(d)h=e;else{if("function"!=typeof(f=s(e)))throw TypeError("Target is not iterable");if(i(f)){for(p=0,m=o(e.length);m>p;p++)if((v=c?_(r(y=e[p])[0],y[1]):_(e[p]))&&v instanceof l)return v;return new l(!1)}h=f.call(e)}for(g=h.next;!(y=g.call(h)).done;)if("object"==typeof(v=u(h,_,y.value,c))&&v&&v instanceof l)return v;return new l(!1)}).stop=function(e){return new l(!0,e)}},"./node_modules/core-js/internals/iterators-core.js":function(e,t,n){"use strict";var r,i,o,a=n("./node_modules/core-js/internals/object-get-prototype-of.js"),s=n("./node_modules/core-js/internals/create-non-enumerable-property.js"),u=n("./node_modules/core-js/internals/has.js"),l=n("./node_modules/core-js/internals/well-known-symbol.js"),c=n("./node_modules/core-js/internals/is-pure.js"),d=l("iterator"),h=!1;[].keys&&("next"in(o=[].keys())?(i=a(a(o)))!==Object.prototype&&(r=i):h=!0),null==r&&(r={}),c||u(r,d)||s(r,d,(function(){return this})),e.exports={IteratorPrototype:r,BUGGY_SAFARI_ITERATORS:h}},"./node_modules/core-js/internals/iterators.js":function(e,t){e.exports={}},"./node_modules/core-js/internals/microtask.js":function(e,t,n){var r,i,o,a,s,u,l,c,d=n("./node_modules/core-js/internals/global.js"),h=n("./node_modules/core-js/internals/object-get-own-property-descriptor.js").f,f=n("./node_modules/core-js/internals/classof-raw.js"),p=n("./node_modules/core-js/internals/task.js").set,m=n("./node_modules/core-js/internals/is-ios.js"),v=d.MutationObserver||d.WebKitMutationObserver,g=d.process,y=d.Promise,_="process"==f(g),b=h(d,"queueMicrotask"),E=b&&b.value;E||(r=function(){var e,t;for(_&&(e=g.domain)&&e.exit();i;){t=i.fn,i=i.next;try{t()}catch(e){throw i?a():o=void 0,e}}o=void 0,e&&e.enter()},_?a=function(){g.nextTick(r)}:v&&!m?(s=!0,u=document.createTextNode(""),new v(r).observe(u,{characterData:!0}),a=function(){u.data=s=!s}):y&&y.resolve?(l=y.resolve(void 0),c=l.then,a=function(){c.call(l,r)}):a=function(){p.call(d,r)}),e.exports=E||function(e){var t={fn:e,next:void 0};o&&(o.next=t),i||(i=t,a()),o=t}},"./node_modules/core-js/internals/native-promise-constructor.js":function(e,t,n){var r=n("./node_modules/core-js/internals/global.js");e.exports=r.Promise},"./node_modules/core-js/internals/native-symbol.js":function(e,t,n){var r=n("./node_modules/core-js/internals/fails.js");e.exports=!!Object.getOwnPropertySymbols&&!r((function(){return!String(Symbol())}))},"./node_modules/core-js/internals/native-url.js":function(e,t,n){var r=n("./node_modules/core-js/internals/fails.js"),i=n("./node_modules/core-js/internals/well-known-symbol.js"),o=n("./node_modules/core-js/internals/is-pure.js"),a=i("iterator");e.exports=!r((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,n="";return e.pathname="c%20d",t.forEach((function(e,r){t.delete("b"),n+=r+e})),o&&!e.toJSON||!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[a]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://тест").host||"#%D0%B1"!==new URL("http://a#б").hash||"a1c3"!==n||"x"!==new URL("http://x",void 0).host}))},"./node_modules/core-js/internals/native-weak-map.js":function(e,t,n){var r=n("./node_modules/core-js/internals/global.js"),i=n("./node_modules/core-js/internals/inspect-source.js"),o=r.WeakMap;e.exports="function"==typeof o&&/native code/.test(i(o))},"./node_modules/core-js/internals/new-promise-capability.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/a-function.js"),i=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=r(t),this.reject=r(n)};e.exports.f=function(e){return new i(e)}},"./node_modules/core-js/internals/not-a-regexp.js":function(e,t,n){var r=n("./node_modules/core-js/internals/is-regexp.js");e.exports=function(e){if(r(e))throw TypeError("The method doesn't accept regular expressions");return e}},"./node_modules/core-js/internals/object-assign.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/descriptors.js"),i=n("./node_modules/core-js/internals/fails.js"),o=n("./node_modules/core-js/internals/object-keys.js"),a=n("./node_modules/core-js/internals/object-get-own-property-symbols.js"),s=n("./node_modules/core-js/internals/object-property-is-enumerable.js"),u=n("./node_modules/core-js/internals/to-object.js"),l=n("./node_modules/core-js/internals/indexed-object.js"),c=Object.assign,d=Object.defineProperty;e.exports=!c||i((function(){if(r&&1!==c({b:1},c(d({},"a",{enumerable:!0,get:function(){d(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol();return e[n]=7,"abcdefghijklmnopqrst".split("").forEach((function(e){t[e]=e})),7!=c({},e)[n]||"abcdefghijklmnopqrst"!=o(c({},t)).join("")}))?function(e,t){for(var n=u(e),i=arguments.length,c=1,d=a.f,h=s.f;i>c;)for(var f,p=l(arguments[c++]),m=d?o(p).concat(d(p)):o(p),v=m.length,g=0;v>g;)f=m[g++],r&&!h.call(p,f)||(n[f]=p[f]);return n}:c},"./node_modules/core-js/internals/object-create.js":function(e,t,n){var r,i=n("./node_modules/core-js/internals/an-object.js"),o=n("./node_modules/core-js/internals/object-define-properties.js"),a=n("./node_modules/core-js/internals/enum-bug-keys.js"),s=n("./node_modules/core-js/internals/hidden-keys.js"),u=n("./node_modules/core-js/internals/html.js"),l=n("./node_modules/core-js/internals/document-create-element.js"),c=n("./node_modules/core-js/internals/shared-key.js"),d=c("IE_PROTO"),h=function(){},f=function(e){return"<script>"+e+"<\/script>"},p=function(){try{r=document.domain&&new ActiveXObject("htmlfile")}catch(e){}var e,t;p=r?function(e){e.write(f("")),e.close();var t=e.parentWindow.Object;return e=null,t}(r):((t=l("iframe")).style.display="none",u.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(f("document.F=Object")),e.close(),e.F);for(var n=a.length;n--;)delete p.prototype[a[n]];return p()};s[d]=!0,e.exports=Object.create||function(e,t){var n;return null!==e?(h.prototype=i(e),n=new h,h.prototype=null,n[d]=e):n=p(),void 0===t?n:o(n,t)}},"./node_modules/core-js/internals/object-define-properties.js":function(e,t,n){var r=n("./node_modules/core-js/internals/descriptors.js"),i=n("./node_modules/core-js/internals/object-define-property.js"),o=n("./node_modules/core-js/internals/an-object.js"),a=n("./node_modules/core-js/internals/object-keys.js");e.exports=r?Object.defineProperties:function(e,t){o(e);for(var n,r=a(t),s=r.length,u=0;s>u;)i.f(e,n=r[u++],t[n]);return e}},"./node_modules/core-js/internals/object-define-property.js":function(e,t,n){var r=n("./node_modules/core-js/internals/descriptors.js"),i=n("./node_modules/core-js/internals/ie8-dom-define.js"),o=n("./node_modules/core-js/internals/an-object.js"),a=n("./node_modules/core-js/internals/to-primitive.js"),s=Object.defineProperty;t.f=r?s:function(e,t,n){if(o(e),t=a(t,!0),o(n),i)try{return s(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},"./node_modules/core-js/internals/object-get-own-property-descriptor.js":function(e,t,n){var r=n("./node_modules/core-js/internals/descriptors.js"),i=n("./node_modules/core-js/internals/object-property-is-enumerable.js"),o=n("./node_modules/core-js/internals/create-property-descriptor.js"),a=n("./node_modules/core-js/internals/to-indexed-object.js"),s=n("./node_modules/core-js/internals/to-primitive.js"),u=n("./node_modules/core-js/internals/has.js"),l=n("./node_modules/core-js/internals/ie8-dom-define.js"),c=Object.getOwnPropertyDescriptor;t.f=r?c:function(e,t){if(e=a(e),t=s(t,!0),l)try{return c(e,t)}catch(e){}if(u(e,t))return o(!i.f.call(e,t),e[t])}},"./node_modules/core-js/internals/object-get-own-property-names-external.js":function(e,t,n){var r=n("./node_modules/core-js/internals/to-indexed-object.js"),i=n("./node_modules/core-js/internals/object-get-own-property-names.js").f,o={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return a&&"[object Window]"==o.call(e)?function(e){try{return i(e)}catch(e){return a.slice()}}(e):i(r(e))}},"./node_modules/core-js/internals/object-get-own-property-names.js":function(e,t,n){var r=n("./node_modules/core-js/internals/object-keys-internal.js"),i=n("./node_modules/core-js/internals/enum-bug-keys.js").concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},"./node_modules/core-js/internals/object-get-own-property-symbols.js":function(e,t){t.f=Object.getOwnPropertySymbols},"./node_modules/core-js/internals/object-get-prototype-of.js":function(e,t,n){var r=n("./node_modules/core-js/internals/has.js"),i=n("./node_modules/core-js/internals/to-object.js"),o=n("./node_modules/core-js/internals/shared-key.js"),a=n("./node_modules/core-js/internals/correct-prototype-getter.js"),s=o("IE_PROTO"),u=Object.prototype;e.exports=a?Object.getPrototypeOf:function(e){return e=i(e),r(e,s)?e[s]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?u:null}},"./node_modules/core-js/internals/object-keys-internal.js":function(e,t,n){var r=n("./node_modules/core-js/internals/has.js"),i=n("./node_modules/core-js/internals/to-indexed-object.js"),o=n("./node_modules/core-js/internals/array-includes.js").indexOf,a=n("./node_modules/core-js/internals/hidden-keys.js");e.exports=function(e,t){var n,s=i(e),u=0,l=[];for(n in s)!r(a,n)&&r(s,n)&&l.push(n);for(;t.length>u;)r(s,n=t[u++])&&(~o(l,n)||l.push(n));return l}},"./node_modules/core-js/internals/object-keys.js":function(e,t,n){var r=n("./node_modules/core-js/internals/object-keys-internal.js"),i=n("./node_modules/core-js/internals/enum-bug-keys.js");e.exports=Object.keys||function(e){return r(e,i)}},"./node_modules/core-js/internals/object-property-is-enumerable.js":function(e,t,n){"use strict";var r={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,o=i&&!r.call({1:2},1);t.f=o?function(e){var t=i(this,e);return!!t&&t.enumerable}:r},"./node_modules/core-js/internals/object-set-prototype-of.js":function(e,t,n){var r=n("./node_modules/core-js/internals/an-object.js"),i=n("./node_modules/core-js/internals/a-possible-prototype.js");e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),t=n instanceof Array}catch(e){}return function(n,o){return r(n),i(o),t?e.call(n,o):n.__proto__=o,n}}():void 0)},"./node_modules/core-js/internals/object-to-array.js":function(e,t,n){var r=n("./node_modules/core-js/internals/descriptors.js"),i=n("./node_modules/core-js/internals/object-keys.js"),o=n("./node_modules/core-js/internals/to-indexed-object.js"),a=n("./node_modules/core-js/internals/object-property-is-enumerable.js").f,s=function(e){return function(t){for(var n,s=o(t),u=i(s),l=u.length,c=0,d=[];l>c;)n=u[c++],r&&!a.call(s,n)||d.push(e?[n,s[n]]:s[n]);return d}};e.exports={entries:s(!0),values:s(!1)}},"./node_modules/core-js/internals/object-to-string.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/to-string-tag-support.js"),i=n("./node_modules/core-js/internals/classof.js");e.exports=r?{}.toString:function(){return"[object "+i(this)+"]"}},"./node_modules/core-js/internals/own-keys.js":function(e,t,n){var r=n("./node_modules/core-js/internals/get-built-in.js"),i=n("./node_modules/core-js/internals/object-get-own-property-names.js"),o=n("./node_modules/core-js/internals/object-get-own-property-symbols.js"),a=n("./node_modules/core-js/internals/an-object.js");e.exports=r("Reflect","ownKeys")||function(e){var t=i.f(a(e)),n=o.f;return n?t.concat(n(e)):t}},"./node_modules/core-js/internals/parse-float.js":function(e,t,n){var r=n("./node_modules/core-js/internals/global.js"),i=n("./node_modules/core-js/internals/string-trim.js").trim,o=n("./node_modules/core-js/internals/whitespaces.js"),a=r.parseFloat,s=1/a(o+"-0")!=-1/0;e.exports=s?function(e){var t=i(String(e)),n=a(t);return 0===n&&"-"==t.charAt(0)?-0:n}:a},"./node_modules/core-js/internals/parse-int.js":function(e,t,n){var r=n("./node_modules/core-js/internals/global.js"),i=n("./node_modules/core-js/internals/string-trim.js").trim,o=n("./node_modules/core-js/internals/whitespaces.js"),a=r.parseInt,s=/^[+-]?0[Xx]/,u=8!==a(o+"08")||22!==a(o+"0x16");e.exports=u?function(e,t){var n=i(String(e));return a(n,t>>>0||(s.test(n)?16:10))}:a},"./node_modules/core-js/internals/path.js":function(e,t,n){var r=n("./node_modules/core-js/internals/global.js");e.exports=r},"./node_modules/core-js/internals/perform.js":function(e,t){e.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}},"./node_modules/core-js/internals/promise-resolve.js":function(e,t,n){var r=n("./node_modules/core-js/internals/an-object.js"),i=n("./node_modules/core-js/internals/is-object.js"),o=n("./node_modules/core-js/internals/new-promise-capability.js");e.exports=function(e,t){if(r(e),i(t)&&t.constructor===e)return t;var n=o.f(e);return(0,n.resolve)(t),n.promise}},"./node_modules/core-js/internals/punycode-to-ascii.js":function(e,t,n){"use strict";var r=/[^\0-\u007E]/,i=/[.\u3002\uFF0E\uFF61]/g,o="Overflow: input needs wider integers to process",a=Math.floor,s=String.fromCharCode,u=function(e){return e+22+75*(e<26)},l=function(e,t,n){var r=0;for(e=n?a(e/700):e>>1,e+=a(e/t);e>455;r+=36)e=a(e/35);return a(r+36*e/(e+38))},c=function(e){var t,n,r=[],i=(e=function(e){for(var t=[],n=0,r=e.length;n<r;){var i=e.charCodeAt(n++);if(i>=55296&&i<=56319&&n<r){var o=e.charCodeAt(n++);56320==(64512&o)?t.push(((1023&i)<<10)+(1023&o)+65536):(t.push(i),n--)}else t.push(i)}return t}(e)).length,c=128,d=0,h=72;for(t=0;t<e.length;t++)(n=e[t])<128&&r.push(s(n));var f=r.length,p=f;for(f&&r.push("-");p<i;){var m=2147483647;for(t=0;t<e.length;t++)(n=e[t])>=c&&n<m&&(m=n);var v=p+1;if(m-c>a((2147483647-d)/v))throw RangeError(o);for(d+=(m-c)*v,c=m,t=0;t<e.length;t++){if((n=e[t])<c&&++d>2147483647)throw RangeError(o);if(n==c){for(var g=d,y=36;;y+=36){var _=y<=h?1:y>=h+26?26:y-h;if(g<_)break;var b=g-_,E=36-_;r.push(s(u(_+b%E))),g=a(b/E)}r.push(s(u(g))),h=l(d,v,p==f),d=0,++p}}++d,++c}return r.join("")};e.exports=function(e){var t,n,o=[],a=e.toLowerCase().replace(i,".").split(".");for(t=0;t<a.length;t++)n=a[t],o.push(r.test(n)?"xn--"+c(n):n);return o.join(".")}},"./node_modules/core-js/internals/redefine-all.js":function(e,t,n){var r=n("./node_modules/core-js/internals/redefine.js");e.exports=function(e,t,n){for(var i in t)r(e,i,t[i],n);return e}},"./node_modules/core-js/internals/redefine.js":function(e,t,n){var r=n("./node_modules/core-js/internals/global.js"),i=n("./node_modules/core-js/internals/create-non-enumerable-property.js"),o=n("./node_modules/core-js/internals/has.js"),a=n("./node_modules/core-js/internals/set-global.js"),s=n("./node_modules/core-js/internals/inspect-source.js"),u=n("./node_modules/core-js/internals/internal-state.js"),l=u.get,c=u.enforce,d=String(String).split("String");(e.exports=function(e,t,n,s){var u=!!s&&!!s.unsafe,l=!!s&&!!s.enumerable,h=!!s&&!!s.noTargetGet;"function"==typeof n&&("string"!=typeof t||o(n,"name")||i(n,"name",t),c(n).source=d.join("string"==typeof t?t:"")),e!==r?(u?!h&&e[t]&&(l=!0):delete e[t],l?e[t]=n:i(e,t,n)):l?e[t]=n:a(t,n)})(Function.prototype,"toString",(function(){return"function"==typeof this&&l(this).source||s(this)}))},"./node_modules/core-js/internals/regexp-exec-abstract.js":function(e,t,n){var r=n("./node_modules/core-js/internals/classof-raw.js"),i=n("./node_modules/core-js/internals/regexp-exec.js");e.exports=function(e,t){var n=e.exec;if("function"==typeof n){var o=n.call(e,t);if("object"!=typeof o)throw TypeError("RegExp exec method returned something other than an Object or null");return o}if("RegExp"!==r(e))throw TypeError("RegExp#exec called on incompatible receiver");return i.call(e,t)}},"./node_modules/core-js/internals/regexp-exec.js":function(e,t,n){"use strict";var r,i,o=n("./node_modules/core-js/internals/regexp-flags.js"),a=n("./node_modules/core-js/internals/regexp-sticky-helpers.js"),s=RegExp.prototype.exec,u=String.prototype.replace,l=s,c=(r=/a/,i=/b*/g,s.call(r,"a"),s.call(i,"a"),0!==r.lastIndex||0!==i.lastIndex),d=a.UNSUPPORTED_Y||a.BROKEN_CARET,h=void 0!==/()??/.exec("")[1];(c||h||d)&&(l=function(e){var t,n,r,i,a=this,l=d&&a.sticky,f=o.call(a),p=a.source,m=0,v=e;return l&&(-1===(f=f.replace("y","")).indexOf("g")&&(f+="g"),v=String(e).slice(a.lastIndex),a.lastIndex>0&&(!a.multiline||a.multiline&&"\n"!==e[a.lastIndex-1])&&(p="(?: "+p+")",v=" "+v,m++),n=new RegExp("^(?:"+p+")",f)),h&&(n=new RegExp("^"+p+"$(?!\\s)",f)),c&&(t=a.lastIndex),r=s.call(l?n:a,v),l?r?(r.input=r.input.slice(m),r[0]=r[0].slice(m),r.index=a.lastIndex,a.lastIndex+=r[0].length):a.lastIndex=0:c&&r&&(a.lastIndex=a.global?r.index+r[0].length:t),h&&r&&r.length>1&&u.call(r[0],n,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(r[i]=void 0)})),r}),e.exports=l},"./node_modules/core-js/internals/regexp-flags.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/an-object.js");e.exports=function(){var e=r(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},"./node_modules/core-js/internals/regexp-sticky-helpers.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/fails.js");function i(e,t){return RegExp(e,t)}t.UNSUPPORTED_Y=r((function(){var e=i("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),t.BROKEN_CARET=r((function(){var e=i("^r","gy");return e.lastIndex=2,null!=e.exec("str")}))},"./node_modules/core-js/internals/require-object-coercible.js":function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e}},"./node_modules/core-js/internals/same-value.js":function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}},"./node_modules/core-js/internals/set-global.js":function(e,t,n){var r=n("./node_modules/core-js/internals/global.js"),i=n("./node_modules/core-js/internals/create-non-enumerable-property.js");e.exports=function(e,t){try{i(r,e,t)}catch(n){r[e]=t}return t}},"./node_modules/core-js/internals/set-species.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/get-built-in.js"),i=n("./node_modules/core-js/internals/object-define-property.js"),o=n("./node_modules/core-js/internals/well-known-symbol.js"),a=n("./node_modules/core-js/internals/descriptors.js"),s=o("species");e.exports=function(e){var t=r(e),n=i.f;a&&t&&!t[s]&&n(t,s,{configurable:!0,get:function(){return this}})}},"./node_modules/core-js/internals/set-to-string-tag.js":function(e,t,n){var r=n("./node_modules/core-js/internals/object-define-property.js").f,i=n("./node_modules/core-js/internals/has.js"),o=n("./node_modules/core-js/internals/well-known-symbol.js")("toStringTag");e.exports=function(e,t,n){e&&!i(e=n?e:e.prototype,o)&&r(e,o,{configurable:!0,value:t})}},"./node_modules/core-js/internals/shared-key.js":function(e,t,n){var r=n("./node_modules/core-js/internals/shared.js"),i=n("./node_modules/core-js/internals/uid.js"),o=r("keys");e.exports=function(e){return o[e]||(o[e]=i(e))}},"./node_modules/core-js/internals/shared-store.js":function(e,t,n){var r=n("./node_modules/core-js/internals/global.js"),i=n("./node_modules/core-js/internals/set-global.js"),o=r["__core-js_shared__"]||i("__core-js_shared__",{});e.exports=o},"./node_modules/core-js/internals/shared.js":function(e,t,n){var r=n("./node_modules/core-js/internals/is-pure.js"),i=n("./node_modules/core-js/internals/shared-store.js");(e.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.6.1",mode:r?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},"./node_modules/core-js/internals/sloppy-array-method.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/fails.js");e.exports=function(e,t){var n=[][e];return!n||!r((function(){n.call(null,t||function(){throw 1},1)}))}},"./node_modules/core-js/internals/species-constructor.js":function(e,t,n){var r=n("./node_modules/core-js/internals/an-object.js"),i=n("./node_modules/core-js/internals/a-function.js"),o=n("./node_modules/core-js/internals/well-known-symbol.js")("species");e.exports=function(e,t){var n,a=r(e).constructor;return void 0===a||null==(n=r(a)[o])?t:i(n)}},"./node_modules/core-js/internals/string-multibyte.js":function(e,t,n){var r=n("./node_modules/core-js/internals/to-integer.js"),i=n("./node_modules/core-js/internals/require-object-coercible.js"),o=function(e){return function(t,n){var o,a,s=String(i(t)),u=r(n),l=s.length;return u<0||u>=l?e?"":void 0:(o=s.charCodeAt(u))<55296||o>56319||u+1===l||(a=s.charCodeAt(u+1))<56320||a>57343?e?s.charAt(u):o:e?s.slice(u,u+2):a-56320+(o-55296<<10)+65536}};e.exports={codeAt:o(!1),charAt:o(!0)}},"./node_modules/core-js/internals/string-repeat.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/to-integer.js"),i=n("./node_modules/core-js/internals/require-object-coercible.js");e.exports="".repeat||function(e){var t=String(i(this)),n="",o=r(e);if(o<0||o==1/0)throw RangeError("Wrong number of repetitions");for(;o>0;(o>>>=1)&&(t+=t))1&o&&(n+=t);return n}},"./node_modules/core-js/internals/string-trim.js":function(e,t,n){var r=n("./node_modules/core-js/internals/require-object-coercible.js"),i="["+n("./node_modules/core-js/internals/whitespaces.js")+"]",o=RegExp("^"+i+i+"*"),a=RegExp(i+i+"*$"),s=function(e){return function(t){var n=String(r(t));return 1&e&&(n=n.replace(o,"")),2&e&&(n=n.replace(a,"")),n}};e.exports={start:s(1),end:s(2),trim:s(3)}},"./node_modules/core-js/internals/task.js":function(e,t,n){var r,i,o,a=n("./node_modules/core-js/internals/global.js"),s=n("./node_modules/core-js/internals/fails.js"),u=n("./node_modules/core-js/internals/classof-raw.js"),l=n("./node_modules/core-js/internals/bind-context.js"),c=n("./node_modules/core-js/internals/html.js"),d=n("./node_modules/core-js/internals/document-create-element.js"),h=n("./node_modules/core-js/internals/is-ios.js"),f=a.location,p=a.setImmediate,m=a.clearImmediate,v=a.process,g=a.MessageChannel,y=a.Dispatch,_=0,b={},E=function(e){if(b.hasOwnProperty(e)){var t=b[e];delete b[e],t()}},w=function(e){return function(){E(e)}},T=function(e){E(e.data)},S=function(e){a.postMessage(e+"",f.protocol+"//"+f.host)};p&&m||(p=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return b[++_]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},r(_),_},m=function(e){delete b[e]},"process"==u(v)?r=function(e){v.nextTick(w(e))}:y&&y.now?r=function(e){y.now(w(e))}:g&&!h?(o=(i=new g).port2,i.port1.onmessage=T,r=l(o.postMessage,o,1)):!a.addEventListener||"function"!=typeof postMessage||a.importScripts||s(S)?r="onreadystatechange"in d("script")?function(e){c.appendChild(d("script")).onreadystatechange=function(){c.removeChild(this),E(e)}}:function(e){setTimeout(w(e),0)}:(r=S,a.addEventListener("message",T,!1))),e.exports={set:p,clear:m}},"./node_modules/core-js/internals/this-number-value.js":function(e,t,n){var r=n("./node_modules/core-js/internals/classof-raw.js");e.exports=function(e){if("number"!=typeof e&&"Number"!=r(e))throw TypeError("Incorrect invocation");return+e}},"./node_modules/core-js/internals/to-absolute-index.js":function(e,t,n){var r=n("./node_modules/core-js/internals/to-integer.js"),i=Math.max,o=Math.min;e.exports=function(e,t){var n=r(e);return n<0?i(n+t,0):o(n,t)}},"./node_modules/core-js/internals/to-indexed-object.js":function(e,t,n){var r=n("./node_modules/core-js/internals/indexed-object.js"),i=n("./node_modules/core-js/internals/require-object-coercible.js");e.exports=function(e){return r(i(e))}},"./node_modules/core-js/internals/to-integer.js":function(e,t){var n=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:n)(e)}},"./node_modules/core-js/internals/to-length.js":function(e,t,n){var r=n("./node_modules/core-js/internals/to-integer.js"),i=Math.min;e.exports=function(e){return e>0?i(r(e),9007199254740991):0}},"./node_modules/core-js/internals/to-object.js":function(e,t,n){var r=n("./node_modules/core-js/internals/require-object-coercible.js");e.exports=function(e){return Object(r(e))}},"./node_modules/core-js/internals/to-primitive.js":function(e,t,n){var r=n("./node_modules/core-js/internals/is-object.js");e.exports=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},"./node_modules/core-js/internals/to-string-tag-support.js":function(e,t,n){var r={};r[n("./node_modules/core-js/internals/well-known-symbol.js")("toStringTag")]="z",e.exports="[object z]"===String(r)},"./node_modules/core-js/internals/uid.js":function(e,t){var n=0,r=Math.random();e.exports=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++n+r).toString(36)}},"./node_modules/core-js/internals/use-symbol-as-uid.js":function(e,t,n){var r=n("./node_modules/core-js/internals/native-symbol.js");e.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},"./node_modules/core-js/internals/user-agent.js":function(e,t,n){var r=n("./node_modules/core-js/internals/get-built-in.js");e.exports=r("navigator","userAgent")||""},"./node_modules/core-js/internals/v8-version.js":function(e,t,n){var r,i,o=n("./node_modules/core-js/internals/global.js"),a=n("./node_modules/core-js/internals/user-agent.js"),s=o.process,u=s&&s.versions,l=u&&u.v8;l?i=(r=l.split("."))[0]+r[1]:a&&(!(r=a.match(/Edge\/(\d+)/))||r[1]>=74)&&(r=a.match(/Chrome\/(\d+)/))&&(i=r[1]),e.exports=i&&+i},"./node_modules/core-js/internals/well-known-symbol.js":function(e,t,n){var r=n("./node_modules/core-js/internals/global.js"),i=n("./node_modules/core-js/internals/shared.js"),o=n("./node_modules/core-js/internals/has.js"),a=n("./node_modules/core-js/internals/uid.js"),s=n("./node_modules/core-js/internals/native-symbol.js"),u=n("./node_modules/core-js/internals/use-symbol-as-uid.js"),l=i("wks"),c=r.Symbol,d=u?c:c&&c.withoutSetter||a;e.exports=function(e){return o(l,e)||(s&&o(c,e)?l[e]=c[e]:l[e]=d("Symbol."+e)),l[e]}},"./node_modules/core-js/internals/whitespaces.js":function(e,t){e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"./node_modules/core-js/internals/wrapped-well-known-symbol.js":function(e,t,n){var r=n("./node_modules/core-js/internals/well-known-symbol.js");t.f=r},"./node_modules/core-js/modules/es.array.concat.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/export.js"),i=n("./node_modules/core-js/internals/fails.js"),o=n("./node_modules/core-js/internals/is-array.js"),a=n("./node_modules/core-js/internals/is-object.js"),s=n("./node_modules/core-js/internals/to-object.js"),u=n("./node_modules/core-js/internals/to-length.js"),l=n("./node_modules/core-js/internals/create-property.js"),c=n("./node_modules/core-js/internals/array-species-create.js"),d=n("./node_modules/core-js/internals/array-method-has-species-support.js"),h=n("./node_modules/core-js/internals/well-known-symbol.js"),f=n("./node_modules/core-js/internals/v8-version.js"),p=h("isConcatSpreadable"),m=f>=51||!i((function(){var e=[];return e[p]=!1,e.concat()[0]!==e})),v=d("concat"),g=function(e){if(!a(e))return!1;var t=e[p];return void 0!==t?!!t:o(e)};r({target:"Array",proto:!0,forced:!m||!v},{concat:function(e){var t,n,r,i,o,a=s(this),d=c(a,0),h=0;for(t=-1,r=arguments.length;t<r;t++)if(o=-1===t?a:arguments[t],g(o)){if(h+(i=u(o.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(n=0;n<i;n++,h++)n in o&&l(d,h,o[n])}else{if(h>=9007199254740991)throw TypeError("Maximum allowed index exceeded");l(d,h++,o)}return d.length=h,d}})},"./node_modules/core-js/modules/es.array.filter.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/export.js"),i=n("./node_modules/core-js/internals/array-iteration.js").filter,o=n("./node_modules/core-js/internals/fails.js"),a=n("./node_modules/core-js/internals/array-method-has-species-support.js")("filter"),s=a&&!o((function(){[].filter.call({length:-1,0:1},(function(e){throw e}))}));r({target:"Array",proto:!0,forced:!a||!s},{filter:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},"./node_modules/core-js/modules/es.array.find-index.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/export.js"),i=n("./node_modules/core-js/internals/array-iteration.js").findIndex,o=n("./node_modules/core-js/internals/add-to-unscopables.js"),a=!0;"findIndex"in[]&&Array(1).findIndex((function(){a=!1})),r({target:"Array",proto:!0,forced:a},{findIndex:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),o("findIndex")},"./node_modules/core-js/modules/es.array.find.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/export.js"),i=n("./node_modules/core-js/internals/array-iteration.js").find,o=n("./node_modules/core-js/internals/add-to-unscopables.js"),a=!0;"find"in[]&&Array(1).find((function(){a=!1})),r({target:"Array",proto:!0,forced:a},{find:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),o("find")},"./node_modules/core-js/modules/es.array.for-each.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/export.js"),i=n("./node_modules/core-js/internals/array-for-each.js");r({target:"Array",proto:!0,forced:[].forEach!=i},{forEach:i})},"./node_modules/core-js/modules/es.array.from.js":function(e,t,n){var r=n("./node_modules/core-js/internals/export.js"),i=n("./node_modules/core-js/internals/array-from.js");r({target:"Array",stat:!0,forced:!n("./node_modules/core-js/internals/check-correctness-of-iteration.js")((function(e){Array.from(e)}))},{from:i})},"./node_modules/core-js/modules/es.array.includes.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/export.js"),i=n("./node_modules/core-js/internals/array-includes.js").includes,o=n("./node_modules/core-js/internals/add-to-unscopables.js");r({target:"Array",proto:!0},{includes:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),o("includes")},"./node_modules/core-js/modules/es.array.index-of.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/export.js"),i=n("./node_modules/core-js/internals/array-includes.js").indexOf,o=n("./node_modules/core-js/internals/sloppy-array-method.js"),a=[].indexOf,s=!!a&&1/[1].indexOf(1,-0)<0,u=o("indexOf");r({target:"Array",proto:!0,forced:s||u},{indexOf:function(e){return s?a.apply(this,arguments)||0:i(this,e,arguments.length>1?arguments[1]:void 0)}})},"./node_modules/core-js/modules/es.array.iterator.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/to-indexed-object.js"),i=n("./node_modules/core-js/internals/add-to-unscopables.js"),o=n("./node_modules/core-js/internals/iterators.js"),a=n("./node_modules/core-js/internals/internal-state.js"),s=n("./node_modules/core-js/internals/define-iterator.js"),u=a.set,l=a.getterFor("Array Iterator");e.exports=s(Array,"Array",(function(e,t){u(this,{type:"Array Iterator",target:r(e),index:0,kind:t})}),(function(){var e=l(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}}),"values"),o.Arguments=o.Array,i("keys"),i("values"),i("entries")},"./node_modules/core-js/modules/es.array.join.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/export.js"),i=n("./node_modules/core-js/internals/indexed-object.js"),o=n("./node_modules/core-js/internals/to-indexed-object.js"),a=n("./node_modules/core-js/internals/sloppy-array-method.js"),s=[].join,u=i!=Object,l=a("join",",");r({target:"Array",proto:!0,forced:u||l},{join:function(e){return s.call(o(this),void 0===e?",":e)}})},"./node_modules/core-js/modules/es.array.map.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/export.js"),i=n("./node_modules/core-js/internals/array-iteration.js").map,o=n("./node_modules/core-js/internals/fails.js"),a=n("./node_modules/core-js/internals/array-method-has-species-support.js")("map"),s=a&&!o((function(){[].map.call({length:-1,0:1},(function(e){throw e}))}));r({target:"Array",proto:!0,forced:!a||!s},{map:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},"./node_modules/core-js/modules/es.array.reduce.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/export.js"),i=n("./node_modules/core-js/internals/array-reduce.js").left;r({target:"Array",proto:!0,forced:n("./node_modules/core-js/internals/sloppy-array-method.js")("reduce")},{reduce:function(e){return i(this,e,arguments.length,arguments.length>1?arguments[1]:void 0)}})},"./node_modules/core-js/modules/es.array.slice.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/export.js"),i=n("./node_modules/core-js/internals/is-object.js"),o=n("./node_modules/core-js/internals/is-array.js"),a=n("./node_modules/core-js/internals/to-absolute-index.js"),s=n("./node_modules/core-js/internals/to-length.js"),u=n("./node_modules/core-js/internals/to-indexed-object.js"),l=n("./node_modules/core-js/internals/create-property.js"),c=n("./node_modules/core-js/internals/array-method-has-species-support.js"),d=n("./node_modules/core-js/internals/well-known-symbol.js")("species"),h=[].slice,f=Math.max;r({target:"Array",proto:!0,forced:!c("slice")},{slice:function(e,t){var n,r,c,p=u(this),m=s(p.length),v=a(e,m),g=a(void 0===t?m:t,m);if(o(p)&&("function"!=typeof(n=p.constructor)||n!==Array&&!o(n.prototype)?i(n)&&null===(n=n[d])&&(n=void 0):n=void 0,n===Array||void 0===n))return h.call(p,v,g);for(r=new(void 0===n?Array:n)(f(g-v,0)),c=0;v<g;v++,c++)v in p&&l(r,c,p[v]);return r.length=c,r}})},"./node_modules/core-js/modules/es.array.some.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/export.js"),i=n("./node_modules/core-js/internals/array-iteration.js").some;r({target:"Array",proto:!0,forced:n("./node_modules/core-js/internals/sloppy-array-method.js")("some")},{some:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},"./node_modules/core-js/modules/es.array.sort.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/export.js"),i=n("./node_modules/core-js/internals/a-function.js"),o=n("./node_modules/core-js/internals/to-object.js"),a=n("./node_modules/core-js/internals/fails.js"),s=n("./node_modules/core-js/internals/sloppy-array-method.js"),u=[],l=u.sort,c=a((function(){u.sort(void 0)})),d=a((function(){u.sort(null)})),h=s("sort");r({target:"Array",proto:!0,forced:c||!d||h},{sort:function(e){return void 0===e?l.call(o(this)):l.call(o(this),i(e))}})},"./node_modules/core-js/modules/es.array.splice.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/export.js"),i=n("./node_modules/core-js/internals/to-absolute-index.js"),o=n("./node_modules/core-js/internals/to-integer.js"),a=n("./node_modules/core-js/internals/to-length.js"),s=n("./node_modules/core-js/internals/to-object.js"),u=n("./node_modules/core-js/internals/array-species-create.js"),l=n("./node_modules/core-js/internals/create-property.js"),c=n("./node_modules/core-js/internals/array-method-has-species-support.js"),d=Math.max,h=Math.min;r({target:"Array",proto:!0,forced:!c("splice")},{splice:function(e,t){var n,r,c,f,p,m,v=s(this),g=a(v.length),y=i(e,g),_=arguments.length;if(0===_?n=r=0:1===_?(n=0,r=g-y):(n=_-2,r=h(d(o(t),0),g-y)),g+n-r>9007199254740991)throw TypeError("Maximum allowed length exceeded");for(c=u(v,r),f=0;f<r;f++)(p=y+f)in v&&l(c,f,v[p]);if(c.length=r,n<r){for(f=y;f<g-r;f++)m=f+n,(p=f+r)in v?v[m]=v[p]:delete v[m];for(f=g;f>g-r+n;f--)delete v[f-1]}else if(n>r)for(f=g-r;f>y;f--)m=f+n-1,(p=f+r-1)in v?v[m]=v[p]:delete v[m];for(f=0;f<n;f++)v[f+y]=arguments[f+2];return v.length=g-r+n,c}})},"./node_modules/core-js/modules/es.date.to-string.js":function(e,t,n){var r=n("./node_modules/core-js/internals/redefine.js"),i=Date.prototype,o=i.toString,a=i.getTime;new Date(NaN)+""!="Invalid Date"&&r(i,"toString",(function(){var e=a.call(this);return e==e?o.call(this):"Invalid Date"}))},"./node_modules/core-js/modules/es.function.name.js":function(e,t,n){var r=n("./node_modules/core-js/internals/descriptors.js"),i=n("./node_modules/core-js/internals/object-define-property.js").f,o=Function.prototype,a=o.toString,s=/^\s*function ([^ (]*)/;r&&!("name"in o)&&i(o,"name",{configurable:!0,get:function(){try{return a.call(this).match(s)[1]}catch(e){return""}}})},"./node_modules/core-js/modules/es.number.constructor.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/descriptors.js"),i=n("./node_modules/core-js/internals/global.js"),o=n("./node_modules/core-js/internals/is-forced.js"),a=n("./node_modules/core-js/internals/redefine.js"),s=n("./node_modules/core-js/internals/has.js"),u=n("./node_modules/core-js/internals/classof-raw.js"),l=n("./node_modules/core-js/internals/inherit-if-required.js"),c=n("./node_modules/core-js/internals/to-primitive.js"),d=n("./node_modules/core-js/internals/fails.js"),h=n("./node_modules/core-js/internals/object-create.js"),f=n("./node_modules/core-js/internals/object-get-own-property-names.js").f,p=n("./node_modules/core-js/internals/object-get-own-property-descriptor.js").f,m=n("./node_modules/core-js/internals/object-define-property.js").f,v=n("./node_modules/core-js/internals/string-trim.js").trim,g=i.Number,y=g.prototype,_="Number"==u(h(y)),b=function(e){var t,n,r,i,o,a,s,u,l=c(e,!1);if("string"==typeof l&&l.length>2)if(43===(t=(l=v(l)).charCodeAt(0))||45===t){if(88===(n=l.charCodeAt(2))||120===n)return NaN}else if(48===t){switch(l.charCodeAt(1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+l}for(a=(o=l.slice(2)).length,s=0;s<a;s++)if((u=o.charCodeAt(s))<48||u>i)return NaN;return parseInt(o,r)}return+l};if(o("Number",!g(" 0o1")||!g("0b1")||g("+0x1"))){for(var E,w=function(e){var t=arguments.length<1?0:e,n=this;return n instanceof w&&(_?d((function(){y.valueOf.call(n)})):"Number"!=u(n))?l(new g(b(t)),n,w):b(t)},T=r?f(g):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),S=0;T.length>S;S++)s(g,E=T[S])&&!s(w,E)&&m(w,E,p(g,E));w.prototype=y,y.constructor=w,a(i,"Number",w)}},"./node_modules/core-js/modules/es.number.is-nan.js":function(e,t,n){n("./node_modules/core-js/internals/export.js")({target:"Number",stat:!0},{isNaN:function(e){return e!=e}})},"./node_modules/core-js/modules/es.number.to-fixed.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/export.js"),i=n("./node_modules/core-js/internals/to-integer.js"),o=n("./node_modules/core-js/internals/this-number-value.js"),a=n("./node_modules/core-js/internals/string-repeat.js"),s=n("./node_modules/core-js/internals/fails.js"),u=1..toFixed,l=Math.floor,c=function(e,t,n){return 0===t?n:t%2==1?c(e,t-1,n*e):c(e*e,t/2,n)};r({target:"Number",proto:!0,forced:u&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!s((function(){u.call({})}))},{toFixed:function(e){var t,n,r,s,u=o(this),d=i(e),h=[0,0,0,0,0,0],f="",p="0",m=function(e,t){for(var n=-1,r=t;++n<6;)r+=e*h[n],h[n]=r%1e7,r=l(r/1e7)},v=function(e){for(var t=6,n=0;--t>=0;)n+=h[t],h[t]=l(n/e),n=n%e*1e7},g=function(){for(var e=6,t="";--e>=0;)if(""!==t||0===e||0!==h[e]){var n=String(h[e]);t=""===t?n:t+a.call("0",7-n.length)+n}return t};if(d<0||d>20)throw RangeError("Incorrect fraction digits");if(u!=u)return"NaN";if(u<=-1e21||u>=1e21)return String(u);if(u<0&&(f="-",u=-u),u>1e-21)if(n=(t=function(e){for(var t=0,n=e;n>=4096;)t+=12,n/=4096;for(;n>=2;)t+=1,n/=2;return t}(u*c(2,69,1))-69)<0?u*c(2,-t,1):u/c(2,t,1),n*=4503599627370496,(t=52-t)>0){for(m(0,n),r=d;r>=7;)m(1e7,0),r-=7;for(m(c(10,r,1),0),r=t-1;r>=23;)v(1<<23),r-=23;v(1<<r),m(1,1),v(2),p=g()}else m(0,n),m(1<<-t,0),p=g()+a.call("0",d);return p=d>0?f+((s=p.length)<=d?"0."+a.call("0",d-s)+p:p.slice(0,s-d)+"."+p.slice(s-d)):f+p}})},"./node_modules/core-js/modules/es.object.assign.js":function(e,t,n){var r=n("./node_modules/core-js/internals/export.js"),i=n("./node_modules/core-js/internals/object-assign.js");r({target:"Object",stat:!0,forced:Object.assign!==i},{assign:i})},"./node_modules/core-js/modules/es.object.get-own-property-descriptor.js":function(e,t,n){var r=n("./node_modules/core-js/internals/export.js"),i=n("./node_modules/core-js/internals/fails.js"),o=n("./node_modules/core-js/internals/to-indexed-object.js"),a=n("./node_modules/core-js/internals/object-get-own-property-descriptor.js").f,s=n("./node_modules/core-js/internals/descriptors.js"),u=i((function(){a(1)}));r({target:"Object",stat:!0,forced:!s||u,sham:!s},{getOwnPropertyDescriptor:function(e,t){return a(o(e),t)}})},"./node_modules/core-js/modules/es.object.get-own-property-descriptors.js":function(e,t,n){var r=n("./node_modules/core-js/internals/export.js"),i=n("./node_modules/core-js/internals/descriptors.js"),o=n("./node_modules/core-js/internals/own-keys.js"),a=n("./node_modules/core-js/internals/to-indexed-object.js"),s=n("./node_modules/core-js/internals/object-get-own-property-descriptor.js"),u=n("./node_modules/core-js/internals/create-property.js");r({target:"Object",stat:!0,sham:!i},{getOwnPropertyDescriptors:function(e){for(var t,n,r=a(e),i=s.f,l=o(r),c={},d=0;l.length>d;)void 0!==(n=i(r,t=l[d++]))&&u(c,t,n);return c}})},"./node_modules/core-js/modules/es.object.get-prototype-of.js":function(e,t,n){var r=n("./node_modules/core-js/internals/export.js"),i=n("./node_modules/core-js/internals/fails.js"),o=n("./node_modules/core-js/internals/to-object.js"),a=n("./node_modules/core-js/internals/object-get-prototype-of.js"),s=n("./node_modules/core-js/internals/correct-prototype-getter.js");r({target:"Object",stat:!0,forced:i((function(){a(1)})),sham:!s},{getPrototypeOf:function(e){return a(o(e))}})},"./node_modules/core-js/modules/es.object.keys.js":function(e,t,n){var r=n("./node_modules/core-js/internals/export.js"),i=n("./node_modules/core-js/internals/to-object.js"),o=n("./node_modules/core-js/internals/object-keys.js");r({target:"Object",stat:!0,forced:n("./node_modules/core-js/internals/fails.js")((function(){o(1)}))},{keys:function(e){return o(i(e))}})},"./node_modules/core-js/modules/es.object.set-prototype-of.js":function(e,t,n){n("./node_modules/core-js/internals/export.js")({target:"Object",stat:!0},{setPrototypeOf:n("./node_modules/core-js/internals/object-set-prototype-of.js")})},"./node_modules/core-js/modules/es.object.to-string.js":function(e,t,n){var r=n("./node_modules/core-js/internals/to-string-tag-support.js"),i=n("./node_modules/core-js/internals/redefine.js"),o=n("./node_modules/core-js/internals/object-to-string.js");r||i(Object.prototype,"toString",o,{unsafe:!0})},"./node_modules/core-js/modules/es.object.values.js":function(e,t,n){var r=n("./node_modules/core-js/internals/export.js"),i=n("./node_modules/core-js/internals/object-to-array.js").values;r({target:"Object",stat:!0},{values:function(e){return i(e)}})},"./node_modules/core-js/modules/es.parse-float.js":function(e,t,n){var r=n("./node_modules/core-js/internals/export.js"),i=n("./node_modules/core-js/internals/parse-float.js");r({global:!0,forced:parseFloat!=i},{parseFloat:i})},"./node_modules/core-js/modules/es.parse-int.js":function(e,t,n){var r=n("./node_modules/core-js/internals/export.js"),i=n("./node_modules/core-js/internals/parse-int.js");r({global:!0,forced:parseInt!=i},{parseInt:i})},"./node_modules/core-js/modules/es.promise.js":function(e,t,n){"use strict";var r,i,o,a,s=n("./node_modules/core-js/internals/export.js"),u=n("./node_modules/core-js/internals/is-pure.js"),l=n("./node_modules/core-js/internals/global.js"),c=n("./node_modules/core-js/internals/get-built-in.js"),d=n("./node_modules/core-js/internals/native-promise-constructor.js"),h=n("./node_modules/core-js/internals/redefine.js"),f=n("./node_modules/core-js/internals/redefine-all.js"),p=n("./node_modules/core-js/internals/set-to-string-tag.js"),m=n("./node_modules/core-js/internals/set-species.js"),v=n("./node_modules/core-js/internals/is-object.js"),g=n("./node_modules/core-js/internals/a-function.js"),y=n("./node_modules/core-js/internals/an-instance.js"),_=n("./node_modules/core-js/internals/classof-raw.js"),b=n("./node_modules/core-js/internals/inspect-source.js"),E=n("./node_modules/core-js/internals/iterate.js"),w=n("./node_modules/core-js/internals/check-correctness-of-iteration.js"),T=n("./node_modules/core-js/internals/species-constructor.js"),S=n("./node_modules/core-js/internals/task.js").set,x=n("./node_modules/core-js/internals/microtask.js"),A=n("./node_modules/core-js/internals/promise-resolve.js"),M=n("./node_modules/core-js/internals/host-report-errors.js"),j=n("./node_modules/core-js/internals/new-promise-capability.js"),R=n("./node_modules/core-js/internals/perform.js"),L=n("./node_modules/core-js/internals/internal-state.js"),C=n("./node_modules/core-js/internals/is-forced.js"),k=n("./node_modules/core-js/internals/well-known-symbol.js"),O=n("./node_modules/core-js/internals/v8-version.js"),P=k("species"),I="Promise",D=L.get,N=L.set,B=L.getterFor(I),U=d,F=l.TypeError,V=l.document,G=l.process,H=c("fetch"),z=j.f,W=z,q="process"==_(G),K=!!(V&&V.createEvent&&l.dispatchEvent),Y=C(I,(function(){if(!(b(U)!==String(U))){if(66===O)return!0;if(!q&&"function"!=typeof PromiseRejectionEvent)return!0}if(u&&!U.prototype.finally)return!0;if(O>=51&&/native code/.test(U))return!1;var e=U.resolve(1),t=function(e){e((function(){}),(function(){}))};return(e.constructor={})[P]=t,!(e.then((function(){}))instanceof t)})),X=Y||!w((function(e){U.all(e).catch((function(){}))})),J=function(e){var t;return!(!v(e)||"function"!=typeof(t=e.then))&&t},Z=function(e,t,n){if(!t.notified){t.notified=!0;var r=t.reactions;x((function(){for(var i=t.value,o=1==t.state,a=0;r.length>a;){var s,u,l,c=r[a++],d=o?c.ok:c.fail,h=c.resolve,f=c.reject,p=c.domain;try{d?(o||(2===t.rejection&&te(e,t),t.rejection=1),!0===d?s=i:(p&&p.enter(),s=d(i),p&&(p.exit(),l=!0)),s===c.promise?f(F("Promise-chain cycle")):(u=J(s))?u.call(s,h,f):h(s)):f(i)}catch(e){p&&!l&&p.exit(),f(e)}}t.reactions=[],t.notified=!1,n&&!t.rejection&&Q(e,t)}))}},$=function(e,t,n){var r,i;K?((r=V.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),l.dispatchEvent(r)):r={promise:t,reason:n},(i=l["on"+e])?i(r):"unhandledrejection"===e&&M("Unhandled promise rejection",n)},Q=function(e,t){S.call(l,(function(){var n,r=t.value;if(ee(t)&&(n=R((function(){q?G.emit("unhandledRejection",r,e):$("unhandledrejection",e,r)})),t.rejection=q||ee(t)?2:1,n.error))throw n.value}))},ee=function(e){return 1!==e.rejection&&!e.parent},te=function(e,t){S.call(l,(function(){q?G.emit("rejectionHandled",e):$("rejectionhandled",e,t.value)}))},ne=function(e,t,n,r){return function(i){e(t,n,i,r)}},re=function(e,t,n,r){t.done||(t.done=!0,r&&(t=r),t.value=n,t.state=2,Z(e,t,!0))},ie=function(e,t,n,r){if(!t.done){t.done=!0,r&&(t=r);try{if(e===n)throw F("Promise can't be resolved itself");var i=J(n);i?x((function(){var r={done:!1};try{i.call(n,ne(ie,e,r,t),ne(re,e,r,t))}catch(n){re(e,r,n,t)}})):(t.value=n,t.state=1,Z(e,t,!1))}catch(n){re(e,{done:!1},n,t)}}};Y&&(U=function(e){y(this,U,I),g(e),r.call(this);var t=D(this);try{e(ne(ie,this,t),ne(re,this,t))}catch(e){re(this,t,e)}},(r=function(e){N(this,{type:I,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=f(U.prototype,{then:function(e,t){var n=B(this),r=z(T(this,U));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=q?G.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&Z(this,n,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),i=function(){var e=new r,t=D(e);this.promise=e,this.resolve=ne(ie,e,t),this.reject=ne(re,e,t)},j.f=z=function(e){return e===U||e===o?new i(e):W(e)},u||"function"!=typeof d||(a=d.prototype.then,h(d.prototype,"then",(function(e,t){var n=this;return new U((function(e,t){a.call(n,e,t)})).then(e,t)}),{unsafe:!0}),"function"==typeof H&&s({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return A(U,H.apply(l,arguments))}}))),s({global:!0,wrap:!0,forced:Y},{Promise:U}),p(U,I,!1,!0),m(I),o=c(I),s({target:I,stat:!0,forced:Y},{reject:function(e){var t=z(this);return t.reject.call(void 0,e),t.promise}}),s({target:I,stat:!0,forced:u||Y},{resolve:function(e){return A(u&&this===o?U:this,e)}}),s({target:I,stat:!0,forced:X},{all:function(e){var t=this,n=z(t),r=n.resolve,i=n.reject,o=R((function(){var n=g(t.resolve),o=[],a=0,s=1;E(e,(function(e){var u=a++,l=!1;o.push(void 0),s++,n.call(t,e).then((function(e){l||(l=!0,o[u]=e,--s||r(o))}),i)})),--s||r(o)}));return o.error&&i(o.value),n.promise},race:function(e){var t=this,n=z(t),r=n.reject,i=R((function(){var i=g(t.resolve);E(e,(function(e){i.call(t,e).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}})},"./node_modules/core-js/modules/es.reflect.get.js":function(e,t,n){var r=n("./node_modules/core-js/internals/export.js"),i=n("./node_modules/core-js/internals/is-object.js"),o=n("./node_modules/core-js/internals/an-object.js"),a=n("./node_modules/core-js/internals/has.js"),s=n("./node_modules/core-js/internals/object-get-own-property-descriptor.js"),u=n("./node_modules/core-js/internals/object-get-prototype-of.js");r({target:"Reflect",stat:!0},{get:function e(t,n){var r,l,c=arguments.length<3?t:arguments[2];return o(t)===c?t[n]:(r=s.f(t,n))?a(r,"value")?r.value:void 0===r.get?void 0:r.get.call(c):i(l=u(t))?e(l,n,c):void 0}})},"./node_modules/core-js/modules/es.regexp.exec.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/export.js"),i=n("./node_modules/core-js/internals/regexp-exec.js");r({target:"RegExp",proto:!0,forced:/./.exec!==i},{exec:i})},"./node_modules/core-js/modules/es.regexp.to-string.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/redefine.js"),i=n("./node_modules/core-js/internals/an-object.js"),o=n("./node_modules/core-js/internals/fails.js"),a=n("./node_modules/core-js/internals/regexp-flags.js"),s=RegExp.prototype,u=s.toString,l=o((function(){return"/a/b"!=u.call({source:"a",flags:"b"})})),c="toString"!=u.name;(l||c)&&r(RegExp.prototype,"toString",(function(){var e=i(this),t=String(e.source),n=e.flags;return"/"+t+"/"+String(void 0===n&&e instanceof RegExp&&!("flags"in s)?a.call(e):n)}),{unsafe:!0})},"./node_modules/core-js/modules/es.string.includes.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/export.js"),i=n("./node_modules/core-js/internals/not-a-regexp.js"),o=n("./node_modules/core-js/internals/require-object-coercible.js");r({target:"String",proto:!0,forced:!n("./node_modules/core-js/internals/correct-is-regexp-logic.js")("includes")},{includes:function(e){return!!~String(o(this)).indexOf(i(e),arguments.length>1?arguments[1]:void 0)}})},"./node_modules/core-js/modules/es.string.iterator.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/string-multibyte.js").charAt,i=n("./node_modules/core-js/internals/internal-state.js"),o=n("./node_modules/core-js/internals/define-iterator.js"),a=i.set,s=i.getterFor("String Iterator");o(String,"String",(function(e){a(this,{type:"String Iterator",string:String(e),index:0})}),(function(){var e,t=s(this),n=t.string,i=t.index;return i>=n.length?{value:void 0,done:!0}:(e=r(n,i),t.index+=e.length,{value:e,done:!1})}))},"./node_modules/core-js/modules/es.string.replace.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/fix-regexp-well-known-symbol-logic.js"),i=n("./node_modules/core-js/internals/an-object.js"),o=n("./node_modules/core-js/internals/to-object.js"),a=n("./node_modules/core-js/internals/to-length.js"),s=n("./node_modules/core-js/internals/to-integer.js"),u=n("./node_modules/core-js/internals/require-object-coercible.js"),l=n("./node_modules/core-js/internals/advance-string-index.js"),c=n("./node_modules/core-js/internals/regexp-exec-abstract.js"),d=Math.max,h=Math.min,f=Math.floor,p=/\$([$&'`]|\d\d?|<[^>]*>)/g,m=/\$([$&'`]|\d\d?)/g;r("replace",2,(function(e,t,n,r){return[function(n,r){var i=u(this),o=null==n?void 0:n[e];return void 0!==o?o.call(n,i,r):t.call(String(i),n,r)},function(e,o){if(r.REPLACE_KEEPS_$0||"string"==typeof o&&-1===o.indexOf("$0")){var u=n(t,e,this,o);if(u.done)return u.value}var f=i(e),p=String(this),m="function"==typeof o;m||(o=String(o));var g=f.global;if(g){var y=f.unicode;f.lastIndex=0}for(var _=[];;){var b=c(f,p);if(null===b)break;if(_.push(b),!g)break;""===String(b[0])&&(f.lastIndex=l(p,a(f.lastIndex),y))}for(var E,w="",T=0,S=0;S<_.length;S++){b=_[S];for(var x=String(b[0]),A=d(h(s(b.index),p.length),0),M=[],j=1;j<b.length;j++)M.push(void 0===(E=b[j])?E:String(E));var R=b.groups;if(m){var L=[x].concat(M,A,p);void 0!==R&&L.push(R);var C=String(o.apply(void 0,L))}else C=v(x,p,A,M,R,o);A>=T&&(w+=p.slice(T,A)+C,T=A+x.length)}return w+p.slice(T)}];function v(e,n,r,i,a,s){var u=r+e.length,l=i.length,c=m;return void 0!==a&&(a=o(a),c=p),t.call(s,c,(function(t,o){var s;switch(o.charAt(0)){case"$":return"$";case"&":return e;case"`":return n.slice(0,r);case"'":return n.slice(u);case"<":s=a[o.slice(1,-1)];break;default:var c=+o;if(0===c)return t;if(c>l){var d=f(c/10);return 0===d?t:d<=l?void 0===i[d-1]?o.charAt(1):i[d-1]+o.charAt(1):t}s=i[c-1]}return void 0===s?"":s}))}}))},"./node_modules/core-js/modules/es.string.search.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/fix-regexp-well-known-symbol-logic.js"),i=n("./node_modules/core-js/internals/an-object.js"),o=n("./node_modules/core-js/internals/require-object-coercible.js"),a=n("./node_modules/core-js/internals/same-value.js"),s=n("./node_modules/core-js/internals/regexp-exec-abstract.js");r("search",1,(function(e,t,n){return[function(t){var n=o(this),r=null==t?void 0:t[e];return void 0!==r?r.call(t,n):new RegExp(t)[e](String(n))},function(e){var r=n(t,e,this);if(r.done)return r.value;var o=i(e),u=String(this),l=o.lastIndex;a(l,0)||(o.lastIndex=0);var c=s(o,u);return a(o.lastIndex,l)||(o.lastIndex=l),null===c?-1:c.index}]}))},"./node_modules/core-js/modules/es.string.split.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/fix-regexp-well-known-symbol-logic.js"),i=n("./node_modules/core-js/internals/is-regexp.js"),o=n("./node_modules/core-js/internals/an-object.js"),a=n("./node_modules/core-js/internals/require-object-coercible.js"),s=n("./node_modules/core-js/internals/species-constructor.js"),u=n("./node_modules/core-js/internals/advance-string-index.js"),l=n("./node_modules/core-js/internals/to-length.js"),c=n("./node_modules/core-js/internals/regexp-exec-abstract.js"),d=n("./node_modules/core-js/internals/regexp-exec.js"),h=n("./node_modules/core-js/internals/fails.js"),f=[].push,p=Math.min,m=!h((function(){return!RegExp(4294967295,"y")}));r("split",2,(function(e,t,n){var r;return r="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,n){var r=String(a(this)),o=void 0===n?4294967295:n>>>0;if(0===o)return[];if(void 0===e)return[r];if(!i(e))return t.call(r,e,o);for(var s,u,l,c=[],h=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),p=0,m=new RegExp(e.source,h+"g");(s=d.call(m,r))&&!((u=m.lastIndex)>p&&(c.push(r.slice(p,s.index)),s.length>1&&s.index<r.length&&f.apply(c,s.slice(1)),l=s[0].length,p=u,c.length>=o));)m.lastIndex===s.index&&m.lastIndex++;return p===r.length?!l&&m.test("")||c.push(""):c.push(r.slice(p)),c.length>o?c.slice(0,o):c}:"0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:t.call(this,e,n)}:t,[function(t,n){var i=a(this),o=null==t?void 0:t[e];return void 0!==o?o.call(t,i,n):r.call(String(i),t,n)},function(e,i){var a=n(r,e,this,i,r!==t);if(a.done)return a.value;var d=o(e),h=String(this),f=s(d,RegExp),v=d.unicode,g=(d.ignoreCase?"i":"")+(d.multiline?"m":"")+(d.unicode?"u":"")+(m?"y":"g"),y=new f(m?d:"^(?:"+d.source+")",g),_=void 0===i?4294967295:i>>>0;if(0===_)return[];if(0===h.length)return null===c(y,h)?[h]:[];for(var b=0,E=0,w=[];E<h.length;){y.lastIndex=m?E:0;var T,S=c(y,m?h:h.slice(E));if(null===S||(T=p(l(y.lastIndex+(m?0:E)),h.length))===b)E=u(h,E,v);else{if(w.push(h.slice(b,E)),w.length===_)return w;for(var x=1;x<=S.length-1;x++)if(w.push(S[x]),w.length===_)return w;E=b=T}}return w.push(h.slice(b)),w}]}),!m)},"./node_modules/core-js/modules/es.symbol.description.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/export.js"),i=n("./node_modules/core-js/internals/descriptors.js"),o=n("./node_modules/core-js/internals/global.js"),a=n("./node_modules/core-js/internals/has.js"),s=n("./node_modules/core-js/internals/is-object.js"),u=n("./node_modules/core-js/internals/object-define-property.js").f,l=n("./node_modules/core-js/internals/copy-constructor-properties.js"),c=o.Symbol;if(i&&"function"==typeof c&&(!("description"in c.prototype)||void 0!==c().description)){var d={},h=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),t=this instanceof h?new c(e):void 0===e?c():c(e);return""===e&&(d[t]=!0),t};l(h,c);var f=h.prototype=c.prototype;f.constructor=h;var p=f.toString,m="Symbol(test)"==String(c("test")),v=/^Symbol\((.*)\)[^)]+$/;u(f,"description",{configurable:!0,get:function(){var e=s(this)?this.valueOf():this,t=p.call(e);if(a(d,e))return"";var n=m?t.slice(7,-1):t.replace(v,"$1");return""===n?void 0:n}}),r({global:!0,forced:!0},{Symbol:h})}},"./node_modules/core-js/modules/es.symbol.iterator.js":function(e,t,n){n("./node_modules/core-js/internals/define-well-known-symbol.js")("iterator")},"./node_modules/core-js/modules/es.symbol.js":function(e,t,n){"use strict";var r=n("./node_modules/core-js/internals/export.js"),i=n("./node_modules/core-js/internals/global.js"),o=n("./node_modules/core-js/internals/get-built-in.js"),a=n("./node_modules/core-js/internals/is-pure.js"),s=n("./node_modules/core-js/internals/descriptors.js"),u=n("./node_modules/core-js/internals/native-symbol.js"),l=n("./node_modules/core-js/internals/use-symbol-as-uid.js"),c=n("./node_modules/core-js/internals/fails.js"),d=n("./node_modules/core-js/internals/has.js"),h=n("./node_modules/core-js/internals/is-array.js"),f=n("./node_modules/core-js/internals/is-object.js"),p=n("./node_modules/core-js/internals/an-object.js"),m=n("./node_modules/core-js/internals/to-object.js"),v=n("./node_modules/core-js/internals/to-indexed-object.js"),g=n("./node_modules/core-js/internals/to-primitive.js"),y=n("./node_modules/core-js/internals/create-property-descriptor.js"),_=n("./node_modules/core-js/internals/object-create.js"),b=n("./node_modules/core-js/internals/object-keys.js"),E=n("./node_modules/core-js/internals/object-get-own-property-names.js"),w=n("./node_modules/core-js/internals/object-get-own-property-names-external.js"),T=n("./node_modules/core-js/internals/object-get-own-property-symbols.js"),S=n("./node_modules/core-js/internals/object-get-own-property-descriptor.js"),x=n("./node_modules/core-js/internals/object-define-property.js"),A=n("./node_modules/core-js/internals/object-property-is-enumerable.js"),M=n("./node_modules/core-js/internals/create-non-enumerable-property.js"),j=n("./node_modules/core-js/internals/redefine.js"),R=n("./node_modules/core-js/internals/shared.js"),L=n("./node_modules/core-js/internals/shared-key.js"),C=n("./node_modules/core-js/internals/hidden-keys.js"),k=n("./node_modules/core-js/internals/uid.js"),O=n("./node_modules/core-js/internals/well-known-symbol.js"),P=n("./node_modules/core-js/internals/wrapped-well-known-symbol.js"),I=n("./node_modules/core-js/internals/define-well-known-symbol.js"),D=n("./node_modules/core-js/internals/set-to-string-tag.js"),N=n("./node_modules/core-js/internals/internal-state.js"),B=n("./node_modules/core-js/internals/array-iteration.js").forEach,U=L("hidden"),F=O("toPrimitive"),V=N.set,G=N.getterFor("Symbol"),H=Object.prototype,z=i.Symbol,W=o("JSON","stringify"),q=S.f,K=x.f,Y=w.f,X=A.f,J=R("symbols"),Z=R("op-symbols"),$=R("string-to-symbol-registry"),Q=R("symbol-to-string-registry"),ee=R("wks"),te=i.QObject,ne=!te||!te.prototype||!te.prototype.findChild,re=s&&c((function(){return 7!=_(K({},"a",{get:function(){return K(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=q(H,t);r&&delete H[t],K(e,t,n),r&&e!==H&&K(H,t,r)}:K,ie=function(e,t){var n=J[e]=_(z.prototype);return V(n,{type:"Symbol",tag:e,description:t}),s||(n.description=t),n},oe=l?function(e){return"symbol"==typeof e}:function(e){return Object(e)instanceof z},ae=function(e,t,n){e===H&&ae(Z,t,n),p(e);var r=g(t,!0);return p(n),d(J,r)?(n.enumerable?(d(e,U)&&e[U][r]&&(e[U][r]=!1),n=_(n,{enumerable:y(0,!1)})):(d(e,U)||K(e,U,y(1,{})),e[U][r]=!0),re(e,r,n)):K(e,r,n)},se=function(e,t){p(e);var n=v(t),r=b(n).concat(de(n));return B(r,(function(t){s&&!ue.call(n,t)||ae(e,t,n[t])})),e},ue=function(e){var t=g(e,!0),n=X.call(this,t);return!(this===H&&d(J,t)&&!d(Z,t))&&(!(n||!d(this,t)||!d(J,t)||d(this,U)&&this[U][t])||n)},le=function(e,t){var n=v(e),r=g(t,!0);if(n!==H||!d(J,r)||d(Z,r)){var i=q(n,r);return!i||!d(J,r)||d(n,U)&&n[U][r]||(i.enumerable=!0),i}},ce=function(e){var t=Y(v(e)),n=[];return B(t,(function(e){d(J,e)||d(C,e)||n.push(e)})),n},de=function(e){var t=e===H,n=Y(t?Z:v(e)),r=[];return B(n,(function(e){!d(J,e)||t&&!d(H,e)||r.push(J[e])})),r};(u||(j((z=function(){if(this instanceof z)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,t=k(e),n=function(e){this===H&&n.call(Z,e),d(this,U)&&d(this[U],t)&&(this[U][t]=!1),re(this,t,y(1,e))};return s&&ne&&re(H,t,{configurable:!0,set:n}),ie(t,e)}).prototype,"toString",(function(){return G(this).tag})),j(z,"withoutSetter",(function(e){return ie(k(e),e)})),A.f=ue,x.f=ae,S.f=le,E.f=w.f=ce,T.f=de,P.f=function(e){return ie(O(e),e)},s&&(K(z.prototype,"description",{configurable:!0,get:function(){return G(this).description}}),a||j(H,"propertyIsEnumerable",ue,{unsafe:!0}))),r({global:!0,wrap:!0,forced:!u,sham:!u},{Symbol:z}),B(b(ee),(function(e){I(e)})),r({target:"Symbol",stat:!0,forced:!u},{for:function(e){var t=String(e);if(d($,t))return $[t];var n=z(t);return $[t]=n,Q[n]=t,n},keyFor:function(e){if(!oe(e))throw TypeError(e+" is not a symbol");if(d(Q,e))return Q[e]},useSetter:function(){ne=!0},useSimple:function(){ne=!1}}),r({target:"Object",stat:!0,forced:!u,sham:!s},{create:function(e,t){return void 0===t?_(e):se(_(e),t)},defineProperty:ae,defineProperties:se,getOwnPropertyDescriptor:le}),r({target:"Object",stat:!0,forced:!u},{getOwnPropertyNames:ce,getOwnPropertySymbols:de}),r({target:"Object",stat:!0,forced:c((function(){T.f(1)}))},{getOwnPropertySymbols:function(e){return T.f(m(e))}}),W)&&r({target:"JSON",stat:!0,forced:!u||c((function(){var e=z();return"[null]"!=W([e])||"{}"!=W({a:e})||"{}"!=W(Object(e))}))},{stringify:function(e,t,n){for(var r,i=[e],o=1;arguments.length>o;)i.push(arguments[o++]);if(r=t,(f(t)||void 0!==e)&&!oe(e))return h(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!oe(t))return t}),i[1]=t,W.apply(null,i)}});z.prototype[F]||M(z.prototype,F,z.prototype.valueOf),D(z,"Symbol"),C[U]=!0},"./node_modules/core-js/modules/web.dom-collections.for-each.js":function(e,t,n){var r=n("./node_modules/core-js/internals/global.js"),i=n("./node_modules/core-js/internals/dom-iterables.js"),o=n("./node_modules/core-js/internals/array-for-each.js"),a=n("./node_modules/core-js/internals/create-non-enumerable-property.js");for(var s in i){var u=r[s],l=u&&u.prototype;if(l&&l.forEach!==o)try{a(l,"forEach",o)}catch(e){l.forEach=o}}},"./node_modules/core-js/modules/web.dom-collections.iterator.js":function(e,t,n){var r=n("./node_modules/core-js/internals/global.js"),i=n("./node_modules/core-js/internals/dom-iterables.js"),o=n("./node_modules/core-js/modules/es.array.iterator.js"),a=n("./node_modules/core-js/internals/create-non-enumerable-property.js"),s=n("./node_modules/core-js/internals/well-known-symbol.js"),u=s("iterator"),l=s("toStringTag"),c=o.values;for(var d in i){var h=r[d],f=h&&h.prototype;if(f){if(f[u]!==c)try{a(f,u,c)}catch(e){f[u]=c}if(f[l]||a(f,l,d),i[d])for(var p in o)if(f[p]!==o[p])try{a(f,p,o[p])}catch(e){f[p]=o[p]}}}},"./node_modules/core-js/modules/web.url-search-params.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.array.iterator.js");var r=n("./node_modules/core-js/internals/export.js"),i=n("./node_modules/core-js/internals/get-built-in.js"),o=n("./node_modules/core-js/internals/native-url.js"),a=n("./node_modules/core-js/internals/redefine.js"),s=n("./node_modules/core-js/internals/redefine-all.js"),u=n("./node_modules/core-js/internals/set-to-string-tag.js"),l=n("./node_modules/core-js/internals/create-iterator-constructor.js"),c=n("./node_modules/core-js/internals/internal-state.js"),d=n("./node_modules/core-js/internals/an-instance.js"),h=n("./node_modules/core-js/internals/has.js"),f=n("./node_modules/core-js/internals/bind-context.js"),p=n("./node_modules/core-js/internals/classof.js"),m=n("./node_modules/core-js/internals/an-object.js"),v=n("./node_modules/core-js/internals/is-object.js"),g=n("./node_modules/core-js/internals/object-create.js"),y=n("./node_modules/core-js/internals/create-property-descriptor.js"),_=n("./node_modules/core-js/internals/get-iterator.js"),b=n("./node_modules/core-js/internals/get-iterator-method.js"),E=n("./node_modules/core-js/internals/well-known-symbol.js"),w=i("fetch"),T=i("Headers"),S=E("iterator"),x=c.set,A=c.getterFor("URLSearchParams"),M=c.getterFor("URLSearchParamsIterator"),j=/\+/g,R=Array(4),L=function(e){return R[e-1]||(R[e-1]=RegExp("((?:%[\\da-f]{2}){"+e+"})","gi"))},C=function(e){try{return decodeURIComponent(e)}catch(t){return e}},k=function(e){var t=e.replace(j," "),n=4;try{return decodeURIComponent(t)}catch(e){for(;n;)t=t.replace(L(n--),C);return t}},O=/[!'()~]|%20/g,P={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},I=function(e){return P[e]},D=function(e){return encodeURIComponent(e).replace(O,I)},N=function(e,t){if(t)for(var n,r,i=t.split("&"),o=0;o<i.length;)(n=i[o++]).length&&(r=n.split("="),e.push({key:k(r.shift()),value:k(r.join("="))}))},B=function(e){this.entries.length=0,N(this.entries,e)},U=function(e,t){if(e<t)throw TypeError("Not enough arguments")},F=l((function(e,t){x(this,{type:"URLSearchParamsIterator",iterator:_(A(e).entries),kind:t})}),"Iterator",(function(){var e=M(this),t=e.kind,n=e.iterator.next(),r=n.value;return n.done||(n.value="keys"===t?r.key:"values"===t?r.value:[r.key,r.value]),n})),V=function(){d(this,V,"URLSearchParams");var e,t,n,r,i,o,a,s,u,l=arguments.length>0?arguments[0]:void 0,c=this,f=[];if(x(c,{type:"URLSearchParams",entries:f,updateURL:function(){},updateSearchParams:B}),void 0!==l)if(v(l))if("function"==typeof(e=b(l)))for(n=(t=e.call(l)).next;!(r=n.call(t)).done;){if((a=(o=(i=_(m(r.value))).next).call(i)).done||(s=o.call(i)).done||!o.call(i).done)throw TypeError("Expected sequence with length 2");f.push({key:a.value+"",value:s.value+""})}else for(u in l)h(l,u)&&f.push({key:u,value:l[u]+""});else N(f,"string"==typeof l?"?"===l.charAt(0)?l.slice(1):l:l+"")},G=V.prototype;s(G,{append:function(e,t){U(arguments.length,2);var n=A(this);n.entries.push({key:e+"",value:t+""}),n.updateURL()},delete:function(e){U(arguments.length,1);for(var t=A(this),n=t.entries,r=e+"",i=0;i<n.length;)n[i].key===r?n.splice(i,1):i++;t.updateURL()},get:function(e){U(arguments.length,1);for(var t=A(this).entries,n=e+"",r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){U(arguments.length,1);for(var t=A(this).entries,n=e+"",r=[],i=0;i<t.length;i++)t[i].key===n&&r.push(t[i].value);return r},has:function(e){U(arguments.length,1);for(var t=A(this).entries,n=e+"",r=0;r<t.length;)if(t[r++].key===n)return!0;return!1},set:function(e,t){U(arguments.length,1);for(var n,r=A(this),i=r.entries,o=!1,a=e+"",s=t+"",u=0;u<i.length;u++)(n=i[u]).key===a&&(o?i.splice(u--,1):(o=!0,n.value=s));o||i.push({key:a,value:s}),r.updateURL()},sort:function(){var e,t,n,r=A(this),i=r.entries,o=i.slice();for(i.length=0,n=0;n<o.length;n++){for(e=o[n],t=0;t<n;t++)if(i[t].key>e.key){i.splice(t,0,e);break}t===n&&i.push(e)}r.updateURL()},forEach:function(e){for(var t,n=A(this).entries,r=f(e,arguments.length>1?arguments[1]:void 0,3),i=0;i<n.length;)r((t=n[i++]).value,t.key,this)},keys:function(){return new F(this,"keys")},values:function(){return new F(this,"values")},entries:function(){return new F(this,"entries")}},{enumerable:!0}),a(G,S,G.entries),a(G,"toString",(function(){for(var e,t=A(this).entries,n=[],r=0;r<t.length;)e=t[r++],n.push(D(e.key)+"="+D(e.value));return n.join("&")}),{enumerable:!0}),u(V,"URLSearchParams"),r({global:!0,forced:!o},{URLSearchParams:V}),o||"function"!=typeof w||"function"!=typeof T||r({global:!0,enumerable:!0,forced:!0},{fetch:function(e){var t,n,r,i=[e];return arguments.length>1&&(t=arguments[1],v(t)&&(n=t.body,"URLSearchParams"===p(n)&&((r=t.headers?new T(t.headers):new T).has("content-type")||r.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),t=g(t,{body:y(0,String(n)),headers:y(0,r)}))),i.push(t)),w.apply(this,i)}}),e.exports={URLSearchParams:V,getState:A}},"./node_modules/core-js/modules/web.url.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.string.iterator.js");var r,i=n("./node_modules/core-js/internals/export.js"),o=n("./node_modules/core-js/internals/descriptors.js"),a=n("./node_modules/core-js/internals/native-url.js"),s=n("./node_modules/core-js/internals/global.js"),u=n("./node_modules/core-js/internals/object-define-properties.js"),l=n("./node_modules/core-js/internals/redefine.js"),c=n("./node_modules/core-js/internals/an-instance.js"),d=n("./node_modules/core-js/internals/has.js"),h=n("./node_modules/core-js/internals/object-assign.js"),f=n("./node_modules/core-js/internals/array-from.js"),p=n("./node_modules/core-js/internals/string-multibyte.js").codeAt,m=n("./node_modules/core-js/internals/punycode-to-ascii.js"),v=n("./node_modules/core-js/internals/set-to-string-tag.js"),g=n("./node_modules/core-js/modules/web.url-search-params.js"),y=n("./node_modules/core-js/internals/internal-state.js"),_=s.URL,b=g.URLSearchParams,E=g.getState,w=y.set,T=y.getterFor("URL"),S=Math.floor,x=Math.pow,A=/[A-Za-z]/,M=/[\d+\-.A-Za-z]/,j=/\d/,R=/^(0x|0X)/,L=/^[0-7]+$/,C=/^\d+$/,k=/^[\dA-Fa-f]+$/,O=/[\u0000\u0009\u000A\u000D #%/:?@[\\]]/,P=/[\u0000\u0009\u000A\u000D #/:?@[\\]]/,I=/^[\u0000-\u001F ]+|[\u0000-\u001F ]+$/g,D=/[\u0009\u000A\u000D]/g,N=function(e,t){var n,r,i;if("["==t.charAt(0)){if("]"!=t.charAt(t.length-1))return"Invalid host";if(!(n=U(t.slice(1,-1))))return"Invalid host";e.host=n}else if(K(e)){if(t=m(t),O.test(t))return"Invalid host";if(null===(n=B(t)))return"Invalid host";e.host=n}else{if(P.test(t))return"Invalid host";for(n="",r=f(t),i=0;i<r.length;i++)n+=W(r[i],V);e.host=n}},B=function(e){var t,n,r,i,o,a,s,u=e.split(".");if(u.length&&""==u[u.length-1]&&u.pop(),(t=u.length)>4)return e;for(n=[],r=0;r<t;r++){if(""==(i=u[r]))return e;if(o=10,i.length>1&&"0"==i.charAt(0)&&(o=R.test(i)?16:8,i=i.slice(8==o?1:2)),""===i)a=0;else{if(!(10==o?C:8==o?L:k).test(i))return e;a=parseInt(i,o)}n.push(a)}for(r=0;r<t;r++)if(a=n[r],r==t-1){if(a>=x(256,5-t))return null}else if(a>255)return null;for(s=n.pop(),r=0;r<n.length;r++)s+=n[r]*x(256,3-r);return s},U=function(e){var t,n,r,i,o,a,s,u=[0,0,0,0,0,0,0,0],l=0,c=null,d=0,h=function(){return e.charAt(d)};if(":"==h()){if(":"!=e.charAt(1))return;d+=2,c=++l}for(;h();){if(8==l)return;if(":"!=h()){for(t=n=0;n<4&&k.test(h());)t=16*t+parseInt(h(),16),d++,n++;if("."==h()){if(0==n)return;if(d-=n,l>6)return;for(r=0;h();){if(i=null,r>0){if(!("."==h()&&r<4))return;d++}if(!j.test(h()))return;for(;j.test(h());){if(o=parseInt(h(),10),null===i)i=o;else{if(0==i)return;i=10*i+o}if(i>255)return;d++}u[l]=256*u[l]+i,2!=++r&&4!=r||l++}if(4!=r)return;break}if(":"==h()){if(d++,!h())return}else if(h())return;u[l++]=t}else{if(null!==c)return;d++,c=++l}}if(null!==c)for(a=l-c,l=7;0!=l&&a>0;)s=u[l],u[l--]=u[c+a-1],u[c+--a]=s;else if(8!=l)return;return u},F=function(e){var t,n,r,i;if("number"==typeof e){for(t=[],n=0;n<4;n++)t.unshift(e%256),e=S(e/256);return t.join(".")}if("object"==typeof e){for(t="",r=function(e){for(var t=null,n=1,r=null,i=0,o=0;o<8;o++)0!==e[o]?(i>n&&(t=r,n=i),r=null,i=0):(null===r&&(r=o),++i);return i>n&&(t=r,n=i),t}(e),n=0;n<8;n++)i&&0===e[n]||(i&&(i=!1),r===n?(t+=n?":":"::",i=!0):(t+=e[n].toString(16),n<7&&(t+=":")));return"["+t+"]"}return e},V={},G=h({},V,{" ":1,'"':1,"<":1,">":1,"`":1}),H=h({},G,{"#":1,"?":1,"{":1,"}":1}),z=h({},H,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),W=function(e,t){var n=p(e,0);return n>32&&n<127&&!d(t,e)?e:encodeURIComponent(e)},q={ftp:21,file:null,http:80,https:443,ws:80,wss:443},K=function(e){return d(q,e.scheme)},Y=function(e){return""!=e.username||""!=e.password},X=function(e){return!e.host||e.cannotBeABaseURL||"file"==e.scheme},J=function(e,t){var n;return 2==e.length&&A.test(e.charAt(0))&&(":"==(n=e.charAt(1))||!t&&"|"==n)},Z=function(e){var t;return e.length>1&&J(e.slice(0,2))&&(2==e.length||"/"===(t=e.charAt(2))||"\\"===t||"?"===t||"#"===t)},$=function(e){var t=e.path,n=t.length;!n||"file"==e.scheme&&1==n&&J(t[0],!0)||t.pop()},Q=function(e){return"."===e||"%2e"===e.toLowerCase()},ee={},te={},ne={},re={},ie={},oe={},ae={},se={},ue={},le={},ce={},de={},he={},fe={},pe={},me={},ve={},ge={},ye={},_e={},be={},Ee=function(e,t,n,i){var o,a,s,u,l,c=n||ee,h=0,p="",m=!1,v=!1,g=!1;for(n||(e.scheme="",e.username="",e.password="",e.host=null,e.port=null,e.path=[],e.query=null,e.fragment=null,e.cannotBeABaseURL=!1,t=t.replace(I,"")),t=t.replace(D,""),o=f(t);h<=o.length;){switch(a=o[h],c){case ee:if(!a||!A.test(a)){if(n)return"Invalid scheme";c=ne;continue}p+=a.toLowerCase(),c=te;break;case te:if(a&&(M.test(a)||"+"==a||"-"==a||"."==a))p+=a.toLowerCase();else{if(":"!=a){if(n)return"Invalid scheme";p="",c=ne,h=0;continue}if(n&&(K(e)!=d(q,p)||"file"==p&&(Y(e)||null!==e.port)||"file"==e.scheme&&!e.host))return;if(e.scheme=p,n)return void(K(e)&&q[e.scheme]==e.port&&(e.port=null));p="","file"==e.scheme?c=fe:K(e)&&i&&i.scheme==e.scheme?c=re:K(e)?c=se:"/"==o[h+1]?(c=ie,h++):(e.cannotBeABaseURL=!0,e.path.push(""),c=ye)}break;case ne:if(!i||i.cannotBeABaseURL&&"#"!=a)return"Invalid scheme";if(i.cannotBeABaseURL&&"#"==a){e.scheme=i.scheme,e.path=i.path.slice(),e.query=i.query,e.fragment="",e.cannotBeABaseURL=!0,c=be;break}c="file"==i.scheme?fe:oe;continue;case re:if("/"!=a||"/"!=o[h+1]){c=oe;continue}c=ue,h++;break;case ie:if("/"==a){c=le;break}c=ge;continue;case oe:if(e.scheme=i.scheme,a==r)e.username=i.username,e.password=i.password,e.host=i.host,e.port=i.port,e.path=i.path.slice(),e.query=i.query;else if("/"==a||"\\"==a&&K(e))c=ae;else if("?"==a)e.username=i.username,e.password=i.password,e.host=i.host,e.port=i.port,e.path=i.path.slice(),e.query="",c=_e;else{if("#"!=a){e.username=i.username,e.password=i.password,e.host=i.host,e.port=i.port,e.path=i.path.slice(),e.path.pop(),c=ge;continue}e.username=i.username,e.password=i.password,e.host=i.host,e.port=i.port,e.path=i.path.slice(),e.query=i.query,e.fragment="",c=be}break;case ae:if(!K(e)||"/"!=a&&"\\"!=a){if("/"!=a){e.username=i.username,e.password=i.password,e.host=i.host,e.port=i.port,c=ge;continue}c=le}else c=ue;break;case se:if(c=ue,"/"!=a||"/"!=p.charAt(h+1))continue;h++;break;case ue:if("/"!=a&&"\\"!=a){c=le;continue}break;case le:if("@"==a){m&&(p="%40"+p),m=!0,s=f(p);for(var y=0;y<s.length;y++){var _=s[y];if(":"!=_||g){var b=W(_,z);g?e.password+=b:e.username+=b}else g=!0}p=""}else if(a==r||"/"==a||"?"==a||"#"==a||"\\"==a&&K(e)){if(m&&""==p)return"Invalid authority";h-=f(p).length+1,p="",c=ce}else p+=a;break;case ce:case de:if(n&&"file"==e.scheme){c=me;continue}if(":"!=a||v){if(a==r||"/"==a||"?"==a||"#"==a||"\\"==a&&K(e)){if(K(e)&&""==p)return"Invalid host";if(n&&""==p&&(Y(e)||null!==e.port))return;if(u=N(e,p))return u;if(p="",c=ve,n)return;continue}"["==a?v=!0:"]"==a&&(v=!1),p+=a}else{if(""==p)return"Invalid host";if(u=N(e,p))return u;if(p="",c=he,n==de)return}break;case he:if(!j.test(a)){if(a==r||"/"==a||"?"==a||"#"==a||"\\"==a&&K(e)||n){if(""!=p){var E=parseInt(p,10);if(E>65535)return"Invalid port";e.port=K(e)&&E===q[e.scheme]?null:E,p=""}if(n)return;c=ve;continue}return"Invalid port"}p+=a;break;case fe:if(e.scheme="file","/"==a||"\\"==a)c=pe;else{if(!i||"file"!=i.scheme){c=ge;continue}if(a==r)e.host=i.host,e.path=i.path.slice(),e.query=i.query;else if("?"==a)e.host=i.host,e.path=i.path.slice(),e.query="",c=_e;else{if("#"!=a){Z(o.slice(h).join(""))||(e.host=i.host,e.path=i.path.slice(),$(e)),c=ge;continue}e.host=i.host,e.path=i.path.slice(),e.query=i.query,e.fragment="",c=be}}break;case pe:if("/"==a||"\\"==a){c=me;break}i&&"file"==i.scheme&&!Z(o.slice(h).join(""))&&(J(i.path[0],!0)?e.path.push(i.path[0]):e.host=i.host),c=ge;continue;case me:if(a==r||"/"==a||"\\"==a||"?"==a||"#"==a){if(!n&&J(p))c=ge;else if(""==p){if(e.host="",n)return;c=ve}else{if(u=N(e,p))return u;if("localhost"==e.host&&(e.host=""),n)return;p="",c=ve}continue}p+=a;break;case ve:if(K(e)){if(c=ge,"/"!=a&&"\\"!=a)continue}else if(n||"?"!=a)if(n||"#"!=a){if(a!=r&&(c=ge,"/"!=a))continue}else e.fragment="",c=be;else e.query="",c=_e;break;case ge:if(a==r||"/"==a||"\\"==a&&K(e)||!n&&("?"==a||"#"==a)){if(".."===(l=(l=p).toLowerCase())||"%2e."===l||".%2e"===l||"%2e%2e"===l?($(e),"/"==a||"\\"==a&&K(e)||e.path.push("")):Q(p)?"/"==a||"\\"==a&&K(e)||e.path.push(""):("file"==e.scheme&&!e.path.length&&J(p)&&(e.host&&(e.host=""),p=p.charAt(0)+":"),e.path.push(p)),p="","file"==e.scheme&&(a==r||"?"==a||"#"==a))for(;e.path.length>1&&""===e.path[0];)e.path.shift();"?"==a?(e.query="",c=_e):"#"==a&&(e.fragment="",c=be)}else p+=W(a,H);break;case ye:"?"==a?(e.query="",c=_e):"#"==a?(e.fragment="",c=be):a!=r&&(e.path[0]+=W(a,V));break;case _e:n||"#"!=a?a!=r&&("'"==a&&K(e)?e.query+="%27":e.query+="#"==a?"%23":W(a,V)):(e.fragment="",c=be);break;case be:a!=r&&(e.fragment+=W(a,G))}h++}},we=function(e){var t,n,r=c(this,we,"URL"),i=arguments.length>1?arguments[1]:void 0,a=String(e),s=w(r,{type:"URL"});if(void 0!==i)if(i instanceof we)t=T(i);else if(n=Ee(t={},String(i)))throw TypeError(n);if(n=Ee(s,a,null,t))throw TypeError(n);var u=s.searchParams=new b,l=E(u);l.updateSearchParams(s.query),l.updateURL=function(){s.query=String(u)||null},o||(r.href=Se.call(r),r.origin=xe.call(r),r.protocol=Ae.call(r),r.username=Me.call(r),r.password=je.call(r),r.host=Re.call(r),r.hostname=Le.call(r),r.port=Ce.call(r),r.pathname=ke.call(r),r.search=Oe.call(r),r.searchParams=Pe.call(r),r.hash=Ie.call(r))},Te=we.prototype,Se=function(){var e=T(this),t=e.scheme,n=e.username,r=e.password,i=e.host,o=e.port,a=e.path,s=e.query,u=e.fragment,l=t+":";return null!==i?(l+="//",Y(e)&&(l+=n+(r?":"+r:"")+"@"),l+=F(i),null!==o&&(l+=":"+o)):"file"==t&&(l+="//"),l+=e.cannotBeABaseURL?a[0]:a.length?"/"+a.join("/"):"",null!==s&&(l+="?"+s),null!==u&&(l+="#"+u),l},xe=function(){var e=T(this),t=e.scheme,n=e.port;if("blob"==t)try{return new URL(t.path[0]).origin}catch(e){return"null"}return"file"!=t&&K(e)?t+"://"+F(e.host)+(null!==n?":"+n:""):"null"},Ae=function(){return T(this).scheme+":"},Me=function(){return T(this).username},je=function(){return T(this).password},Re=function(){var e=T(this),t=e.host,n=e.port;return null===t?"":null===n?F(t):F(t)+":"+n},Le=function(){var e=T(this).host;return null===e?"":F(e)},Ce=function(){var e=T(this).port;return null===e?"":String(e)},ke=function(){var e=T(this),t=e.path;return e.cannotBeABaseURL?t[0]:t.length?"/"+t.join("/"):""},Oe=function(){var e=T(this).query;return e?"?"+e:""},Pe=function(){return T(this).searchParams},Ie=function(){var e=T(this).fragment;return e?"#"+e:""},De=function(e,t){return{get:e,set:t,configurable:!0,enumerable:!0}};if(o&&u(Te,{href:De(Se,(function(e){var t=T(this),n=String(e),r=Ee(t,n);if(r)throw TypeError(r);E(t.searchParams).updateSearchParams(t.query)})),origin:De(xe),protocol:De(Ae,(function(e){var t=T(this);Ee(t,String(e)+":",ee)})),username:De(Me,(function(e){var t=T(this),n=f(String(e));if(!X(t)){t.username="";for(var r=0;r<n.length;r++)t.username+=W(n[r],z)}})),password:De(je,(function(e){var t=T(this),n=f(String(e));if(!X(t)){t.password="";for(var r=0;r<n.length;r++)t.password+=W(n[r],z)}})),host:De(Re,(function(e){var t=T(this);t.cannotBeABaseURL||Ee(t,String(e),ce)})),hostname:De(Le,(function(e){var t=T(this);t.cannotBeABaseURL||Ee(t,String(e),de)})),port:De(Ce,(function(e){var t=T(this);X(t)||(""==(e=String(e))?t.port=null:Ee(t,e,he))})),pathname:De(ke,(function(e){var t=T(this);t.cannotBeABaseURL||(t.path=[],Ee(t,e+"",ve))})),search:De(Oe,(function(e){var t=T(this);""==(e=String(e))?t.query=null:("?"==e.charAt(0)&&(e=e.slice(1)),t.query="",Ee(t,e,_e)),E(t.searchParams).updateSearchParams(t.query)})),searchParams:De(Pe),hash:De(Ie,(function(e){var t=T(this);""!=(e=String(e))?("#"==e.charAt(0)&&(e=e.slice(1)),t.fragment="",Ee(t,e,be)):t.fragment=null}))}),l(Te,"toJSON",(function(){return Se.call(this)}),{enumerable:!0}),l(Te,"toString",(function(){return Se.call(this)}),{enumerable:!0}),_){var Ne=_.createObjectURL,Be=_.revokeObjectURL;Ne&&l(we,"createObjectURL",(function(e){return Ne.apply(_,arguments)})),Be&&l(we,"revokeObjectURL",(function(e){return Be.apply(_,arguments)}))}v(we,"URL"),i({global:!0,forced:!a,sham:!o},{URL:we})},"./node_modules/events/events.js":function(e,t,n){"use strict";var r,i="object"==typeof Reflect?Reflect:null,o=i&&"function"==typeof i.apply?i.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};r=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var u=10;function l(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function c(e,t,n,r){var i,o,a,s;if("function"!=typeof n)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n);if(void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]),void 0===a)a=o[t]=n,++e._eventsCount;else if("function"==typeof a?a=o[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),(i=l(e))>0&&a.length>i&&!a.warned){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=a.length,s=u,console&&console.warn&&console.warn(s)}return e}function d(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,o(this.listener,this.target,e))}function h(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=d.bind(r);return i.listener=n,r.wrapFn=i,i}function f(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):m(i,i.length)}function p(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function m(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");u=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return l(this)},s.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var u=i[e];if(void 0===u)return!1;if("function"==typeof u)o(u,this,t);else{var l=u.length,c=m(u,l);for(n=0;n<l;++n)o(c[n],this,t)}return!0},s.prototype.addListener=function(e,t){return c(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return c(this,e,t,!0)},s.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.on(e,h(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.prependListener(e,h(this,e,t)),this},s.prototype.removeListener=function(e,t){var n,r,i,o,a;if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);if(void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},s.prototype.listeners=function(e){return f(this,e,!0)},s.prototype.rawListeners=function(e){return f(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},s.prototype.listenerCount=p,s.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},"./node_modules/hls.js/dist/hls.js":function(e,t,n){var r;"undefined"!=typeof window&&(r=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/dist/",n(n.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(e,t,n){"use strict";var r=Object.prototype.hasOwnProperty,i="~";function o(){}function a(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function s(e,t,n,r,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new a(n,r||e,o),u=i?i+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],s]:e._events[u].push(s):(e._events[u]=s,e._eventsCount++),e}function u(e,t){0==--e._eventsCount?e._events=new o:delete e._events[t]}function l(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(i=!1)),l.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)r.call(e,t)&&n.push(i?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},l.prototype.listeners=function(e){var t=i?i+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,o=n.length,a=new Array(o);r<o;r++)a[r]=n[r].fn;return a},l.prototype.listenerCount=function(e){var t=i?i+e:e,n=this._events[t];return n?n.fn?1:n.length:0},l.prototype.emit=function(e,t,n,r,o,a){var s=i?i+e:e;if(!this._events[s])return!1;var u,l,c=this._events[s],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,r),!0;case 5:return c.fn.call(c.context,t,n,r,o),!0;case 6:return c.fn.call(c.context,t,n,r,o,a),!0}for(l=1,u=new Array(d-1);l<d;l++)u[l-1]=arguments[l];c.fn.apply(c.context,u)}else{var h,f=c.length;for(l=0;l<f;l++)switch(c[l].once&&this.removeListener(e,c[l].fn,void 0,!0),d){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,t);break;case 3:c[l].fn.call(c[l].context,t,n);break;case 4:c[l].fn.call(c[l].context,t,n,r);break;default:if(!u)for(h=1,u=new Array(d-1);h<d;h++)u[h-1]=arguments[h];c[l].fn.apply(c[l].context,u)}}return!0},l.prototype.on=function(e,t,n){return s(this,e,t,n,!1)},l.prototype.once=function(e,t,n){return s(this,e,t,n,!0)},l.prototype.removeListener=function(e,t,n,r){var o=i?i+e:e;if(!this._events[o])return this;if(!t)return u(this,o),this;var a=this._events[o];if(a.fn)a.fn!==t||r&&!a.once||n&&a.context!==n||u(this,o);else{for(var s=0,l=[],c=a.length;s<c;s++)(a[s].fn!==t||r&&!a[s].once||n&&a[s].context!==n)&&l.push(a[s]);l.length?this._events[o]=1===l.length?l[0]:l:u(this,o)}return this},l.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&u(this,t)):(this._events=new o,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=i,l.EventEmitter=l,e.exports=l},"./node_modules/url-toolkit/src/url-toolkit.js":function(e,t,n){var r,i,o,a,s;r=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/\?#]*\/)*.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,i=/^([^\/?#]*)(.*)$/,o=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,s={buildAbsoluteURL:function(e,t,n){if(n=n||{},e=e.trim(),!(t=t.trim())){if(!n.alwaysNormalize)return e;var r=s.parseURL(e);if(!r)throw new Error("Error trying to parse base URL.");return r.path=s.normalizePath(r.path),s.buildURLFromParts(r)}var o=s.parseURL(t);if(!o)throw new Error("Error trying to parse relative URL.");if(o.scheme)return n.alwaysNormalize?(o.path=s.normalizePath(o.path),s.buildURLFromParts(o)):t;var a=s.parseURL(e);if(!a)throw new Error("Error trying to parse base URL.");if(!a.netLoc&&a.path&&"/"!==a.path[0]){var u=i.exec(a.path);a.netLoc=u[1],a.path=u[2]}a.netLoc&&!a.path&&(a.path="/");var l={scheme:a.scheme,netLoc:o.netLoc,path:null,params:o.params,query:o.query,fragment:o.fragment};if(!o.netLoc&&(l.netLoc=a.netLoc,"/"!==o.path[0]))if(o.path){var c=a.path,d=c.substring(0,c.lastIndexOf("/")+1)+o.path;l.path=s.normalizePath(d)}else l.path=a.path,o.params||(l.params=a.params,o.query||(l.query=a.query));return null===l.path&&(l.path=n.alwaysNormalize?s.normalizePath(o.path):o.path),s.buildURLFromParts(l)},parseURL:function(e){var t=r.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(o,"");e.length!==(e=e.replace(a,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},e.exports=s},"./node_modules/webworkify-webpack/index.js":function(e,t,n){function r(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n.oe=function(e){throw console.error(e),e};var r=n(n.s=ENTRY_MODULE);return r.default||r}function i(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function o(e,t,r){var o={};o[r]=[];var a=t.toString(),s=a.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!s)return o;for(var u,l=s[1],c=new RegExp("(\\\\n|\\W)"+i(l)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");u=c.exec(a);)"dll-reference"!==u[3]&&o[r].push(u[3]);for(c=new RegExp("\\("+i(l)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");u=c.exec(a);)e[u[2]]||(o[r].push(u[1]),e[u[2]]=n(u[1]).m),o[u[2]]=o[u[2]]||[],o[u[2]].push(u[4]);for(var d,h=Object.keys(o),f=0;f<h.length;f++)for(var p=0;p<o[h[f]].length;p++)d=o[h[f]][p],isNaN(1*d)||(o[h[f]][p]=1*o[h[f]][p]);return o}function a(e){return Object.keys(e).reduce((function(t,n){return t||e[n].length>0}),!1)}e.exports=function(e,t){t=t||{};var i={main:n.m},s=t.all?{main:Object.keys(i.main)}:function(e,t){for(var n={main:[t]},r={main:[]},i={main:{}};a(n);)for(var s=Object.keys(n),u=0;u<s.length;u++){var l=s[u],c=n[l].pop();if(i[l]=i[l]||{},!i[l][c]&&e[l][c]){i[l][c]=!0,r[l]=r[l]||[],r[l].push(c);for(var d=o(e,e[l][c],l),h=Object.keys(d),f=0;f<h.length;f++)n[h[f]]=n[h[f]]||[],n[h[f]]=n[h[f]].concat(d[h[f]])}}return r}(i,e),u="";Object.keys(s).filter((function(e){return"main"!==e})).forEach((function(e){for(var t=0;s[e][t];)t++;s[e].push(t),i[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",u=u+"var "+e+" = ("+r.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+s[e].map((function(t){return JSON.stringify(t)+": "+i[e][t].toString()})).join(",")+"});\n"})),u=u+"new (("+r.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+s.main.map((function(e){return JSON.stringify(e)+": "+i.main[e].toString()})).join(",")+"}))(self);";var l=new window.Blob([u],{type:"text/javascript"});if(t.bare)return l;var c=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(l),d=new window.Worker(c);return d.objectURL=c,d}},"./src/crypt/decrypter.js":function(e,t,n){"use strict";n.r(t);var r=function(){function e(e,t){this.subtle=e,this.aesIV=t}return e.prototype.decrypt=function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)},e}(),i=function(){function e(e,t){this.subtle=e,this.key=t}return e.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},e}(),o=function(){function e(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}var t=e.prototype;return t.uint8ArrayToUint32Array_=function(e){for(var t=new DataView(e),n=new Uint32Array(4),r=0;r<4;r++)n[r]=t.getUint32(4*r);return n},t.initTable=function(){var e=this.sBox,t=this.invSBox,n=this.subMix,r=n[0],i=n[1],o=n[2],a=n[3],s=this.invSubMix,u=s[0],l=s[1],c=s[2],d=s[3],h=new Uint32Array(256),f=0,p=0,m=0;for(m=0;m<256;m++)h[m]=m<128?m<<1:m<<1^283;for(m=0;m<256;m++){var v=p^p<<1^p<<2^p<<3^p<<4;v=v>>>8^255&v^99,e[f]=v,t[v]=f;var g=h[f],y=h[g],_=h[y],b=257*h[v]^16843008*v;r[f]=b<<24|b>>>8,i[f]=b<<16|b>>>16,o[f]=b<<8|b>>>24,a[f]=b,b=16843009*_^65537*y^257*g^16843008*f,u[v]=b<<24|b>>>8,l[v]=b<<16|b>>>16,c[v]=b<<8|b>>>24,d[v]=b,f?(f=g^h[h[h[_^g]]],p^=h[h[p]]):f=p=1}},t.expandKey=function(e){for(var t=this.uint8ArrayToUint32Array_(e),n=!0,r=0;r<t.length&&n;)n=t[r]===this.key[r],r++;if(!n){this.key=t;var i=this.keySize=t.length;if(4!==i&&6!==i&&8!==i)throw new Error("Invalid aes key size="+i);var o,a,s,u,l=this.ksRows=4*(i+6+1),c=this.keySchedule=new Uint32Array(l),d=this.invKeySchedule=new Uint32Array(l),h=this.sBox,f=this.rcon,p=this.invSubMix,m=p[0],v=p[1],g=p[2],y=p[3];for(o=0;o<l;o++)o<i?s=c[o]=t[o]:(u=s,o%i==0?(u=h[(u=u<<8|u>>>24)>>>24]<<24|h[u>>>16&255]<<16|h[u>>>8&255]<<8|h[255&u],u^=f[o/i|0]<<24):i>6&&o%i==4&&(u=h[u>>>24]<<24|h[u>>>16&255]<<16|h[u>>>8&255]<<8|h[255&u]),c[o]=s=(c[o-i]^u)>>>0);for(a=0;a<l;a++)o=l-a,u=3&a?c[o]:c[o-4],d[a]=a<4||o<=4?u:m[h[u>>>24]]^v[h[u>>>16&255]]^g[h[u>>>8&255]]^y[h[255&u]],d[a]=d[a]>>>0}},t.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},t.decrypt=function(e,t,n,r){for(var i,o,a,s,u,l,c,d,h,f,p,m,v,g,y,_,b,E=this.keySize+6,w=this.invKeySchedule,T=this.invSBox,S=this.invSubMix,x=S[0],A=S[1],M=S[2],j=S[3],R=this.uint8ArrayToUint32Array_(n),L=R[0],C=R[1],k=R[2],O=R[3],P=new Int32Array(e),I=new Int32Array(P.length),D=this.networkToHostOrderSwap;t<P.length;){for(h=D(P[t]),f=D(P[t+1]),p=D(P[t+2]),m=D(P[t+3]),u=h^w[0],l=m^w[1],c=p^w[2],d=f^w[3],v=4,g=1;g<E;g++)i=x[u>>>24]^A[l>>16&255]^M[c>>8&255]^j[255&d]^w[v],o=x[l>>>24]^A[c>>16&255]^M[d>>8&255]^j[255&u]^w[v+1],a=x[c>>>24]^A[d>>16&255]^M[u>>8&255]^j[255&l]^w[v+2],s=x[d>>>24]^A[u>>16&255]^M[l>>8&255]^j[255&c]^w[v+3],u=i,l=o,c=a,d=s,v+=4;i=T[u>>>24]<<24^T[l>>16&255]<<16^T[c>>8&255]<<8^T[255&d]^w[v],o=T[l>>>24]<<24^T[c>>16&255]<<16^T[d>>8&255]<<8^T[255&u]^w[v+1],a=T[c>>>24]<<24^T[d>>16&255]<<16^T[u>>8&255]<<8^T[255&l]^w[v+2],s=T[d>>>24]<<24^T[u>>16&255]<<16^T[l>>8&255]<<8^T[255&c]^w[v+3],v+=3,I[t]=D(i^L),I[t+1]=D(s^C),I[t+2]=D(a^k),I[t+3]=D(o^O),L=h,C=f,k=p,O=m,t+=4}return r?(y=I.buffer,_=y.byteLength,(b=_&&new DataView(y).getUint8(_-1))?y.slice(0,_-b):y):I.buffer},t.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},e}(),a=n("./src/errors.ts"),s=n("./src/utils/logger.js"),u=n("./src/events.js"),l=n("./src/utils/get-self-scope.js"),c=Object(l.getSelfScope)(),d=function(){function e(e,t,n){var r=(void 0===n?{}:n).removePKCS7Padding,i=void 0===r||r;if(this.logEnabled=!0,this.observer=e,this.config=t,this.removePKCS7Padding=i,i)try{var o=c.crypto;o&&(this.subtle=o.subtle||o.webkitSubtle)}catch(e){}this.disableWebCrypto=!this.subtle}var t=e.prototype;return t.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},t.decrypt=function(e,t,n,a){var u=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(s.logger.log("JS AES decrypt"),this.logEnabled=!1);var l=this.decryptor;l||(this.decryptor=l=new o),l.expandKey(t),a(l.decrypt(e,0,n,this.removePKCS7Padding))}else{this.logEnabled&&(s.logger.log("WebCrypto AES decrypt"),this.logEnabled=!1);var c=this.subtle;this.key!==t&&(this.key=t,this.fastAesKey=new i(c,t)),this.fastAesKey.expandKey().then((function(i){new r(c,n).decrypt(e,i).catch((function(r){u.onWebCryptoError(r,e,t,n,a)})).then((function(e){a(e)}))})).catch((function(r){u.onWebCryptoError(r,e,t,n,a)}))}},t.onWebCryptoError=function(e,t,n,r,i){this.config.enableSoftwareAES?(s.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(t,n,r,i)):(s.logger.error("decrypting error : "+e.message),this.observer.trigger(u.default.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:e.message}))},t.destroy=function(){var e=this.decryptor;e&&(e.destroy(),this.decryptor=void 0)},e}();t.default=d},"./src/demux/demuxer-inline.js":function(e,t,n){"use strict";n.r(t);var r=n("./src/events.js"),i=n("./src/errors.ts"),o=n("./src/crypt/decrypter.js"),a=n("./src/polyfills/number-isFinite.js"),s=n("./src/utils/logger.js"),u=n("./src/utils/get-self-scope.js");function l(e,t){return 255===e[t]&&240==(246&e[t+1])}function c(e,t){return 1&e[t+1]?7:9}function d(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function h(e,t){return!!(t+1<e.length&&l(e,t))}function f(e,t){if(h(e,t)){var n=c(e,t);t+5<e.length&&(n=d(e,t));var r=t+n;if(r===e.length||r+1<e.length&&l(e,r))return!0}return!1}function p(e,t,n,o,a){if(!e.samplerate){var u=function(e,t,n,o){var a,u,l,c,d,h=navigator.userAgent.toLowerCase(),f=o,p=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];if(a=1+((192&t[n+2])>>>6),!((u=(60&t[n+2])>>>2)>p.length-1))return c=(1&t[n+2])<<2,c|=(192&t[n+3])>>>6,s.logger.log("manifest codec:"+o+",ADTS data:type:"+a+",sampleingIndex:"+u+"["+p[u]+"Hz],channelConfig:"+c),/firefox/i.test(h)?u>=6?(a=5,d=new Array(4),l=u-3):(a=2,d=new Array(2),l=u):-1!==h.indexOf("android")?(a=2,d=new Array(2),l=u):(a=5,d=new Array(4),o&&(-1!==o.indexOf("mp4a.40.29")||-1!==o.indexOf("mp4a.40.5"))||!o&&u>=6?l=u-3:((o&&-1!==o.indexOf("mp4a.40.2")&&(u>=6&&1===c||/vivaldi/i.test(h))||!o&&1===c)&&(a=2,d=new Array(2)),l=u)),d[0]=a<<3,d[0]|=(14&u)>>1,d[1]|=(1&u)<<7,d[1]|=c<<3,5===a&&(d[1]|=(14&l)>>1,d[2]=(1&l)<<7,d[2]|=8,d[3]=0),{config:d,samplerate:p[u],channelCount:c,codec:"mp4a.40."+a,manifestCodec:f};e.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+u})}(t,n,o,a);e.config=u.config,e.samplerate=u.samplerate,e.channelCount=u.channelCount,e.codec=u.codec,e.manifestCodec=u.manifestCodec,s.logger.log("parsed codec:"+e.codec+",rate:"+u.samplerate+",nb channel:"+u.channelCount)}}function m(e){return 9216e4/e}function v(e,t,n,r,i){var o=function(e,t,n,r,i){var o,a,s=e.length;if(o=c(e,t),a=d(e,t),(a-=o)>0&&t+o+a<=s)return{headerLength:o,frameLength:a,stamp:n+r*i}}(t,n,r,i,m(e.samplerate));if(o){var a=o.stamp,s=o.headerLength,u=o.frameLength,l={unit:t.subarray(n+s,n+s+u),pts:a,dts:a};return e.samples.push(l),{sample:l,length:u+s}}}var g=n("./src/demux/id3.js"),y=function(){function e(e,t,n){this.observer=e,this.config=n,this.remuxer=t}var t=e.prototype;return t.resetInitSegment=function(e,t,n,r){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:t,duration:r,inputTimeScale:9e4}},t.resetTimeStamp=function(){},e.probe=function(e){if(!e)return!1;for(var t=(g.default.getID3Data(e,0)||[]).length,n=e.length;t<n;t++)if(f(e,t))return s.logger.log("ADTS sync word found !"),!0;return!1},t.append=function(e,t,n,r){for(var i=this._audioTrack,o=g.default.getID3Data(e,0)||[],u=g.default.getTimeStamp(o),l=Object(a.isFiniteNumber)(u)?90*u:9e4*t,c=0,d=l,f=e.length,m=o.length,y=[{pts:d,dts:d,data:o}];m<f-1;)if(h(e,m)&&m+5<f){p(i,this.observer,e,m,i.manifestCodec);var _=v(i,e,m,l,c);if(!_){s.logger.log("Unable to parse AAC frame");break}m+=_.length,d=_.sample.pts,c++}else g.default.isHeader(e,m)?(o=g.default.getID3Data(e,m),y.push({pts:d,dts:d,data:o}),m+=o.length):m++;this.remuxer.remux(i,{samples:[]},{samples:y,inputTimeScale:9e4},{samples:[]},t,n,r)},t.destroy=function(){},e}(),_=n("./src/demux/mp4demuxer.js"),b={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(e,t,n,r,i){if(!(n+24>t.length)){var o=this.parseHeader(t,n);if(o&&n+o.frameLength<=t.length){var a=r+i*(9e4*o.samplesPerFrame/o.sampleRate),s={unit:t.subarray(n,n+o.frameLength),pts:a,dts:a};return e.config=[],e.channelCount=o.channelCount,e.samplerate=o.sampleRate,e.samples.push(s),{sample:s,length:o.frameLength}}}},parseHeader:function(e,t){var n=e[t+1]>>3&3,r=e[t+1]>>1&3,i=e[t+2]>>4&15,o=e[t+2]>>2&3,a=e[t+2]>>1&1;if(1!==n&&0!==i&&15!==i&&3!==o){var s=3===n?3-r:3===r?3:4,u=1e3*b.BitratesMap[14*s+i-1],l=3===n?0:2===n?1:2,c=b.SamplingRateMap[3*l+o],d=e[t+3]>>6==3?1:2,h=b.SamplesCoefficients[n][r],f=b.BytesInSlot[r],p=8*h*f;return{sampleRate:c,channelCount:d,frameLength:parseInt(h*u/c+a,10)*f,samplesPerFrame:p}}},isHeaderPattern:function(e,t){return 255===e[t]&&224==(224&e[t+1])&&0!=(6&e[t+1])},isHeader:function(e,t){return!!(t+1<e.length&&this.isHeaderPattern(e,t))},probe:function(e,t){if(t+1<e.length&&this.isHeaderPattern(e,t)){var n=this.parseHeader(e,t),r=4;n&&n.frameLength&&(r=n.frameLength);var i=t+r;if(i===e.length||i+1<e.length&&this.isHeaderPattern(e,i))return!0}return!1}},E=b,w=function(){function e(e){this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}var t=e.prototype;return t.loadWord=function(){var e=this.data,t=this.bytesAvailable,n=e.byteLength-t,r=new Uint8Array(4),i=Math.min(4,t);if(0===i)throw new Error("no bytes available");r.set(e.subarray(n,n+i)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=8*i,this.bytesAvailable-=i},t.skipBits=function(e){var t;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,e-=(t=e>>3)>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)},t.readBits=function(e){var t=Math.min(this.bitsAvailable,e),n=this.word>>>32-t;return e>32&&s.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this.bytesAvailable>0&&this.loadWord(),(t=e-t)>0&&this.bitsAvailable?n<<t|this.readBits(t):n},t.skipLZ=function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},t.skipUEG=function(){this.skipBits(1+this.skipLZ())},t.skipEG=function(){this.skipBits(1+this.skipLZ())},t.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},t.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},t.readBoolean=function(){return 1===this.readBits(1)},t.readUByte=function(){return this.readBits(8)},t.readUShort=function(){return this.readBits(16)},t.readUInt=function(){return this.readBits(32)},t.skipScalingList=function(e){var t,n=8,r=8;for(t=0;t<e;t++)0!==r&&(r=(n+this.readEG()+256)%256),n=0===r?n:r},t.readSPS=function(){var e,t,n,r,i,o,a,s=0,u=0,l=0,c=0,d=this.readUByte.bind(this),h=this.readBits.bind(this),f=this.readUEG.bind(this),p=this.readBoolean.bind(this),m=this.skipBits.bind(this),v=this.skipEG.bind(this),g=this.skipUEG.bind(this),y=this.skipScalingList.bind(this);if(d(),e=d(),h(5),m(3),d(),g(),100===e||110===e||122===e||244===e||44===e||83===e||86===e||118===e||128===e){var _=f();if(3===_&&m(1),g(),g(),m(1),p())for(o=3!==_?8:12,a=0;a<o;a++)p()&&y(a<6?16:64)}g();var b=f();if(0===b)f();else if(1===b)for(m(1),v(),v(),t=f(),a=0;a<t;a++)v();g(),m(1),n=f(),r=f(),0===(i=h(1))&&m(1),m(1),p()&&(s=f(),u=f(),l=f(),c=f());var E=[1,1];if(p()&&p())switch(d()){case 1:E=[1,1];break;case 2:E=[12,11];break;case 3:E=[10,11];break;case 4:E=[16,11];break;case 5:E=[40,33];break;case 6:E=[24,11];break;case 7:E=[20,11];break;case 8:E=[32,11];break;case 9:E=[80,33];break;case 10:E=[18,11];break;case 11:E=[15,11];break;case 12:E=[64,33];break;case 13:E=[160,99];break;case 14:E=[4,3];break;case 15:E=[3,2];break;case 16:E=[2,1];break;case 255:E=[d()<<8|d(),d()<<8|d()]}return{width:Math.ceil(16*(n+1)-2*s-2*u),height:(2-i)*(r+1)*16-(i?2:4)*(l+c),pixelRatio:E}},t.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},e}(),T=function(){function e(e,t,n,r){this.decryptdata=n,this.discardEPB=r,this.decrypter=new o.default(e,t,{removePKCS7Padding:!1})}var t=e.prototype;return t.decryptBuffer=function(e,t){this.decrypter.decrypt(e,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,t)},t.decryptAacSample=function(e,t,n,r){var i=e[t].unit,o=i.subarray(16,i.length-i.length%16),a=o.buffer.slice(o.byteOffset,o.byteOffset+o.length),s=this;this.decryptBuffer(a,(function(o){o=new Uint8Array(o),i.set(o,16),r||s.decryptAacSamples(e,t+1,n)}))},t.decryptAacSamples=function(e,t,n){for(;;t++){if(t>=e.length)return void n();if(!(e[t].unit.length<32)){var r=this.decrypter.isSync();if(this.decryptAacSample(e,t,n,r),!r)return}}},t.getAvcEncryptedData=function(e){for(var t=16*Math.floor((e.length-48)/160)+16,n=new Int8Array(t),r=0,i=32;i<=e.length-16;i+=160,r+=16)n.set(e.subarray(i,i+16),r);return n},t.getAvcDecryptedUnit=function(e,t){t=new Uint8Array(t);for(var n=0,r=32;r<=e.length-16;r+=160,n+=16)e.set(t.subarray(n,n+16),r);return e},t.decryptAvcSample=function(e,t,n,r,i,o){var a=this.discardEPB(i.data),s=this.getAvcEncryptedData(a),u=this;this.decryptBuffer(s.buffer,(function(s){i.data=u.getAvcDecryptedUnit(a,s),o||u.decryptAvcSamples(e,t,n+1,r)}))},t.decryptAvcSamples=function(e,t,n,r){for(;;t++,n=0){if(t>=e.length)return void r();for(var i=e[t].units;!(n>=i.length);n++){var o=i[n];if(!(o.length<=48||1!==o.type&&5!==o.type)){var a=this.decrypter.isSync();if(this.decryptAvcSample(e,t,n,r,o,a),!a)return}}}},e}(),S={video:1,audio:2,id3:3,text:4},x=function(){function e(e,t,n,r){this.observer=e,this.config=n,this.typeSupported=r,this.remuxer=t,this.sampleAes=null}var t=e.prototype;return t.setDecryptData=function(e){null!=e&&null!=e.key&&"SAMPLE-AES"===e.method?this.sampleAes=new T(this.observer,this.config,e,this.discardEPB):this.sampleAes=null},e.probe=function(t){var n=e._syncOffset(t);return!(n<0||(n&&s.logger.warn("MPEG2-TS detected but first sync word found @ offset "+n+", junk ahead ?"),0))},e._syncOffset=function(e){for(var t=Math.min(1e3,e.length-564),n=0;n<t;){if(71===e[n]&&71===e[n+188]&&71===e[n+376])return n;n++}return-1},e.createTrack=function(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:S[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:"video"===e?0:void 0,isAAC:"audio"===e||void 0,duration:"audio"===e?t:void 0}},t.resetInitSegment=function(t,n,r,i){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=e.createTrack("video",i),this._audioTrack=e.createTrack("audio",i),this._id3Track=e.createTrack("id3",i),this._txtTrack=e.createTrack("text",i),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=n,this.videoCodec=r,this._duration=i},t.resetTimeStamp=function(){},t.append=function(t,n,o,a){var u,l,c,d,h,f=t.length,p=!1;this.contiguous=o;var m=this.pmtParsed,v=this._avcTrack,g=this._audioTrack,y=this._id3Track,_=v.pid,b=g.pid,E=y.pid,w=this._pmtId,T=v.pesData,S=g.pesData,x=y.pesData,A=this._parsePAT,M=this._parsePMT,j=this._parsePES,R=this._parseAVCPES.bind(this),L=this._parseAACPES.bind(this),C=this._parseMPEGPES.bind(this),k=this._parseID3PES.bind(this),O=e._syncOffset(t);for(f-=(f+O)%188,u=O;u<f;u+=188)if(71===t[u]){if(l=!!(64&t[u+1]),c=((31&t[u+1])<<8)+t[u+2],(48&t[u+3])>>4>1){if((d=u+5+t[u+4])===u+188)continue}else d=u+4;switch(c){case _:l&&(T&&(h=j(T))&&void 0!==h.pts&&R(h,!1),T={data:[],size:0}),T&&(T.data.push(t.subarray(d,u+188)),T.size+=u+188-d);break;case b:l&&(S&&(h=j(S))&&void 0!==h.pts&&(g.isAAC?L(h):C(h)),S={data:[],size:0}),S&&(S.data.push(t.subarray(d,u+188)),S.size+=u+188-d);break;case E:l&&(x&&(h=j(x))&&void 0!==h.pts&&k(h),x={data:[],size:0}),x&&(x.data.push(t.subarray(d,u+188)),x.size+=u+188-d);break;case 0:l&&(d+=t[d]+1),w=this._pmtId=A(t,d);break;case w:l&&(d+=t[d]+1);var P=M(t,d,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);(_=P.avc)>0&&(v.pid=_),(b=P.audio)>0&&(g.pid=b,g.isAAC=P.isAAC),(E=P.id3)>0&&(y.pid=E),p&&!m&&(s.logger.log("reparse from beginning"),p=!1,u=O-188),m=this.pmtParsed=!0;break;case 17:case 8191:break;default:p=!0}}else this.observer.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});T&&(h=j(T))&&void 0!==h.pts?(R(h,!0),v.pesData=null):v.pesData=T,S&&(h=j(S))&&void 0!==h.pts?(g.isAAC?L(h):C(h),g.pesData=null):(S&&S.size&&s.logger.log("last AAC PES packet truncated,might overlap between fragments"),g.pesData=S),x&&(h=j(x))&&void 0!==h.pts?(k(h),y.pesData=null):y.pesData=x,null==this.sampleAes?this.remuxer.remux(g,v,y,this._txtTrack,n,o,a):this.decryptAndRemux(g,v,y,this._txtTrack,n,o,a)},t.decryptAndRemux=function(e,t,n,r,i,o,a){if(e.samples&&e.isAAC){var s=this;this.sampleAes.decryptAacSamples(e.samples,0,(function(){s.decryptAndRemuxAvc(e,t,n,r,i,o,a)}))}else this.decryptAndRemuxAvc(e,t,n,r,i,o,a)},t.decryptAndRemuxAvc=function(e,t,n,r,i,o,a){if(t.samples){var s=this;this.sampleAes.decryptAvcSamples(t.samples,0,0,(function(){s.remuxer.remux(e,t,n,r,i,o,a)}))}else this.remuxer.remux(e,t,n,r,i,o,a)},t.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},t._parsePAT=function(e,t){return(31&e[t+10])<<8|e[t+11]},t._parsePMT=function(e,t,n,r){var i,o,a={audio:-1,avc:-1,id3:-1,isAAC:!0};for(i=t+3+((15&e[t+1])<<8|e[t+2])-4,t+=12+((15&e[t+10])<<8|e[t+11]);t<i;){switch(o=(31&e[t+1])<<8|e[t+2],e[t]){case 207:if(!r){s.logger.log("unknown stream type:"+e[t]);break}case 15:-1===a.audio&&(a.audio=o);break;case 21:-1===a.id3&&(a.id3=o);break;case 219:if(!r){s.logger.log("unknown stream type:"+e[t]);break}case 27:-1===a.avc&&(a.avc=o);break;case 3:case 4:n?-1===a.audio&&(a.audio=o,a.isAAC=!1):s.logger.log("MPEG audio found, not supported in this browser for now");break;case 36:s.logger.warn("HEVC stream type found, not supported for now");break;default:s.logger.log("unknown stream type:"+e[t])}t+=5+((15&e[t+3])<<8|e[t+4])}return a},t._parsePES=function(e){var t,n,r,i,o,a,u,l,c=0,d=e.data;if(!e||0===e.size)return null;for(;d[0].length<19&&d.length>1;){var h=new Uint8Array(d[0].length+d[1].length);h.set(d[0]),h.set(d[1],d[0].length),d[0]=h,d.splice(1,1)}if(1===((t=d[0])[0]<<16)+(t[1]<<8)+t[2]){if((r=(t[4]<<8)+t[5])&&r>e.size-6)return null;if(192&(n=t[7])&&((a=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2)>4294967295&&(a-=8589934592),64&n?((u=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2)>4294967295&&(u-=8589934592),a-u>54e5&&(s.logger.warn(Math.round((a-u)/9e4)+"s delta between PTS and DTS, align them"),a=u)):u=a),l=(i=t[8])+9,e.size<=l)return null;e.size-=l,o=new Uint8Array(e.size);for(var f=0,p=d.length;f<p;f++){var m=(t=d[f]).byteLength;if(l){if(l>m){l-=m;continue}t=t.subarray(l),m-=l,l=0}o.set(t,c),c+=m}return r&&(r-=i+3),{data:o,pts:a,dts:u,len:r}}return null},t.pushAccesUnit=function(e,t){if(e.units.length&&e.frame){var n=t.samples,r=n.length;!this.config.forceKeyFrameOnDiscontinuity||!0===e.key||t.sps&&(r||this.contiguous)?(e.id=r,n.push(e)):t.dropped++}e.debug.length&&s.logger.log(e.pts+"/"+e.dts+":"+e.debug)},t._parseAVCPES=function(e,t){var n,r,i,o=this,a=this._avcTrack,s=this._parseAVCNALu(e.data),u=this.avcSample,l=!1,c=this.pushAccesUnit.bind(this),d=function(e,t,n,r){return{key:e,pts:t,dts:n,units:[],debug:r}};e.data=null,u&&s.length&&!a.audFound&&(c(u,a),u=this.avcSample=d(!1,e.pts,e.dts,"")),s.forEach((function(t){switch(t.type){case 1:r=!0,u||(u=o.avcSample=d(!0,e.pts,e.dts,"")),u.frame=!0;var s=t.data;if(l&&s.length>4){var h=new w(s).readSliceType();2!==h&&4!==h&&7!==h&&9!==h||(u.key=!0)}break;case 5:r=!0,u||(u=o.avcSample=d(!0,e.pts,e.dts,"")),u.key=!0,u.frame=!0;break;case 6:r=!0,(n=new w(o.discardEPB(t.data))).readUByte();for(var f=0,p=0,m=!1,v=0;!m&&n.bytesAvailable>1;){f=0;do{f+=v=n.readUByte()}while(255===v);p=0;do{p+=v=n.readUByte()}while(255===v);if(4===f&&0!==n.bytesAvailable){if(m=!0,181===n.readUByte()&&49===n.readUShort()&&1195456820===n.readUInt()&&3===n.readUByte()){var y=n.readUByte(),_=31&y,b=[y,n.readUByte()];for(i=0;i<_;i++)b.push(n.readUByte()),b.push(n.readUByte()),b.push(n.readUByte());o._insertSampleInOrder(o._txtTrack.samples,{type:3,pts:e.pts,bytes:b})}}else if(5===f&&0!==n.bytesAvailable){if(m=!0,p>16){var E=[];for(i=0;i<16;i++)E.push(n.readUByte().toString(16)),3!==i&&5!==i&&7!==i&&9!==i||E.push("-");var T=p-16,S=new Uint8Array(T);for(i=0;i<T;i++)S[i]=n.readUByte();o._insertSampleInOrder(o._txtTrack.samples,{pts:e.pts,payloadType:f,uuid:E.join(""),userDataBytes:S,userData:Object(g.utf8ArrayToStr)(S.buffer)})}}else if(p<n.bytesAvailable)for(i=0;i<p;i++)n.readUByte()}break;case 7:if(r=!0,l=!0,!a.sps){var x=(n=new w(t.data)).readSPS();a.width=x.width,a.height=x.height,a.pixelRatio=x.pixelRatio,a.sps=[t.data],a.duration=o._duration;var A=t.data.subarray(1,4),M="avc1.";for(i=0;i<3;i++){var j=A[i].toString(16);j.length<2&&(j="0"+j),M+=j}a.codec=M}break;case 8:r=!0,a.pps||(a.pps=[t.data]);break;case 9:r=!1,a.audFound=!0,u&&c(u,a),u=o.avcSample=d(!1,e.pts,e.dts,"");break;case 12:r=!1;break;default:r=!1,u&&(u.debug+="unknown NAL "+t.type+" ")}u&&r&&u.units.push(t)})),t&&u&&(c(u,a),this.avcSample=null)},t._insertSampleInOrder=function(e,t){var n=e.length;if(n>0){if(t.pts>=e[n-1].pts)e.push(t);else for(var r=n-1;r>=0;r--)if(t.pts<e[r].pts){e.splice(r,0,t);break}}else e.push(t)},t._getLastNalUnit=function(){var e,t=this.avcSample;if(!t||0===t.units.length){var n=this._avcTrack.samples;t=n[n.length-1]}if(t){var r=t.units;e=r[r.length-1]}return e},t._parseAVCNALu=function(e){var t,n,r,i,o=0,a=e.byteLength,s=this._avcTrack,u=s.naluState||0,l=u,c=[],d=-1;for(-1===u&&(d=0,i=31&e[0],u=0,o=1);o<a;)if(t=e[o++],u)if(1!==u)if(t)if(1===t){if(d>=0)r={data:e.subarray(d,o-u-1),type:i},c.push(r);else{var h=this._getLastNalUnit();if(h&&(l&&o<=4-l&&h.state&&(h.data=h.data.subarray(0,h.data.byteLength-l)),(n=o-u-1)>0)){var f=new Uint8Array(h.data.byteLength+n);f.set(h.data,0),f.set(e.subarray(0,n),h.data.byteLength),h.data=f}}o<a?(d=o,i=31&e[o],u=0):u=-1}else u=0;else u=3;else u=t?0:2;else u=t?0:1;if(d>=0&&u>=0&&(r={data:e.subarray(d,a),type:i,state:u},c.push(r)),0===c.length){var p=this._getLastNalUnit();if(p){var m=new Uint8Array(p.data.byteLength+e.byteLength);m.set(p.data,0),m.set(e,p.data.byteLength),p.data=m}}return s.naluState=u,c},t.discardEPB=function(e){for(var t,n,r=e.byteLength,i=[],o=1;o<r-2;)0===e[o]&&0===e[o+1]&&3===e[o+2]?(i.push(o+2),o+=2):o++;if(0===i.length)return e;t=r-i.length,n=new Uint8Array(t);var a=0;for(o=0;o<t;a++,o++)a===i[0]&&(a++,i.shift()),n[o]=e[a];return n},t._parseAACPES=function(e){var t,n,o,a,u,l,c,d=this._audioTrack,f=e.data,g=e.pts,y=this.aacOverFlow,_=this.aacLastPTS;if(y){var b=new Uint8Array(y.byteLength+f.byteLength);b.set(y,0),b.set(f,y.byteLength),f=b}for(o=0,u=f.length;o<u-1&&!h(f,o);o++);if(!o||(o<u-1?(l="AAC PES did not start with ADTS header,offset:"+o,c=!1):(l="no ADTS header found in AAC PES",c=!0),s.logger.warn("parsing error:"+l),this.observer.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:c,reason:l}),!c)){if(p(d,this.observer,f,o,this.audioCodec),n=0,t=m(d.samplerate),y&&_){var E=_+t;Math.abs(E-g)>1&&(s.logger.log("AAC: align PTS for overlapping frames by "+Math.round((E-g)/90)),g=E)}for(;o<u;)if(h(f,o)&&o+5<u){var w=v(d,f,o,g,n);if(!w)break;o+=w.length,a=w.sample.pts,n++}else o++;y=o<u?f.subarray(o,u):null,this.aacOverFlow=y,this.aacLastPTS=a}},t._parseMPEGPES=function(e){for(var t=e.data,n=t.length,r=0,i=0,o=e.pts;i<n;)if(E.isHeader(t,i)){var a=E.appendFrame(this._audioTrack,t,i,o,r);if(!a)break;i+=a.length,r++}else i++},t._parseID3PES=function(e){this._id3Track.samples.push(e)},e}(),A=function(){function e(e,t,n){this.observer=e,this.config=n,this.remuxer=t}var t=e.prototype;return t.resetInitSegment=function(e,t,n,r){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:t,duration:r,inputTimeScale:9e4}},t.resetTimeStamp=function(){},e.probe=function(e){var t,n,r=g.default.getID3Data(e,0);if(r&&void 0!==g.default.getTimeStamp(r))for(t=r.length,n=Math.min(e.length-1,t+100);t<n;t++)if(E.probe(e,t))return s.logger.log("MPEG Audio sync word found !"),!0;return!1},t.append=function(e,t,n,r){for(var i=g.default.getID3Data(e,0),o=g.default.getTimeStamp(i),a=o?90*o:9e4*t,s=i.length,u=e.length,l=0,c=0,d=this._audioTrack,h=[{pts:a,dts:a,data:i}];s<u;)if(E.isHeader(e,s)){var f=E.appendFrame(d,e,s,a,l);if(!f)break;s+=f.length,c=f.sample.pts,l++}else g.default.isHeader(e,s)?(i=g.default.getID3Data(e,s),h.push({pts:c,dts:c,data:i}),s+=i.length):s++;this.remuxer.remux(d,{samples:[]},{samples:h,inputTimeScale:9e4},{samples:[]},t,n,r)},t.destroy=function(){},e}(),M=function(){function e(){}return e.getSilentFrame=function(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},e}(),j=Math.pow(2,32)-1,R=function(){function e(){}return e.init=function(){var t;for(t in e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var n=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:n,audio:r};var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),o=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=o,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var a=new Uint8Array([105,115,111,109]),s=new Uint8Array([97,118,99,49]),u=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,a,u,a,s),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,i))},e.box=function(e){for(var t,n=Array.prototype.slice.call(arguments,1),r=8,i=n.length,o=i;i--;)r+=n[i].byteLength;for((t=new Uint8Array(r))[0]=r>>24&255,t[1]=r>>16&255,t[2]=r>>8&255,t[3]=255&r,t.set(e,4),i=0,r=8;i<o;i++)t.set(n[i],r),r+=n[i].byteLength;return t},e.hdlr=function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])},e.mdat=function(t){return e.box(e.types.mdat,t)},e.mdhd=function(t,n){n*=t;var r=Math.floor(n/(j+1)),i=Math.floor(n%(j+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,i>>24,i>>16&255,i>>8&255,255&i,85,196,0,0]))},e.mdia=function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))},e.mfhd=function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))},e.minf=function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))},e.moof=function(t,n,r){return e.box(e.types.moof,e.mfhd(t),e.traf(r,n))},e.moov=function(t){for(var n=t.length,r=[];n--;)r[n]=e.trak(t[n]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(r).concat(e.mvex(t)))},e.mvex=function(t){for(var n=t.length,r=[];n--;)r[n]=e.trex(t[n]);return e.box.apply(null,[e.types.mvex].concat(r))},e.mvhd=function(t,n){n*=t;var r=Math.floor(n/(j+1)),i=Math.floor(n%(j+1)),o=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,i>>24,i>>16&255,i>>8&255,255&i,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,o)},e.sdtp=function(t){var n,r,i=t.samples||[],o=new Uint8Array(4+i.length);for(r=0;r<i.length;r++)n=i[r].flags,o[r+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return e.box(e.types.sdtp,o)},e.stbl=function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))},e.avc1=function(t){var n,r,i,o=[],a=[];for(n=0;n<t.sps.length;n++)i=(r=t.sps[n]).byteLength,o.push(i>>>8&255),o.push(255&i),o=o.concat(Array.prototype.slice.call(r));for(n=0;n<t.pps.length;n++)i=(r=t.pps[n]).byteLength,a.push(i>>>8&255),a.push(255&i),a=a.concat(Array.prototype.slice.call(r));var s=e.box(e.types.avcC,new Uint8Array([1,o[3],o[4],o[5],255,224|t.sps.length].concat(o).concat([t.pps.length]).concat(a))),u=t.width,l=t.height,c=t.pixelRatio[0],d=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,255&u,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),s,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,d>>24,d>>16&255,d>>8&255,255&d])))},e.esds=function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))},e.mp4a=function(t){var n=t.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]),e.box(e.types.esds,e.esds(t)))},e.mp3=function(t){var n=t.samplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]))},e.stsd=function(t){return"audio"===t.type?t.isAAC||"mp3"!==t.codec?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.mp3(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))},e.tkhd=function(t){var n=t.id,r=t.duration*t.timescale,i=t.width,o=t.height,a=Math.floor(r/(j+1)),s=Math.floor(r%(j+1));return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,255&n,0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,s>>24,s>>16&255,s>>8&255,255&s,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,255&i,0,0,o>>8&255,255&o,0,0]))},e.traf=function(t,n){var r=e.sdtp(t),i=t.id,o=Math.floor(n/(j+1)),a=Math.floor(n%(j+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,a>>24,a>>16&255,a>>8&255,255&a])),e.trun(t,r.length+16+20+8+16+8+8),r)},e.trak=function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))},e.trex=function(t){var n=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},e.trun=function(t,n){var r,i,o,a,s,u,l=t.samples||[],c=l.length,d=12+16*c,h=new Uint8Array(d);for(n+=8+d,h.set([0,0,15,1,c>>>24&255,c>>>16&255,c>>>8&255,255&c,n>>>24&255,n>>>16&255,n>>>8&255,255&n],0),r=0;r<c;r++)o=(i=l[r]).duration,a=i.size,s=i.flags,u=i.cts,h.set([o>>>24&255,o>>>16&255,o>>>8&255,255&o,a>>>24&255,a>>>16&255,a>>>8&255,255&a,s.isLeading<<2|s.dependsOn,s.isDependedOn<<6|s.hasRedundancy<<4|s.paddingValue<<1|s.isNonSync,61440&s.degradPrio,15&s.degradPrio,u>>>24&255,u>>>16&255,u>>>8&255,255&u],12+16*r);return e.box(e.types.trun,h)},e.initSegment=function(t){e.types||e.init();var n,r=e.moov(t);return(n=new Uint8Array(e.FTYP.byteLength+r.byteLength)).set(e.FTYP),n.set(r,e.FTYP.byteLength),n},e}();function L(e,t,n,r){void 0===n&&(n=1),void 0===r&&(r=!1);var i=e*t*n;return r?Math.round(i):i}function C(e,t){return void 0===t&&(t=!1),L(e,1e3,1/9e4,t)}function k(e,t){return void 0===t&&(t=1),L(e,9e4,1/t)}var O,P=k(10),I=k(.2),D=function(){function e(e,t,n,r){this.observer=e,this.config=t,this.typeSupported=n;var i=navigator.userAgent;this.isSafari=r&&r.indexOf("Apple")>-1&&i&&!i.match("CriOS"),this.ISGenerated=!1}var t=e.prototype;return t.destroy=function(){},t.resetTimeStamp=function(e){this._initPTS=this._initDTS=e},t.resetInitSegment=function(){this.ISGenerated=!1},t.remux=function(e,t,n,i,o,a,u){if(this.ISGenerated||this.generateIS(e,t,o),this.ISGenerated){var l=e.samples.length,c=t.samples.length,d=o,h=o;if(l&&c){var f=(e.samples[0].pts-t.samples[0].pts)/t.inputTimeScale;d+=Math.max(0,f),h+=Math.max(0,-f)}if(l){e.timescale||(s.logger.warn("regenerate InitSegment as audio detected"),this.generateIS(e,t,o));var p,m=this.remuxAudio(e,d,a,u);c&&(m&&(p=m.endPTS-m.startPTS),t.timescale||(s.logger.warn("regenerate InitSegment as video detected"),this.generateIS(e,t,o)),this.remuxVideo(t,h,a,p,u))}else if(c){var v=this.remuxVideo(t,h,a,0,u);v&&e.codec&&this.remuxEmptyAudio(e,d,a,v)}}n.samples.length&&this.remuxID3(n,o),i.samples.length&&this.remuxText(i,o),this.observer.trigger(r.default.FRAG_PARSED)},t.generateIS=function(e,t,n){var o,a,u=this.observer,l=e.samples,c=t.samples,d=this.typeSupported,h="audio/mp4",f={},p={tracks:f},m=void 0===this._initPTS;if(m&&(o=a=1/0),e.config&&l.length&&(e.timescale=e.samplerate,s.logger.log("audio sampling rate : "+e.samplerate),e.isAAC||(d.mpeg?(h="audio/mpeg",e.codec=""):d.mp3&&(e.codec="mp3")),f.audio={container:h,codec:e.codec,initSegment:!e.isAAC&&d.mpeg?new Uint8Array:R.initSegment([e]),metadata:{channelCount:e.channelCount}},m&&(o=a=l[0].pts-e.inputTimeScale*n)),t.sps&&t.pps&&c.length){var v=t.inputTimeScale;t.timescale=v,f.video={container:"video/mp4",codec:t.codec,initSegment:R.initSegment([t]),metadata:{width:t.width,height:t.height}},m&&(o=Math.min(o,c[0].pts-v*n),a=Math.min(a,c[0].dts-v*n),this.observer.trigger(r.default.INIT_PTS_FOUND,{initPTS:o}))}Object.keys(f).length?(u.trigger(r.default.FRAG_PARSING_INIT_SEGMENT,p),this.ISGenerated=!0,m&&(this._initPTS=o,this._initDTS=a)):u.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},t.remuxVideo=function(e,t,n,o,a){var u,l,c,d,h,f,p,m=8,v=e.timescale,g=e.samples,y=[],_=g.length,b=this._PTSNormalize,E=this._initPTS,w=this.nextAvcDts,T=this.isSafari;if(0!==_){T&&(n|=g.length&&w&&(a&&Math.abs(t-w/v)<.1||Math.abs(g[0].pts-w-E)<v/5)),n||(w=t*v),g.forEach((function(e){e.pts=b(e.pts-E,w),e.dts=b(e.dts-E,w)})),g.sort((function(e,t){var n=e.dts-t.dts,r=e.pts-t.pts;return n||r||e.id-t.id}));var S=g.reduce((function(e,t){return Math.max(Math.min(e,t.pts-t.dts),-1*I)}),0);if(S<0){s.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+C(S,!0)+" ms to overcome this issue");for(var x=0;x<g.length;x++)g[x].dts+=S}var A=g[0];h=Math.max(A.dts,0),d=Math.max(A.pts,0);var M=h-w;n&&M&&(M>1?s.logger.log("AVC: "+C(M,!0)+" ms hole between fragments detected,filling it"):M<-1&&s.logger.log("AVC: "+C(-M,!0)+" ms overlapping between fragments detected"),h=w,g[0].dts=h,d=Math.max(d-M,w),g[0].pts=d,s.logger.log("Video: PTS/DTS adjusted: "+C(d,!0)+"/"+C(h,!0)+", delta: "+C(M,!0)+" ms")),A=g[g.length-1],p=Math.max(A.dts,0),f=Math.max(A.pts,0,p),T&&(u=Math.round((p-h)/(g.length-1)));for(var j=0,L=0,k=0;k<_;k++){for(var O=g[k],P=O.units,D=P.length,N=0,B=0;B<D;B++)N+=P[B].data.length;L+=N,j+=D,O.length=N,O.dts=T?h+k*u:Math.max(O.dts,h),O.pts=Math.max(O.pts,O.dts)}var U=L+4*j+8;try{l=new Uint8Array(U)}catch(e){return void this.observer.trigger(r.default.ERROR,{type:i.ErrorTypes.MUX_ERROR,details:i.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:U,reason:"fail allocating video mdat "+U})}var F=new DataView(l.buffer);F.setUint32(0,U),l.set(R.types.mdat,4);for(var V=0;V<_;V++){for(var G=g[V],H=G.units,z=0,W=void 0,q=0,K=H.length;q<K;q++){var Y=H[q],X=Y.data,J=Y.data.byteLength;F.setUint32(m,J),m+=4,l.set(X,m),m+=J,z+=4+J}if(T)W=Math.max(0,u*Math.round((G.pts-G.dts)/u));else{if(V<_-1)u=g[V+1].dts-G.dts;else{var Z=this.config,$=G.dts-g[V>0?V-1:V].dts;if(Z.stretchShortVideoTrack){var Q=Z.maxBufferHole,ee=Math.floor(Q*v),te=(o?d+o*v:this.nextAudioPts)-G.pts;te>ee?((u=te-$)<0&&(u=$),s.logger.log("It is approximately "+C(te,!1)+" ms to the next segment; using duration "+C(u,!1)+" ms for the last video frame.")):u=$}else u=$}W=Math.round(G.pts-G.dts)}y.push({size:z,duration:u,cts:W,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:G.key?2:1,isNonSync:G.key?0:1}})}this.nextAvcDts=p+u;var ne=e.dropped;if(e.nbNalu=0,e.dropped=0,y.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var re=y[0].flags;re.dependsOn=2,re.isNonSync=0}e.samples=y,c=R.moof(e.sequenceNumber++,h,e),e.samples=[];var ie={data1:c,data2:l,startPTS:d/v,endPTS:(f+u)/v,startDTS:h/v,endDTS:this.nextAvcDts/v,type:"video",hasAudio:!1,hasVideo:!0,nb:y.length,dropped:ne};return this.observer.trigger(r.default.FRAG_PARSING_DATA,ie),ie}},t.remuxAudio=function(e,t,n,o){var a,u,l,c,d,h,f=e.inputTimeScale,p=e.timescale,m=f/p,v=(e.isAAC?1024:1152)*m,g=this._PTSNormalize,y=this._initPTS,_=!e.isAAC&&this.typeSupported.mpeg,b=_?0:8,E=e.samples,w=[],T=this.nextAudioPts;if(n|=E.length&&T&&(o&&Math.abs(t-T/f)<.1||Math.abs(E[0].pts-T-y)<20*v),E.forEach((function(e){e.pts=e.dts=g(e.pts-y,t*f)})),0!==(E=E.filter((function(e){return e.pts>=0}))).length){if(n||(T=o?t*f:E[0].pts),e.isAAC)for(var S=this.config.maxAudioFramesDrift,x=0,A=T;x<E.length;){var j,L=E[x];if((j=L.pts-A)<=-S*v)s.logger.warn("Dropping 1 audio frame @ "+C(A,!0)+" ms due to "+C(j,!0)+" ms overlap."),E.splice(x,1);else if(j>=S*v&&j<P&&A){var k=Math.round(j/v);s.logger.warn("Injecting "+k+" audio frames @ "+C(A,!0)+" ms due to "+C(A,!0)+" ms gap.");for(var O=0;O<k;O++){var I=Math.max(A,0);(u=M.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(s.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),u=L.unit.subarray()),E.splice(x,0,{unit:u,pts:I,dts:I}),A+=v,x++}L.pts=L.dts=A,A+=v,x++}else Math.abs(j),L.pts=L.dts=A,A+=v,x++}for(var D=E.length,N=0;D--;)N+=E[D].unit.byteLength;for(var B=0,U=E.length;B<U;B++){var F=E[B],V=F.unit,G=F.pts;if(void 0!==h)a.duration=Math.round((G-h)/m);else{var H=G-T,z=0;if(n&&e.isAAC&&H){if(H>0&&H<P)z=Math.round((G-T)/v),s.logger.log(C(H,!0)+" ms hole between AAC samples detected,filling it"),z>0&&((u=M.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(u=V.subarray()),N+=z*u.length);else if(H<-12){s.logger.log("drop overlapping AAC sample, expected/parsed/delta: "+C(T,!0)+" ms / "+C(G,!0)+" ms / "+C(-H,!0)+" ms"),N-=V.byteLength;continue}G=T}if(d=G,!(N>0))return;N+=b;try{l=new Uint8Array(N)}catch(e){return void this.observer.trigger(r.default.ERROR,{type:i.ErrorTypes.MUX_ERROR,details:i.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:N,reason:"fail allocating audio mdat "+N})}_||(new DataView(l.buffer).setUint32(0,N),l.set(R.types.mdat,4));for(var W=0;W<z;W++)(u=M.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(s.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),u=V.subarray()),l.set(u,b),b+=u.byteLength,a={size:u.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},w.push(a)}l.set(V,b);var q=V.byteLength;b+=q,a={size:q,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},w.push(a),h=G}var K=0;if((D=w.length)>=2&&(K=w[D-2].duration,a.duration=K),D){this.nextAudioPts=T=h+m*K,e.samples=w,c=_?new Uint8Array:R.moof(e.sequenceNumber++,d/m,e),e.samples=[];var Y=d/f,X=T/f,J={data1:c,data2:l,startPTS:Y,endPTS:X,startDTS:Y,endDTS:X,type:"audio",hasAudio:!0,hasVideo:!1,nb:D};return this.observer.trigger(r.default.FRAG_PARSING_DATA,J),J}return null}},t.remuxEmptyAudio=function(e,t,n,r){var i=e.inputTimeScale,o=i/(e.samplerate?e.samplerate:i),a=this.nextAudioPts,u=(void 0!==a?a:r.startDTS*i)+this._initDTS,l=r.endDTS*i+this._initDTS,c=1024*o,d=Math.ceil((l-u)/c),h=M.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(s.logger.warn("remux empty Audio"),h){for(var f=[],p=0;p<d;p++){var m=u+p*c;f.push({unit:h,pts:m,dts:m})}e.samples=f,this.remuxAudio(e,t,n)}else s.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")},t.remuxID3=function(e){var t,n=e.samples.length,i=e.inputTimeScale,o=this._initPTS,a=this._initDTS;if(n){for(var s=0;s<n;s++)(t=e.samples[s]).pts=(t.pts-o)/i,t.dts=(t.dts-a)/i;this.observer.trigger(r.default.FRAG_PARSING_METADATA,{samples:e.samples})}e.samples=[]},t.remuxText=function(e){e.samples.sort((function(e,t){return e.pts-t.pts}));var t,n=e.samples.length,i=e.inputTimeScale,o=this._initPTS;if(n){for(var a=0;a<n;a++)(t=e.samples[a]).pts=(t.pts-o)/i;this.observer.trigger(r.default.FRAG_PARSING_USERDATA,{samples:e.samples})}e.samples=[]},t._PTSNormalize=function(e,t){var n;if(void 0===t)return e;for(n=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=n;return e},e}(),N=function(){function e(e){this.observer=e}var t=e.prototype;return t.destroy=function(){},t.resetTimeStamp=function(){},t.resetInitSegment=function(){},t.remux=function(e,t,n,i,o,a,s,u){var l=this.observer,c="";e&&(c+="audio"),t&&(c+="video"),l.trigger(r.default.FRAG_PARSING_DATA,{data1:u,startPTS:o,startDTS:o,type:c,hasAudio:!!e,hasVideo:!!t,nb:1,dropped:0}),l.trigger(r.default.FRAG_PARSED)},e}(),B=Object(u.getSelfScope)();try{O=B.performance.now.bind(B.performance)}catch(e){s.logger.debug("Unable to use Performance API on this environment"),O=B.Date.now}var U=function(){function e(e,t,n,r){this.observer=e,this.typeSupported=t,this.config=n,this.vendor=r}var t=e.prototype;return t.destroy=function(){var e=this.demuxer;e&&e.destroy()},t.push=function(e,t,n,i,a,s,u,l,c,d,h,f){var p=this;if(e.byteLength>0&&null!=t&&null!=t.key&&"AES-128"===t.method){var m=this.decrypter;null==m&&(m=this.decrypter=new o.default(this.observer,this.config));var v=O();m.decrypt(e,t.key.buffer,t.iv.buffer,(function(e){var o=O();p.observer.trigger(r.default.FRAG_DECRYPTED,{stats:{tstart:v,tdecrypt:o}}),p.pushDecrypted(new Uint8Array(e),t,new Uint8Array(n),i,a,s,u,l,c,d,h,f)}))}else this.pushDecrypted(new Uint8Array(e),t,new Uint8Array(n),i,a,s,u,l,c,d,h,f)},t.pushDecrypted=function(e,t,n,o,a,s,u,l,c,d,h,f){var p=this.demuxer;if(!p||(u||l)&&!this.probe(e)){for(var m=this.observer,v=this.typeSupported,g=this.config,b=[{demux:x,remux:D},{demux:_.default,remux:N},{demux:y,remux:D},{demux:A,remux:D}],E=0,w=b.length;E<w;E++){var T=b[E],S=T.demux.probe;if(S(e)){var M=this.remuxer=new T.remux(m,g,v,this.vendor);p=new T.demux(m,M,g,v),this.probe=S;break}}if(!p)return void m.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this.demuxer=p}var j=this.remuxer;(u||l)&&(p.resetInitSegment(n,o,a,d),j.resetInitSegment()),u&&(p.resetTimeStamp(f),j.resetTimeStamp(f)),"function"==typeof p.setDecryptData&&p.setDecryptData(t),p.append(e,s,c,h)},e}();t.default=U},"./src/demux/demuxer-worker.js":function(e,t,n){"use strict";n.r(t);var r=n("./src/demux/demuxer-inline.js"),i=n("./src/events.js"),o=n("./src/utils/logger.js"),a=n("./node_modules/eventemitter3/index.js");t.default=function(e){var t=new a.EventEmitter;t.trigger=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.emit.apply(t,[e,e].concat(r))},t.off=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.removeListener.apply(t,[e].concat(r))};var n=function(t,n){e.postMessage({event:t,data:n})};e.addEventListener("message",(function(i){var a=i.data;switch(a.cmd){case"init":var s=JSON.parse(a.config);e.demuxer=new r.default(t,a.typeSupported,s,a.vendor),Object(o.enableLogs)(s.debug),n("init",null);break;case"demux":e.demuxer.push(a.data,a.decryptdata,a.initSegment,a.audioCodec,a.videoCodec,a.timeOffset,a.discontinuity,a.trackSwitch,a.contiguous,a.duration,a.accurateTimeOffset,a.defaultInitPTS)}})),t.on(i.default.FRAG_DECRYPTED,n),t.on(i.default.FRAG_PARSING_INIT_SEGMENT,n),t.on(i.default.FRAG_PARSED,n),t.on(i.default.ERROR,n),t.on(i.default.FRAG_PARSING_METADATA,n),t.on(i.default.FRAG_PARSING_USERDATA,n),t.on(i.default.INIT_PTS_FOUND,n),t.on(i.default.FRAG_PARSING_DATA,(function(t,n){var r=[],i={event:t,data:n};n.data1&&(i.data1=n.data1.buffer,r.push(n.data1.buffer),delete n.data1),n.data2&&(i.data2=n.data2.buffer,r.push(n.data2.buffer),delete n.data2),e.postMessage(i,r)}))}},"./src/demux/id3.js":function(e,t,n){"use strict";n.r(t),n.d(t,"utf8ArrayToStr",(function(){return s}));var r,i=n("./src/utils/get-self-scope.js"),o=function(){function e(){}return e.isHeader=function(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},e.isFooter=function(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},e.getID3Data=function(t,n){for(var r=n,i=0;e.isHeader(t,n);)i+=10,i+=e._readSize(t,n+6),e.isFooter(t,n+10)&&(i+=10),n+=i;if(i>0)return t.subarray(r,r+i)},e._readSize=function(e,t){var n=0;return n=(127&e[t])<<21,n|=(127&e[t+1])<<14,n|=(127&e[t+2])<<7,n|=127&e[t+3]},e.getTimeStamp=function(t){for(var n=e.getID3Frames(t),r=0;r<n.length;r++){var i=n[r];if(e.isTimeStampFrame(i))return e._readTimeStamp(i)}},e.isTimeStampFrame=function(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info},e._getFrameData=function(t){var n=String.fromCharCode(t[0],t[1],t[2],t[3]),r=e._readSize(t,4);return{type:n,size:r,data:t.subarray(10,10+r)}},e.getID3Frames=function(t){for(var n=0,r=[];e.isHeader(t,n);){for(var i=e._readSize(t,n+6),o=(n+=10)+i;n+8<o;){var a=e._getFrameData(t.subarray(n)),s=e._decodeFrame(a);s&&r.push(s),n+=a.size+10}e.isFooter(t,n)&&(n+=10)}return r},e._decodeFrame=function(t){return"PRIV"===t.type?e._decodePrivFrame(t):"T"===t.type[0]?e._decodeTextFrame(t):"W"===t.type[0]?e._decodeURLFrame(t):void 0},e._readTimeStamp=function(e){if(8===e.data.byteLength){var t=new Uint8Array(e.data),n=1&t[3],r=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return r/=45,n&&(r+=47721858.84),Math.round(r)}},e._decodePrivFrame=function(t){if(!(t.size<2)){var n=e._utf8ArrayToStr(t.data,!0),r=new Uint8Array(t.data.subarray(n.length+1));return{key:t.type,info:n,data:r.buffer}}},e._decodeTextFrame=function(t){if(!(t.size<2)){if("TXXX"===t.type){var n=1,r=e._utf8ArrayToStr(t.data.subarray(n),!0);n+=r.length+1;var i=e._utf8ArrayToStr(t.data.subarray(n));return{key:t.type,info:r,data:i}}var o=e._utf8ArrayToStr(t.data.subarray(1));return{key:t.type,data:o}}},e._decodeURLFrame=function(t){if("WXXX"===t.type){if(t.size<2)return;var n=1,r=e._utf8ArrayToStr(t.data.subarray(n));n+=r.length+1;var i=e._utf8ArrayToStr(t.data.subarray(n));return{key:t.type,info:r,data:i}}var o=e._utf8ArrayToStr(t.data);return{key:t.type,data:o}},e._utf8ArrayToStr=function(e,t){void 0===t&&(t=!1);var n=a();if(n){var r=n.decode(e);if(t){var i=r.indexOf("\0");return-1!==i?r.substring(0,i):r}return r.replace(/\0/g,"")}for(var o,s,u,l=e.length,c="",d=0;d<l;){if(0===(o=e[d++])&&t)return c;if(0!==o&&3!==o)switch(o>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:c+=String.fromCharCode(o);break;case 12:case 13:s=e[d++],c+=String.fromCharCode((31&o)<<6|63&s);break;case 14:s=e[d++],u=e[d++],c+=String.fromCharCode((15&o)<<12|(63&s)<<6|(63&u)<<0)}}return c},e}();function a(){var e=Object(i.getSelfScope)();return r||void 0===e.TextDecoder||(r=new e.TextDecoder("utf-8")),r}var s=o._utf8ArrayToStr;t.default=o},"./src/demux/mp4demuxer.js":function(e,t,n){"use strict";n.r(t);var r=n("./src/utils/logger.js"),i=n("./src/events.js"),o=Math.pow(2,32)-1,a=function(){function e(e,t){this.observer=e,this.remuxer=t}var t=e.prototype;return t.resetTimeStamp=function(e){this.initPTS=e},t.resetInitSegment=function(t,n,r,o){if(t&&t.byteLength){var a=this.initData=e.parseInitSegment(t);null==n&&(n="mp4a.40.5"),null==r&&(r="avc1.42e01e");var s={};a.audio&&a.video?s.audiovideo={container:"video/mp4",codec:n+","+r,initSegment:o?t:null}:(a.audio&&(s.audio={container:"audio/mp4",codec:n,initSegment:o?t:null}),a.video&&(s.video={container:"video/mp4",codec:r,initSegment:o?t:null})),this.observer.trigger(i.default.FRAG_PARSING_INIT_SEGMENT,{tracks:s})}else n&&(this.audioCodec=n),r&&(this.videoCodec=r)},e.probe=function(t){return e.findBox({data:t,start:0,end:Math.min(t.length,16384)},["moof"]).length>0},e.bin2str=function(e){return String.fromCharCode.apply(null,e)},e.readUint16=function(e,t){e.data&&(t+=e.start,e=e.data);var n=e[t]<<8|e[t+1];return n<0?65536+n:n},e.readUint32=function(e,t){e.data&&(t+=e.start,e=e.data);var n=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3];return n<0?4294967296+n:n},e.writeUint32=function(e,t,n){e.data&&(t+=e.start,e=e.data),e[t]=n>>24,e[t+1]=n>>16&255,e[t+2]=n>>8&255,e[t+3]=255&n},e.findBox=function(t,n){var r,i,o,a,s,u,l=[];if(t.data?(s=t.start,o=t.end,t=t.data):(s=0,o=t.byteLength),!n.length)return null;for(r=s;r<o;)u=(i=e.readUint32(t,r))>1?r+i:o,e.bin2str(t.subarray(r+4,r+8))===n[0]&&(1===n.length?l.push({data:t,start:r+8,end:u}):(a=e.findBox({data:t,start:r+8,end:u},n.slice(1))).length&&(l=l.concat(a))),r=u;return l},e.parseSegmentIndex=function(t){var n,r=e.findBox(t,["moov"])[0],i=r?r.end:null,o=0,a=e.findBox(t,["sidx"]);if(!a||!a[0])return null;n=[];var s=(a=a[0]).data[0];o=0===s?8:16;var u=e.readUint32(a,o);o+=4,o+=0===s?8:16,o+=2;var l=a.end+0,c=e.readUint16(a,o);o+=2;for(var d=0;d<c;d++){var h=o,f=e.readUint32(a,h);h+=4;var p=2147483647&f;if(1==(2147483648&f)>>>31)return void console.warn("SIDX has hierarchical references (not supported)");var m=e.readUint32(a,h);h+=4,n.push({referenceSize:p,subsegmentDuration:m,info:{duration:m/u,start:l,end:l+p-1}}),l+=p,o=h+=4}return{earliestPresentationTime:0,timescale:u,version:s,referencesCount:c,references:n,moovEndOffset:i}},e.parseInitSegment=function(t){var n=[];return e.findBox(t,["moov","trak"]).forEach((function(t){var i=e.findBox(t,["tkhd"])[0];if(i){var o=i.data[i.start],a=0===o?12:20,s=e.readUint32(i,a),u=e.findBox(t,["mdia","mdhd"])[0];if(u){a=0===(o=u.data[u.start])?12:20;var l=e.readUint32(u,a),c=e.findBox(t,["mdia","hdlr"])[0];if(c){var d={soun:"audio",vide:"video"}[e.bin2str(c.data.subarray(c.start+8,c.start+12))];if(d){var h=e.findBox(t,["mdia","minf","stbl","stsd"]);if(h.length){h=h[0];var f=e.bin2str(h.data.subarray(h.start+12,h.start+16));r.logger.log("MP4Demuxer:"+d+":"+f+" found")}n[s]={timescale:l,type:d},n[d]={timescale:l,id:s}}}}}})),n},e.getStartDTS=function(t,n){var r,i,o;return r=e.findBox(n,["moof","traf"]),i=[].concat.apply([],r.map((function(n){return e.findBox(n,["tfhd"]).map((function(r){var i,o;return i=e.readUint32(r,4),o=t[i].timescale||9e4,e.findBox(n,["tfdt"]).map((function(t){var n,r;return n=t.data[t.start],r=e.readUint32(t,4),1===n&&(r*=Math.pow(2,32),r+=e.readUint32(t,8)),r}))[0]/o}))}))),o=Math.min.apply(null,i),isFinite(o)?o:0},e.offsetStartDTS=function(t,n,r){e.findBox(n,["moof","traf"]).map((function(n){return e.findBox(n,["tfhd"]).map((function(i){var a=e.readUint32(i,4),s=t[a].timescale||9e4;e.findBox(n,["tfdt"]).map((function(t){var n=t.data[t.start],i=e.readUint32(t,4);if(0===n)e.writeUint32(t,4,i-r*s);else{i*=Math.pow(2,32),i+=e.readUint32(t,8),i-=r*s,i=Math.max(i,0);var a=Math.floor(i/(o+1)),u=Math.floor(i%(o+1));e.writeUint32(t,4,a),e.writeUint32(t,8,u)}}))}))}))},t.append=function(t,n,r,o){var a=this.initData;a||(this.resetInitSegment(t,this.audioCodec,this.videoCodec,!1),a=this.initData);var s,u=this.initPTS;if(void 0===u){var l=e.getStartDTS(a,t);this.initPTS=u=l-n,this.observer.trigger(i.default.INIT_PTS_FOUND,{initPTS:u})}e.offsetStartDTS(a,t,u),s=e.getStartDTS(a,t),this.remuxer.remux(a.audio,a.video,null,null,s,r,o,t)},t.destroy=function(){},e}();t.default=a},"./src/errors.ts":function(e,t,n){"use strict";var r,i;n.r(t),n.d(t,"ErrorTypes",(function(){return r})),n.d(t,"ErrorDetails",(function(){return i})),function(e){e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError"}(r||(r={})),function(e){e.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.INTERNAL_EXCEPTION="internalException"}(i||(i={}))},"./src/events.js":function(e,t,n){"use strict";n.r(t),t.default={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition",LIVE_BACK_BUFFER_REACHED:"hlsLiveBackBufferReached"}},"./src/hls.ts":function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"newCue",(function(){return vt}));var i,o,a=n("./node_modules/url-toolkit/src/url-toolkit.js"),s=n("./src/errors.ts"),u=n("./src/polyfills/number-isFinite.js"),l=n("./src/events.js"),c=n("./src/utils/logger.js"),d={hlsEventGeneric:!0,hlsHandlerDestroying:!0,hlsHandlerDestroyed:!0},h=function(){function e(e){this.hls=void 0,this.handledEvents=void 0,this.useGenericHandler=void 0,this.hls=e,this.onEvent=this.onEvent.bind(this);for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.handledEvents=n,this.useGenericHandler=!0,this.registerListeners()}var t=e.prototype;return t.destroy=function(){this.onHandlerDestroying(),this.unregisterListeners(),this.onHandlerDestroyed()},t.onHandlerDestroying=function(){},t.onHandlerDestroyed=function(){},t.isEventHandler=function(){return"object"==typeof this.handledEvents&&this.handledEvents.length&&"function"==typeof this.onEvent},t.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach((function(e){if(d[e])throw new Error("Forbidden event-name: "+e);this.hls.on(e,this.onEvent)}),this)},t.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach((function(e){this.hls.off(e,this.onEvent)}),this)},t.onEvent=function(e,t){this.onEventGeneric(e,t)},t.onEventGeneric=function(e,t){try{(function(e,t){var n="on"+e.replace("hls","");if("function"!=typeof this[n])throw new Error("Event "+e+" has no generic handler in this "+this.constructor.name+" class (tried "+n+")");return this[n].bind(this,t)}).call(this,e,t).call()}catch(t){c.logger.error("An internal error happened while handling event "+e+'. Error message: "'+t.message+'". Here is a stacktrace:',t),this.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.OTHER_ERROR,details:s.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:e,err:t})}},e}();!function(e){e.MANIFEST="manifest",e.LEVEL="level",e.AUDIO_TRACK="audioTrack",e.SUBTITLE_TRACK="subtitleTrack"}(i||(i={})),function(e){e.MAIN="main",e.AUDIO="audio",e.SUBTITLE="subtitle"}(o||(o={}));var f=n("./src/demux/mp4demuxer.js");function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var m,v=function(){function e(e,t){this._uri=null,this.baseuri=void 0,this.reluri=void 0,this.method=null,this.key=null,this.iv=null,this.baseuri=e,this.reluri=t}var t,n,r;return t=e,(n=[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=Object(a.buildAbsoluteURL)(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}])&&p(t.prototype,n),r&&p(t,r),e}();function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e.AUDIO="audio",e.VIDEO="video"}(m||(m={}));var y=function(){function e(){var e;this._url=null,this._byteRange=null,this._decryptdata=null,this._elementaryStreams=((e={})[m.AUDIO]=!1,e[m.VIDEO]=!1,e),this.deltaPTS=0,this.rawProgramDateTime=null,this.programDateTime=null,this.title=null,this.tagList=[],this.cc=void 0,this.type=void 0,this.relurl=void 0,this.baseurl=void 0,this.duration=void 0,this.start=void 0,this.sn=0,this.urlId=0,this.level=0,this.levelkey=void 0,this.loader=void 0}var t,n,r,i=e.prototype;return i.setByteRange=function(e,t){var n=e.split("@",2),r=[];1===n.length?r[0]=t?t.byteRangeEndOffset:0:r[0]=parseInt(n[1]),r[1]=parseInt(n[0])+r[0],this._byteRange=r},i.addElementaryStream=function(e){this._elementaryStreams[e]=!0},i.hasElementaryStream=function(e){return!0===this._elementaryStreams[e]},i.createInitializationVector=function(e){for(var t=new Uint8Array(16),n=12;n<16;n++)t[n]=e>>8*(15-n)&255;return t},i.setDecryptDataFromLevelKey=function(e,t){var n=e;return e&&e.method&&e.uri&&!e.iv&&((n=new v(e.baseuri,e.reluri)).method=e.method,n.iv=this.createInitializationVector(t)),n},t=e,(n=[{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=Object(a.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(e){this._url=e}},{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var e=this.sn;"number"!=typeof e&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&c.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),e=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,e)}return this._decryptdata}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!Object(u.isFiniteNumber)(this.programDateTime))return null;var e=Object(u.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*e}},{key:"encrypted",get:function(){return!(!this.decryptdata||null===this.decryptdata.uri||null!==this.decryptdata.key)}}])&&g(t.prototype,n),r&&g(t,r),e}();function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var b=function(){function e(e){this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=e,this.version=null}var t,n,r;return t=e,(n=[{key:"hasProgramDateTime",get:function(){return!(!this.fragments[0]||!Object(u.isFiniteNumber)(this.fragments[0].programDateTime))}}])&&_(t.prototype,n),r&&_(t,r),e}(),E=/^(\d+)x(\d+)$/,w=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,T=function(){function e(t){for(var n in"string"==typeof t&&(t=e.parseAttrList(t)),t)t.hasOwnProperty(n)&&(this[n]=t[n])}var t=e.prototype;return t.decimalInteger=function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var n=new Uint8Array(t.length/2),r=0;r<t.length/2;r++)n[r]=parseInt(t.slice(2*r,2*r+2),16);return n}return null},t.hexadecimalIntegerAsNumber=function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.decimalFloatingPoint=function(e){return parseFloat(this[e])},t.enumeratedString=function(e){return this[e]},t.decimalResolution=function(e){var t=E.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},e.parseAttrList=function(e){var t,n={};for(w.lastIndex=0;null!==(t=w.exec(e));){var r=t[2];0===r.indexOf('"')&&r.lastIndexOf('"')===r.length-1&&(r=r.slice(1,-1)),n[t[1]]=r}return n},e}(),S={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};function x(e,t){return MediaSource.isTypeSupported((t||"video")+'/mp4;codecs="'+e+'"')}var A=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,M=/#EXT-X-MEDIA:(.*)/g,j=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),R=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,L=/\.(mp4|m4s|m4v|m4a)$/i,C=function(){function e(){}return e.findGroup=function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(r.id===t)return r}},e.convertAVC1ToAVCOTI=function(e){var t,n=e.split(".");return n.length>2?(t=n.shift()+".",t+=parseInt(n.shift()).toString(16),t+=("000"+parseInt(n.shift()).toString(16)).substr(-4)):t=e,t},e.resolve=function(e,t){return a.buildAbsoluteURL(t,e,{alwaysNormalize:!0})},e.parseMasterPlaylist=function(t,n){var r,i=[];function o(e,t){["video","audio"].forEach((function(n){var r=e.filter((function(e){return function(e,t){var n=S[t];return!!n&&!0===n[e.slice(0,4)]}(e,n)}));if(r.length){var i=r.filter((function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)}));t[n+"Codec"]=i.length>0?i[0]:r[0],e=e.filter((function(e){return-1===r.indexOf(e)}))}})),t.unknownCodecs=e}for(A.lastIndex=0;null!=(r=A.exec(t));){var a={},s=a.attrs=new T(r[1]);a.url=e.resolve(r[2],n);var u=s.decimalResolution("RESOLUTION");u&&(a.width=u.width,a.height=u.height),a.bitrate=s.decimalInteger("AVERAGE-BANDWIDTH")||s.decimalInteger("BANDWIDTH"),a.name=s.NAME,o([].concat((s.CODECS||"").split(/[ ,]+/)),a),a.videoCodec&&-1!==a.videoCodec.indexOf("avc1")&&(a.videoCodec=e.convertAVC1ToAVCOTI(a.videoCodec)),i.push(a)}return i},e.parseMasterPlaylistMedia=function(t,n,r,i){var o;void 0===i&&(i=[]);var a=[],s=0;for(M.lastIndex=0;null!==(o=M.exec(t));){var u=new T(o[1]);if(u.TYPE===r){var l={id:s++,groupId:u["GROUP-ID"],name:u.NAME||u.LANGUAGE,type:r,default:"YES"===u.DEFAULT,autoselect:"YES"===u.AUTOSELECT,forced:"YES"===u.FORCED,lang:u.LANGUAGE};if(u.URI&&(l.url=e.resolve(u.URI,n)),i.length){var c=e.findGroup(i,l.groupId);l.audioCodec=c?c.codec:i[0].codec}a.push(l)}}return a},e.parseLevelPlaylist=function(e,t,n,r,i){var o,a,s,l=0,d=0,h=new b(t),f=0,p=null,m=new y,g=null;for(j.lastIndex=0;null!==(o=j.exec(e));){var _=o[1];if(_){m.duration=parseFloat(_);var E=(" "+o[2]).slice(1);m.title=E||null,m.tagList.push(E?["INF",_,E]:["INF",_])}else if(o[3]){if(Object(u.isFiniteNumber)(m.duration)){var w=l++;m.type=r,m.start=d,s&&(m.levelkey=s),m.sn=w,m.level=n,m.cc=f,m.urlId=i,m.baseurl=t,m.relurl=(" "+o[3]).slice(1),k(m,p),h.fragments.push(m),p=m,d+=m.duration,m=new y}}else if(o[4]){var S=(" "+o[4]).slice(1);p?m.setByteRange(S,p):m.setByteRange(S)}else if(o[5])m.rawProgramDateTime=(" "+o[5]).slice(1),m.tagList.push(["PROGRAM-DATE-TIME",m.rawProgramDateTime]),null===g&&(g=h.fragments.length);else{if(!(o=o[0].match(R))){c.logger.warn("No matches on slow regex match for level playlist!");continue}for(a=1;a<o.length&&void 0===o[a];a++);var x=(" "+o[a+1]).slice(1),A=(" "+o[a+2]).slice(1);switch(o[a]){case"#":m.tagList.push(A?[x,A]:[x]);break;case"PLAYLIST-TYPE":h.type=x.toUpperCase();break;case"MEDIA-SEQUENCE":l=h.startSN=parseInt(x);break;case"TARGETDURATION":h.targetduration=parseFloat(x);break;case"VERSION":h.version=parseInt(x);break;case"EXTM3U":break;case"ENDLIST":h.live=!1;break;case"DIS":f++,m.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":f=parseInt(x);break;case"KEY":var M=new T(x),C=M.enumeratedString("METHOD"),O=M.URI,P=M.hexadecimalInteger("IV");C&&(s=new v(t,O),O&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(C)>=0&&(s.method=C,s.key=null,s.iv=P));break;case"START":var I=new T(x).decimalFloatingPoint("TIME-OFFSET");Object(u.isFiniteNumber)(I)&&(h.startTimeOffset=I);break;case"MAP":var D=new T(x);m.relurl=D.URI,D.BYTERANGE&&m.setByteRange(D.BYTERANGE),m.baseurl=t,m.level=n,m.type=r,m.sn="initSegment",h.initSegment=m,(m=new y).rawProgramDateTime=h.initSegment.rawProgramDateTime;break;default:c.logger.warn("line parsed but not handled: "+o)}}}return(m=p)&&!m.relurl&&(h.fragments.pop(),d-=m.duration),h.totalduration=d,h.averagetargetduration=d/h.fragments.length,h.endSN=l-1,h.startCC=h.fragments[0]?h.fragments[0].cc:0,h.endCC=f,!h.initSegment&&h.fragments.length&&h.fragments.every((function(e){return L.test(e.relurl)}))&&(c.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(m=new y).relurl=h.fragments[0].relurl,m.baseurl=t,m.level=n,m.type=r,m.sn="initSegment",h.initSegment=m,h.needSidxRanges=!0),g&&function(e,t){for(var n=e[t],r=t-1;r>=0;r--){var i=e[r];i.programDateTime=n.programDateTime-1e3*i.duration,n=i}}(h.fragments,g),h},e}();function k(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),Object(u.isFiniteNumber)(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}var O=window.performance,P=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,l.default.MANIFEST_LOADING,l.default.LEVEL_LOADING,l.default.AUDIO_TRACK_LOADING,l.default.SUBTITLE_TRACK_LOADING)||this).loaders={},n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,r.canHaveQualityLevels=function(e){return e!==i.AUDIO_TRACK&&e!==i.SUBTITLE_TRACK},r.mapContextToLevelType=function(e){switch(e.type){case i.AUDIO_TRACK:return o.AUDIO;case i.SUBTITLE_TRACK:return o.SUBTITLE;default:return o.MAIN}},r.getResponseUrl=function(e,t){var n=e.url;return void 0!==n&&0!==n.indexOf("data:")||(n=t.url),n};var a=r.prototype;return a.createInternalLoader=function(e){var t=this.hls.config,n=t.pLoader,r=t.loader,i=new(n||r)(t);return e.loader=i,this.loaders[e.type]=i,i},a.getInternalLoader=function(e){return this.loaders[e.type]},a.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},a.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},a.destroy=function(){this.destroyInternalLoaders(),e.prototype.destroy.call(this)},a.onManifestLoading=function(e){this.load({url:e.url,type:i.MANIFEST,level:0,id:null,responseType:"text"})},a.onLevelLoading=function(e){this.load({url:e.url,type:i.LEVEL,level:e.level,id:e.id,responseType:"text"})},a.onAudioTrackLoading=function(e){this.load({url:e.url,type:i.AUDIO_TRACK,level:null,id:e.id,responseType:"text"})},a.onSubtitleTrackLoading=function(e){this.load({url:e.url,type:i.SUBTITLE_TRACK,level:null,id:e.id,responseType:"text"})},a.load=function(e){var t=this.hls.config;c.logger.debug("Loading playlist of type "+e.type+", level: "+e.level+", id: "+e.id);var n,r,o,a,s=this.getInternalLoader(e);if(s){var u=s.context;if(u&&u.url===e.url)return c.logger.trace("playlist request ongoing"),!1;c.logger.warn("aborting previous loader for type: "+e.type),s.abort()}switch(e.type){case i.MANIFEST:n=t.manifestLoadingMaxRetry,r=t.manifestLoadingTimeOut,o=t.manifestLoadingRetryDelay,a=t.manifestLoadingMaxRetryTimeout;break;case i.LEVEL:n=0,a=0,o=0,r=t.levelLoadingTimeOut;break;default:n=t.levelLoadingMaxRetry,r=t.levelLoadingTimeOut,o=t.levelLoadingRetryDelay,a=t.levelLoadingMaxRetryTimeout}s=this.createInternalLoader(e);var l={timeout:r,maxRetry:n,retryDelay:o,maxRetryDelay:a},d={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};return c.logger.debug("Calling internal loader delegate for URL: "+e.url),s.load(e,l,d),!0},a.loadsuccess=function(e,t,n,r){if(void 0===r&&(r=null),n.isSidxRequest)return this._handleSidxRequest(e,n),void this._handlePlaylistLoaded(e,t,n,r);if(this.resetInternalLoader(n.type),"string"!=typeof e.data)throw new Error('expected responseType of "text" for PlaylistLoader');var i=e.data;t.tload=O.now(),0===i.indexOf("#EXTM3U")?i.indexOf("#EXTINF:")>0||i.indexOf("#EXT-X-TARGETDURATION:")>0?this._handleTrackOrLevelPlaylist(e,t,n,r):this._handleMasterPlaylist(e,t,n,r):this._handleManifestParsingError(e,n,"no EXTM3U delimiter",r)},a.loaderror=function(e,t,n){void 0===n&&(n=null),this._handleNetworkError(t,n,!1,e)},a.loadtimeout=function(e,t,n){void 0===n&&(n=null),this._handleNetworkError(t,n,!0)},a._handleMasterPlaylist=function(e,t,n,i){var o=this.hls,a=e.data,s=r.getResponseUrl(e,n),u=C.parseMasterPlaylist(a,s);if(u.length){var d=u.map((function(e){return{id:e.attrs.AUDIO,codec:e.audioCodec}})),h=C.parseMasterPlaylistMedia(a,s,"AUDIO",d),f=C.parseMasterPlaylistMedia(a,s,"SUBTITLES");if(h.length){var p=!1;h.forEach((function(e){e.url||(p=!0)})),!1===p&&u[0].audioCodec&&!u[0].attrs.AUDIO&&(c.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),h.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1}))}o.trigger(l.default.MANIFEST_LOADED,{levels:u,audioTracks:h,subtitles:f,url:s,stats:t,networkDetails:i})}else this._handleManifestParsingError(e,n,"no level found in manifest",i)},a._handleTrackOrLevelPlaylist=function(e,t,n,o){var a=this.hls,s=n.id,c=n.level,d=n.type,h=r.getResponseUrl(e,n),f=Object(u.isFiniteNumber)(s)?s:0,p=Object(u.isFiniteNumber)(c)?c:f,m=r.mapContextToLevelType(n),v=C.parseLevelPlaylist(e.data,h,p,m,f);if(v.tload=t.tload,d===i.MANIFEST){var g={url:h,details:v};a.trigger(l.default.MANIFEST_LOADED,{levels:[g],audioTracks:[],url:h,stats:t,networkDetails:o})}if(t.tparsed=O.now(),v.needSidxRanges){var y=v.initSegment.url;this.load({url:y,isSidxRequest:!0,type:d,level:c,levelDetails:v,id:s,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"})}else n.levelDetails=v,this._handlePlaylistLoaded(e,t,n,o)},a._handleSidxRequest=function(e,t){if("string"==typeof e.data)throw new Error("sidx request must be made with responseType of array buffer");var n=f.default.parseSegmentIndex(new Uint8Array(e.data));if(n){var r=n.references,i=t.levelDetails;r.forEach((function(e,t){var n=e.info;if(i){var r=i.fragments[t];0===r.byteRange.length&&r.setByteRange(String(1+n.end-n.start)+"@"+String(n.start))}})),i&&i.initSegment.setByteRange(String(n.moovEndOffset)+"@0")}},a._handleManifestParsingError=function(e,t,n,r){this.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:e.url,reason:n,networkDetails:r})},a._handleNetworkError=function(e,t,n,r){var o,a;void 0===n&&(n=!1),void 0===r&&(r=null),c.logger.info("A network error occured while loading a "+e.type+"-type playlist");var u=this.getInternalLoader(e);switch(e.type){case i.MANIFEST:o=n?s.ErrorDetails.MANIFEST_LOAD_TIMEOUT:s.ErrorDetails.MANIFEST_LOAD_ERROR,a=!0;break;case i.LEVEL:o=n?s.ErrorDetails.LEVEL_LOAD_TIMEOUT:s.ErrorDetails.LEVEL_LOAD_ERROR,a=!1;break;case i.AUDIO_TRACK:o=n?s.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:s.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,a=!1;break;default:a=!1}u&&(u.abort(),this.resetInternalLoader(e.type));var d={type:s.ErrorTypes.NETWORK_ERROR,details:o,fatal:a,url:e.url,loader:u,context:e,networkDetails:t};r&&(d.response=r),this.hls.trigger(l.default.ERROR,d)},a._handlePlaylistLoaded=function(e,t,n,o){var a=n.type,s=n.level,u=n.id,c=n.levelDetails;if(c&&c.targetduration)if(r.canHaveQualityLevels(n.type))this.hls.trigger(l.default.LEVEL_LOADED,{details:c,level:s||0,id:u||0,stats:t,networkDetails:o});else switch(a){case i.AUDIO_TRACK:this.hls.trigger(l.default.AUDIO_TRACK_LOADED,{details:c,id:u,stats:t,networkDetails:o});break;case i.SUBTITLE_TRACK:this.hls.trigger(l.default.SUBTITLE_TRACK_LOADED,{details:c,id:u,stats:t,networkDetails:o})}else this._handleManifestParsingError(e,n,"invalid target duration",o)},r}(h),I=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,l.default.FRAG_LOADING)||this).loaders={},n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.destroy=function(){var t=this.loaders;for(var n in t){var r=t[n];r&&r.destroy()}this.loaders={},e.prototype.destroy.call(this)},i.onFragLoading=function(e){var t=e.frag,n=t.type,r=this.loaders,i=this.hls.config,o=i.fLoader,a=i.loader;t.loaded=0;var s,l,d,h=r[n];h&&(c.logger.warn("abort previous fragment loader for type: "+n),h.abort()),h=r[n]=t.loader=i.fLoader?new o(i):new a(i),s={url:t.url,frag:t,responseType:"arraybuffer",progressData:!1};var f=t.byteRangeStartOffset,p=t.byteRangeEndOffset;Object(u.isFiniteNumber)(f)&&Object(u.isFiniteNumber)(p)&&(s.rangeStart=f,s.rangeEnd=p),l={timeout:i.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:i.fragLoadingMaxRetryTimeout},d={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},h.load(s,l,d)},i.loadsuccess=function(e,t,n,r){void 0===r&&(r=null);var i=e.data,o=n.frag;o.loader=void 0,this.loaders[o.type]=void 0,this.hls.trigger(l.default.FRAG_LOADED,{payload:i,frag:o,stats:t,networkDetails:r})},i.loaderror=function(e,t,n){void 0===n&&(n=null);var r=t.frag,i=r.loader;i&&i.abort(),this.loaders[r.type]=void 0,this.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t.frag,response:e,networkDetails:n})},i.loadtimeout=function(e,t,n){void 0===n&&(n=null);var r=t.frag,i=r.loader;i&&i.abort(),this.loaders[r.type]=void 0,this.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t.frag,networkDetails:n})},i.loadprogress=function(e,t,n,r){void 0===r&&(r=null);var i=t.frag;i.loaded=e.loaded,this.hls.trigger(l.default.FRAG_LOAD_PROGRESS,{frag:i,stats:e,networkDetails:r})},r}(h),D=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,l.default.KEY_LOADING)||this).loaders={},n.decryptkey=null,n.decrypturl=null,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.destroy=function(){for(var t in this.loaders){var n=this.loaders[t];n&&n.destroy()}this.loaders={},e.prototype.destroy.call(this)},i.onKeyLoading=function(e){var t=e.frag,n=t.type,r=this.loaders[n];if(t.decryptdata){var i=t.decryptdata.uri;if(i!==this.decrypturl||null===this.decryptkey){var o=this.hls.config;if(r&&(c.logger.warn("abort previous key loader for type:"+n),r.abort()),!i)return void c.logger.warn("key uri is falsy");t.loader=this.loaders[n]=new o.loader(o),this.decrypturl=i,this.decryptkey=null;var a={url:i,frag:t,responseType:"arraybuffer"},s={timeout:o.fragLoadingTimeOut,maxRetry:0,retryDelay:o.fragLoadingRetryDelay,maxRetryDelay:o.fragLoadingMaxRetryTimeout},u={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};t.loader.load(a,s,u)}else this.decryptkey&&(t.decryptdata.key=this.decryptkey,this.hls.trigger(l.default.KEY_LOADED,{frag:t}))}else c.logger.warn("Missing decryption data on fragment in onKeyLoading")},i.loadsuccess=function(e,t,n){var r=n.frag;r.decryptdata?(this.decryptkey=r.decryptdata.key=new Uint8Array(e.data),r.loader=void 0,delete this.loaders[r.type],this.hls.trigger(l.default.KEY_LOADED,{frag:r})):c.logger.error("after key load, decryptdata unset")},i.loaderror=function(e,t){var n=t.frag,r=n.loader;r&&r.abort(),delete this.loaders[n.type],this.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:n,response:e})},i.loadtimeout=function(e,t){var n=t.frag,r=n.loader;r&&r.abort(),delete this.loaders[n.type],this.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:n})},r}(h),N="NOT_LOADED",B="APPENDING",U="PARTIAL",F="OK",V=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,l.default.BUFFER_APPENDED,l.default.FRAG_BUFFERED,l.default.FRAG_LOADED)||this).bufferPadding=.2,n.fragments=Object.create(null),n.timeRanges=Object.create(null),n.config=t.config,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.destroy=function(){this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.config=null,h.prototype.destroy.call(this),e.prototype.destroy.call(this)},i.getBufferedFrag=function(e,t){var n=this.fragments,r=Object.keys(n).filter((function(r){var i=n[r];if(i.body.type!==t)return!1;if(!i.buffered)return!1;var o=i.body;return o.startPTS<=e&&e<=o.endPTS}));if(0===r.length)return null;var i=r.pop();return n[i].body},i.detectEvictedFragments=function(e,t){var n,r,i=this;Object.keys(this.fragments).forEach((function(o){var a=i.fragments[o];if(!0===a.buffered){var s=a.range[e];if(s){n=s.time;for(var u=0;u<n.length;u++)if(r=n[u],!1===i.isTimeBuffered(r.startPTS,r.endPTS,t)){i.removeFragment(a.body);break}}}}))},i.detectPartialFragments=function(e){var t=this,n=this.getFragmentKey(e),r=this.fragments[n];r&&(r.buffered=!0,Object.keys(this.timeRanges).forEach((function(n){if(e.hasElementaryStream(n)){var i=t.timeRanges[n];r.range[n]=t.getBufferedTimes(e.startPTS,e.endPTS,i)}})))},i.getBufferedTimes=function(e,t,n){for(var r,i,o=[],a=!1,s=0;s<n.length;s++){if(r=n.start(s)-this.bufferPadding,i=n.end(s)+this.bufferPadding,e>=r&&t<=i){o.push({startPTS:Math.max(e,n.start(s)),endPTS:Math.min(t,n.end(s))});break}if(e<i&&t>r)o.push({startPTS:Math.max(e,n.start(s)),endPTS:Math.min(t,n.end(s))}),a=!0;else if(t<=r)break}return{time:o,partial:a}},i.getFragmentKey=function(e){return e.type+"_"+e.level+"_"+e.urlId+"_"+e.sn},i.getPartialFragment=function(e){var t,n,r,i=this,o=null,a=0;return Object.keys(this.fragments).forEach((function(s){var u=i.fragments[s];i.isPartial(u)&&(n=u.body.startPTS-i.bufferPadding,r=u.body.endPTS+i.bufferPadding,e>=n&&e<=r&&(t=Math.min(e-n,r-e),a<=t&&(o=u.body,a=t)))})),o},i.getState=function(e){var t=this.getFragmentKey(e),n=this.fragments[t],r=N;return void 0!==n&&(r=n.buffered?!0===this.isPartial(n)?U:F:B),r},i.isPartial=function(e){return!0===e.buffered&&(void 0!==e.range.video&&!0===e.range.video.partial||void 0!==e.range.audio&&!0===e.range.audio.partial)},i.isTimeBuffered=function(e,t,n){for(var r,i,o=0;o<n.length;o++){if(r=n.start(o)-this.bufferPadding,i=n.end(o)+this.bufferPadding,e>=r&&t<=i)return!0;if(t<=r)return!1}return!1},i.onFragLoaded=function(e){var t=e.frag;Object(u.isFiniteNumber)(t.sn)&&!t.bitrateTest&&(this.fragments[this.getFragmentKey(t)]={body:t,range:Object.create(null),buffered:!1})},i.onBufferAppended=function(e){var t=this;this.timeRanges=e.timeRanges,Object.keys(this.timeRanges).forEach((function(e){var n=t.timeRanges[e];t.detectEvictedFragments(e,n)}))},i.onFragBuffered=function(e){this.detectPartialFragments(e.frag)},i.hasFragment=function(e){var t=this.getFragmentKey(e);return void 0!==this.fragments[t]},i.removeFragment=function(e){var t=this.getFragmentKey(e);delete this.fragments[t]},i.removeAllFragments=function(){this.fragments=Object.create(null)},r}(h),G={search:function(e,t){for(var n=0,r=e.length-1,i=null,o=null;n<=r;){var a=t(o=e[i=(n+r)/2|0]);if(a>0)n=i+1;else{if(!(a<0))return o;r=i-1}}return null}},H=function(){function e(){}return e.isBuffered=function(e,t){try{if(e)for(var n=e.buffered,r=0;r<n.length;r++)if(t>=n.start(r)&&t<=n.end(r))return!0}catch(e){}return!1},e.bufferInfo=function(e,t,n){try{if(e){var r,i=e.buffered,o=[];for(r=0;r<i.length;r++)o.push({start:i.start(r),end:i.end(r)});return this.bufferedInfo(o,t,n)}}catch(e){}return{len:0,start:t,end:t,nextStart:void 0}},e.bufferedInfo=function(e,t,n){e.sort((function(e,t){var n=e.start-t.start;return n||t.end-e.end}));var r=[];if(n)for(var i=0;i<e.length;i++){var o=r.length;if(o){var a=r[o-1].end;e[i].start-a<n?e[i].end>a&&(r[o-1].end=e[i].end):r.push(e[i])}else r.push(e[i])}else r=e;for(var s,u=0,l=t,c=t,d=0;d<r.length;d++){var h=r[d].start,f=r[d].end;if(t+n>=h&&t<f)l=h,u=(c=f)-t;else if(t+n<h){s=h;break}}return{len:u,start:l,end:c,nextStart:s}},e}(),z=n("./node_modules/eventemitter3/index.js"),W=n("./node_modules/webworkify-webpack/index.js"),q=n("./src/demux/demuxer-inline.js");function K(){return window.MediaSource||window.WebKitMediaSource}var Y=n("./src/utils/get-self-scope.js"),X=function(e){var t,n;function r(){return e.apply(this,arguments)||this}return n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,r.prototype.trigger=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.emit.apply(this,[e,e].concat(n))},r}(z.EventEmitter),J=Object(Y.getSelfScope)(),Z=K()||{isTypeSupported:function(){return!1}},$=function(){function e(e,t){var n=this;this.hls=e,this.id=t;var r=this.observer=new X,i=e.config,o=function(t,r){(r=r||{}).frag=n.frag,r.id=n.id,e.trigger(t,r)};r.on(l.default.FRAG_DECRYPTED,o),r.on(l.default.FRAG_PARSING_INIT_SEGMENT,o),r.on(l.default.FRAG_PARSING_DATA,o),r.on(l.default.FRAG_PARSED,o),r.on(l.default.ERROR,o),r.on(l.default.FRAG_PARSING_METADATA,o),r.on(l.default.FRAG_PARSING_USERDATA,o),r.on(l.default.INIT_PTS_FOUND,o);var a={mp4:Z.isTypeSupported("video/mp4"),mpeg:Z.isTypeSupported("audio/mpeg"),mp3:Z.isTypeSupported('audio/mp4; codecs="mp3"')},u=navigator.vendor;if(i.enableWorker&&"undefined"!=typeof Worker){var d;c.logger.log("demuxing in webworker");try{d=this.w=W("./src/demux/demuxer-worker.js"),this.onwmsg=this.onWorkerMessage.bind(this),d.addEventListener("message",this.onwmsg),d.onerror=function(t){e.trigger(l.default.ERROR,{type:s.ErrorTypes.OTHER_ERROR,details:s.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:t.message+" ("+t.filename+":"+t.lineno+")"}})},d.postMessage({cmd:"init",typeSupported:a,vendor:u,id:t,config:JSON.stringify(i)})}catch(e){c.logger.warn("Error in worker:",e),c.logger.error("Error while initializing DemuxerWorker, fallback on DemuxerInline"),d&&J.URL.revokeObjectURL(d.objectURL),this.demuxer=new q.default(r,a,i,u),this.w=void 0}}else this.demuxer=new q.default(r,a,i,u)}var t=e.prototype;return t.destroy=function(){var e=this.w;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.w=null;else{var t=this.demuxer;t&&(t.destroy(),this.demuxer=null)}var n=this.observer;n&&(n.removeAllListeners(),this.observer=null)},t.push=function(e,t,n,r,i,o,a,s){var l=this.w,d=Object(u.isFiniteNumber)(i.startPTS)?i.startPTS:i.start,h=i.decryptdata,f=this.frag,p=!(f&&i.cc===f.cc),m=!(f&&i.level===f.level),v=f&&i.sn===f.sn+1,g=!m&&v;if(p&&c.logger.log(this.id+":discontinuity detected"),m&&c.logger.log(this.id+":switch detected"),this.frag=i,l)l.postMessage({cmd:"demux",data:e,decryptdata:h,initSegment:t,audioCodec:n,videoCodec:r,timeOffset:d,discontinuity:p,trackSwitch:m,contiguous:g,duration:o,accurateTimeOffset:a,defaultInitPTS:s},e instanceof ArrayBuffer?[e]:[]);else{var y=this.demuxer;y&&y.push(e,h,t,n,r,d,p,m,g,o,a,s)}},t.onWorkerMessage=function(e){var t=e.data,n=this.hls;switch(t.event){case"init":J.URL.revokeObjectURL(this.w.objectURL);break;case l.default.FRAG_PARSING_DATA:t.data.data1=new Uint8Array(t.data1),t.data2&&(t.data.data2=new Uint8Array(t.data2));default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,n.trigger(t.event,t.data)}},e}();function Q(e,t,n){switch(t){case"audio":e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds.push(n);break;case"text":e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds.push(n)}}function ee(e,t,n){var r=e[t],i=e[n],o=i.startPTS;Object(u.isFiniteNumber)(o)?n>t?(r.duration=o-r.start,r.duration<0&&c.logger.warn("negative duration computed for frag "+r.sn+",level "+r.level+", there should be some duration drift between playlist and fragment!")):(i.duration=r.start-o,i.duration<0&&c.logger.warn("negative duration computed for frag "+i.sn+",level "+i.level+", there should be some duration drift between playlist and fragment!")):i.start=n>t?r.start+r.duration:Math.max(r.start-i.duration,0)}function te(e,t,n,r,i,o){var a=n;if(Object(u.isFiniteNumber)(t.startPTS)){var s=Math.abs(t.startPTS-n);Object(u.isFiniteNumber)(t.deltaPTS)?t.deltaPTS=Math.max(s,t.deltaPTS):t.deltaPTS=s,a=Math.max(n,t.startPTS),n=Math.min(n,t.startPTS),r=Math.max(r,t.endPTS),i=Math.min(i,t.startDTS),o=Math.max(o,t.endDTS)}var l=n-t.start;t.start=t.startPTS=n,t.maxStartPTS=a,t.endPTS=r,t.startDTS=i,t.endDTS=o,t.duration=r-n;var c,d,h,f=t.sn;if(!e||f<e.startSN||f>e.endSN)return 0;for(c=f-e.startSN,(d=e.fragments)[c]=t,h=c;h>0;h--)ee(d,h,h-1);for(h=c;h<d.length-1;h++)ee(d,h,h+1);return e.PTSKnown=!0,l}function ne(e,t){t.initSegment&&e.initSegment&&(t.initSegment=e.initSegment);var n,r=0;if(re(e,t,(function(e,i){r=e.cc-i.cc,Object(u.isFiniteNumber)(e.startPTS)&&(i.start=i.startPTS=e.startPTS,i.endPTS=e.endPTS,i.duration=e.duration,i.backtracked=e.backtracked,i.dropped=e.dropped,n=i),t.PTSKnown=!0})),t.PTSKnown){if(r){c.logger.log("discontinuity sliding from playlist, take drift into account");for(var i=t.fragments,o=0;o<i.length;o++)i[o].cc+=r}n?te(t,n,n.startPTS,n.endPTS,n.startDTS,n.endDTS):function(e,t){var n=t.startSN-e.startSN,r=e.fragments,i=t.fragments;if(!(n<0||n>r.length))for(var o=0;o<i.length;o++)i[o].start+=r[n].start}(e,t),t.PTSKnown=e.PTSKnown}}function re(e,t,n){if(e&&t)for(var r=Math.max(e.startSN,t.startSN)-t.startSN,i=Math.min(e.endSN,t.endSN)-t.startSN,o=t.startSN-e.startSN,a=r;a<=i;a++){var s=e.fragments[o+a],u=t.fragments[a];if(!s||!u)break;n(s,u,a)}}function ie(e,t,n){var r=1e3*(t.averagetargetduration?t.averagetargetduration:t.targetduration),i=r/2;return e&&t.endSN===e.endSN&&(r=i),n&&(r=Math.max(i,r-(window.performance.now()-n))),Math.round(r)}var oe={toString:function(e){for(var t="",n=e.length,r=0;r<n;r++)t+="["+e.start(r).toFixed(3)+","+e.end(r).toFixed(3)+"]";return t}};function ae(e,t){t.fragments.forEach((function(t){if(t){var n=t.start+e;t.start=t.startPTS=n,t.endPTS=n+t.duration}})),t.PTSKnown=!0}function se(e,t,n){!function(e,t,n){if(function(e,t,n){var r=!1;return t&&t.details&&n&&(n.endCC>n.startCC||e&&e.cc<n.startCC)&&(r=!0),r}(e,n,t)){var r=function(e,t){var n=e.fragments,r=t.fragments;if(r.length&&n.length){var i=function(e,t){for(var n=null,r=0;r<e.length;r+=1){var i=e[r];if(i&&i.cc===t){n=i;break}}return n}(n,r[0].cc);if(i&&(!i||i.startPTS))return i;c.logger.log("No frag in previous level to align on")}else c.logger.log("No fragments to align")}(n.details,t);r&&(c.logger.log("Adjusting PTS using last level due to CC increase within current level"),ae(r.start,t))}}(e,n,t),!n.PTSKnown&&t&&function(e,t){if(t&&t.fragments.length){if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;var n=t.fragments[0].programDateTime,r=(e.fragments[0].programDateTime-n)/1e3+t.fragments[0].start;Object(u.isFiniteNumber)(r)&&(c.logger.log("adjusting PTS using programDateTime delta, sliding:"+r.toFixed(3)),ae(r,e))}}(n,t.details)}function ue(e,t,n){if(null===t||!Array.isArray(e)||!e.length||!Object(u.isFiniteNumber)(t))return null;if(t<(e[0].programDateTime||0))return null;if(t>=(e[e.length-1].endProgramDateTime||0))return null;n=n||0;for(var r=0;r<e.length;++r){var i=e[r];if(de(t,n,i))return i}return null}function le(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var i=e?t[e.sn-t[0].sn+1]:null;return i&&!ce(n,r,i)?i:G.search(t,ce.bind(null,n,r))}function ce(e,t,n){void 0===e&&(e=0),void 0===t&&(t=0);var r=Math.min(t,n.duration+(n.deltaPTS?n.deltaPTS:0));return n.start+n.duration-r<=e?1:n.start-r>e&&n.start?-1:0}function de(e,t,n){var r=1e3*Math.min(t,n.duration+(n.deltaPTS?n.deltaPTS:0));return(n.endProgramDateTime||0)-r>e}var he=function(){function e(e,t,n,r){this.config=e,this.media=t,this.fragmentTracker=n,this.hls=r,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1}var t=e.prototype;return t.poll=function(e){var t=this.config,n=this.media,r=this.stalled,i=n.currentTime,o=n.seeking,a=this.seeking&&!o,s=!this.seeking&&o;if(this.seeking=o,i===e){if((s||a)&&(this.stalled=null),!n.paused&&!n.ended&&0!==n.playbackRate&&n.buffered.length){var u=H.bufferInfo(n,i,0),l=u.len>0,d=u.nextStart||0;if(l||d){if(o){if(u.len>2||!d||d-i>2)return;this.moved=!1}if(!this.moved&&this.stalled){var h=Math.max(d,u.start||0)-i;if(h>0&&h<=2)return void this._trySkipBufferHole(null)}var f=self.performance.now();if(null!==r){var p=f-r;!o&&p>=250&&this._reportStall(u.len);var m=H.bufferInfo(n,i,t.maxBufferHole);this._tryFixBufferStall(m,p)}else this.stalled=f}}}else if(this.moved=!0,null!==r){if(this.stallReported){var v=self.performance.now()-r;c.logger.warn("playback not stuck anymore @"+i+", after "+Math.round(v)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}},t._tryFixBufferStall=function(e,t){var n=this.config,r=this.fragmentTracker,i=this.media.currentTime,o=r.getPartialFragment(i);o&&this._trySkipBufferHole(o)||e.len>n.maxBufferHole&&t>1e3*n.highBufferWatchdogPeriod&&(c.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},t._reportStall=function(e){var t=this.hls,n=this.media;this.stallReported||(this.stallReported=!0,c.logger.warn("Playback stalling at @"+n.currentTime+" due to low buffer"),t.trigger(l.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:e}))},t._trySkipBufferHole=function(e){for(var t=this.config,n=this.hls,r=this.media,i=r.currentTime,o=0,a=0;a<r.buffered.length;a++){var u=r.buffered.start(a);if(i+t.maxBufferHole>=o&&i<u){var d=Math.max(u+.05,r.currentTime+.1);return c.logger.warn("skipping hole, adjusting currentTime from "+i+" to "+d),this.moved=!0,this.stalled=null,r.currentTime=d,e&&n.trigger(l.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+i+" to "+d,frag:e}),d}o=r.buffered.end(a)}return 0},t._tryNudgeBuffer=function(){var e=this.config,t=this.hls,n=this.media,r=n.currentTime,i=(this.nudgeRetry||0)+1;if(this.nudgeRetry=i,i<e.nudgeMaxRetry){var o=r+i*e.nudgeOffset;c.logger.warn("Nudging 'currentTime' from "+r+" to "+o),n.currentTime=o,t.trigger(l.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else c.logger.error("Playhead still not moving while enough data buffered @"+r+" after "+e.nudgeMaxRetry+" nudges"),t.trigger(l.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},e}();function fe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var pe=function(e){var t,n;function r(t){for(var n,r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return(n=e.call.apply(e,[this,t].concat(i))||this)._boundTick=void 0,n._tickTimer=null,n._tickInterval=null,n._tickCallCount=0,n._boundTick=n.tick.bind(fe(n)),n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},i.hasInterval=function(){return!!this._tickInterval},i.hasNextTick=function(){return!!this._tickTimer},i.setInterval=function(e){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,e),!0)},i.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},i.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},i.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&(this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)),this._tickCallCount=0)},i.doTick=function(){},r}(h),me="STOPPED",ve="STARTING",ge="IDLE",ye="PAUSED",_e="KEY_LOADING",be="FRAG_LOADING",Ee="FRAG_LOADING_WAITING_RETRY",we="WAITING_TRACK",Te="PARSING",Se="PARSED",xe="BUFFER_FLUSHING",Ae="ENDED",Me="ERROR",je="WAITING_INIT_PTS",Re="WAITING_LEVEL",Le=function(e){var t,n;function r(){return e.apply(this,arguments)||this}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.doTick=function(){},i.startLoad=function(){},i.stopLoad=function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragmentTracker.removeFragment(e)),this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=me},i._streamEnded=function(e,t){var n=this.fragCurrent,r=this.fragmentTracker;if(!t.live&&n&&!n.backtracked&&n.sn===t.endSN&&!e.nextStart){var i=r.getState(n);return i===U||i===F}return!1},i.onMediaSeeking=function(){var e=this.config,t=this.media,n=this.mediaBuffer,r=this.state,i=t?t.currentTime:null,o=H.bufferInfo(n||t,i,this.config.maxBufferHole);if(Object(u.isFiniteNumber)(i)&&c.logger.log("media seeking to "+i.toFixed(3)),r===be){var a=this.fragCurrent;if(0===o.len&&a){var s=e.maxFragLookUpTolerance,l=a.start-s,d=a.start+a.duration+s;i<l||i>d?(a.loader&&(c.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),a.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=ge):c.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else r===Ae&&(0===o.len&&(this.fragPrevious=null,this.fragCurrent=null),this.state=ge);t&&(this.lastCurrentTime=i),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=i),this.tick()},i.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},i.onHandlerDestroying=function(){this.stopLoad(),e.prototype.onHandlerDestroying.call(this)},i.onHandlerDestroyed=function(){this.state=me,this.fragmentTracker=null},i.computeLivePosition=function(e,t){var n=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*t.targetduration;return e+Math.max(0,t.totalduration-n)},r}(pe);function Ce(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ke=function(e){var t,n;function r(t,n){var r;return(r=e.call(this,t,l.default.MEDIA_ATTACHED,l.default.MEDIA_DETACHING,l.default.MANIFEST_LOADING,l.default.MANIFEST_PARSED,l.default.LEVEL_LOADED,l.default.KEY_LOADED,l.default.FRAG_LOADED,l.default.FRAG_LOAD_EMERGENCY_ABORTED,l.default.FRAG_PARSING_INIT_SEGMENT,l.default.FRAG_PARSING_DATA,l.default.FRAG_PARSED,l.default.ERROR,l.default.AUDIO_TRACK_SWITCHING,l.default.AUDIO_TRACK_SWITCHED,l.default.BUFFER_CREATED,l.default.BUFFER_APPENDED,l.default.BUFFER_FLUSHED)||this).fragmentTracker=n,r.config=t.config,r.audioCodecSwap=!1,r._state=me,r.stallReported=!1,r.gapController=null,r.altAudio=!1,r}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i,a,d,h=r.prototype;return h.startLoad=function(e){if(this.levels){var t=this.lastCurrentTime,n=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var r=n.startLevel;-1===r&&(r=0,this.bitrateTest=!0),this.level=n.nextLoadLevel=r,this.loadedmetadata=!1}t>0&&-1===e&&(c.logger.log("override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=ge,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this.forceStartLoad=!0,this.state=me},h.stopLoad=function(){this.forceStartLoad=!1,e.prototype.stopLoad.call(this)},h.doTick=function(){switch(this.state){case xe:this.fragLoadError=0;break;case ge:this._doTickIdle();break;case Re:var e=this.levels[this.level];e&&e.details&&(this.state=ge);break;case Ee:var t=window.performance.now(),n=this.retryDate;(!n||t>=n||this.media&&this.media.seeking)&&(c.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=ge)}this._checkBuffer(),this._checkFragmentChanged()},h._doTickIdle=function(){var e=this.hls,t=e.config,n=this.media;if(void 0!==this.levelLastLoaded&&(n||!this.startFragRequested&&t.startFragPrefetch)){var r;r=this.loadedmetadata?n.currentTime:this.nextLoadPosition;var i=e.nextLoadLevel,o=this.levels[i];if(o){var a,s=o.bitrate;a=s?Math.max(8*t.maxBufferSize/s,t.maxBufferLength):t.maxBufferLength,a=Math.min(a,t.maxMaxBufferLength);var u=H.bufferInfo(this.mediaBuffer?this.mediaBuffer:n,r,t.maxBufferHole),d=u.len;if(!(d>=a)){c.logger.trace("buffer length of "+d.toFixed(3)+" is below max of "+a.toFixed(3)+". checking for more payload ..."),this.level=e.nextLoadLevel=i;var h=o.details;if(!h||h.live&&this.levelLastLoaded!==i)this.state=Re;else{if(this._streamEnded(u,h)){var f={};return this.altAudio&&(f.type="video"),this.hls.trigger(l.default.BUFFER_EOS,f),void(this.state=Ae)}this._fetchPayloadOrEos(r,u,h)}}}}},h._fetchPayloadOrEos=function(e,t,n){var r=this.fragPrevious,i=this.level,o=n.fragments,a=o.length;if(0!==a){var s,u=o[0].start,l=o[a-1].start+o[a-1].duration,d=t.end;if(n.initSegment&&!n.initSegment.data)s=n.initSegment;else if(n.live){var h=this.config.initialLiveManifestSize;if(a<h)return void c.logger.warn("Can not start playback of a level, reason: not enough fragments "+a+" < "+h);if(null===(s=this._ensureFragmentAtLivePoint(n,d,u,l,r,o,a)))return}else d<u&&(s=o[0]);s||(s=this._findFragment(u,r,a,o,d,l,n)),s&&(s.encrypted?(c.logger.log("Loading key for "+s.sn+" of ["+n.startSN+" ,"+n.endSN+"],level "+i),this._loadKey(s)):(c.logger.log("Loading "+s.sn+" of ["+n.startSN+" ,"+n.endSN+"],level "+i+", currentTime:"+e.toFixed(3)+",bufferEnd:"+d.toFixed(3)),this._loadFragment(s)))}},h._ensureFragmentAtLivePoint=function(e,t,n,r,i,o,a){var s,u=this.hls.config,l=this.media,d=void 0!==u.liveMaxLatencyDuration?u.liveMaxLatencyDuration:u.liveMaxLatencyDurationCount*e.targetduration;if(t<Math.max(n-u.maxFragLookUpTolerance,r-d)){var h=this.liveSyncPosition=this.computeLivePosition(n,e);c.logger.log("buffer end: "+t.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+h.toFixed(3)),t=h,l&&!l.paused&&l.readyState&&l.duration>h&&(l.currentTime=h),this.nextLoadPosition=h}if(e.PTSKnown&&t>r&&l&&l.readyState)return null;if(this.startFragRequested&&!e.PTSKnown){if(i)if(e.hasProgramDateTime)c.logger.log("live playlist, switching playlist, load frag with same PDT: "+i.programDateTime),s=ue(o,i.endProgramDateTime,u.maxFragLookUpTolerance);else{var f=i.sn+1;if(f>=e.startSN&&f<=e.endSN){var p=o[f-e.startSN];i.cc===p.cc&&(s=p,c.logger.log("live playlist, switching playlist, load frag with next SN: "+s.sn))}s||(s=G.search(o,(function(e){return i.cc-e.cc})))&&c.logger.log("live playlist, switching playlist, load frag with same CC: "+s.sn)}s||(s=o[Math.min(a-1,Math.round(a/2))],c.logger.log("live playlist, switching playlist, unknown, load middle frag : "+s.sn))}return s},h._findFragment=function(e,t,n,r,i,o,a){var s,u=this.hls.config;if(s=i<o?le(t,r,i,i>o-u.maxFragLookUpTolerance?0:u.maxFragLookUpTolerance):r[n-1]){var l=s.sn-a.startSN,d=t&&s.level===t.level,h=r[l-1],f=r[l+1];if(t&&s.sn===t.sn)if(d&&!s.backtracked)if(s.sn<a.endSN){var p=t.deltaPTS;p&&p>u.maxBufferHole&&t.dropped&&l?(s=h,c.logger.warn("Previous fragment was dropped with large PTS gap between audio and video. Maybe fragment is not starting with a keyframe? Loading previous one to try to overcome this")):(s=f,c.logger.log("Re-loading fragment with SN: "+s.sn))}else s=null;else s.backtracked&&(f&&f.backtracked?(c.logger.warn("Already backtracked from fragment "+f.sn+", will not backtrack to fragment "+s.sn+". Loading fragment "+f.sn),s=f):(c.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),s.dropped=0,h?(s=h).backtracked=!0:l&&(s=null)))}return s},h._loadKey=function(e){this.state=_e,this.hls.trigger(l.default.KEY_LOADING,{frag:e})},h._loadFragment=function(e){var t=this.fragmentTracker.getState(e);this.fragCurrent=e,"initSegment"!==e.sn&&(this.startFragRequested=!0),Object(u.isFiniteNumber)(e.sn)&&!e.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),e.backtracked||t===N||t===U?(e.autoLevel=this.hls.autoLevelEnabled,e.bitrateTest=this.bitrateTest,this.hls.trigger(l.default.FRAG_LOADING,{frag:e}),this.demuxer||(this.demuxer=new $(this.hls,"main")),this.state=be):t===B&&this._reduceMaxBufferLength(e.duration)&&this.fragmentTracker.removeFragment(e)},h.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,o.MAIN)},h.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.endPTS+.5):null},h._checkFragmentChanged=function(){var e,t,n=this.media;if(n&&n.readyState&&!1===n.seeking&&((t=n.currentTime)>this.lastCurrentTime&&(this.lastCurrentTime=t),H.isBuffered(n,t)?e=this.getBufferedFrag(t):H.isBuffered(n,t+.1)&&(e=this.getBufferedFrag(t+.1)),e)){var r=e;if(r!==this.fragPlaying){this.hls.trigger(l.default.FRAG_CHANGED,{frag:r});var i=r.level;this.fragPlaying&&this.fragPlaying.level===i||this.hls.trigger(l.default.LEVEL_SWITCHED,{level:i}),this.fragPlaying=r}}},h.immediateLevelSwitch=function(){if(c.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var e,t=this.media;t?(e=t.paused,t.pause()):e=!0,this.previouslyPaused=e}var n=this.fragCurrent;n&&n.loader&&n.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},h.immediateLevelSwitchEnd=function(){var e=this.media;e&&e.buffered.length&&(this.immediateSwitch=!1,H.isBuffered(e,e.currentTime)&&(e.currentTime-=1e-4),this.previouslyPaused||e.play())},h.nextLevelSwitch=function(){var e=this.media;if(e&&e.readyState){var t,n,r;if((n=this.getBufferedFrag(e.currentTime))&&n.startPTS>1&&this.flushMainBuffer(0,n.startPTS-1),e.paused)t=0;else{var i=this.hls.nextLoadLevel,o=this.levels[i],a=this.fragLastKbps;t=a&&this.fragCurrent?this.fragCurrent.duration*o.bitrate/(1e3*a)+1:0}if((r=this.getBufferedFrag(e.currentTime+t))&&(r=this.followingBufferedFrag(r))){var s=this.fragCurrent;s&&s.loader&&s.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(r.maxStartPTS,Number.POSITIVE_INFINITY)}}},h.flushMainBuffer=function(e,t){this.state=xe;var n={startOffset:e,endOffset:t};this.altAudio&&(n.type="video"),this.hls.trigger(l.default.BUFFER_FLUSHING,n)},h.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("seeked",this.onvseeked),t.addEventListener("ended",this.onvended);var n=this.config;this.levels&&n.autoStartLoad&&this.hls.startLoad(n.startPosition),this.gapController=new he(n,t,this.fragmentTracker,this.hls)},h.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(c.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.levels;t&&t.forEach((function(e){e.details&&e.details.fragments.forEach((function(e){e.backtracked=void 0}))})),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("seeked",this.onvseeked),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.fragmentTracker.removeAllFragments(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},h.onMediaSeeked=function(){var e=this.media,t=e?e.currentTime:void 0;Object(u.isFiniteNumber)(t)&&c.logger.log("media seeked to "+t.toFixed(3)),this.tick()},h.onManifestLoading=function(){c.logger.log("trigger BUFFER_RESET"),this.hls.trigger(l.default.BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0},h.onManifestParsed=function(e){var t,n=!1,r=!1;e.levels.forEach((function(e){(t=e.audioCodec)&&(-1!==t.indexOf("mp4a.40.2")&&(n=!0),-1!==t.indexOf("mp4a.40.5")&&(r=!0))})),this.audioCodecSwitch=n&&r,this.audioCodecSwitch&&c.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.altAudio=e.altAudio,this.levels=e.levels,this.startFragRequested=!1;var i=this.config;(i.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(i.startPosition)},h.onLevelLoaded=function(e){var t=e.details,n=e.level,r=this.levels[this.levelLastLoaded],i=this.levels[n],o=t.totalduration,a=0;if(c.logger.log("level "+n+" loaded ["+t.startSN+","+t.endSN+"],duration:"+o),t.live){var s=i.details;s&&t.fragments.length>0?(ne(s,t),a=t.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(a,s),t.PTSKnown&&Object(u.isFiniteNumber)(a)?c.logger.log("live playlist sliding:"+a.toFixed(3)):(c.logger.log("live playlist - outdated PTS, unknown sliding"),se(this.fragPrevious,r,t))):(c.logger.log("live playlist - first load, unknown sliding"),t.PTSKnown=!1,se(this.fragPrevious,r,t))}else t.PTSKnown=!1;if(i.details=t,this.levelLastLoaded=n,this.hls.trigger(l.default.LEVEL_UPDATED,{details:t,level:n}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var d=t.startTimeOffset;Object(u.isFiniteNumber)(d)?(d<0&&(c.logger.log("negative start time offset "+d+", count from end of last fragment"),d=a+o+d),c.logger.log("start time offset found in playlist, adjust startPosition to "+d),this.startPosition=d):t.live?(this.startPosition=this.computeLivePosition(a,t),c.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0,this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===Re&&(this.state=ge),this.tick()},h.onKeyLoaded=function(){this.state===_e&&(this.state=ge,this.tick())},h.onFragLoaded=function(e){var t=this.fragCurrent,n=this.hls,r=this.levels,i=this.media,o=e.frag;if(this.state===be&&t&&"main"===o.type&&o.level===t.level&&o.sn===t.sn){var a=e.stats,s=r[t.level],u=s.details;if(this.bitrateTest=!1,this.stats=a,c.logger.log("Loaded "+t.sn+" of ["+u.startSN+" ,"+u.endSN+"],level "+t.level),o.bitrateTest&&n.nextLoadLevel)this.state=ge,this.startFragRequested=!1,a.tparsed=a.tbuffered=window.performance.now(),n.trigger(l.default.FRAG_BUFFERED,{stats:a,frag:t,id:"main"}),this.tick();else if("initSegment"===o.sn)this.state=ge,a.tparsed=a.tbuffered=window.performance.now(),u.initSegment.data=e.payload,n.trigger(l.default.FRAG_BUFFERED,{stats:a,frag:t,id:"main"}),this.tick();else{c.logger.log("Parsing "+t.sn+" of ["+u.startSN+" ,"+u.endSN+"],level "+t.level+", cc "+t.cc),this.state=Te,this.pendingBuffering=!0,this.appended=!1,o.bitrateTest&&(o.bitrateTest=!1,this.fragmentTracker.onFragLoaded({frag:o}));var d=!(i&&i.seeking)&&(u.PTSKnown||!u.live),h=u.initSegment?u.initSegment.data:[],f=this._getAudioCodec(s);(this.demuxer=this.demuxer||new $(this.hls,"main")).push(e.payload,h,f,s.videoCodec,t,u.totalduration,d)}}this.fragLoadError=0},h.onFragParsingInitSegment=function(e){var t=this.fragCurrent,n=e.frag;if(t&&"main"===e.id&&n.sn===t.sn&&n.level===t.level&&this.state===Te){var r,i,o=e.tracks;if(o.audio&&this.altAudio&&delete o.audio,i=o.audio){var a=this.levels[this.level].audioCodec,s=navigator.userAgent.toLowerCase();a&&this.audioCodecSwap&&(c.logger.log("swapping playlist audio codec"),a=-1!==a.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==i.metadata.channelCount&&-1===s.indexOf("firefox")&&(a="mp4a.40.5"),-1!==s.indexOf("android")&&"audio/mpeg"!==i.container&&(a="mp4a.40.2",c.logger.log("Android: force audio codec to "+a)),i.levelCodec=a,i.id=e.id}for(r in(i=o.video)&&(i.levelCodec=this.levels[this.level].videoCodec,i.id=e.id),this.hls.trigger(l.default.BUFFER_CODECS,o),o){i=o[r],c.logger.log("main track:"+r+",container:"+i.container+",codecs[level/parsed]=["+i.levelCodec+"/"+i.codec+"]");var u=i.initSegment;u&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(l.default.BUFFER_APPENDING,{type:r,data:u,parent:"main",content:"initSegment"}))}this.tick()}},h.onFragParsingData=function(e){var t=this,n=this.fragCurrent,r=e.frag;if(n&&"main"===e.id&&r.sn===n.sn&&r.level===n.level&&("audio"!==e.type||!this.altAudio)&&this.state===Te){var i=this.levels[this.level],o=n;if(Object(u.isFiniteNumber)(e.endPTS)||(e.endPTS=e.startPTS+n.duration,e.endDTS=e.startDTS+n.duration),!0===e.hasAudio&&o.addElementaryStream(m.AUDIO),!0===e.hasVideo&&o.addElementaryStream(m.VIDEO),c.logger.log("Parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb+",dropped:"+(e.dropped||0)),"video"===e.type)if(o.dropped=e.dropped,o.dropped)if(o.backtracked)c.logger.warn("Already backtracked on this fragment, appending with the gap",o.sn);else{var a=i.details;if(!a||o.sn!==a.startSN)return c.logger.warn("missing video frame(s), backtracking fragment",o.sn),this.fragmentTracker.removeFragment(o),o.backtracked=!0,this.nextLoadPosition=e.startPTS,this.state=ge,this.fragPrevious=o,void this.tick();c.logger.warn("missing video frame(s) on first frag, appending with gap",o.sn)}else o.backtracked=!1;var s=te(i.details,o,e.startPTS,e.endPTS,e.startDTS,e.endDTS),d=this.hls;d.trigger(l.default.LEVEL_PTS_UPDATED,{details:i.details,level:this.level,drift:s,type:e.type,start:e.startPTS,end:e.endPTS}),[e.data1,e.data2].forEach((function(n){n&&n.length&&t.state===Te&&(t.appended=!0,t.pendingBuffering=!0,d.trigger(l.default.BUFFER_APPENDING,{type:e.type,data:n,parent:"main",content:"data"}))})),this.tick()}},h.onFragParsed=function(e){var t=this.fragCurrent,n=e.frag;t&&"main"===e.id&&n.sn===t.sn&&n.level===t.level&&this.state===Te&&(this.stats.tparsed=window.performance.now(),this.state=Se,this._checkAppendedParsed())},h.onAudioTrackSwitching=function(e){var t=!!e.url,n=e.id;if(!t){if(this.mediaBuffer!==this.media){c.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var r=this.fragCurrent;r.loader&&(c.logger.log("switching to main audio track, cancel main fragment load"),r.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=ge}var i=this.hls;i.trigger(l.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),i.trigger(l.default.AUDIO_TRACK_SWITCHED,{id:n}),this.altAudio=!1}},h.onAudioTrackSwitched=function(e){var t=e.id,n=!!this.hls.audioTracks[t].url;if(n){var r=this.videoBuffer;r&&this.mediaBuffer!==r&&(c.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=n,this.tick()},h.onBufferCreated=function(e){var t,n,r=e.tracks,i=!1;for(var o in r){var a=r[o];"main"===a.id?(n=o,t=a,"video"===o&&(this.videoBuffer=r[o].buffer)):i=!0}i&&t?(c.logger.log("alternate track found, use "+n+".buffered to schedule main fragment loading"),this.mediaBuffer=t.buffer):this.mediaBuffer=this.media},h.onBufferAppended=function(e){if("main"===e.parent){var t=this.state;t!==Te&&t!==Se||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}},h._checkAppendedParsed=function(){if(!(this.state!==Se||this.appended&&this.pendingBuffering)){var e=this.fragCurrent;if(e){var t=this.mediaBuffer?this.mediaBuffer:this.media;c.logger.log("main buffered : "+oe.toString(t.buffered)),this.fragPrevious=e;var n=this.stats;n.tbuffered=window.performance.now(),this.fragLastKbps=Math.round(8*n.total/(n.tbuffered-n.tfirst)),this.hls.trigger(l.default.FRAG_BUFFERED,{stats:n,frag:e,id:"main"}),this.state=ge}this.tick()}},h.onError=function(e){var t=e.frag||this.fragCurrent;if(!t||"main"===t.type){var n=!!this.media&&H.isBuffered(this.media,this.media.currentTime)&&H.isBuffered(this.media,this.media.currentTime+.5);switch(e.details){case s.ErrorDetails.FRAG_LOAD_ERROR:case s.ErrorDetails.FRAG_LOAD_TIMEOUT:case s.ErrorDetails.KEY_LOAD_ERROR:case s.ErrorDetails.KEY_LOAD_TIMEOUT:if(!e.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var r=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);c.logger.warn("mediaController: frag loading failed, retry in "+r+" ms"),this.retryDate=window.performance.now()+r,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=Ee}else c.logger.error("mediaController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=Me;break;case s.ErrorDetails.LEVEL_LOAD_ERROR:case s.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==Me&&(e.fatal?(this.state=Me,c.logger.warn("streamController: "+e.details+",switch to "+this.state+" state ...")):e.levelRetry||this.state!==Re||(this.state=ge));break;case s.ErrorDetails.BUFFER_FULL_ERROR:"main"!==e.parent||this.state!==Te&&this.state!==Se||(n?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=ge):(c.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}},h._reduceMaxBufferLength=function(e){var t=this.config;return t.maxMaxBufferLength>=e&&(t.maxMaxBufferLength/=2,c.logger.warn("main:reduce max buffer length to "+t.maxMaxBufferLength+"s"),!0)},h._checkBuffer=function(){var e=this.media;if(e&&0!==e.readyState){var t=(this.mediaBuffer?this.mediaBuffer:e).buffered;!this.loadedmetadata&&t.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():this.gapController.poll(this.lastCurrentTime,t)}},h.onFragLoadEmergencyAborted=function(){this.state=ge,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},h.onBufferFlushed=function(){var e=this.mediaBuffer?this.mediaBuffer:this.media;e&&this.fragmentTracker.detectEvictedFragments(m.VIDEO,e.buffered),this.state=ge,this.fragPrevious=null},h.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},h._seekToStartPos=function(){var e=this.media,t=e.currentTime,n=e.seeking?t:this.startPosition;t!==n&&n>=0&&(c.logger.log("target start position not buffered, seek to buffered.start(0) "+n+" from current time "+t+" "),e.currentTime=n)},h._getAudioCodec=function(e){var t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&(c.logger.log("swapping playlist audio codec"),t&&(t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),t},i=r,(a=[{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,c.logger.log("main stream-controller: "+t+"->"+e),this.hls.trigger(l.default.STREAM_STATE_TRANSITION,{previousState:t,nextState:e})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var e=this.media;if(e){var t=this.getBufferedFrag(e.currentTime);if(t)return t.level}return-1}},{key:"nextBufferedFrag",get:function(){var e=this.media;return e?this.followingBufferedFrag(this.getBufferedFrag(e.currentTime)):null}},{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(e){this._liveSyncPosition=e}}])&&Ce(i.prototype,a),d&&Ce(i,d),r}(Le);function Oe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}window.performance;var Pe,Ie=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,l.default.MANIFEST_LOADED,l.default.LEVEL_LOADED,l.default.AUDIO_TRACK_SWITCHED,l.default.FRAG_LOADED,l.default.ERROR)||this).canload=!1,n.currentLevelIndex=null,n.manualLevelIndex=-1,n.timer=null,Pe=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i,o,a,u=r.prototype;return u.onHandlerDestroying=function(){this.clearTimer(),this.manualLevelIndex=-1},u.clearTimer=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},u.startLoad=function(){var e=this._levels;this.canload=!0,this.levelRetryCount=0,e&&e.forEach((function(e){e.loadError=0;var t=e.details;t&&t.live&&(e.details=void 0)})),null!==this.timer&&this.loadLevel()},u.stopLoad=function(){this.canload=!1},u.onManifestLoaded=function(e){var t,n=[],r=[],i={},o=null,a=!1,u=!1;if(e.levels.forEach((function(e){var t=e.attrs;e.loadError=0,e.fragmentError=!1,a=a||!!e.videoCodec,u=u||!!e.audioCodec,Pe&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(e.audioCodec=void 0),(o=i[e.bitrate])?o.url.push(e.url):(e.url=[e.url],e.urlId=0,i[e.bitrate]=e,n.push(e)),t&&(t.AUDIO&&(u=!0,Q(o||e,"audio",t.AUDIO)),t.SUBTITLES&&Q(o||e,"text",t.SUBTITLES))})),a&&u&&(n=n.filter((function(e){return!!e.videoCodec}))),n=n.filter((function(e){var t=e.audioCodec,n=e.videoCodec;return(!t||x(t,"audio"))&&(!n||x(n,"video"))})),e.audioTracks&&(r=e.audioTracks.filter((function(e){return!e.audioCodec||x(e.audioCodec,"audio")}))).forEach((function(e,t){e.id=t})),n.length>0){t=n[0].bitrate,n.sort((function(e,t){return e.bitrate-t.bitrate})),this._levels=n;for(var d=0;d<n.length;d++)if(n[d].bitrate===t){this._firstLevel=d,c.logger.log("manifest loaded,"+n.length+" level(s) found, first bitrate:"+t);break}this.hls.trigger(l.default.MANIFEST_PARSED,{levels:n,audioTracks:r,firstLevel:this._firstLevel,stats:e.stats,audio:u,video:a,altAudio:r.some((function(e){return!!e.url}))})}else this.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},u.setLevelInternal=function(e){var t=this._levels,n=this.hls;if(e>=0&&e<t.length){if(this.clearTimer(),this.currentLevelIndex!==e){c.logger.log("switching to level "+e),this.currentLevelIndex=e;var r=t[e];r.level=e,n.trigger(l.default.LEVEL_SWITCHING,r)}var i=t[e],o=i.details;if(!o||o.live){var a=i.urlId;n.trigger(l.default.LEVEL_LOADING,{url:i.url[a],level:e,id:a})}}else n.trigger(l.default.ERROR,{type:s.ErrorTypes.OTHER_ERROR,details:s.ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:"invalid level idx"})},u.onError=function(e){if(e.fatal)e.type===s.ErrorTypes.NETWORK_ERROR&&this.clearTimer();else{var t,n=!1,r=!1;switch(e.details){case s.ErrorDetails.FRAG_LOAD_ERROR:case s.ErrorDetails.FRAG_LOAD_TIMEOUT:case s.ErrorDetails.KEY_LOAD_ERROR:case s.ErrorDetails.KEY_LOAD_TIMEOUT:t=e.frag.level,r=!0;break;case s.ErrorDetails.LEVEL_LOAD_ERROR:case s.ErrorDetails.LEVEL_LOAD_TIMEOUT:t=e.context.level,n=!0;break;case s.ErrorDetails.REMUX_ALLOC_ERROR:t=e.level,n=!0}void 0!==t&&this.recoverLevel(e,t,n,r)}},u.recoverLevel=function(e,t,n,r){var i,o,a,s=this,u=this.hls.config,l=e.details,d=this._levels[t];if(d.loadError++,d.fragmentError=r,n){if(!(this.levelRetryCount+1<=u.levelLoadingMaxRetry))return c.logger.error("level controller, cannot recover from "+l+" error"),this.currentLevelIndex=null,this.clearTimer(),void(e.fatal=!0);o=Math.min(Math.pow(2,this.levelRetryCount)*u.levelLoadingRetryDelay,u.levelLoadingMaxRetryTimeout),this.timer=setTimeout((function(){return s.loadLevel()}),o),e.levelRetry=!0,this.levelRetryCount++,c.logger.warn("level controller, "+l+", retry in "+o+" ms, current retry count is "+this.levelRetryCount)}(n||r)&&((i=d.url.length)>1&&d.loadError<i?(d.urlId=(d.urlId+1)%i,d.details=void 0,c.logger.warn("level controller, "+l+" for level "+t+": switching to redundant URL-id "+d.urlId)):-1===this.manualLevelIndex?(a=0===t?this._levels.length-1:t-1,c.logger.warn("level controller, "+l+": switch to "+a),this.hls.nextAutoLevel=this.currentLevelIndex=a):r&&(c.logger.warn("level controller, "+l+": reload a fragment"),this.currentLevelIndex=null))},u.onFragLoaded=function(e){var t=e.frag;if(void 0!==t&&"main"===t.type){var n=this._levels[t.level];void 0!==n&&(n.fragmentError=!1,n.loadError=0,this.levelRetryCount=0)}},u.onLevelLoaded=function(e){var t=this,n=e.level,r=e.details;if(n===this.currentLevelIndex){var i=this._levels[n];if(i.fragmentError||(i.loadError=0,this.levelRetryCount=0),r.live){var o=ie(i.details,r,e.stats.trequest);c.logger.log("live playlist, reload in "+Math.round(o)+" ms"),this.timer=setTimeout((function(){return t.loadLevel()}),o)}else this.clearTimer()}},u.onAudioTrackSwitched=function(e){var t=this.hls.audioTracks[e.id].groupId,n=this.hls.levels[this.currentLevelIndex];if(n&&n.audioGroupIds){for(var r=-1,i=0;i<n.audioGroupIds.length;i++)if(n.audioGroupIds[i]===t){r=i;break}r!==n.urlId&&(n.urlId=r,this.startLoad())}},u.loadLevel=function(){if(c.logger.debug("call to loadLevel"),null!==this.currentLevelIndex&&this.canload){var e=this._levels[this.currentLevelIndex];if("object"==typeof e&&e.url.length>0){var t=this.currentLevelIndex,n=e.urlId,r=e.url[n];c.logger.log("Attempt loading level index "+t+" with URL-id "+n),this.hls.trigger(l.default.LEVEL_LOADING,{url:r,level:t,id:n})}}},i=r,(o=[{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var t=this._levels;t&&(e=Math.min(e,t.length-1),this.currentLevelIndex===e&&t[e].details||this.setLevelInternal(e))}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}return this._startLevel},set:function(e){this._startLevel=e}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}}])&&Oe(i.prototype,o),a&&Oe(i,a),r}(h),De=n("./src/demux/id3.js");function Ne(e,t){var n;try{n=new Event("addtrack")}catch(e){(n=document.createEvent("Event")).initEvent("addtrack",!1,!1)}n.track=e,t.dispatchEvent(n)}function Be(e){if(e&&e.cues)for(;e.cues.length>0;)e.removeCue(e.cues[0])}var Ue=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,l.default.MEDIA_ATTACHED,l.default.MEDIA_DETACHING,l.default.FRAG_PARSING_METADATA,l.default.LIVE_BACK_BUFFER_REACHED)||this).id3Track=void 0,n.media=void 0,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.destroy=function(){h.prototype.destroy.call(this)},i.onMediaAttached=function(e){this.media=e.media,this.media},i.onMediaDetaching=function(){Be(this.id3Track),this.id3Track=void 0,this.media=void 0},i.getID3Track=function(e){for(var t=0;t<e.length;t++){var n=e[t];if("metadata"===n.kind&&"id3"===n.label)return Ne(n,this.media),n}return this.media.addTextTrack("metadata","id3")},i.onFragParsingMetadata=function(e){var t=e.frag,n=e.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var r=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,i=0;i<n.length;i++){var o=De.default.getID3Frames(n[i].data);if(o){var a=n[i].pts,s=i<n.length-1?n[i+1].pts:t.endPTS;a===s?s+=1e-4:a>s&&(c.logger.warn("detected an id3 sample with endTime < startTime, adjusting endTime to (startTime + 0.25)"),s=a+.25);for(var u=0;u<o.length;u++){var l=o[u];if(!De.default.isTimeStampFrame(l)){var d=new r(a,s,"");d.value=l,this.id3Track.addCue(d)}}}}},i.onLiveBackBufferReached=function(e){var t=e.bufferEnd,n=this.id3Track;if(n&&n.cues&&n.cues.length){var r=function(e,t){if(t<e[0].endTime)return e[0];if(t>e[e.length-1].endTime)return e[e.length-1];for(var n=0,r=e.length-1;n<=r;){var i=Math.floor((r+n)/2);if(t<e[i].endTime)r=i-1;else{if(!(t>e[i].endTime))return e[i];n=i+1}}return e[n].endTime-t<t-e[r].endTime?e[n]:e[r]}(n.cues,t);if(r)for(;n.cues[0]!==r;)n.removeCue(n.cues[0])}},r}(h),Fe=function(){function e(e){this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=0,this.totalWeight_=0}var t=e.prototype;return t.sample=function(e,t){var n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e},t.getTotalWeight=function(){return this.totalWeight_},t.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/e}return this.estimate_},e}(),Ve=function(){function e(e,t,n,r){this.hls=void 0,this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.hls=e,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Fe(t),this.fast_=new Fe(n)}var t=e.prototype;return t.sample=function(e,t){var n=(e=Math.max(e,this.minDelayMs_))/1e3,r=8*t/n;this.fast_.sample(n,r),this.slow_.sample(n,r)},t.canEstimate=function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_},t.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},t.destroy=function(){},e}();function Ge(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var He=window.performance,ze=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,l.default.FRAG_LOADING,l.default.FRAG_LOADED,l.default.FRAG_BUFFERED,l.default.ERROR)||this).lastLoadedFragLevel=0,n._nextAutoLevel=-1,n.hls=t,n.timer=null,n._bwEstimator=null,n.onCheck=n._abandonRulesCheck.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(n)),n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i,o,a,d=r.prototype;return d.destroy=function(){this.clearTimer(),h.prototype.destroy.call(this)},d.onFragLoading=function(e){var t=e.frag;if("main"===t.type&&(this.timer||(this.fragCurrent=t,this.timer=setInterval(this.onCheck,100)),!this._bwEstimator)){var n,r,i=this.hls,o=i.config,a=t.level;i.levels[a].details.live?(n=o.abrEwmaFastLive,r=o.abrEwmaSlowLive):(n=o.abrEwmaFastVoD,r=o.abrEwmaSlowVoD),this._bwEstimator=new Ve(i,r,n,o.abrEwmaDefaultEstimate)}},d._abandonRulesCheck=function(){var e=this.hls,t=e.media,n=this.fragCurrent;if(n){var r=n.loader,i=e.minAutoLevel;if(!r||r.stats&&r.stats.aborted)return c.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var o=r.stats;if(t&&o&&(!t.paused&&0!==t.playbackRate||!t.readyState)&&n.autoLevel&&n.level){var a=He.now()-o.trequest,s=Math.abs(t.playbackRate);if(a>500*n.duration/s){var u=e.levels,d=Math.max(1,o.bw?o.bw/8:1e3*o.loaded/a),h=u[n.level],f=h.realBitrate?Math.max(h.realBitrate,h.bitrate):h.bitrate,p=o.total?o.total:Math.max(o.loaded,Math.round(n.duration*f/8)),m=t.currentTime,v=(p-o.loaded)/d,g=(H.bufferInfo(t,m,e.config.maxBufferHole).end-m)/s;if(g<2*n.duration/s&&v>g){var y;for(y=n.level-1;y>i;y--){var _=u[y].realBitrate?Math.max(u[y].realBitrate,u[y].bitrate):u[y].bitrate;if(n.duration*_/(6.4*d)<g)break}void 0<v&&(c.logger.warn("loading too slow, abort fragment loading and switch to level "+y+":fragLoadedDelay["+y+"]<fragLoadedDelay["+(n.level-1)+"];bufferStarvationDelay:"+(void 0).toFixed(1)+"<"+v.toFixed(1)+":"+g.toFixed(1)),e.nextLoadLevel=y,this._bwEstimator.sample(a,o.loaded),r.abort(),this.clearTimer(),e.trigger(l.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,stats:o}))}}}}},d.onFragLoaded=function(e){var t=e.frag;if("main"===t.type&&Object(u.isFiniteNumber)(t.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var n=this.hls.levels[t.level],r=(n.loaded?n.loaded.bytes:0)+e.stats.loaded,i=(n.loaded?n.loaded.duration:0)+e.frag.duration;n.loaded={bytes:r,duration:i},n.realBitrate=Math.round(8*r/i)}if(e.frag.bitrateTest){var o=e.stats;o.tparsed=o.tbuffered=o.tload,this.onFragBuffered(e)}}},d.onFragBuffered=function(e){var t=e.stats,n=e.frag;if(!0!==t.aborted&&"main"===n.type&&Object(u.isFiniteNumber)(n.sn)&&(!n.bitrateTest||t.tload===t.tbuffered)){var r=t.tparsed-t.trequest;c.logger.log("latency/loading/parsing/append/kbps:"+Math.round(t.tfirst-t.trequest)+"/"+Math.round(t.tload-t.tfirst)+"/"+Math.round(t.tparsed-t.tload)+"/"+Math.round(t.tbuffered-t.tparsed)+"/"+Math.round(8*t.loaded/(t.tbuffered-t.trequest))),this._bwEstimator.sample(r,t.loaded),t.bwEstimate=this._bwEstimator.getEstimate(),n.bitrateTest?this.bitrateTestDelay=r/1e3:this.bitrateTestDelay=0}},d.onError=function(e){switch(e.details){case s.ErrorDetails.FRAG_LOAD_ERROR:case s.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},d.clearTimer=function(){clearInterval(this.timer),this.timer=null},d._findBestLevel=function(e,t,n,r,i,o,a,s,u){for(var l=i;l>=r;l--){var d=u[l];if(d){var h=d.details,f=h?h.totalduration/h.fragments.length:t,p=!!h&&h.live,m=void 0;m=l<=e?a*n:s*n;var v=u[l].realBitrate?Math.max(u[l].realBitrate,u[l].bitrate):u[l].bitrate,g=v*f/m;if(c.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+l+"/"+Math.round(m)+"/"+v+"/"+f+"/"+o+"/"+g),m>v&&(!g||p&&!this.bitrateTestDelay||g<o))return l}}return-1},i=r,(o=[{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this._bwEstimator;if(!(-1===e||t&&t.canEstimate()))return e;var n=this._nextABRAutoLevel;return-1!==e&&(n=Math.min(e,n)),n},set:function(e){this._nextAutoLevel=e}},{key:"_nextABRAutoLevel",get:function(){var e=this.hls,t=e.maxAutoLevel,n=e.levels,r=e.config,i=e.minAutoLevel,o=e.media,a=this.lastLoadedFragLevel,s=this.fragCurrent?this.fragCurrent.duration:0,u=o?o.currentTime:0,l=o&&0!==o.playbackRate?Math.abs(o.playbackRate):1,d=this._bwEstimator?this._bwEstimator.getEstimate():r.abrEwmaDefaultEstimate,h=(H.bufferInfo(o,u,r.maxBufferHole).end-u)/l,f=this._findBestLevel(a,s,d,i,t,h,r.abrBandWidthFactor,r.abrBandWidthUpFactor,n);if(f>=0)return f;c.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var p=s?Math.min(s,r.maxStarvationDelay):r.maxStarvationDelay,m=r.abrBandWidthFactor,v=r.abrBandWidthUpFactor;if(0===h){var g=this.bitrateTestDelay;g&&(p=(s?Math.min(s,r.maxLoadingDelay):r.maxLoadingDelay)-g,c.logger.trace("bitrate test took "+Math.round(1e3*g)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*p)+" ms"),m=v=1)}return f=this._findBestLevel(a,s,d,i,t,h+p,m,v,n),Math.max(f,0)}}])&&Ge(i.prototype,o),a&&Ge(i,a),r}(h),We=K(),qe=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,l.default.MEDIA_ATTACHING,l.default.MEDIA_DETACHING,l.default.MANIFEST_PARSED,l.default.BUFFER_RESET,l.default.BUFFER_APPENDING,l.default.BUFFER_CODECS,l.default.BUFFER_EOS,l.default.BUFFER_FLUSHING,l.default.LEVEL_PTS_UPDATED,l.default.LEVEL_UPDATED)||this)._msDuration=null,n._levelDuration=null,n._levelTargetDuration=10,n._live=null,n._objectUrl=null,n._needsFlush=!1,n._needsEos=!1,n.config=void 0,n.audioTimestampOffset=void 0,n.bufferCodecEventsExpected=0,n._bufferCodecEventsTotal=0,n.media=null,n.mediaSource=null,n.segments=[],n.parent=void 0,n.appending=!1,n.appended=0,n.appendError=0,n.flushBufferCounter=0,n.tracks={},n.pendingTracks={},n.sourceBuffer={},n.flushRange=[],n._onMediaSourceOpen=function(){c.logger.log("media source opened"),n.hls.trigger(l.default.MEDIA_ATTACHED,{media:n.media});var e=n.mediaSource;e&&e.removeEventListener("sourceopen",n._onMediaSourceOpen),n.checkPendingTracks()},n._onMediaSourceClose=function(){c.logger.log("media source closed")},n._onMediaSourceEnded=function(){c.logger.log("media source ended")},n._onSBUpdateEnd=function(){if(n.audioTimestampOffset&&n.sourceBuffer.audio){var e=n.sourceBuffer.audio;c.logger.warn("change mpeg audio timestamp offset from "+e.timestampOffset+" to "+n.audioTimestampOffset),e.timestampOffset=n.audioTimestampOffset,delete n.audioTimestampOffset}n._needsFlush&&n.doFlush(),n._needsEos&&n.checkEos(),n.appending=!1;var t=n.parent,r=n.segments.reduce((function(e,n){return n.parent===t?e+1:e}),0),i={},o=n.sourceBuffer;for(var a in o){var s=o[a];if(!s)throw Error("handling source buffer update end error: source buffer for "+a+" uninitilized and unable to update buffered TimeRanges.");i[a]=s.buffered}n.hls.trigger(l.default.BUFFER_APPENDED,{parent:t,pending:r,timeRanges:i}),n._needsFlush||n.doAppending(),n.updateMediaElementDuration(),0===r&&n.flushLiveBackBuffer()},n._onSBUpdateError=function(e){c.logger.error("sourceBuffer error:",e),n.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})},n.config=t.config,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.destroy=function(){h.prototype.destroy.call(this)},i.onLevelPtsUpdated=function(e){var t=e.type,n=this.tracks.audio;if("audio"===t&&n&&"audio/mpeg"===n.container){var r=this.sourceBuffer.audio;if(!r)throw Error("Level PTS Updated and source buffer for audio uninitalized");if(Math.abs(r.timestampOffset-e.start)>.1){var i=r.updating;try{r.abort()}catch(e){c.logger.warn("can not abort audio buffer: "+e)}i?this.audioTimestampOffset=e.start:(c.logger.warn("change mpeg audio timestamp offset from "+r.timestampOffset+" to "+e.start),r.timestampOffset=e.start)}}},i.onManifestParsed=function(e){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=e.altAudio?2:1,c.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},i.onMediaAttaching=function(e){var t=this.media=e.media;if(t&&We){var n=this.mediaSource=new We;n.addEventListener("sourceopen",this._onMediaSourceOpen),n.addEventListener("sourceended",this._onMediaSourceEnded),n.addEventListener("sourceclose",this._onMediaSourceClose),t.src=window.URL.createObjectURL(n),this._objectUrl=t.src}},i.onMediaDetaching=function(){c.logger.log("media source detaching");var e=this.mediaSource;if(e){if("open"===e.readyState)try{e.endOfStream()}catch(e){c.logger.warn("onMediaDetaching:"+e.message+" while calling endOfStream")}e.removeEventListener("sourceopen",this._onMediaSourceOpen),e.removeEventListener("sourceended",this._onMediaSourceEnded),e.removeEventListener("sourceclose",this._onMediaSourceClose),this.media&&(this._objectUrl&&window.URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):c.logger.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.hls.trigger(l.default.MEDIA_DETACHED)},i.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,t=this.pendingTracks,n=Object.keys(t).length;(n&&!e||2===n)&&(this.createSourceBuffers(t),this.pendingTracks={},this.doAppending())},i.onBufferReset=function(){var e=this.sourceBuffer;for(var t in e){var n=e[t];try{n&&(this.mediaSource&&this.mediaSource.removeSourceBuffer(n),n.removeEventListener("updateend",this._onSBUpdateEnd),n.removeEventListener("error",this._onSBUpdateError))}catch(e){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},i.onBufferCodecs=function(e){var t=this;Object.keys(this.sourceBuffer).length||(Object.keys(e).forEach((function(n){t.pendingTracks[n]=e[n]})),this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},i.createSourceBuffers=function(e){var t=this.sourceBuffer,n=this.mediaSource;if(!n)throw Error("createSourceBuffers called when mediaSource was null");for(var r in e)if(!t[r]){var i=e[r];if(!i)throw Error("source buffer exists for track "+r+", however track does not");var o=i.levelCodec||i.codec,a=i.container+";codecs="+o;c.logger.log("creating sourceBuffer("+a+")");try{var u=t[r]=n.addSourceBuffer(a);u.addEventListener("updateend",this._onSBUpdateEnd),u.addEventListener("error",this._onSBUpdateError),this.tracks[r]={buffer:u,codec:o,id:i.id,container:i.container,levelCodec:i.levelCodec}}catch(e){c.logger.error("error while trying to add sourceBuffer:"+e.message),this.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:e,mimeType:a})}}this.hls.trigger(l.default.BUFFER_CREATED,{tracks:this.tracks})},i.onBufferAppending=function(e){this._needsFlush||(this.segments?this.segments.push(e):this.segments=[e],this.doAppending())},i.onBufferEos=function(e){for(var t in this.sourceBuffer)if(!e.type||e.type===t){var n=this.sourceBuffer[t];n&&!n.ended&&(n.ended=!0,c.logger.log(t+" sourceBuffer now EOS"))}this.checkEos()},i.checkEos=function(){var e=this.sourceBuffer,t=this.mediaSource;if(t&&"open"===t.readyState){for(var n in e){var r=e[n];if(r){if(!r.ended)return;if(r.updating)return void(this._needsEos=!0)}}c.logger.log("all media data are available, signal endOfStream() to MediaSource and stop loading fragment");try{t.endOfStream()}catch(e){c.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}else this._needsEos=!1},i.onBufferFlushing=function(e){e.type?this.flushRange.push({start:e.startOffset,end:e.endOffset,type:e.type}):(this.flushRange.push({start:e.startOffset,end:e.endOffset,type:"video"}),this.flushRange.push({start:e.startOffset,end:e.endOffset,type:"audio"})),this.flushBufferCounter=0,this.doFlush()},i.flushLiveBackBuffer=function(){if(this._live){var e=this.config.liveBackBufferLength;if(isFinite(e)&&!(e<0))if(this.media)for(var t=this.media.currentTime,n=this.sourceBuffer,r=Object.keys(n),i=t-Math.max(e,this._levelTargetDuration),o=r.length-1;o>=0;o--){var a=r[o],s=n[a];if(s){var u=s.buffered;u.length>0&&i>u.start(0)&&this.removeBufferRange(a,s,0,i)&&this.hls.trigger(l.default.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i})}}else c.logger.error("flushLiveBackBuffer called without attaching media")}},i.onLevelUpdated=function(e){var t=e.details;t.fragments.length>0&&(this._levelDuration=t.totalduration+t.fragments[0].start,this._levelTargetDuration=t.averagetargetduration||t.targetduration||10,this._live=t.live,this.updateMediaElementDuration())},i.updateMediaElementDuration=function(){var e,t=this.config;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(var n in this.sourceBuffer){var r=this.sourceBuffer[n];if(r&&!0===r.updating)return}e=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),!0===this._live&&!0===t.liveDurationInfinity?(c.logger.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>e||!Object(u.isFiniteNumber)(e))&&(c.logger.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},i.doFlush=function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end,e.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var t=0,n=this.sourceBuffer;try{for(var r in n){var i=n[r];i&&(t+=i.buffered.length)}}catch(e){c.logger.error("error while accessing sourceBuffer.buffered")}this.appended=t,this.hls.trigger(l.default.BUFFER_FLUSHED)}},i.doAppending=function(){var e=this.config,t=this.hls,n=this.segments,r=this.sourceBuffer;if(Object.keys(r).length){if(!this.media||this.media.error)return this.segments=[],void c.logger.error("trying to append although a media error occured, flush segment and abort");if(!this.appending){var i=n.shift();if(i)try{var o=r[i.type];if(!o)return void this._onSBUpdateEnd();if(o.updating)return void n.unshift(i);o.ended=!1,this.parent=i.parent,o.appendBuffer(i.data),this.appendError=0,this.appended++,this.appending=!0}catch(r){c.logger.error("error while trying to append buffer:"+r.message),n.unshift(i);var a={type:s.ErrorTypes.MEDIA_ERROR,parent:i.parent,details:"",fatal:!1};22===r.code?(this.segments=[],a.details=s.ErrorDetails.BUFFER_FULL_ERROR):(this.appendError++,a.details=s.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>e.appendErrorMaxRetry&&(c.logger.log("fail "+e.appendErrorMaxRetry+" times to append segment in sourceBuffer"),this.segments=[],a.fatal=!0)),t.trigger(l.default.ERROR,a)}}}},i.flushBuffer=function(e,t,n){var r=this.sourceBuffer;if(!Object.keys(r).length)return!0;var i="null";if(this.media&&(i=this.media.currentTime.toFixed(3)),c.logger.log("flushBuffer,pos/start/end: "+i+"/"+e+"/"+t),this.flushBufferCounter>=this.appended)return c.logger.warn("abort flushing too many retries"),!0;var o=r[n];if(o){if(o.ended=!1,o.updating)return c.logger.warn("cannot flush, sb updating in progress"),!1;if(this.removeBufferRange(n,o,e,t))return this.flushBufferCounter++,!1}return c.logger.log("buffer flushed"),!0},i.removeBufferRange=function(e,t,n,r){try{for(var i=0;i<t.buffered.length;i++){var o=t.buffered.start(i),a=t.buffered.end(i),s=Math.max(o,n),u=Math.min(a,r);if(Math.min(u,a)-s>.5){var l="null";return this.media&&(l=this.media.currentTime.toString()),c.logger.log("sb remove "+e+" ["+s+","+u+"], of ["+o+","+a+"], pos:"+l),t.remove(s,u),!0}}}catch(e){c.logger.warn("removeBufferRange failed",e)}return!1},r}(h);function Ke(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ye=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,l.default.FPS_DROP_LEVEL_CAPPING,l.default.MEDIA_ATTACHING,l.default.MANIFEST_PARSED,l.default.BUFFER_CODECS,l.default.MEDIA_DETACHING)||this).autoLevelCapping=Number.POSITIVE_INFINITY,n.firstLevel=null,n.levels=[],n.media=null,n.restrictedLevels=[],n.timer=null,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i,o,a,s=r.prototype;return s.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this.stopCapping())},s.onFpsDropLevelCapping=function(e){r.isLevelAllowed(e.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(e.droppedLevel)},s.onMediaAttaching=function(e){this.media=e.media instanceof window.HTMLVideoElement?e.media:null},s.onManifestParsed=function(e){var t=this.hls;this.restrictedLevels=[],this.levels=e.levels,this.firstLevel=e.firstLevel,t.config.capLevelToPlayerSize&&e.video&&this.startCapping()},s.onBufferCodecs=function(e){this.hls.config.capLevelToPlayerSize&&e.video&&this.startCapping()},s.onLevelsUpdated=function(e){this.levels=e.levels},s.onMediaDetaching=function(){this.stopCapping()},s.detectPlayerSize=function(){if(this.media){var e=this.levels?this.levels.length:0;if(e){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e-1),t.autoLevelCapping>this.autoLevelCapping&&t.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}},s.getMaxLevel=function(e){var t=this;if(!this.levels)return-1;var n=this.levels.filter((function(n,i){return r.isLevelAllowed(i,t.restrictedLevels)&&i<=e}));return r.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)},s.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},s.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer),this.timer=null)},r.isLevelAllowed=function(e,t){return void 0===t&&(t=[]),-1===t.indexOf(e)},r.getMaxLevelByMediaSize=function(e,t,n){if(!e||e&&!e.length)return-1;for(var r,i,o=e.length-1,a=0;a<e.length;a+=1){var s=e[a];if((s.width>=t||s.height>=n)&&(r=s,!(i=e[a+1])||r.width!==i.width||r.height!==i.height)){o=a;break}}return o},i=r,a=[{key:"contentScaleFactor",get:function(){var e=1;try{e=window.devicePixelRatio}catch(e){}return e}}],(o=[{key:"mediaWidth",get:function(){var e,t=this.media;return t&&(e=t.width||t.clientWidth||t.offsetWidth,e*=r.contentScaleFactor),e}},{key:"mediaHeight",get:function(){var e,t=this.media;return t&&(e=t.height||t.clientHeight||t.offsetHeight,e*=r.contentScaleFactor),e}}])&&Ke(i.prototype,o),a&&Ke(i,a),r}(h),Xe=window.performance,Je=function(e){var t,n;function r(t){return e.call(this,t,l.default.MEDIA_ATTACHING)||this}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},i.onMediaAttaching=function(e){var t=this.hls.config;t.capLevelOnFPSDrop&&("function"==typeof(this.video=e.media instanceof window.HTMLVideoElement?e.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),t.fpsDroppedMonitoringPeriod))},i.checkFPS=function(e,t,n){var r=Xe.now();if(t){if(this.lastTime){var i=r-this.lastTime,o=n-this.lastDroppedFrames,a=t-this.lastDecodedFrames,s=1e3*o/i,u=this.hls;if(u.trigger(l.default.FPS_DROP,{currentDropped:o,currentDecoded:a,totalDroppedFrames:n}),s>0&&o>u.config.fpsDroppedMonitoringThreshold*a){var d=u.currentLevel;c.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+d),d>0&&(-1===u.autoLevelCapping||u.autoLevelCapping>=d)&&(d-=1,u.trigger(l.default.FPS_DROP_LEVEL_CAPPING,{level:d,droppedLevel:u.currentLevel}),u.autoLevelCapping=d,u.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=n,this.lastDecodedFrames=t}},i.checkFPSInterval=function(){var e=this.video;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},r}(h),Ze=window,$e=Ze.performance,Qe=Ze.XMLHttpRequest,et=function(){function e(e){e&&e.xhrSetup&&(this.xhrSetup=e.xhrSetup)}var t=e.prototype;return t.destroy=function(){this.abort(),this.loader=null},t.abort=function(){var e=this.loader;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},t.load=function(e,t,n){this.context=e,this.config=t,this.callbacks=n,this.stats={trequest:$e.now(),retry:0},this.retryDelay=t.retryDelay,this.loadInternal()},t.loadInternal=function(){var e,t=this.context;e=this.loader=new Qe;var n=this.stats;n.tfirst=0,n.loaded=0;var r=this.xhrSetup;try{if(r)try{r(e,t.url)}catch(n){e.open("GET",t.url,!0),r(e,t.url)}e.readyState||e.open("GET",t.url,!0)}catch(n){return void this.callbacks.onError({code:e.status,text:n.message},t,e)}t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),e.send()},t.readystatechange=function(e){var t=e.currentTarget,n=t.readyState,r=this.stats,i=this.context,o=this.config;if(!r.aborted&&n>=2)if(window.clearTimeout(this.requestTimeout),0===r.tfirst&&(r.tfirst=Math.max($e.now(),r.trequest)),4===n){var a=t.status;if(a>=200&&a<300){var s,u;r.tload=Math.max(r.tfirst,$e.now()),u="arraybuffer"===i.responseType?(s=t.response).byteLength:(s=t.responseText).length,r.loaded=r.total=u;var l={url:t.responseURL,data:s};this.callbacks.onSuccess(l,r,i,t)}else r.retry>=o.maxRetry||a>=400&&a<499?(c.logger.error(a+" while loading "+i.url),this.callbacks.onError({code:a,text:t.statusText},i,t)):(c.logger.warn(a+" while loading "+i.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,o.maxRetryDelay),r.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),o.timeout)},t.loadtimeout=function(){c.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},t.loadprogress=function(e){var t=e.currentTarget,n=this.stats;n.loaded=e.loaded,e.lengthComputable&&(n.total=e.total);var r=this.callbacks.onProgress;r&&r(n,this.context,null,t)},e}();function tt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var nt=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,l.default.MANIFEST_LOADING,l.default.MANIFEST_PARSED,l.default.AUDIO_TRACK_LOADED,l.default.AUDIO_TRACK_SWITCHED,l.default.LEVEL_LOADED,l.default.ERROR)||this)._trackId=-1,n._selectDefaultTrack=!0,n.tracks=[],n.trackIdBlacklist=Object.create(null),n.audioGroupId=null,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i,o,a,u=r.prototype;return u.onManifestLoading=function(){this.tracks=[],this._trackId=-1,this._selectDefaultTrack=!0},u.onManifestParsed=function(e){var t=this.tracks=e.audioTracks||[];this.hls.trigger(l.default.AUDIO_TRACKS_UPDATED,{audioTracks:t})},u.onAudioTrackLoaded=function(e){if(e.id>=this.tracks.length)c.logger.warn("Invalid audio track id:",e.id);else{if(c.logger.log("audioTrack "+e.id+" loaded"),this.tracks[e.id].details=e.details,e.details.live&&!this.hasInterval()){var t=1e3*e.details.targetduration;this.setInterval(t)}!e.details.live&&this.hasInterval()&&this.clearInterval()}},u.onAudioTrackSwitched=function(e){var t=this.tracks[e.id].groupId;t&&this.audioGroupId!==t&&(this.audioGroupId=t)},u.onLevelLoaded=function(e){var t=this.hls.levels[e.level];if(t.audioGroupIds){var n=t.audioGroupIds[t.urlId];this.audioGroupId!==n&&(this.audioGroupId=n,this._selectInitialAudioTrack())}},u.onError=function(e){e.type===s.ErrorTypes.NETWORK_ERROR&&(e.fatal&&this.clearInterval(),e.details===s.ErrorDetails.AUDIO_TRACK_LOAD_ERROR&&(c.logger.warn("Network failure on audio-track id:",e.context.id),this._handleLoadError()))},u._setAudioTrack=function(e){if(this._trackId===e&&this.tracks[this._trackId].details)c.logger.debug("Same id as current audio-track passed, and track details available -> no-op");else if(e<0||e>=this.tracks.length)c.logger.warn("Invalid id passed to audio-track controller");else{var t=this.tracks[e];c.logger.log("Now switching to audio-track index "+e),this.clearInterval(),this._trackId=e;var n=t.url,r=t.type,i=t.id;this.hls.trigger(l.default.AUDIO_TRACK_SWITCHING,{id:i,type:r,url:n}),this._loadTrackDetailsIfNeeded(t)}},u.doTick=function(){this._updateTrack(this._trackId)},u._selectInitialAudioTrack=function(){var e=this,t=this.tracks;if(t.length){var n=this.tracks[this._trackId],r=null;if(n&&(r=n.name),this._selectDefaultTrack){var i=t.filter((function(e){return e.default}));i.length?t=i:c.logger.warn("No default audio tracks defined")}var o=!1,a=function(){t.forEach((function(t){o||e.audioGroupId&&t.groupId!==e.audioGroupId||r&&r!==t.name||(e._setAudioTrack(t.id),o=!0)}))};a(),o||(r=null,a()),o||(c.logger.error("No track found for running audio group-ID: "+this.audioGroupId),this.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))}},u._needsTrackLoading=function(e){var t=e.details,n=e.url;return!(t&&!t.live||!n)},u._loadTrackDetailsIfNeeded=function(e){if(this._needsTrackLoading(e)){var t=e.url,n=e.id;c.logger.log("loading audio-track playlist for id: "+n),this.hls.trigger(l.default.AUDIO_TRACK_LOADING,{url:t,id:n})}},u._updateTrack=function(e){if(!(e<0||e>=this.tracks.length)){this.clearInterval(),this._trackId=e,c.logger.log("trying to update audio-track "+e);var t=this.tracks[e];this._loadTrackDetailsIfNeeded(t)}},u._handleLoadError=function(){this.trackIdBlacklist[this._trackId]=!0;var e=this._trackId,t=this.tracks[e],n=t.name,r=t.language,i=t.groupId;c.logger.warn("Loading failed on audio track id: "+e+", group-id: "+i+', name/language: "'+n+'" / "'+r+'"');for(var o=e,a=0;a<this.tracks.length;a++)if(!this.trackIdBlacklist[a]&&this.tracks[a].name===n){o=a;break}o!==e?(c.logger.log("Attempting audio-track fallback id:",o,"group-id:",this.tracks[o].groupId),this._setAudioTrack(o)):c.logger.warn('No fallback audio-track found for name/language: "'+n+'" / "'+r+'"')},i=r,(o=[{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this._trackId},set:function(e){this._setAudioTrack(e),this._selectDefaultTrack=!1}}])&&tt(i.prototype,o),a&&tt(i,a),r}(pe);function rt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var it=window.performance,ot=function(e){var t,n;function r(t,n){var r;return(r=e.call(this,t,l.default.MEDIA_ATTACHED,l.default.MEDIA_DETACHING,l.default.AUDIO_TRACKS_UPDATED,l.default.AUDIO_TRACK_SWITCHING,l.default.AUDIO_TRACK_LOADED,l.default.KEY_LOADED,l.default.FRAG_LOADED,l.default.FRAG_PARSING_INIT_SEGMENT,l.default.FRAG_PARSING_DATA,l.default.FRAG_PARSED,l.default.ERROR,l.default.BUFFER_RESET,l.default.BUFFER_CREATED,l.default.BUFFER_APPENDED,l.default.BUFFER_FLUSHED,l.default.INIT_PTS_FOUND)||this).fragmentTracker=n,r.config=t.config,r.audioCodecSwap=!1,r._state=me,r.initPTS=[],r.waitingFragment=null,r.videoTrackCC=null,r}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i,o,a,d=r.prototype;return d.onInitPtsFound=function(e){var t=e.id,n=e.frag.cc,r=e.initPTS;"main"===t&&(this.initPTS[n]=r,this.videoTrackCC=n,c.logger.log("InitPTS for cc: "+n+" found from video track: "+r),this.state===je&&this.tick())},d.startLoad=function(e){if(this.tracks){var t=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,t>0&&-1===e?(c.logger.log("audio:override startPosition with lastCurrentTime @"+t.toFixed(3)),this.state=ge):(this.lastCurrentTime=this.startPosition?this.startPosition:e,this.state=ve),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=e,this.state=me},d.doTick=function(){var e,t,n,r=this.hls,i=r.config;switch(this.state){case Me:case ye:case xe:break;case ve:this.state=we,this.loadedmetadata=!1;break;case ge:var o=this.tracks;if(!o)break;if(!this.media&&(this.startFragRequested||!i.startFragPrefetch))break;if(this.loadedmetadata)e=this.media.currentTime;else if(void 0===(e=this.nextLoadPosition))break;var a=this.mediaBuffer?this.mediaBuffer:this.media,s=this.videoBuffer?this.videoBuffer:this.media,d=H.bufferInfo(a,e,i.maxBufferHole),h=H.bufferInfo(s,e,i.maxBufferHole),f=d.len,p=d.end,m=this.fragPrevious,v=Math.min(i.maxBufferLength,i.maxMaxBufferLength),g=Math.max(v,h.len),y=this.audioSwitch,_=this.trackId;if((f<g||y)&&_<o.length){if(void 0===(n=o[_].details)){this.state=we;break}if(!y&&this._streamEnded(d,n))return this.hls.trigger(l.default.BUFFER_EOS,{type:"audio"}),void(this.state=Ae);var b,E=n.fragments,w=E.length,T=E[0].start,S=E[w-1].start+E[w-1].duration;if(y)if(n.live&&!n.PTSKnown)c.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),p=0;else if(p=e,n.PTSKnown&&e<T){if(!(d.end>T||d.nextStart))return;c.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=T+.05}if(n.initSegment&&!n.initSegment.data)b=n.initSegment;else if(p<=T){if(b=E[0],null!==this.videoTrackCC&&b.cc!==this.videoTrackCC&&(b=function(e,t){return G.search(e,(function(e){return e.cc<t?1:e.cc>t?-1:0}))}(E,this.videoTrackCC)),n.live&&b.loadIdx&&b.loadIdx===this.fragLoadIdx){var x=d.nextStart?d.nextStart:T;return c.logger.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(x+.05)),void(this.media.currentTime=x+.05)}}else{var A,M=i.maxFragLookUpTolerance,j=m?E[m.sn-E[0].sn+1]:void 0,R=function(e){var t=Math.min(M,e.duration);return e.start+e.duration-t<=p?1:e.start-t>p&&e.start?-1:0};p<S?(p>S-M&&(M=0),A=j&&!R(j)?j:G.search(E,R)):A=E[w-1],A&&(b=A,T=A.start,m&&b.level===m.level&&b.sn===m.sn&&(b.sn<n.endSN?(b=E[b.sn+1-n.startSN],c.logger.log("SN just loaded, load next one: "+b.sn)):b=null))}b&&(b.encrypted?(c.logger.log("Loading key for "+b.sn+" of ["+n.startSN+" ,"+n.endSN+"],track "+_),this.state=_e,r.trigger(l.default.KEY_LOADING,{frag:b})):(c.logger.log("Loading "+b.sn+", cc: "+b.cc+" of ["+n.startSN+" ,"+n.endSN+"],track "+_+", currentTime:"+e+",bufferEnd:"+p.toFixed(3)),this.fragCurrent=b,(y||this.fragmentTracker.getState(b)===N)&&("initSegment"!==b.sn&&(this.startFragRequested=!0),Object(u.isFiniteNumber)(b.sn)&&(this.nextLoadPosition=b.start+b.duration),r.trigger(l.default.FRAG_LOADING,{frag:b}),this.state=be)))}break;case we:(t=this.tracks[this.trackId])&&t.details&&(this.state=ge);break;case Ee:var L=it.now(),C=this.retryDate,k=(a=this.media)&&a.seeking;(!C||L>=C||k)&&(c.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=ge);break;case je:var O=this.videoTrackCC;if(void 0===this.initPTS[O])break;var P=this.waitingFragment;if(P){var I=P.frag.cc;O!==I?(t=this.tracks[this.trackId]).details&&t.details.live&&(c.logger.warn("Waiting fragment CC ("+I+") does not match video track CC ("+O+")"),this.waitingFragment=null,this.state=ge):(this.state=be,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null)}else this.state=ge}},d.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("ended",this.onvended);var n=this.config;this.tracks&&n.autoStartLoad&&this.startLoad(n.startPosition)},d.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(c.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},d.onAudioTracksUpdated=function(e){c.logger.log("audio tracks updated"),this.tracks=e.audioTracks},d.onAudioTrackSwitching=function(e){var t=!!e.url;this.trackId=e.id,this.fragCurrent=null,this.state=ye,this.waitingFragment=null,t?this.setInterval(100):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),t&&(this.audioSwitch=!0,this.state=ge),this.tick()},d.onAudioTrackLoaded=function(e){var t=e.details,n=e.id,r=this.tracks[n],i=t.totalduration,o=0;if(c.logger.log("track "+n+" loaded ["+t.startSN+","+t.endSN+"],duration:"+i),t.live){var a=r.details;a&&t.fragments.length>0?(ne(a,t),o=t.fragments[0].start,t.PTSKnown?c.logger.log("live audio playlist sliding:"+o.toFixed(3)):c.logger.log("live audio playlist - outdated PTS, unknown sliding")):(t.PTSKnown=!1,c.logger.log("live audio playlist - first load, unknown sliding"))}else t.PTSKnown=!1;if(r.details=t,!this.startFragRequested){if(-1===this.startPosition){var s=t.startTimeOffset;Object(u.isFiniteNumber)(s)?(c.logger.log("start time offset found in playlist, adjust startPosition to "+s),this.startPosition=s):t.live?(this.startPosition=this.computeLivePosition(o,t),c.logger.log("compute startPosition for audio-track to "+this.startPosition)):this.startPosition=0}this.nextLoadPosition=this.startPosition}this.state===we&&(this.state=ge),this.tick()},d.onKeyLoaded=function(){this.state===_e&&(this.state=ge,this.tick())},d.onFragLoaded=function(e){var t=this.fragCurrent,n=e.frag;if(this.state===be&&t&&"audio"===n.type&&n.level===t.level&&n.sn===t.sn){var r=this.tracks[this.trackId],i=r.details,o=i.totalduration,a=t.level,s=t.sn,u=t.cc,d=this.config.defaultAudioCodec||r.audioCodec||"mp4a.40.2",h=this.stats=e.stats;if("initSegment"===s)this.state=ge,h.tparsed=h.tbuffered=it.now(),i.initSegment.data=e.payload,this.hls.trigger(l.default.FRAG_BUFFERED,{stats:h,frag:t,id:"audio"}),this.tick();else{this.state=Te,this.appended=!1,this.demuxer||(this.demuxer=new $(this.hls,"audio"));var f=this.initPTS[u],p=i.initSegment?i.initSegment.data:[];i.initSegment||void 0!==f?(this.pendingBuffering=!0,c.logger.log("Demuxing "+s+" of ["+i.startSN+" ,"+i.endSN+"],track "+a),this.demuxer.push(e.payload,p,d,null,t,o,!1,f)):(c.logger.log("unknown video PTS for continuity counter "+u+", waiting for video PTS before demuxing audio frag "+s+" of ["+i.startSN+" ,"+i.endSN+"],track "+a),this.waitingFragment=e,this.state=je)}}this.fragLoadError=0},d.onFragParsingInitSegment=function(e){var t=this.fragCurrent,n=e.frag;if(t&&"audio"===e.id&&n.sn===t.sn&&n.level===t.level&&this.state===Te){var r,i=e.tracks;if(i.video&&delete i.video,r=i.audio){r.levelCodec=r.codec,r.id=e.id,this.hls.trigger(l.default.BUFFER_CODECS,i),c.logger.log("audio track:audio,container:"+r.container+",codecs[level/parsed]=["+r.levelCodec+"/"+r.codec+"]");var o=r.initSegment;if(o){var a={type:"audio",data:o,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[a]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(l.default.BUFFER_APPENDING,a))}this.tick()}}},d.onFragParsingData=function(e){var t=this,n=this.fragCurrent,r=e.frag;if(n&&"audio"===e.id&&"audio"===e.type&&r.sn===n.sn&&r.level===n.level&&this.state===Te){var i=this.trackId,o=this.tracks[i],a=this.hls;Object(u.isFiniteNumber)(e.endPTS)||(e.endPTS=e.startPTS+n.duration,e.endDTS=e.startDTS+n.duration),n.addElementaryStream(m.AUDIO),c.logger.log("parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb),te(o.details,n,e.startPTS,e.endPTS);var d=this.audioSwitch,h=this.media,f=!1;if(d)if(h&&h.readyState){var p=h.currentTime;c.logger.log("switching audio track : currentTime:"+p),p>=e.startPTS&&(c.logger.log("switching audio track : flushing all audio"),this.state=xe,a.trigger(l.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),f=!0,this.audioSwitch=!1,a.trigger(l.default.AUDIO_TRACK_SWITCHED,{id:i}))}else this.audioSwitch=!1,a.trigger(l.default.AUDIO_TRACK_SWITCHED,{id:i});var v=this.pendingData;if(!v)return c.logger.warn("Apparently attempt to enqueue media payload without codec initialization data upfront"),void a.trigger(l.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:null,fatal:!0});this.audioSwitch||([e.data1,e.data2].forEach((function(t){t&&t.length&&v.push({type:e.type,data:t,parent:"audio",content:"data"})})),!f&&v.length&&(v.forEach((function(e){t.state===Te&&(t.pendingBuffering=!0,t.hls.trigger(l.default.BUFFER_APPENDING,e))})),this.pendingData=[],this.appended=!0)),this.tick()}},d.onFragParsed=function(e){var t=this.fragCurrent,n=e.frag;t&&"audio"===e.id&&n.sn===t.sn&&n.level===t.level&&this.state===Te&&(this.stats.tparsed=it.now(),this.state=Se,this._checkAppendedParsed())},d.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},d.onBufferCreated=function(e){var t=e.tracks.audio;t&&(this.mediaBuffer=t.buffer,this.loadedmetadata=!0),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer)},d.onBufferAppended=function(e){if("audio"===e.parent){var t=this.state;t!==Te&&t!==Se||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}},d._checkAppendedParsed=function(){if(!(this.state!==Se||this.appended&&this.pendingBuffering)){var e=this.fragCurrent,t=this.stats,n=this.hls;if(e){this.fragPrevious=e,t.tbuffered=it.now(),n.trigger(l.default.FRAG_BUFFERED,{stats:t,frag:e,id:"audio"});var r=this.mediaBuffer?this.mediaBuffer:this.media;r&&c.logger.log("audio buffered : "+oe.toString(r.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,n.trigger(l.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=ge}this.tick()}},d.onError=function(e){var t=e.frag;if(!t||"audio"===t.type)switch(e.details){case s.ErrorDetails.FRAG_LOAD_ERROR:case s.ErrorDetails.FRAG_LOAD_TIMEOUT:var n=e.frag;if(n&&"audio"!==n.type)break;if(!e.fatal){var r=this.fragLoadError;r?r++:r=1;var i=this.config;if(r<=i.fragLoadingMaxRetry){this.fragLoadError=r;var o=Math.min(Math.pow(2,r-1)*i.fragLoadingRetryDelay,i.fragLoadingMaxRetryTimeout);c.logger.warn("AudioStreamController: frag loading failed, retry in "+o+" ms"),this.retryDate=it.now()+o,this.state=Ee}else c.logger.error("AudioStreamController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=Me}break;case s.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case s.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case s.ErrorDetails.KEY_LOAD_ERROR:case s.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==Me&&(this.state=e.fatal?Me:ge,c.logger.warn("AudioStreamController: "+e.details+" while loading frag, now switching to "+this.state+" state ..."));break;case s.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===e.parent&&(this.state===Te||this.state===Se)){var a=this.mediaBuffer,u=this.media.currentTime;if(a&&H.isBuffered(a,u)&&H.isBuffered(a,u+.5)){var d=this.config;d.maxMaxBufferLength>=d.maxBufferLength&&(d.maxMaxBufferLength/=2,c.logger.warn("AudioStreamController: reduce max buffer length to "+d.maxMaxBufferLength+"s")),this.state=ge}else c.logger.warn("AudioStreamController: buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=xe,this.hls.trigger(l.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})}}},d.onBufferFlushed=function(){var e=this,t=this.pendingData;t&&t.length?(c.logger.log("AudioStreamController: appending pending audio data after buffer flushed"),t.forEach((function(t){e.hls.trigger(l.default.BUFFER_APPENDING,t)})),this.appended=!0,this.pendingData=[],this.state=Se):(this.state=ge,this.fragPrevious=null,this.tick())},i=r,(o=[{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,c.logger.log("audio stream:"+t+"->"+e)}},get:function(){return this._state}}])&&rt(i.prototype,o),a&&rt(i,a),r}(Le),at=function(){if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var e={"":!0,lr:!0,rl:!0},t={start:!0,middle:!0,end:!0,left:!0,right:!0};function n(e){return"string"==typeof e&&!!t[e.toLowerCase()]&&e.toLowerCase()}function r(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)e[r]=n[r]}return e}function i(t,i,o){var a=this,s={enumerable:!0};a.hasBeenReset=!1;var u="",l=!1,c=t,d=i,h=o,f=null,p="",m=!0,v="auto",g="start",y=50,_="middle",b=50,E="middle";Object.defineProperty(a,"id",r({},s,{get:function(){return u},set:function(e){u=""+e}})),Object.defineProperty(a,"pauseOnExit",r({},s,{get:function(){return l},set:function(e){l=!!e}})),Object.defineProperty(a,"startTime",r({},s,{get:function(){return c},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");c=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"endTime",r({},s,{get:function(){return d},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");d=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"text",r({},s,{get:function(){return h},set:function(e){h=""+e,this.hasBeenReset=!0}})),Object.defineProperty(a,"region",r({},s,{get:function(){return f},set:function(e){f=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"vertical",r({},s,{get:function(){return p},set:function(t){var n=function(t){return"string"==typeof t&&!!e[t.toLowerCase()]&&t.toLowerCase()}(t);if(!1===n)throw new SyntaxError("An invalid or illegal string was specified.");p=n,this.hasBeenReset=!0}})),Object.defineProperty(a,"snapToLines",r({},s,{get:function(){return m},set:function(e){m=!!e,this.hasBeenReset=!0}})),Object.defineProperty(a,"line",r({},s,{get:function(){return v},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");v=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"lineAlign",r({},s,{get:function(){return g},set:function(e){var t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");g=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"position",r({},s,{get:function(){return y},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"positionAlign",r({},s,{get:function(){return _},set:function(e){var t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");_=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"size",r({},s,{get:function(){return b},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");b=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"align",r({},s,{get:function(){return E},set:function(e){var t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");E=t,this.hasBeenReset=!0}})),a.displayState=void 0}return i.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},i}(),st=function(){return{decode:function(e){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}};function ut(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new st,this.regionList=[]}function lt(){this.values=Object.create(null)}function ct(e,t,n,r){var i=r?e.split(r):[e];for(var o in i)if("string"==typeof i[o]){var a=i[o].split(n);2===a.length&&t(a[0],a[1])}}lt.prototype={set:function(e,t){this.get(e)||""===t||(this.values[e]=t)},get:function(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,n){for(var r=0;r<n.length;++r)if(t===n[r]){this.set(e,t);break}},integer:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},percent:function(e,t){return!!(t.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(t=parseFloat(t))>=0&&t<=100)&&(this.set(e,t),!0)}};var dt=new at(0,0,0),ht="middle"===dt.align?"middle":"center";function ft(e,t,n){var r=e;function i(){var t=function(e){function t(e,t,n,r){return 3600*(0|e)+60*(0|t)+(0|n)+(0|r)/1e3}var n=e.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return n?n[3]?t(n[1],n[2],n[3].replace(":",""),n[4]):n[1]>59?t(n[1],n[2],0,n[4]):t(0,n[1],n[2],n[4]):null}(e);if(null===t)throw new Error("Malformed timestamp: "+r);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function o(){e=e.replace(/^\s+/,"")}if(o(),t.startTime=i(),o(),"--\x3e"!==e.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+r);e=e.substr(3),o(),t.endTime=i(),o(),function(e,t){var r=new lt;ct(e,(function(e,t){switch(e){case"region":for(var i=n.length-1;i>=0;i--)if(n[i].id===t){r.set(e,n[i].region);break}break;case"vertical":r.alt(e,t,["rl","lr"]);break;case"line":var o=t.split(","),a=o[0];r.integer(e,a),r.percent(e,a)&&r.set("snapToLines",!1),r.alt(e,a,["auto"]),2===o.length&&r.alt("lineAlign",o[1],["start",ht,"end"]);break;case"position":o=t.split(","),r.percent(e,o[0]),2===o.length&&r.alt("positionAlign",o[1],["start",ht,"end","line-left","line-right","auto"]);break;case"size":r.percent(e,t);break;case"align":r.alt(e,t,["start",ht,"end","left","right"])}}),/:/,/\s/),t.region=r.get("region",null),t.vertical=r.get("vertical","");var i=r.get("line","auto");"auto"===i&&-1===dt.line&&(i=-1),t.line=i,t.lineAlign=r.get("lineAlign","start"),t.snapToLines=r.get("snapToLines",!0),t.size=r.get("size",100),t.align=r.get("align",ht);var o=r.get("position","auto");"auto"===o&&50===dt.position&&(o="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=o}(e,t)}function pt(e){return e.replace(/<br(?: \/)?>/gi,"\n")}ut.prototype={parse:function(e){var t=this;function n(){var e=t.buffer,n=0;for(e=pt(e);n<e.length&&"\r"!==e[n]&&"\n"!==e[n];)++n;var r=e.substr(0,n);return"\r"===e[n]&&++n,"\n"===e[n]&&++n,t.buffer=e.substr(n),r}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var r;if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;var i=(r=n()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!i||!i[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var o=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:r=n(),t.state){case"HEADER":/:/.test(r)?ct(r,(function(e,t){}),/:/):r||(t.state="ID");continue;case"NOTE":r||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){t.state="NOTE";break}if(!r)continue;if(t.cue=new at(0,0,""),t.state="CUE",-1===r.indexOf("--\x3e")){t.cue.id=r;continue}case"CUE":try{ft(r,t.cue,t.regionList)}catch(e){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var a=-1!==r.indexOf("--\x3e");if(!r||a&&(o=!0)){t.oncue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}t.cue.text&&(t.cue.text+="\n"),t.cue.text+=r;continue;case"BADCUE":r||(t.state="ID");continue}}}catch(e){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){try{if(this.buffer+=this.decoder.decode(),(this.cue||"HEADER"===this.state)&&(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state)throw new Error("Malformed WebVTT signature.")}catch(e){throw e}return this.onflush&&this.onflush(),this}};var mt=ut;function vt(e,t,n,r){for(var i,o,a,s,u,l=window.VTTCue||TextTrackCue,c=0;c<r.rows.length;c++)if(a=!0,s=0,u="",!(i=r.rows[c]).isEmpty()){for(var d=0;d<i.chars.length;d++)i.chars[d].uchar.match(/\s/)&&a?s++:(u+=i.chars[d].uchar,a=!1);i.cueStartTime=t,t===n&&(n+=1e-4),o=new l(t,n,pt(u.trim())),s>=16?s--:s++,navigator.userAgent.match(/Firefox\//)?o.line=c+1:o.line=c>7?c-2:c+1,o.align="left",o.position=Math.max(0,Math.min(100,s/32*100)),e.addCue(o)}}var gt,yt={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},_t=function(e){var t=e;return yt.hasOwnProperty(e)&&(t=yt[e]),String.fromCharCode(t)},bt={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Et={17:2,18:4,21:6,22:8,23:10,19:13,20:15},wt={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Tt={25:2,26:4,29:6,30:8,31:10,27:13,28:15},St=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];!function(e){e[e.ERROR=0]="ERROR",e[e.TEXT=1]="TEXT",e[e.WARNING=2]="WARNING",e[e.INFO=2]="INFO",e[e.DEBUG=3]="DEBUG",e[e.DATA=3]="DATA"}(gt||(gt={}));var xt={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(e){this.time=e},log:function(e,t){this.verboseFilter[e],this.verboseLevel}},At=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].toString(16));return t},Mt=function(){function e(e,t,n,r,i){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=e||"white",this.underline=t||!1,this.italics=n||!1,this.background=r||"black",this.flash=i||!1}var t=e.prototype;return t.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},t.setStyles=function(e){for(var t=["foreground","underline","italics","background","flash"],n=0;n<t.length;n++){var r=t[n];e.hasOwnProperty(r)&&(this[r]=e[r])}},t.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},t.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},t.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},t.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},e}(),jt=function(){function e(e,t,n,r,i,o){this.uchar=void 0,this.penState=void 0,this.uchar=e||" ",this.penState=new Mt(t,n,r,i,o)}var t=e.prototype;return t.reset=function(){this.uchar=" ",this.penState.reset()},t.setChar=function(e,t){this.uchar=e,this.penState.copy(t)},t.setPenState=function(e){this.penState.copy(e)},t.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},t.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},t.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},e}(),Rt=function(){function e(){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.chars=[];for(var e=0;e<100;e++)this.chars.push(new jt);this.pos=0,this.currPenState=new Mt}var t=e.prototype;return t.equals=function(e){for(var t=!0,n=0;n<100;n++)if(!this.chars[n].equals(e.chars[n])){t=!1;break}return t},t.copy=function(e){for(var t=0;t<100;t++)this.chars[t].copy(e.chars[t])},t.isEmpty=function(){for(var e=!0,t=0;t<100;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},t.setCursor=function(e){this.pos!==e&&(this.pos=e),this.pos<0?(xt.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>100&&(xt.log("ERROR","Too large cursor position "+this.pos),this.pos=100)},t.moveCursor=function(e){var t=this.pos+e;if(e>1)for(var n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)},t.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},t.insertChar=function(e){e>=144&&this.backSpace();var t=_t(e);this.pos>=100?xt.log("ERROR","Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))},t.clearFromPos=function(e){var t;for(t=e;t<100;t++)this.chars[t].reset()},t.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},t.clearToEndOfRow=function(){this.clearFromPos(this.pos)},t.getTextString=function(){for(var e=[],t=!0,n=0;n<100;n++){var r=this.chars[n].uchar;" "!==r&&(t=!1),e.push(r)}return t?"":e.join("")},t.setPenStyles=function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)},e}(),Lt=function(){function e(){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.rows=[];for(var e=0;e<15;e++)this.rows.push(new Rt);this.currRow=14,this.nrRollUpRows=null,this.reset()}var t=e.prototype;return t.reset=function(){for(var e=0;e<15;e++)this.rows[e].clear();this.currRow=14},t.equals=function(e){for(var t=!0,n=0;n<15;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t},t.copy=function(e){for(var t=0;t<15;t++)this.rows[t].copy(e.rows[t])},t.isEmpty=function(){for(var e=!0,t=0;t<15;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},t.backSpace=function(){this.rows[this.currRow].backSpace()},t.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},t.insertChar=function(e){this.rows[this.currRow].insertChar(e)},t.setPen=function(e){this.rows[this.currRow].setPenStyles(e)},t.moveCursor=function(e){this.rows[this.currRow].moveCursor(e)},t.setCursor=function(e){xt.log("INFO","setCursor: "+e),this.rows[this.currRow].setCursor(e)},t.setPAC=function(e){xt.log("INFO","pacData = "+JSON.stringify(e));var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var n=0;n<15;n++)this.rows[n].clear();var r=this.currRow+1-this.nrRollUpRows,i=this.lastOutputScreen;if(i){var o=i.rows[r].cueStartTime;if(o&&xt.time&&o<xt.time)for(var a=0;a<this.nrRollUpRows;a++)this.rows[t-this.nrRollUpRows+a+1].copy(i.rows[r+a])}}this.currRow=t;var s=this.rows[this.currRow];if(null!==e.indent){var u=e.indent,l=Math.max(u-1,0);s.setCursor(e.indent),e.color=s.chars[l].penState.foreground}var c={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(c)},t.setBkgData=function(e){xt.log("INFO","bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)},t.setRollUpRows=function(e){this.nrRollUpRows=e},t.rollUp=function(){if(null!==this.nrRollUpRows){xt.log("TEXT",this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),xt.log("INFO","Rolling up")}else xt.log("DEBUG","roll_up but nrRollUpRows not set yet")},t.getDisplayText=function(e){e=e||!1;for(var t=[],n="",r=-1,i=0;i<15;i++){var o=this.rows[i].getTextString();o&&(r=i+1,e?t.push("Row "+r+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(n=e?"["+t.join(" | ")+"]":t.join("\n")),n},t.getTextAndFormat=function(){return this.rows},e}(),Ct=function(){function e(e,t){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.lastCueEndTime=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Lt,this.nonDisplayedMemory=new Lt,this.lastOutputScreen=new Lt,this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}var t=e.prototype;return t.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},t.getHandler=function(){return this.outputFilter},t.setHandler=function(e){this.outputFilter=e},t.setPAC=function(e){this.writeScreen.setPAC(e)},t.setBkgData=function(e){this.writeScreen.setBkgData(e)},t.setMode=function(e){e!==this.mode&&(this.mode=e,xt.log("INFO","MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},t.insertChars=function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var n=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";xt.log("INFO",n+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(xt.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},t.ccRCL=function(){xt.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},t.ccBS=function(){xt.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},t.ccAOF=function(){},t.ccAON=function(){},t.ccDER=function(){xt.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},t.ccRU=function(e){xt.log("INFO","RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},t.ccFON=function(){xt.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},t.ccRDC=function(){xt.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},t.ccTR=function(){xt.log("INFO","TR"),this.setMode("MODE_TEXT")},t.ccRTD=function(){xt.log("INFO","RTD"),this.setMode("MODE_TEXT")},t.ccEDM=function(){xt.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},t.ccCR=function(){xt.log("INFO","CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},t.ccENM=function(){xt.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},t.ccEOC=function(){if(xt.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,xt.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},t.ccTO=function(e){xt.log("INFO","TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},t.ccMIDROW=function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var n=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][n]}xt.log("INFO","MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},t.outputDataUpdate=function(e){void 0===e&&(e=!1);var t=xt.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))},t.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},e}(),kt=function(){function e(e,t,n){this.field=void 0,this.outputs=void 0,this.channels=void 0,this.currChNr=void 0,this.lastCmdA=void 0,this.lastCmdB=void 0,this.lastTime=void 0,this.dataCounters=void 0,this.field=e||1,this.outputs=[t,n],this.channels=[new Ct(1,t),new Ct(2,n)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}var t=e.prototype;return t.getHandler=function(e){return this.channels[e].getHandler()},t.setHandler=function(e,t){this.channels[e].setHandler(t)},t.addData=function(e,t){var n,r,i,o=!1;this.lastTime=e,xt.setTime(e);for(var a=0;a<t.length;a+=2)r=127&t[a],i=127&t[a+1],0!==r||0!==i?(xt.log("DATA","["+At([t[a],t[a+1]])+"] -> ("+At([r,i])+")"),(n=this.parseCmd(r,i))||(n=this.parseMidrow(r,i)),n||(n=this.parsePAC(r,i)),n||(n=this.parseBackgroundAttributes(r,i)),n||(o=this.parseChars(r,i))&&(this.currChNr&&this.currChNr>=0?this.channels[this.currChNr-1].insertChars(o):xt.log("WARNING","No channel found yet. TEXT-MODE?")),n?this.dataCounters.cmd+=2:o?this.dataCounters.char+=2:(this.dataCounters.other+=2,xt.log("WARNING","Couldn't parse cleaned data "+At([r,i])+" orig: "+At([t[a],t[a+1]])))):this.dataCounters.padding+=2},t.parseCmd=function(e,t){var n=null;if(!((20===e||28===e)&&t>=32&&t<=47||(23===e||31===e)&&t>=33&&t<=35))return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,xt.log("DEBUG","Repeated command ("+At([e,t])+") is dropped"),!0;n=20===e||23===e?1:2;var r=this.channels[n-1];return 20===e||28===e?32===t?r.ccRCL():33===t?r.ccBS():34===t?r.ccAOF():35===t?r.ccAON():36===t?r.ccDER():37===t?r.ccRU(2):38===t?r.ccRU(3):39===t?r.ccRU(4):40===t?r.ccFON():41===t?r.ccRDC():42===t?r.ccTR():43===t?r.ccRTD():44===t?r.ccEDM():45===t?r.ccCR():46===t?r.ccENM():47===t&&r.ccEOC():r.ccTO(t-32),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=n,!0},t.parseMidrow=function(e,t){var n=null;return(17===e||25===e)&&t>=32&&t<=47&&((n=17===e?1:2)!==this.currChNr?(xt.log("ERROR","Mismatch channel in midrow parsing"),!1):(this.channels[n-1].ccMIDROW(t),xt.log("DEBUG","MIDROW ("+At([e,t])+")"),!0))},t.parsePAC=function(e,t){var n,r=null;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127||(16===e||24===e)&&t>=64&&t<=95))return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;n=e<=23?1:2,r=t>=64&&t<=95?1===n?bt[e]:wt[e]:1===n?Et[e]:Tt[e];var i=this.interpretPAC(r,t);return this.channels[n-1].setPAC(i),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=n,!0},t.interpretPAC=function(e,t){var n=t,r={color:null,italics:!1,indent:null,underline:!1,row:e};return n=t>95?t-96:t-64,r.underline=1==(1&n),n<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(r.italics=!0,r.color="white"):r.indent=4*Math.floor((n-16)/2),r},t.parseChars=function(e,t){var n=null,r=null,i=null;if(e>=25?(n=2,i=e-8):(n=1,i=e),i>=17&&i<=19){var o=t;o=17===i?t+80:18===i?t+112:t+144,xt.log("INFO","Special char '"+_t(o)+"' in channel "+n),r=[o]}else e>=32&&e<=127&&(r=0===t?[e]:[e,t]);if(r){var a=At(r);xt.log("DEBUG","Char codes =  "+a.join(",")),this.lastCmdA=null,this.lastCmdB=null}return r},t.parseBackgroundAttributes=function(e,t){var n,r,i;return((16===e||24===e)&&t>=32&&t<=47||(23===e||31===e)&&t>=45&&t<=47)&&(n={},16===e||24===e?(r=Math.floor((t-32)/2),n.background=St[r],t%2==1&&(n.background=n.background+"_semi")):45===t?n.background="transparent":(n.foreground="black",47===t&&(n.underline=!0)),i=e<24?1:2,this.channels[i-1].setBkgData(n),this.lastCmdA=null,this.lastCmdB=null,!0)},t.reset=function(){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].reset();this.lastCmdA=null,this.lastCmdB=null},t.cueSplitAtTime=function(e){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].cueSplitAtTime(e)},e}(),Ot=function(){function e(e,t){this.timelineController=void 0,this.trackName=void 0,this.startTime=void 0,this.endTime=void 0,this.screen=void 0,this.timelineController=e,this.trackName=t,this.startTime=null,this.endTime=null,this.screen=null}var t=e.prototype;return t.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen),this.startTime=null)},t.newCue=function(e,t,n){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)},e}(),Pt=function(e,t,n){return e.substr(n||0,t.length)===t},It=function(e){for(var t=5381,n=e.length;n;)t=33*t^e.charCodeAt(--n);return(t>>>0).toString()},Dt={parse:function(e,t,n,r,i,o){var a,s=Object(De.utf8ArrayToStr)(new Uint8Array(e)).trim().replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n"),l="00:00.000",c=0,d=0,h=0,f=[],p=!0,m=!1,v=new mt;v.oncue=function(e){var t=n[r],i=n.ccOffset;t&&t.new&&(void 0!==d?i=n.ccOffset=t.start:function(e,t,n){var r=e[t],i=e[r.prevCC];if(!i||!i.new&&r.new)return e.ccOffset=e.presentationOffset=r.start,void(r.new=!1);for(;i&&i.new;)e.ccOffset+=r.start-i.start,r.new=!1,i=e[(r=i).prevCC];e.presentationOffset=n}(n,r,h)),h&&(i=h-n.presentationOffset),m&&(e.startTime+=i-d,e.endTime+=i-d),e.id=It(e.startTime.toString())+It(e.endTime.toString())+It(e.text),e.text=decodeURIComponent(encodeURIComponent(e.text)),e.endTime>0&&f.push(e)},v.onparsingerror=function(e){a=e},v.onflush=function(){a&&o?o(a):i(f)},s.forEach((function(e){if(p){if(Pt(e,"X-TIMESTAMP-MAP=")){p=!1,m=!0,e.substr(16).split(",").forEach((function(e){Pt(e,"LOCAL:")?l=e.substr(6):Pt(e,"MPEGTS:")&&(c=parseInt(e.substr(7)))}));try{t+(9e4*n[r].start||0)<0&&(t+=8589934592),c-=t,d=function(e){var t=parseInt(e.substr(-3)),n=parseInt(e.substr(-6,2)),r=parseInt(e.substr(-9,2)),i=e.length>9?parseInt(e.substr(0,e.indexOf(":"))):0;if(!(Object(u.isFiniteNumber)(t)&&Object(u.isFiniteNumber)(n)&&Object(u.isFiniteNumber)(r)&&Object(u.isFiniteNumber)(i)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+e);return t+=1e3*n,t+=6e4*r,t+=36e5*i}(l)/1e3,h=c/9e4}catch(e){m=!1,a=e}return}""===e&&(p=!1)}v.parse(e+"\n")})),v.flush()}};function Nt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Bt(e,t){return e&&e.label===t.name&&!(e.textTrack1||e.textTrack2)}var Ut=function(e){var t,n;function r(t){var n;if((n=e.call(this,t,l.default.MEDIA_ATTACHING,l.default.MEDIA_DETACHING,l.default.FRAG_PARSING_USERDATA,l.default.FRAG_DECRYPTED,l.default.MANIFEST_LOADING,l.default.MANIFEST_LOADED,l.default.FRAG_LOADED,l.default.INIT_PTS_FOUND)||this).media=null,n.config=void 0,n.enabled=!0,n.Cues=void 0,n.textTracks=[],n.tracks=[],n.initPTS=[],n.unparsedVttFrags=[],n.cueRanges=[],n.captionsTracks={},n.captionsProperties=void 0,n.cea608Parser=void 0,n.lastSn=-1,n.prevCC=-1,n.vttCCs=null,n.hls=t,n.config=t.config,n.Cues=t.config.cueHandler,n.captionsProperties={textTrack1:{label:n.config.captionsTextTrack1Label,languageCode:n.config.captionsTextTrack1LanguageCode},textTrack2:{label:n.config.captionsTextTrack2Label,languageCode:n.config.captionsTextTrack2LanguageCode}},n.config.enableCEA708Captions){var r=new Ot(Nt(n),"textTrack1"),i=new Ot(Nt(n),"textTrack2");n.cea608Parser=new kt(0,r,i)}return n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.addCues=function(e,t,n,r){for(var i,o,a,s,u=this.cueRanges,l=!1,c=u.length;c--;){var d=u[c],h=(i=d[0],o=d[1],a=t,s=n,Math.min(o,s)-Math.max(i,a));if(h>=0&&(d[0]=Math.min(d[0],t),d[1]=Math.max(d[1],n),l=!0,h/(n-t)>.5))return}l||u.push([t,n]),this.Cues.newCue(this.captionsTracks[e],t,n,r)},i.onInitPtsFound=function(e){var t=this,n=e.frag,r=e.id,i=e.initPTS,o=this.unparsedVttFrags;"main"===r&&(this.initPTS[n.cc]=i),o.length&&(this.unparsedVttFrags=[],o.forEach((function(e){t.onFragLoaded(e)})))},i.getExistingTrack=function(e){var t=this.media;if(t)for(var n=0;n<t.textTracks.length;n++){var r=t.textTracks[n];if(r[e])return r}return null},i.createCaptionsTrack=function(e){var t=this.captionsProperties,n=this.captionsTracks,r=this.media,i=t[e],o=i.label,a=i.languageCode;if(!n[e]){var s=this.getExistingTrack(e);if(s)n[e]=s,Be(n[e]),Ne(n[e],r);else{var u=this.createTextTrack("captions",o,a);u&&(u[e]=!0,n[e]=u)}}},i.createTextTrack=function(e,t,n){var r=this.media;if(r)return r.addTextTrack(e,t,n)},i.destroy=function(){e.prototype.destroy.call(this)},i.onMediaAttaching=function(e){this.media=e.media,this._cleanTracks()},i.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach((function(t){Be(e[t]),delete e[t]}))},i.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks()},i._cleanTracks=function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var n=0;n<t.length;n++)Be(t[n])}},i.onManifestLoaded=function(e){var t=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cueRanges=[],this.config.enableWebVTT){this.tracks=e.subtitles||[];var n=this.media?this.media.textTracks:[];this.tracks.forEach((function(e,r){var i;if(r<n.length){for(var o=null,a=0;a<n.length;a++)if(Bt(n[a],e)){o=n[a];break}o&&(i=o)}i||(i=t.createTextTrack("subtitles",e.name,e.lang)),e.default?i.mode=t.hls.subtitleDisplay?"showing":"hidden":i.mode="disabled",t.textTracks.push(i)}))}},i.onFragLoaded=function(e){var t=e.frag,n=e.payload,r=this.cea608Parser,i=this.initPTS,o=this.lastSn,a=this.unparsedVttFrags;if("main"===t.type){var s=t.sn;t.sn!==o+1&&r&&r.reset(),this.lastSn=s}else if("subtitle"===t.type)if(n.byteLength){if(!Object(u.isFiniteNumber)(i[t.cc]))return a.push(e),void(i.length&&this.hls.trigger(l.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t}));var c=t.decryptdata;null!=c&&null!=c.key&&"AES-128"===c.method||this._parseVTTs(t,n)}else this.hls.trigger(l.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})},i._parseVTTs=function(e,t){var n=this.hls,r=this.prevCC,i=this.textTracks,o=this.vttCCs;o[e.cc]||(o[e.cc]={start:e.start,prevCC:r,new:!0},this.prevCC=e.cc),Dt.parse(t,this.initPTS[e.cc],o,e.cc,(function(t){var r=i[e.level];"disabled"!==r.mode?(t.forEach((function(e){if(!r.cues.getCueById(e.id))try{if(r.addCue(e),!r.cues.getCueById(e.id))throw new Error("addCue is failed for: "+e)}catch(n){c.logger.debug("Failed occurred on adding cues: "+n);var t=new window.TextTrackCue(e.startTime,e.endTime,e.text);t.id=e.id,r.addCue(t)}})),n.trigger(l.default.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})):n.trigger(l.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})}),(function(t){c.logger.log("Failed to parse VTT cue: "+t),n.trigger(l.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})}))},i.onFragDecrypted=function(e){var t=e.frag,n=e.payload;if("subtitle"===t.type){if(!Object(u.isFiniteNumber)(this.initPTS[t.cc]))return void this.unparsedVttFrags.push(e);this._parseVTTs(t,n)}},i.onFragParsingUserdata=function(e){if(this.enabled&&this.cea608Parser)for(var t=0;t<e.samples.length;t++){var n=e.samples[t].bytes;if(n){var r=this.extractCea608Data(n);this.cea608Parser.addData(e.samples[t].pts,r)}}},i.extractCea608Data=function(e){for(var t,n,r,i=31&e[0],o=2,a=[],s=0;s<i;s++)t=e[o++],n=127&e[o++],r=127&e[o++],0===n&&0===r||0!=(4&t)&&0==(3&t)&&(a.push(n),a.push(r));return a},r}(h);function Ft(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Vt(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];"subtitles"===r.kind&&r.label&&t.push(e[n])}return t}var Gt,Ht=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,l.default.MEDIA_ATTACHED,l.default.MEDIA_DETACHING,l.default.MANIFEST_LOADED,l.default.SUBTITLE_TRACK_LOADED)||this).tracks=[],n.trackId=-1,n.media=null,n.stopped=!0,n.subtitleDisplay=!0,n.queuedDefaultTrack=null,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i,o,a,s=r.prototype;return s.destroy=function(){h.prototype.destroy.call(this)},s.onMediaAttached=function(e){var t=this;this.media=e.media,this.media&&(Object(u.isFiniteNumber)(this.queuedDefaultTrack)&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=null),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval((function(){t.trackChangeListener()}),500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},s.onMediaDetaching=function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),Object(u.isFiniteNumber)(this.subtitleTrack)&&(this.queuedDefaultTrack=this.subtitleTrack),Vt(this.media.textTracks).forEach((function(e){Be(e)})),this.subtitleTrack=-1,this.media=null)},s.onManifestLoaded=function(e){var t=this,n=e.subtitles||[];this.tracks=n,this.hls.trigger(l.default.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:n}),n.forEach((function(e){e.default&&(t.media?t.subtitleTrack=e.id:t.queuedDefaultTrack=e.id)}))},s.onSubtitleTrackLoaded=function(e){var t=this,n=e.id,r=e.details,i=this.trackId,o=this.tracks,a=o[i];if(n>=o.length||n!==i||!a||this.stopped)this._clearReloadTimer();else if(c.logger.log("subtitle track "+n+" loaded"),r.live){var s=ie(a.details,r,e.stats.trequest);c.logger.log("Reloading live subtitle playlist in "+s+"ms"),this.timer=setTimeout((function(){t._loadCurrentTrack()}),s)}else this._clearReloadTimer()},s.startLoad=function(){this.stopped=!1,this._loadCurrentTrack()},s.stopLoad=function(){this.stopped=!0,this._clearReloadTimer()},s._clearReloadTimer=function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},s._loadCurrentTrack=function(){var e=this.trackId,t=this.tracks,n=this.hls,r=t[e];e<0||!r||r.details&&!r.details.live||(c.logger.log("Loading subtitle track "+e),n.trigger(l.default.SUBTITLE_TRACK_LOADING,{url:r.url,id:e}))},s._toggleTrackModes=function(e){var t=this.media,n=this.subtitleDisplay,r=this.trackId;if(t){var i=Vt(t.textTracks);if(-1===e)[].slice.call(i).forEach((function(e){e.mode="disabled"}));else{var o=i[r];o&&(o.mode="disabled")}var a=i[e];a&&(a.mode=n?"showing":"hidden")}},s._setSubtitleTrackInternal=function(e){var t=this.hls,n=this.tracks;!Object(u.isFiniteNumber)(e)||e<-1||e>=n.length||(this.trackId=e,c.logger.log("Switching to subtitle track "+e),t.trigger(l.default.SUBTITLE_TRACK_SWITCH,{id:e}),this._loadCurrentTrack())},s._onTextTracksChanged=function(){if(this.media){for(var e=-1,t=Vt(this.media.textTracks),n=0;n<t.length;n++)if("hidden"===t[n].mode)e=n;else if("showing"===t[n].mode){e=n;break}this.subtitleTrack=e}},i=r,(o=[{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.trackId!==e&&(this._toggleTrackModes(e),this._setSubtitleTrackInternal(e))}}])&&Ft(i.prototype,o),a&&Ft(i,a),r}(h),zt=n("./src/crypt/decrypter.js"),Wt=window.performance,qt=function(e){var t,n;function r(t,n){var r;return(r=e.call(this,t,l.default.MEDIA_ATTACHED,l.default.MEDIA_DETACHING,l.default.ERROR,l.default.KEY_LOADED,l.default.FRAG_LOADED,l.default.SUBTITLE_TRACKS_UPDATED,l.default.SUBTITLE_TRACK_SWITCH,l.default.SUBTITLE_TRACK_LOADED,l.default.SUBTITLE_FRAG_PROCESSED,l.default.LEVEL_UPDATED)||this).fragmentTracker=n,r.config=t.config,r.state=me,r.tracks=[],r.tracksBuffered=[],r.currentTrackId=-1,r.decrypter=new zt.default(t,t.config),r.lastAVStart=0,r._onMediaSeeking=r.onMediaSeeking.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(r)),r}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.onSubtitleFragProcessed=function(e){var t=e.frag,n=e.success;if(this.fragPrevious=t,this.state=ge,n){var r=this.tracksBuffered[this.currentTrackId];if(r){for(var i,o=t.start,a=0;a<r.length;a++)if(o>=r[a].start&&o<=r[a].end){i=r[a];break}var s=t.start+t.duration;i?i.end=s:(i={start:o,end:s},r.push(i))}}},i.onMediaAttached=function(e){var t=e.media;this.media=t,t.addEventListener("seeking",this._onMediaSeeking),this.state=ge},i.onMediaDetaching=function(){var e=this;this.media&&(this.media.removeEventListener("seeking",this._onMediaSeeking),this.fragmentTracker.removeAllFragments(),this.currentTrackId=-1,this.tracks.forEach((function(t){e.tracksBuffered[t.id]=[]})),this.media=null,this.state=me)},i.onError=function(e){var t=e.frag;t&&"subtitle"===t.type&&(this.state=ge)},i.onSubtitleTracksUpdated=function(e){var t=this;c.logger.log("subtitle tracks updated"),this.tracksBuffered=[],this.tracks=e.subtitleTracks,this.tracks.forEach((function(e){t.tracksBuffered[e.id]=[]}))},i.onSubtitleTrackSwitch=function(e){if(this.currentTrackId=e.id,this.tracks&&this.tracks.length&&-1!==this.currentTrackId){var t=this.tracks[this.currentTrackId];t&&t.details&&this.setInterval(500)}else this.clearInterval()},i.onSubtitleTrackLoaded=function(e){var t=e.id,n=e.details,r=this.currentTrackId,i=this.tracks,o=i[r];t>=i.length||t!==r||!o||(n.live&&function(e,t,n){void 0===n&&(n=0);var r=-1;re(e,t,(function(e,t,n){t.start=e.start,r=n}));var i=t.fragments;if(r<0)i.forEach((function(e){e.start+=n}));else for(var o=r+1;o<i.length;o++)i[o].start=i[o-1].start+i[o-1].duration}(o.details,n,this.lastAVStart),o.details=n,this.setInterval(500))},i.onKeyLoaded=function(){this.state===_e&&(this.state=ge)},i.onFragLoaded=function(e){var t=this.fragCurrent,n=e.frag.decryptdata,r=e.frag,i=this.hls;if(this.state===be&&t&&"subtitle"===e.frag.type&&t.sn===e.frag.sn&&e.payload.byteLength>0&&n&&n.key&&"AES-128"===n.method){var o=Wt.now();this.decrypter.decrypt(e.payload,n.key.buffer,n.iv.buffer,(function(e){var t=Wt.now();i.trigger(l.default.FRAG_DECRYPTED,{frag:r,payload:e,stats:{tstart:o,tdecrypt:t}})}))}},i.onLevelUpdated=function(e){var t=e.details.fragments;this.lastAVStart=t.length?t[0].start:0},i.doTick=function(){if(this.media)switch(this.state){case ge:var e=this.config,t=this.currentTrackId,n=this.fragmentTracker,r=this.media,i=this.tracks;if(!i||!i[t]||!i[t].details)break;var o,a=e.maxBufferHole,s=e.maxFragLookUpTolerance,u=Math.min(e.maxBufferLength,e.maxMaxBufferLength),d=H.bufferedInfo(this._getBuffered(),r.currentTime,a),h=d.end,f=d.len,p=i[t].details,m=p.fragments,v=m.length,g=m[v-1].start+m[v-1].duration;if(f>u)return;var y=this.fragPrevious;h<g?(y&&p.hasProgramDateTime&&(o=ue(m,y.endProgramDateTime,s)),o||(o=le(y,m,h,s))):o=m[v-1],o&&o.encrypted?(c.logger.log("Loading key for "+o.sn),this.state=_e,this.hls.trigger(l.default.KEY_LOADING,{frag:o})):o&&n.getState(o)===N&&(this.fragCurrent=o,this.state=be,this.hls.trigger(l.default.FRAG_LOADING,{frag:o}))}else this.state=ge},i.stopLoad=function(){this.lastAVStart=0,e.prototype.stopLoad.call(this)},i._getBuffered=function(){return this.tracksBuffered[this.currentTrackId]||[]},i.onMediaSeeking=function(){this.fragPrevious=null},r}(Le);!function(e){e.WIDEVINE="com.widevine.alpha",e.PLAYREADY="com.microsoft.playready"}(Gt||(Gt={}));var Kt="undefined"!=typeof window&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null;function Yt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Xt=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,l.default.MEDIA_ATTACHED,l.default.MEDIA_DETACHED,l.default.MANIFEST_PARSED)||this)._widevineLicenseUrl=void 0,n._licenseXhrSetup=void 0,n._emeEnabled=void 0,n._requestMediaKeySystemAccess=void 0,n._config=void 0,n._mediaKeysList=[],n._media=null,n._hasSetMediaKeys=!1,n._requestLicenseFailureCount=0,n._onMediaEncrypted=function(e){c.logger.log('Media is encrypted using "'+e.initDataType+'" init data type'),n._attemptSetMediaKeys(),n._generateRequestWithPreferredKeySession(e.initDataType,e.initData)},n._config=t.config,n._widevineLicenseUrl=n._config.widevineLicenseUrl,n._licenseXhrSetup=n._config.licenseXhrSetup,n._emeEnabled=n._config.emeEnabled,n._requestMediaKeySystemAccess=n._config.requestMediaKeySystemAccessFunc,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i,o,a,u=r.prototype;return u.getLicenseServerUrl=function(e){switch(e){case Gt.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+e+'"')},u._attemptKeySystemAccess=function(e,t,n){var r=this,i=function(e,t,n){switch(e){case Gt.WIDEVINE:return function(e,t){var n={videoCapabilities:[]};return t.forEach((function(e){n.videoCapabilities.push({contentType:'video/mp4; codecs="'+e+'"'})})),[n]}(0,n);default:throw new Error("Unknown key-system: "+e)}}(e,0,n);c.logger.log("Requesting encrypted media key-system access"),this.requestMediaKeySystemAccess(e,i).then((function(t){r._onMediaKeySystemAccessObtained(e,t)})).catch((function(t){c.logger.error('Failed to obtain key-system "'+e+'" access:',t)}))},u._onMediaKeySystemAccessObtained=function(e,t){var n=this;c.logger.log('Access for key-system "'+e+'" obtained');var r={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:t,mediaKeySystemDomain:e};this._mediaKeysList.push(r),t.createMediaKeys().then((function(t){r.mediaKeys=t,c.logger.log('Media-keys created for key-system "'+e+'"'),n._onMediaKeysCreated()})).catch((function(e){c.logger.error("Failed to create media-keys:",e)}))},u._onMediaKeysCreated=function(){var e=this;this._mediaKeysList.forEach((function(t){t.mediaKeysSession||(t.mediaKeysSession=t.mediaKeys.createSession(),e._onNewMediaKeySession(t.mediaKeysSession))}))},u._onNewMediaKeySession=function(e){var t=this;c.logger.log("New key-system session "+e.sessionId),e.addEventListener("message",(function(n){t._onKeySessionMessage(e,n.message)}),!1)},u._onKeySessionMessage=function(e,t){c.logger.log("Got EME message event, creating license request"),this._requestLicense(t,(function(t){c.logger.log("Received license data (length: "+(t?t.byteLength:t)+"), updating key-session"),e.update(t)}))},u._attemptSetMediaKeys=function(){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var e=this._mediaKeysList[0];if(!e||!e.mediaKeys)return c.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});c.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0}},u._generateRequestWithPreferredKeySession=function(e,t){var n=this,r=this._mediaKeysList[0];if(!r)return c.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(r.mediaKeysSessionInitialized)c.logger.warn("Key-Session already initialized but requested again");else{var i=r.mediaKeysSession;if(!i)return c.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});if(!t)return c.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});c.logger.log('Generating key-session request for "'+e+'" init data type'),r.mediaKeysSessionInitialized=!0,i.generateRequest(e,t).then((function(){c.logger.debug("Key-session generation succeeded")})).catch((function(e){c.logger.error("Error generating key-session request:",e),n.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})}))}},u._createLicenseXhr=function(e,t,n){var r=new XMLHttpRequest,i=this._licenseXhrSetup;try{if(i)try{i(r,e)}catch(t){r.open("POST",e,!0),i(r,e)}r.readyState||r.open("POST",e,!0)}catch(e){throw new Error("issue setting up KeySystem license XHR "+e)}return r.responseType="arraybuffer",r.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,r,e,t,n),r},u._onLicenseRequestReadyStageChange=function(e,t,n,r){switch(e.readyState){case 4:if(200===e.status)this._requestLicenseFailureCount=0,c.logger.log("License request succeeded"),"arraybuffer"!==e.responseType&&c.logger.warn("xhr response type was not set to the expected arraybuffer for license request"),r(e.response);else{if(c.logger.error("License Request XHR failed ("+t+"). Status: "+e.status+" ("+e.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var i=3-this._requestLicenseFailureCount+1;c.logger.warn("Retrying license request, "+i+" attempts left"),this._requestLicense(n,r)}}},u._generateLicenseRequestChallenge=function(e,t){switch(e.mediaKeySystemDomain){case Gt.WIDEVINE:return t}throw new Error("unsupported key-system: "+e.mediaKeySystemDomain)},u._requestLicense=function(e,t){c.logger.log("Requesting content license for key-system");var n=this._mediaKeysList[0];if(!n)return c.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var r=this.getLicenseServerUrl(n.mediaKeySystemDomain),i=this._createLicenseXhr(r,e,t);c.logger.log("Sending license request to URL: "+r);var o=this._generateLicenseRequestChallenge(n,e);i.send(o)}catch(e){c.logger.error("Failure requesting DRM license: "+e),this.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},u.onMediaAttached=function(e){if(this._emeEnabled){var t=e.media;this._media=t,t.addEventListener("encrypted",this._onMediaEncrypted)}},u.onMediaDetached=function(){this._media&&(this._media.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null)},u.onManifestParsed=function(e){if(this._emeEnabled){var t=e.levels.map((function(e){return e.audioCodec})),n=e.levels.map((function(e){return e.videoCodec}));this._attemptKeySystemAccess(Gt.WIDEVINE,t,n)}},i=r,(o=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}])&&Yt(i.prototype,o),a&&Yt(i,a),r}(h);function Jt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Zt=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Jt(e,t,n[t])}))}return e}({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,liveBackBufferLength:1/0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:et,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:ze,bufferController:qe,capLevelController:Ye,fpsController:Je,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,requestMediaKeySystemAccessFunc:Kt},{cueHandler:r,enableCEA708Captions:!0,enableWebVTT:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es"},{subtitleStreamController:qt,subtitleTrackController:Ht,timelineController:Ut,audioStreamController:ot,audioTrackController:nt,emeController:Xt});function $t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Qt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function en(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function tn(e,t,n){return t&&en(e.prototype,t),n&&en(e,n),e}n.d(t,"default",(function(){return nn}));var nn=function(e){var t,n;function r(t){var n;void 0===t&&(t={}),(n=e.call(this)||this).config=void 0,n._autoLevelCapping=void 0,n.abrController=void 0,n.capLevelController=void 0,n.levelController=void 0,n.streamController=void 0,n.networkControllers=void 0,n.audioTrackController=void 0,n.subtitleTrackController=void 0,n.emeController=void 0,n.coreComponents=void 0,n.media=null,n.url=null;var i=r.DefaultConfig;if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");n.config=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){$t(e,t,n[t])}))}return e}({},i,t);var o=Qt(n).config;if(void 0!==o.liveMaxLatencyDurationCount&&o.liveMaxLatencyDurationCount<=o.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==o.liveMaxLatencyDuration&&(void 0===o.liveSyncDuration||o.liveMaxLatencyDuration<=o.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');Object(c.enableLogs)(o.debug),n._autoLevelCapping=-1;var a=n.abrController=new o.abrController(Qt(n)),s=new o.bufferController(Qt(n)),u=n.capLevelController=new o.capLevelController(Qt(n)),l=new o.fpsController(Qt(n)),d=new P(Qt(n)),h=new I(Qt(n)),f=new D(Qt(n)),p=new Ue(Qt(n)),m=n.levelController=new Ie(Qt(n)),v=new V(Qt(n)),g=[m,n.streamController=new ke(Qt(n),v)],y=o.audioStreamController;y&&g.push(new y(Qt(n),v)),n.networkControllers=g;var _=[d,h,f,a,s,u,l,p,v];if(y=o.audioTrackController){var b=new y(Qt(n));n.audioTrackController=b,_.push(b)}if(y=o.subtitleTrackController){var E=new y(Qt(n));n.subtitleTrackController=E,g.push(E)}if(y=o.emeController){var w=new y(Qt(n));n.emeController=w,_.push(w)}return(y=o.subtitleStreamController)&&g.push(new y(Qt(n),v)),(y=o.timelineController)&&_.push(new y(Qt(n))),n.coreComponents=_,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,r.isSupported=function(){return function(){var e=K();if(!e)return!1;var t=SourceBuffer||window.WebKitSourceBuffer,n=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),r=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return!!n&&!!r}()},tn(r,null,[{key:"version",get:function(){return"0.13.0"}},{key:"Events",get:function(){return l.default}},{key:"ErrorTypes",get:function(){return s.ErrorTypes}},{key:"ErrorDetails",get:function(){return s.ErrorDetails}},{key:"DefaultConfig",get:function(){return r.defaultConfig?r.defaultConfig:Zt},set:function(e){r.defaultConfig=e}}]);var i=r.prototype;return i.destroy=function(){c.logger.log("destroy"),this.trigger(l.default.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach((function(e){e.destroy()})),this.url=null,this.removeAllListeners(),this._autoLevelCapping=-1},i.attachMedia=function(e){c.logger.log("attachMedia"),this.media=e,this.trigger(l.default.MEDIA_ATTACHING,{media:e})},i.detachMedia=function(){c.logger.log("detachMedia"),this.trigger(l.default.MEDIA_DETACHING),this.media=null},i.loadSource=function(e){e=a.buildAbsoluteURL(window.location.href,e,{alwaysNormalize:!0}),c.logger.log("loadSource:"+e),this.url=e,this.trigger(l.default.MANIFEST_LOADING,{url:e})},i.startLoad=function(e){void 0===e&&(e=-1),c.logger.log("startLoad("+e+")"),this.networkControllers.forEach((function(t){t.startLoad(e)}))},i.stopLoad=function(){c.logger.log("stopLoad"),this.networkControllers.forEach((function(e){e.stopLoad()}))},i.swapAudioCodec=function(){c.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},i.recoverMediaError=function(){c.logger.log("recoverMediaError");var e=this.media;this.detachMedia(),e&&this.attachMedia(e)},tn(r,[{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){c.logger.log("set currentLevel:"+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){c.logger.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){c.logger.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){c.logger.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){c.logger.log("set startLevel:"+e),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"capLevelToPlayerSize",set:function(e){var t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){c.logger.log("set autoLevelCapping:"+e),this._autoLevelCapping=e}},{key:"bandwidthEstimate",get:function(){var e=this.abrController._bwEstimator;return e?e.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var e=this.levels,t=this.config.minAutoBitrate,n=e?e.length:0,r=0;r<n;r++)if((e[r].realBitrate?Math.max(e[r].realBitrate,e[r].bitrate):e[r].bitrate)>t)return r;return 0}},{key:"maxAutoLevel",get:function(){var e=this.levels,t=this.autoLevelCapping;return-1===t&&e&&e.length?e.length-1:t}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}}]),r}(X);nn.defaultConfig=void 0},"./src/polyfills/number-isFinite.js":function(e,t,n){"use strict";n.r(t),n.d(t,"isFiniteNumber",(function(){return r}));var r=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)}},"./src/utils/get-self-scope.js":function(e,t,n){"use strict";function r(){return"undefined"==typeof window?self:window}n.r(t),n.d(t,"getSelfScope",(function(){return r}))},"./src/utils/logger.js":function(e,t,n){"use strict";n.r(t),n.d(t,"enableLogs",(function(){return c})),n.d(t,"logger",(function(){return d}));var r=n("./src/utils/get-self-scope.js");function i(){}var o={trace:i,debug:i,log:i,warn:i,info:i,error:i},a=o;function s(e,t){return t="["+e+"] > "+t}var u=Object(r.getSelfScope)();function l(e){var t=u.console[e];return t?function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];r[0]&&(r[0]=s(e,r[0])),t.apply(u.console,r)}:i}var c=function(e){if(u.console&&!0===e||"object"==typeof e){!function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];n.forEach((function(t){a[t]=e[t]?e[t].bind(e):l(t)}))}(e,"debug","log","info","warn","error");try{a.log()}catch(e){a=o}}else a=o},d=a}}).default},e.exports=r())},"./node_modules/json-logic-js/logic.js":function(e,t,n){var r,i;void 0===(i="function"==typeof(r=function(){"use strict";Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)});var e={},t={"==":function(e,t){return e==t},"===":function(e,t){return e===t},"!=":function(e,t){return e!=t},"!==":function(e,t){return e!==t},">":function(e,t){return e>t},">=":function(e,t){return e>=t},"<":function(e,t,n){return void 0===n?e<t:e<t&&t<n},"<=":function(e,t,n){return void 0===n?e<=t:e<=t&&t<=n},"!!":function(t){return e.truthy(t)},"!":function(t){return!e.truthy(t)},"%":function(e,t){return e%t},log:function(e){return console.log(e),e},in:function(e,t){return!(!t||void 0===t.indexOf)&&-1!==t.indexOf(e)},cat:function(){return Array.prototype.join.call(arguments,"")},substr:function(e,t,n){if(n<0){var r=String(e).substr(t);return r.substr(0,r.length+n)}return String(e).substr(t,n)},"+":function(){return Array.prototype.reduce.call(arguments,(function(e,t){return parseFloat(e,10)+parseFloat(t,10)}),0)},"*":function(){return Array.prototype.reduce.call(arguments,(function(e,t){return parseFloat(e,10)*parseFloat(t,10)}))},"-":function(e,t){return void 0===t?-e:e-t},"/":function(e,t){return e/t},min:function(){return Math.min.apply(this,arguments)},max:function(){return Math.max.apply(this,arguments)},merge:function(){return Array.prototype.reduce.call(arguments,(function(e,t){return e.concat(t)}),[])},var:function(e,t){var n=void 0===t?null:t,r=this;if(void 0===e||""===e||null===e)return r;for(var i=String(e).split("."),o=0;o<i.length;o++){if(null===r)return n;if(void 0===(r=r[i[o]]))return n}return r},missing:function(){for(var t=[],n=Array.isArray(arguments[0])?arguments[0]:arguments,r=0;r<n.length;r++){var i=n[r],o=e.apply({var:i},this);null!==o&&""!==o||t.push(i)}return t},missing_some:function(t,n){var r=e.apply({missing:n},this);return n.length-r.length>=t?[]:r},method:function(e,t,n){return e[t].apply(e,n)}};return e.is_logic=function(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)&&1===Object.keys(e).length},e.truthy=function(e){return!(Array.isArray(e)&&0===e.length||!e)},e.get_operator=function(e){return Object.keys(e)[0]},e.get_values=function(t){return t[e.get_operator(t)]},e.apply=function(n,r){if(Array.isArray(n))return n.map((function(t){return e.apply(t,r)}));if(!e.is_logic(n))return n;r=r||{};var i,o,a,s,u,l=e.get_operator(n),c=n[l];if(Array.isArray(c)||(c=[c]),"if"===l||"?:"==l){for(i=0;i<c.length-1;i+=2)if(e.truthy(e.apply(c[i],r)))return e.apply(c[i+1],r);return c.length===i+1?e.apply(c[i],r):null}if("and"===l){for(i=0;i<c.length;i+=1)if(o=e.apply(c[i],r),!e.truthy(o))return o;return o}if("or"===l){for(i=0;i<c.length;i+=1)if(o=e.apply(c[i],r),e.truthy(o))return o;return o}if("filter"===l)return s=e.apply(c[0],r),a=c[1],Array.isArray(s)?s.filter((function(t){return e.truthy(e.apply(a,t))})):[];if("map"===l)return s=e.apply(c[0],r),a=c[1],Array.isArray(s)?s.map((function(t){return e.apply(a,t)})):[];if("reduce"===l)return s=e.apply(c[0],r),a=c[1],u=void 0!==c[2]?c[2]:null,Array.isArray(s)?s.reduce((function(t,n){return e.apply(a,{current:n,accumulator:t})}),u):u;if("all"===l){if(s=e.apply(c[0],r),a=c[1],!s.length)return!1;for(i=0;i<s.length;i+=1)if(!e.truthy(e.apply(a,s[i])))return!1;return!0}if("none"===l)return 0===e.apply({filter:c},r).length;if("some"===l)return e.apply({filter:c},r).length>0;if(c=c.map((function(t){return e.apply(t,r)})),"function"==typeof t[l])return t[l].apply(r,c);if(l.indexOf(".")>0){var d=String(l).split("."),h=t;for(i=0;i<d.length;i++)if(void 0===(h=h[d[i]]))throw new Error("Unrecognized operation "+l+" (failed at "+d.slice(0,i+1).join(".")+")");return h.apply(r,c)}throw new Error("Unrecognized operation "+l)},e.uses_data=function(t){var n=[];if(e.is_logic(t)){var r=e.get_operator(t),i=t[r];Array.isArray(i)||(i=[i]),"var"===r?n.push(i[0]):i.map((function(t){n.push.apply(n,e.uses_data(t))}))}return function(e){for(var t=[],n=0,r=e.length;n<r;n++)-1===t.indexOf(e[n])&&t.push(e[n]);return t}(n)},e.add_operation=function(e,n){t[e]=n},e.rm_operation=function(e){delete t[e]},e.rule_like=function(t,n){if(n===t)return!0;if("@"===n)return!0;if("number"===n)return"number"==typeof t;if("string"===n)return"string"==typeof t;if("array"===n)return Array.isArray(t)&&!e.is_logic(t);if(e.is_logic(n)){if(e.is_logic(t)){var r=e.get_operator(n),i=e.get_operator(t);if("@"===r||r===i)return e.rule_like(e.get_values(t,!1),e.get_values(n,!1))}return!1}if(Array.isArray(n)){if(Array.isArray(t)){if(n.length!==t.length)return!1;for(var o=0;o<n.length;o+=1)if(!e.rule_like(t[o],n[o]))return!1;return!0}return!1}return!1},e})?r.call(t,n,t,e):r)||(e.exports=i)},"./node_modules/shaka-player/dist/shaka-player.compiled.js":function(e,t,n){(function(e,n){!function(){var r="undefined"!=typeof window?window:e,i={};for(var o in function(e,t){var r,i="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){e!=Array.prototype&&e!=Object.prototype&&(e[t]=n.value)},o=void 0!==e&&e===this?this:void 0!==t&&null!=t?t:this;function a(){a=function(){},o.Symbol||(o.Symbol=u)}var s,u=(s=0,function(e){return"jscomp_symbol_"+(e||"")+s++});function l(){a();var e=o.Symbol.iterator;e||(e=o.Symbol.iterator=o.Symbol("iterator")),"function"!=typeof Array.prototype[e]&&i(Array.prototype,e,{configurable:!0,writable:!0,value:function(){return c(this)}}),l=function(){}}function c(e){var t=0;return d((function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}))}function d(e){return l(),(e={next:e})[o.Symbol.iterator]=function(){return this},e}function h(e){l();var t=e[Symbol.iterator];return t?t.call(e):c(e)}function f(e,t){if(t){for(var n=o,r=e.split("."),a=0;a<r.length-1;a++){var s=r[a];s in n||(n[s]={}),n=n[s]}(s=t(a=n[r=r[r.length-1]]))!=a&&null!=s&&i(n,r,{configurable:!0,writable:!0,value:s})}}function p(e){return function(e){function t(t){return e.next(t)}function n(t){return e.throw(t)}return new Promise((function(r,i){!function e(o){o.done?r(o.value):Promise.resolve(o.value).then(t,n).then(e,i)}(e.next())}))}(e())}f("Promise",(function(e){function t(e){this.b=0,this.g=void 0,this.a=[];var t=this.c();try{e(t.resolve,t.reject)}catch(e){t.reject(e)}}function n(){this.a=null}function r(e){return e instanceof t?e:new t((function(t){t(e)}))}if(e)return e;n.prototype.b=function(e){null==this.a&&(this.a=[],this.f()),this.a.push(e)},n.prototype.f=function(){var e=this;this.c((function(){e.h()}))};var i=o.setTimeout;n.prototype.c=function(e){i(e,0)},n.prototype.h=function(){for(;this.a&&this.a.length;){var e=this.a;this.a=[];for(var t=0;t<e.length;++t){var n=e[t];e[t]=null;try{n()}catch(e){this.g(e)}}}this.a=null},n.prototype.g=function(e){this.c((function(){throw e}))},t.prototype.c=function(){function e(e){return function(r){n||(n=!0,e.call(t,r))}}var t=this,n=!1;return{resolve:e(this.s),reject:e(this.f)}},t.prototype.s=function(e){if(e===this)this.f(new TypeError("A Promise cannot resolve to itself"));else if(e instanceof t)this.v(e);else{e:switch(typeof e){case"object":var n=null!=e;break e;case"function":n=!0;break e;default:n=!1}n?this.m(e):this.h(e)}},t.prototype.m=function(e){var t=void 0;try{t=e.then}catch(e){return void this.f(e)}"function"==typeof t?this.C(t,e):this.h(e)},t.prototype.f=function(e){this.i(2,e)},t.prototype.h=function(e){this.i(1,e)},t.prototype.i=function(e,t){if(0!=this.b)throw Error("Cannot settle("+e+", "+t+"): Promise already settled in state"+this.b);this.b=e,this.g=t,this.l()},t.prototype.l=function(){if(null!=this.a){for(var e=0;e<this.a.length;++e)a.b(this.a[e]);this.a=null}};var a=new n;return t.prototype.v=function(e){var t=this.c();e.ac(t.resolve,t.reject)},t.prototype.C=function(e,t){var n=this.c();try{e.call(t,n.resolve,n.reject)}catch(e){n.reject(e)}},t.prototype.then=function(e,n){function r(e,t){return"function"==typeof e?function(t){try{i(e(t))}catch(e){o(e)}}:t}var i,o,a=new t((function(e,t){i=e,o=t}));return this.ac(r(e,i),r(n,o)),a},t.prototype.catch=function(e){return this.then(void 0,e)},t.prototype.ac=function(e,t){function n(){switch(r.b){case 1:e(r.g);break;case 2:t(r.g);break;default:throw Error("Unexpected state: "+r.b)}}var r=this;null==this.a?a.b(n):this.a.push(n)},t.resolve=r,t.reject=function(e){return new t((function(t,n){n(e)}))},t.race=function(e){return new t((function(t,n){for(var i=h(e),o=i.next();!o.done;o=i.next())r(o.value).ac(t,n)}))},t.all=function(e){var n=h(e),i=n.next();return i.done?r([]):new t((function(e,t){function o(t){return function(n){a[t]=n,0==--s&&e(a)}}var a=[],s=0;do{a.push(void 0),s++,r(i.value).ac(o(a.length-1),t),i=n.next()}while(!i.done)}))},t})),f("Promise.prototype.finally",(function(e){return e||function(e){return this.then((function(t){return Promise.resolve(e()).then((function(){return t}))}),(function(t){return Promise.resolve(e()).then((function(){throw t}))}))}}));var m,v="function"==typeof Object.create?Object.create:function(e){function t(){}return t.prototype=e,new t};if("function"==typeof Object.setPrototypeOf)m=Object.setPrototypeOf;else{var g;e:{var y={};try{y.__proto__={pe:!0},g=y.pe;break e}catch(s){}g=!1}m=g?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}var _=m;function b(){this.g=!1,this.c=null,this.o=void 0,this.j=1,this.b=this.f=0,this.i=this.a=null}function E(e){if(e.g)throw new TypeError("Generator is already running");e.g=!0}function w(e,t){e.a={Cd:t,Jd:!0},e.j=e.f||e.b}function T(e,t,n){return e.j=n,{value:t}}function S(e){e.j=0}function x(e,t,n){e.f=t,null!=n&&(e.b=n)}function A(e,t){e.f=0,e.b=t||0}function M(e,t){e.j=t,e.f=0}function j(e){e.f=0;var t=e.a.Cd;return e.a=null,t}function R(e){e.i=[e.a],e.f=0,e.b=0}function L(e,t){var n=e.i.splice(0)[0];(n=e.a=e.a||n)?n.Jd?e.j=e.f||e.b:null!=n.A&&e.b<n.A?(e.j=n.A,e.a=null):e.j=e.b:e.j=t}function C(e){this.a=new b,this.b=e}function k(e,t,n,r){try{var i=t.call(e.a.c,n);if(!(i instanceof Object))throw new TypeError("Iterator result "+i+" is not an object");if(!i.done)return e.a.g=!1,i;var o=i.value}catch(t){return e.a.c=null,w(e.a,t),O(e)}return e.a.c=null,r.call(e.a,o),O(e)}function O(e){for(;e.a.j;)try{var t=e.b(e.a);if(t)return e.a.g=!1,{value:t.value,done:!1}}catch(t){e.a.o=void 0,w(e.a,t)}if(e.a.g=!1,e.a.a){if(t=e.a.a,e.a.a=null,t.Jd)throw t.Cd;return{value:t.return,done:!0}}return{value:void 0,done:!0}}function P(e){this.next=function(t){return E(e.a),e.a.c?t=k(e,e.a.c.next,t,e.a.h):(e.a.h(t),t=O(e)),t},this.throw=function(t){return E(e.a),e.a.c?t=k(e,e.a.c.throw,t,e.a.h):(w(e.a,t),t=O(e)),t},this.return=function(t){return function(e,t){E(e.a);var n=e.a.c;return n?k(e,"return"in n?n.return:function(e){return{value:e,done:!0}},t,e.a.return):(e.a.return(t),O(e))}(e,t)},l(),this[Symbol.iterator]=function(){return this}}function I(e,t){return P.prototype=e.prototype,new P(new C(t))}function D(e){if(!(e instanceof Array)){e=h(e);for(var t,n=[];!(t=e.next()).done;)n.push(t.value);e=n}return e}function N(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function B(e,t,n){e instanceof String&&(e=String(e));for(var r=e.length,i=0;i<r;i++){var o=e[i];if(t.call(n,o,i,e))return{Gd:i,ke:o}}return{Gd:-1,ke:void 0}}function U(e,t,n){if(null==e)throw new TypeError("The 'this' value for String.prototype."+n+" must not be null or undefined");if(t instanceof RegExp)throw new TypeError("First argument to String.prototype."+n+" must not be a regular expression");return e+""}b.prototype.h=function(e){this.o=e},b.prototype.return=function(e){this.a={return:e},this.j=this.b},b.prototype.A=function(e){this.j=e},f("WeakMap",(function(e){function t(e){if(this.a=(s+=Math.random()+1).toString(),e){a(),l(),e=h(e);for(var t;!(t=e.next()).done;)t=t.value,this.set(t[0],t[1])}}function n(e){N(e,o)||i(e,o,{value:{}})}function r(e){var t=Object[e];t&&(Object[e]=function(e){return n(e),t(e)})}if(function(){if(!e||!Object.seal)return!1;try{var t=Object.seal({}),n=Object.seal({}),r=new e([[t,2],[n,3]]);return 2==r.get(t)&&3==r.get(n)&&(r.delete(t),r.set(n,4),!r.has(t)&&4==r.get(n))}catch(e){return!1}}())return e;var o="$jscomp_hidden_"+Math.random();r("freeze"),r("preventExtensions"),r("seal");var s=0;return t.prototype.set=function(e,t){if(n(e),!N(e,o))throw Error("WeakMap key fail: "+e);return e[o][this.a]=t,this},t.prototype.get=function(e){return N(e,o)?e[o][this.a]:void 0},t.prototype.has=function(e){return N(e,o)&&N(e[o],this.a)},t.prototype.delete=function(e){return!(!N(e,o)||!N(e[o],this.a))&&delete e[o][this.a]},t})),f("Map",(function(e){function t(){var e={};return e.Ea=e.next=e.head=e}function n(e,t){var n=e.a;return d((function(){if(n){for(;n.head!=e.a;)n=n.Ea;for(;n.next!=n.head;)return n=n.next,{done:!1,value:t(n)};n=null}return{done:!0,value:void 0}}))}function r(e,t){var n=t&&typeof t;"object"==n||"function"==n?o.has(t)?n=o.get(t):(n=""+ ++s,o.set(t,n)):n="p_"+t;var r=e.b[n];if(r&&N(e.b,n))for(var i=0;i<r.length;i++){var a=r[i];if(t!=t&&a.key!=a.key||t===a.key)return{id:n,list:r,index:i,X:a}}return{id:n,list:r,index:-1,X:void 0}}function i(e){if(this.b={},this.a=t(),this.size=0,e){e=h(e);for(var n;!(n=e.next()).done;)n=n.value,this.set(n[0],n[1])}}if(function(){if(!e||"function"!=typeof e||!e.prototype.entries||"function"!=typeof Object.seal)return!1;try{var t=Object.seal({x:4}),n=new e(h([[t,"s"]]));if("s"!=n.get(t)||1!=n.size||n.get({x:4})||n.set({x:4},"t")!=n||2!=n.size)return!1;var r=n.entries(),i=r.next();return!i.done&&i.value[0]==t&&"s"==i.value[1]&&!((i=r.next()).done||4!=i.value[0].x||"t"!=i.value[1]||!r.next().done)}catch(e){return!1}}())return e;a(),l();var o=new WeakMap;i.prototype.set=function(e,t){var n=r(this,e);return n.list||(n.list=this.b[n.id]=[]),n.X?n.X.value=t:(n.X={next:this.a,Ea:this.a.Ea,head:this.a,key:e,value:t},n.list.push(n.X),this.a.Ea.next=n.X,this.a.Ea=n.X,this.size++),this},i.prototype.delete=function(e){return!(!(e=r(this,e)).X||!e.list)&&(e.list.splice(e.index,1),e.list.length||delete this.b[e.id],e.X.Ea.next=e.X.next,e.X.next.Ea=e.X.Ea,e.X.head=null,this.size--,!0)},i.prototype.clear=function(){this.b={},this.a=this.a.Ea=t(),this.size=0},i.prototype.has=function(e){return!!r(this,e).X},i.prototype.get=function(e){return(e=r(this,e).X)&&e.value},i.prototype.entries=function(){return n(this,(function(e){return[e.key,e.value]}))},i.prototype.keys=function(){return n(this,(function(e){return e.key}))},i.prototype.values=function(){return n(this,(function(e){return e.value}))},i.prototype.forEach=function(e,t){for(var n,r=this.entries();!(n=r.next()).done;)n=n.value,e.call(t,n[1],n[0],this)},i.prototype[Symbol.iterator]=i.prototype.entries;var s=0;return i})),f("Set",(function(e){function t(e){if(this.a=new Map,e){e=h(e);for(var t;!(t=e.next()).done;)this.add(t.value)}this.size=this.a.size}return function(){if(!e||"function"!=typeof e||!e.prototype.entries||"function"!=typeof Object.seal)return!1;try{var t=Object.seal({x:4}),n=new e(h([t]));if(!n.has(t)||1!=n.size||n.add(t)!=n||1!=n.size||n.add({x:4})!=n||2!=n.size)return!1;var r=n.entries(),i=r.next();return!i.done&&i.value[0]==t&&i.value[1]==t&&(!(i=r.next()).done&&i.value[0]!=t&&4==i.value[0].x&&i.value[1]==i.value[0]&&r.next().done)}catch(e){return!1}}()?e:(a(),l(),t.prototype.add=function(e){return this.a.set(e,e),this.size=this.a.size,this},t.prototype.delete=function(e){return e=this.a.delete(e),this.size=this.a.size,e},t.prototype.clear=function(){this.a.clear(),this.size=0},t.prototype.has=function(e){return this.a.has(e)},t.prototype.entries=function(){return this.a.entries()},t.prototype.values=function(){return this.a.values()},t.prototype.keys=t.prototype.values,t.prototype[Symbol.iterator]=t.prototype.values,t.prototype.forEach=function(e,t){var n=this;this.a.forEach((function(r){return e.call(t,r,r,n)}))},t)})),f("Array.prototype.findIndex",(function(e){return e||function(e,t){return B(this,e,t).Gd}})),f("Array.prototype.keys",(function(e){return e||function(){return function(e,t){l(),e instanceof String&&(e+="");var n=0,r={next:function(){if(n<e.length){var i=n++;return{value:t(i,e[i]),done:!1}}return r.next=function(){return{done:!0,value:void 0}},r.next()}};return r[Symbol.iterator]=function(){return r},r}(this,(function(e){return e}))}})),f("Object.is",(function(e){return e||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}})),f("Array.prototype.includes",(function(e){return e||function(e,t){var n=this;n instanceof String&&(n=String(n));var r=n.length,i=t||0;for(0>i&&(i=Math.max(i+r,0));i<r;i++){var o=n[i];if(o===e||Object.is(o,e))return!0}return!1}})),f("String.prototype.includes",(function(e){return e||function(e,t){return-1!==U(this,e,"includes").indexOf(e,t||0)}})),f("Array.from",(function(e){return e||function(e,t,n){l(),t=null!=t?t:function(e){return e};var r=[],i=e[Symbol.iterator];if("function"==typeof i)for(e=i.call(e);!(i=e.next()).done;)r.push(t.call(n,i.value));else{i=e.length;for(var o=0;o<i;o++)r.push(t.call(n,e[o]))}return r}})),f("String.prototype.startsWith",(function(e){return e||function(e,t){for(var n=U(this,e,"startsWith"),r=n.length,i=e.length,o=Math.max(0,Math.min(0|t,n.length)),a=0;a<i&&o<r;)if(n[o++]!=e[a++])return!1;return a>=i}})),f("Array.prototype.find",(function(e){return e||function(e,t){return B(this,e,t).ke}}));var F="function"==typeof Object.assign?Object.assign:function(e,t){for(var n=1;n<arguments.length;n++){var r=arguments[n];if(r)for(var i in r)N(r,i)&&(e[i]=r[i])}return e};f("Object.assign",(function(e){return e||F}));var V=this;function G(e,t){var n,r=e.split("."),i=V;r[0]in i||!i.execScript||i.execScript("var "+r[0]);for(;r.length&&(n=r.shift());)r.length||void 0===t?i=i[n]?i[n]:i[n]={}:i[n]=t}function H(e,t){function n(){}n.prototype=t.prototype,e.fg=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.tg=function(e,n,r){return t.prototype[n].apply(e,Array.prototype.slice.call(arguments,2))}}function z(e){this.c=Math.exp(Math.log(.5)/e),this.b=this.a=0}function W(e,t,n){var r=Math.pow(e.c,t);n=n*(1-r)+r*e.a,isNaN(n)||(e.a=n,e.b+=t)}function q(e){return e.a/(1-Math.pow(e.c,e.b))}function K(){this.b=new z(2),this.c=new z(5),this.a=0}function Y(){}function X(){}function J(){}V.a=!0,K.prototype.getBandwidthEstimate=function(e){return 128e3>this.a?e:Math.min(q(this.b),q(this.c))},e.console&&e.console.log.bind&&(X=console.warn.bind(console),Y=console.error.bind(console));var Z=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/;function $(e){var t;e instanceof $?(Q(this,e.sa),this.bb=e.bb,this.ra=e.ra,ee(this,e.zb),this.ja=e.ja,te(this,e.a.clone()),this.Sa=e.Sa):e&&(t=String(e).match(Z))?(Q(this,t[1]||"",!0),this.bb=ne(t[2]||""),this.ra=ne(t[3]||"",!0),ee(this,t[4]),this.ja=ne(t[5]||"",!0),te(this,t[6]||"",!0),this.Sa=ne(t[7]||"")):this.a=new ce(null)}function Q(e,t,n){e.sa=n?ne(t,!0):t,e.sa&&(e.sa=e.sa.replace(/:$/,""))}function ee(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.zb=t}else e.zb=null}function te(e,t,n){t instanceof ce?e.a=t:(n||(t=re(t,ue)),e.a=new ce(t))}function ne(e,t){return e?t?decodeURI(e):decodeURIComponent(e):""}function re(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,ie),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function ie(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}(r=$.prototype).sa="",r.bb="",r.ra="",r.zb=null,r.ja="",r.Sa="",r.toString=function(){var e=[],t=this.sa;if(t&&e.push(re(t,oe,!0),":"),t=this.ra){e.push("//");var n=this.bb;n&&e.push(re(n,oe,!0),"@"),e.push(encodeURIComponent(t).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.zb)&&e.push(":",String(t))}return(t=this.ja)&&(this.ra&&"/"!=t.charAt(0)&&e.push("/"),e.push(re(t,"/"==t.charAt(0)?se:ae,!0))),(t=this.a.toString())&&e.push("?",t),(t=this.Sa)&&e.push("#",re(t,le)),e.join("")},r.resolve=function(e){var t=this.clone();"data"===t.sa&&(t=new $);var n=!!e.sa;n?Q(t,e.sa):n=!!e.bb,n?t.bb=e.bb:n=!!e.ra,n?t.ra=e.ra:n=null!=e.zb;var r=e.ja;if(n)ee(t,e.zb);else if(n=!!e.ja){if("/"!=r.charAt(0))if(this.ra&&!this.ja)r="/"+r;else{var i=t.ja.lastIndexOf("/");-1!=i&&(r=t.ja.substr(0,i+1)+r)}if(".."==r||"."==r)r="";else if(-1!=r.indexOf("./")||-1!=r.indexOf("/.")){i=0==r.lastIndexOf("/",0),r=r.split("/");for(var o=[],a=0;a<r.length;){var s=r[a++];"."==s?i&&a==r.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),i&&a==r.length&&o.push("")):(o.push(s),i=!0)}r=o.join("/")}}return n?t.ja=r:n=""!==e.a.toString(),n?te(t,e.a.clone()):n=!!e.Sa,n&&(t.Sa=e.Sa),t},r.clone=function(){return new $(this)};var oe=/[#\/\?@]/g,ae=/[#\?:]/g,se=/[#\?]/g,ue=/[#\?@]/g,le=/#/g;function ce(e){this.a=e||null}function de(e){this.b=e,this.a=null}function he(e){this.b=e,this.a=null}function fe(e,t){var n={maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:0};this.i=null==e.maxAttempts?n.maxAttempts:e.maxAttempts,this.f=null==e.baseDelay?n.baseDelay:e.baseDelay,this.h=null==e.fuzzFactor?n.fuzzFactor:e.fuzzFactor,this.g=null==e.backoffFactor?n.backoffFactor:e.backoffFactor,this.a=0,this.b=this.f,(this.c=void 0!==t&&t)&&(this.a=1)}function pe(e){return p((function t(){var n,r;return I(t,(function(t){switch(t.j){case 1:if(e.a>=e.i){if(!e.c)return t.return(Promise.reject());e.a=1,e.b=e.f}return n=e.a,e.a++,0==n?t.return():(r=e.b*(1+(2*Math.random()-1)*e.h),T(t,new Promise((function(e){new he(e).P(r/1e3)})),2));case 2:e.b*=e.g,S(t)}}))}))}function me(e,t,n,r){for(var i=[],o=3;o<arguments.length;++o)i[o-3]=arguments[o];this.severity=e,this.category=t,this.code=n,this.data=i,this.handled=!1}function ve(){var e,t,n=new Promise((function(n,r){e=n,t=r}));return n.resolve=e,n.reject=t,n}function ge(e,t){this.promise=e,this.Md=t,this.a=!1}function ye(e){return new ge(Promise.reject(e),(function(){return Promise.resolve()}))}function _e(){var e=Promise.reject(new me(2,7,7001));return e.catch((function(){})),new ge(e,(function(){return Promise.resolve()}))}function be(e){return new ge(Promise.resolve(e),(function(){return Promise.resolve()}))}function Ee(e){return new ge(e,(function(){return e.catch((function(){}))}))}function we(e){return new ge(Promise.all(e.map((function(e){return e.promise}))),(function(){return Promise.all(e.map((function(e){return e.abort()})))}))}function Te(e,t,n){try{var r=e(t);return r&&r.promise&&r.abort?(n.resolve(r.promise),function(){return r.abort()}):(n.resolve(r),function(){return Promise.resolve(r).then((function(){})).catch((function(){}))})}catch(e){return n.reject(e),function(){return Promise.resolve()}}}function Se(t,n){for(var r in n=void 0===n?{}:n)this[r]=n[r];this.defaultPrevented=this.cancelable=this.bubbles=!1,this.timeStamp=e.performance&&e.performance.now?e.performance.now():Date.now(),this.type=t,this.isTrusted=!1,this.target=this.currentTarget=null,this.a=!1}function xe(){this.a={}}function Ae(){this.Fc=new xe,this.Yb=this}function Me(e){var t=new Set;return function e(n){switch(typeof n){case"undefined":case"boolean":case"number":case"string":case"symbol":case"function":return n;default:if(!n||n.buffer&&n.buffer.constructor==ArrayBuffer)return n;if(t.has(n))return null;var r=n.constructor==Array;if(n.constructor!=Object&&!r)return null;t.add(n);var i,o=r?[]:{};for(i in n)o[i]=e(n[i]);return r&&(o.length=n.length),o}}(e)}function je(e,t){return!("number"!=typeof e||"number"!=typeof t||!isNaN(e)||!isNaN(t))||e===t}function Re(e,t){var n=e.indexOf(t);-1<n&&e.splice(n,1)}function Le(e,t,n){if(n||(n=je),e.length!=t.length)return!1;t=t.slice();for(var r={},i=(e=h(e)).next();!i.done;r={item:r.item},i=e.next()){if(r.item=i.value,-1==(i=t.findIndex(function(e){return function(t){return n(e.item,t)}}(r))))return!1;t[i]=t[t.length-1],t.pop()}return 0==t.length}function Ce(){this.a=[]}function ke(e,t){e.a.push(t.finally((function(){Re(e.a,t)})))}function Oe(e){Ae.call(this),this.f=!1,this.g=new Ce,this.a=new Set,this.b=new Set,this.c=e||null}(r=ce.prototype).ha=null,r.cc=null,r.add=function(e,t){if(!this.ha&&(this.ha={},this.cc=0,this.a))for(var n=this.a.split("&"),r=0;r<n.length;r++){var i=n[r].indexOf("="),o=null;if(0<=i){var a=n[r].substring(0,i);o=n[r].substring(i+1)}else a=n[r];a=decodeURIComponent(a.replace(/\+/g," ")),o=o||"",this.add(a,decodeURIComponent(o.replace(/\+/g," ")))}return this.a=null,(n=this.ha.hasOwnProperty(e)&&this.ha[e])||(this.ha[e]=n=[]),n.push(t),this.cc++,this},r.toString=function(){if(this.a)return this.a;if(!this.ha)return"";var e,t=[];for(e in this.ha)for(var n=encodeURIComponent(e),r=this.ha[e],i=0;i<r.length;i++){var o=n;""!==r[i]&&(o+="="+encodeURIComponent(r[i])),t.push(o)}return this.a=t.join("&")},r.clone=function(){var e=new ce;if(e.a=this.a,this.ha){var t,n={};for(t in this.ha)n[t]=this.ha[t].concat();e.ha=n,e.cc=this.cc}return e},de.prototype.P=function(t){var n=this;this.stop();var r=!0,i=null;return this.a=function(){e.clearTimeout(i),r=!1},i=e.setTimeout((function(){r&&n.b()}),1e3*t),this},de.prototype.stop=function(){this.a&&(this.a(),this.a=null)},G("shaka.util.Timer",he),he.prototype.uc=function(){return this.stop(),this.b(),this},he.prototype.tickNow=he.prototype.uc,he.prototype.P=function(e){var t=this;return this.stop(),this.a=new de((function(){t.b()})).P(e),this},he.prototype.tickAfter=he.prototype.P,he.prototype.Na=function(e){var t=this;return this.stop(),this.a=new de((function(){t.a.P(e),t.b()})).P(e),this},he.prototype.tickEvery=he.prototype.Na,he.prototype.stop=function(){this.a&&(this.a.stop(),this.a=null)},he.prototype.stop=he.prototype.stop,G("shaka.util.Error",me),me.prototype.toString=function(){return"shaka.util.Error "+JSON.stringify(this,null,"  ")},me.Severity={RECOVERABLE:1,CRITICAL:2},me.Category={NETWORK:1,TEXT:2,MEDIA:3,MANIFEST:4,STREAMING:5,DRM:6,PLAYER:7,CAST:8,STORAGE:9},me.Code={UNSUPPORTED_SCHEME:1e3,BAD_HTTP_STATUS:1001,HTTP_ERROR:1002,TIMEOUT:1003,MALFORMED_DATA_URI:1004,UNKNOWN_DATA_URI_ENCODING:1005,REQUEST_FILTER_ERROR:1006,RESPONSE_FILTER_ERROR:1007,MALFORMED_TEST_URI:1008,UNEXPECTED_TEST_REQUEST:1009,INVALID_TEXT_HEADER:2e3,INVALID_TEXT_CUE:2001,UNABLE_TO_DETECT_ENCODING:2003,BAD_ENCODING:2004,INVALID_XML:2005,INVALID_MP4_TTML:2007,INVALID_MP4_VTT:2008,UNABLE_TO_EXTRACT_CUE_START_TIME:2009,BUFFER_READ_OUT_OF_BOUNDS:3e3,JS_INTEGER_OVERFLOW:3001,EBML_OVERFLOW:3002,EBML_BAD_FLOATING_POINT_SIZE:3003,MP4_SIDX_WRONG_BOX_TYPE:3004,MP4_SIDX_INVALID_TIMESCALE:3005,MP4_SIDX_TYPE_NOT_SUPPORTED:3006,WEBM_CUES_ELEMENT_MISSING:3007,WEBM_EBML_HEADER_ELEMENT_MISSING:3008,WEBM_SEGMENT_ELEMENT_MISSING:3009,WEBM_INFO_ELEMENT_MISSING:3010,WEBM_DURATION_ELEMENT_MISSING:3011,WEBM_CUE_TRACK_POSITIONS_ELEMENT_MISSING:3012,WEBM_CUE_TIME_ELEMENT_MISSING:3013,MEDIA_SOURCE_OPERATION_FAILED:3014,MEDIA_SOURCE_OPERATION_THREW:3015,VIDEO_ERROR:3016,QUOTA_EXCEEDED_ERROR:3017,TRANSMUXING_FAILED:3018,UNABLE_TO_GUESS_MANIFEST_TYPE:4e3,DASH_INVALID_XML:4001,DASH_NO_SEGMENT_INFO:4002,DASH_EMPTY_ADAPTATION_SET:4003,DASH_EMPTY_PERIOD:4004,DASH_WEBM_MISSING_INIT:4005,DASH_UNSUPPORTED_CONTAINER:4006,DASH_PSSH_BAD_ENCODING:4007,DASH_NO_COMMON_KEY_SYSTEM:4008,DASH_MULTIPLE_KEY_IDS_NOT_SUPPORTED:4009,DASH_CONFLICTING_KEY_IDS:4010,UNPLAYABLE_PERIOD:4011,RESTRICTIONS_CANNOT_BE_MET:4012,NO_PERIODS:4014,HLS_PLAYLIST_HEADER_MISSING:4015,INVALID_HLS_TAG:4016,HLS_INVALID_PLAYLIST_HIERARCHY:4017,DASH_DUPLICATE_REPRESENTATION_ID:4018,HLS_MULTIPLE_MEDIA_INIT_SECTIONS_FOUND:4020,HLS_COULD_NOT_GUESS_MIME_TYPE:4021,HLS_MASTER_PLAYLIST_NOT_PROVIDED:4022,HLS_REQUIRED_ATTRIBUTE_MISSING:4023,HLS_REQUIRED_TAG_MISSING:4024,HLS_COULD_NOT_GUESS_CODECS:4025,HLS_KEYFORMATS_NOT_SUPPORTED:4026,DASH_UNSUPPORTED_XLINK_ACTUATE:4027,DASH_XLINK_DEPTH_LIMIT:4028,HLS_COULD_NOT_PARSE_SEGMENT_START_TIME:4030,CONTENT_UNSUPPORTED_BY_BROWSER:4032,CANNOT_ADD_EXTERNAL_TEXT_TO_LIVE_STREAM:4033,HLS_AES_128_ENCRYPTION_NOT_SUPPORTED:4034,INVALID_STREAMS_CHOSEN:5005,NO_RECOGNIZED_KEY_SYSTEMS:6e3,REQUESTED_KEY_SYSTEM_CONFIG_UNAVAILABLE:6001,FAILED_TO_CREATE_CDM:6002,FAILED_TO_ATTACH_TO_VIDEO:6003,INVALID_SERVER_CERTIFICATE:6004,FAILED_TO_CREATE_SESSION:6005,FAILED_TO_GENERATE_LICENSE_REQUEST:6006,LICENSE_REQUEST_FAILED:6007,LICENSE_RESPONSE_REJECTED:6008,ENCRYPTED_CONTENT_WITHOUT_DRM_INFO:6010,NO_LICENSE_SERVER_GIVEN:6012,OFFLINE_SESSION_REMOVED:6013,EXPIRED:6014,SERVER_CERTIFICATE_REQUIRED:6015,INIT_DATA_TRANSFORM_ERROR:6016,LOAD_INTERRUPTED:7e3,OPERATION_ABORTED:7001,NO_VIDEO_ELEMENT:7002,CAST_API_UNAVAILABLE:8e3,NO_CAST_RECEIVERS:8001,ALREADY_CASTING:8002,UNEXPECTED_CAST_ERROR:8003,CAST_CANCELED_BY_USER:8004,CAST_CONNECTION_TIMED_OUT:8005,CAST_RECEIVER_APP_UNAVAILABLE:8006,CAST_RECEIVER_APP_ID_MISSING:8007,STORAGE_NOT_SUPPORTED:9e3,INDEXED_DB_ERROR:9001,DEPRECATED_OPERATION_ABORTED:9002,REQUESTED_ITEM_NOT_FOUND:9003,MALFORMED_OFFLINE_URI:9004,CANNOT_STORE_LIVE_OFFLINE:9005,STORE_ALREADY_IN_PROGRESS:9006,NO_INIT_DATA_FOR_OFFLINE:9007,LOCAL_PLAYER_INSTANCE_REQUIRED:9008,NEW_KEY_OPERATION_NOT_SUPPORTED:9011,KEY_NOT_FOUND:9012,MISSING_STORAGE_CELL:9013},ve.prototype.resolve=function(){},ve.prototype.reject=function(){},G("shaka.util.AbortableOperation",ge),ge.failed=ye,ge.aborted=_e,ge.completed=be,ge.notAbortable=Ee,ge.prototype.abort=function(){return this.a=!0,this.Md()},ge.prototype.abort=ge.prototype.abort,ge.all=we,ge.prototype.finally=function(e){return this.promise.then((function(){return e(!0)}),(function(){return e(!1)})),this},ge.prototype.finally=ge.prototype.finally,ge.prototype.U=function(e,t){function n(){return i.reject(new me(2,7,7001)),r.abort()}var r=this,i=new ve;return this.promise.then((function(t){r.a?i.reject(new me(2,7,7001)):e?n=Te(e,t,i):i.resolve(t)}),(function(e){t?n=Te(t,e,i):i.reject(e)})),new ge(i,(function(){return n()}))},ge.prototype.chain=ge.prototype.U,Se.prototype.preventDefault=function(){this.cancelable&&(this.defaultPrevented=!0)},Se.prototype.stopImmediatePropagation=function(){this.a=!0},Se.prototype.stopPropagation=function(){},(r=xe.prototype).push=function(e,t){this.a.hasOwnProperty(e)?this.a[e].push(t):this.a[e]=[t]},r.get=function(e){return(e=this.a[e])?e.slice():null},r.getAll=function(){var e,t=[];for(e in this.a)t.push.apply(t,this.a[e]);return t},r.remove=function(e,t){var n=this.a[e];if(n)for(var r=0;r<n.length;++r)n[r]==t&&(n.splice(r,1),--r)},r.forEach=function(e){for(var t in this.a)e(t,this.a[t])},Ae.prototype.addEventListener=function(e,t){this.Fc.push(e,t)},Ae.prototype.removeEventListener=function(e,t){this.Fc.remove(e,t)},Ae.prototype.dispatchEvent=function(e){for(var t=this.Fc.get(e.type)||[],n=0;n<t.length;++n){e.target=this.Yb,e.currentTarget=this.Yb;var r=t[n];try{r.handleEvent?r.handleEvent(e):r.call(this,e)}catch(e){}if(e.a)break}return e.defaultPrevented},Ce.prototype.destroy=function(){var e=[];return this.a.forEach((function(t){t.promise.catch((function(){})),e.push(t.abort())})),this.a=[],Promise.all(e)},H(Oe,Ae),G("shaka.net.NetworkingEngine",Oe),Oe.RequestType={MANIFEST:0,SEGMENT:1,LICENSE:2,APP:3,TIMING:4},Oe.PluginPriority={FALLBACK:1,PREFERRED:2,APPLICATION:3};var Pe={};function Ie(e,t,n){n=n||3;var r=Pe[e];(!r||n>=r.priority)&&(Pe[e]={priority:n,Df:t})}function De(e,t){return{uris:e,method:"GET",body:null,headers:{},allowCrossSiteCredentials:!1,retryParameters:t,licenseRequestType:null,sessionId:null}}function Ne(){this.a=0}function Be(e,t,n){ge.call(this,e,t),this.b=n}Oe.registerScheme=Ie,Oe.unregisterScheme=function(e){delete Pe[e]},Oe.prototype.Ff=function(e){this.a.add(e)},Oe.prototype.registerRequestFilter=Oe.prototype.Ff,Oe.prototype.hg=function(e){this.a.delete(e)},Oe.prototype.unregisterRequestFilter=Oe.prototype.hg,Oe.prototype.ye=function(){this.a.clear()},Oe.prototype.clearAllRequestFilters=Oe.prototype.ye,Oe.prototype.Gf=function(e){this.b.add(e)},Oe.prototype.registerResponseFilter=Oe.prototype.Gf,Oe.prototype.ig=function(e){this.b.delete(e)},Oe.prototype.unregisterResponseFilter=Oe.prototype.ig,Oe.prototype.ze=function(){this.b.clear()},Oe.prototype.clearAllResponseFilters=Oe.prototype.ze,Oe.defaultRetryParameters=function(){return{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:0}},Oe.makeRequest=De,Oe.prototype.destroy=function(){return this.f=!0,this.a.clear(),this.b.clear(),this.g.destroy()},Oe.prototype.destroy=Oe.prototype.destroy,Oe.prototype.request=function(e,t){var n=this,r=new Ne;if(this.f){var i=Promise.reject(new me(2,7,7001));return i.catch((function(){})),new Be(i,(function(){return Promise.resolve()}),r)}t.method=t.method||"GET",t.headers=t.headers||{},t.retryParameters=t.retryParameters?Me(t.retryParameters):{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:0},t.uris=Me(t.uris);var o=(i=function(e,t,n){for(var r=be(void 0),i={},o=(e=h(e.a)).next();!o.done;i={ld:i.ld},o=e.next())i.ld=o.value,r=r.U(function(e){return function(){return e.ld(t,n)}}(i));return r.U(void 0,(function(e){if(e&&7001==e.code)throw e;throw new me(2,1,1006,e)}))}(this,e,t)).U((function(){return function e(t,n,r,i,o,a,s){var u=new $(r.uris[o]),l=u.sa,c=!1;l||(l=(l=location.protocol).slice(0,-1),Q(u,l),r.uris[o]=u.toString()),l=l.toLowerCase();var d,h=(l=Pe[l])?l.Df:null;return h?Ee(pe(i)).U((function(){return t.f?_e():(d=Date.now(),h(r.uris[o],r,n,(function(e,r,i){t.c&&1==n&&(t.c(e,r),c=!0,s.a=i)})))})).U((function(e){return null==e.timeMs&&(e.timeMs=Date.now()-d),{response:e,cf:c}}),(function(u){if(u&&7001==u.code)throw u;if(t.f)return _e();if(u&&1==u.severity)return t.dispatchEvent(new Se("retry",{error:u instanceof me?u:null})),o=(o+1)%r.uris.length,e(t,n,r,i,o,u,s);throw u||a})):ye(new me(2,1,1e3,u))}(n,e,t,new fe(t.retryParameters,!1),0,null,r)})),a=o.U((function(t){return function(e,t,n){for(var r=be(void 0),i=(e=h(e.b)).next();!i.done;i=e.next())r=r.U(i.value.bind(null,t,n.response));return r.U((function(){return n}),(function(e){if(e&&7001==e.code)throw e;var t=2;throw e instanceof me&&(t=e.severity),new me(t,1,1007,e)}))}(n,e,t)})),s=Date.now(),u=0;i.promise.then((function(){u=Date.now()-s}),(function(){}));var l=0;return o.promise.then((function(){l=Date.now()}),(function(){})),i=new Be((i=a.U((function(t){var r=Date.now()-l,i=t.response;return i.timeMs+=u,i.timeMs+=r,t.cf||!n.c||i.fromCache||1!=e||n.c(i.timeMs,i.data.byteLength),i}),(function(e){throw e&&(e.severity=2),e}))).promise,i.Md,r),ke(this.g,i),i},Oe.prototype.request=Oe.prototype.request,Oe.NumBytesRemainingClass=Ne;var Ue=Be;if(Ue.prototype=v(ge.prototype),Ue.prototype.constructor=Ue,_)_(Ue,ge);else for(var Fe in ge)if("prototype"!=Fe)if(Object.defineProperties){var Ve=Object.getOwnPropertyDescriptor(ge,Fe);Ve&&Object.defineProperty(Ue,Fe,Ve)}else Ue[Fe]=ge[Fe];function Ge(){}function He(){this.a=new xe}function ze(e,t,n,r){this.target=e,this.type=t,this.listener=n,this.a=function(e,t){if(null==t)return!1;if("boolean"==typeof t)return t;var n=new Set(["passive","capture"]);return Object.keys(t).filter((function(e){return!n.has(e)})),function(e){var t=We;if(null==t){t=!1;try{var n={},r={get:function(){return t=!0,!1}};Object.defineProperty(n,"passive",r),Object.defineProperty(n,"capture",r),r=function(){},e.addEventListener("test",r,n),e.removeEventListener("test",r,n)}catch(e){t=!1}We=t}return t||!1}(e)?t:t.capture||!1}(e,r),this.target.addEventListener(t,n,this.a)}Ue.fg=ge.prototype,Oe.PendingRequest=Be,Be.all=we,Be.notAbortable=Ee,Be.completed=be,Be.aborted=_e,Be.failed=ye,G("shaka.util.IReleasable",Ge),Ge.prototype.release=function(){},G("shaka.util.EventManager",He),He.prototype.release=function(){this.$a(),this.a=null},He.prototype.release=He.prototype.release,He.prototype.w=function(e,t,n,r){this.a&&(e=new ze(e,t,n,r),this.a.push(t,e))},He.prototype.listen=He.prototype.w,He.prototype.da=function(e,t,n,r){var i=this;this.w(e,t,(function r(o){i.ea(e,t,r),n(o)}),r)},He.prototype.listenOnce=He.prototype.da,He.prototype.ea=function(e,t,n){if(this.a)for(var r=this.a.get(t)||[],i=(r=h(r)).next();!i.done;i=r.next())(i=i.value).target!=e||n!=i.listener&&n||(i.ea(),this.a.remove(t,i))},He.prototype.unlisten=He.prototype.ea,He.prototype.$a=function(){if(this.a){for(var e=this.a.getAll(),t=(e=h(e)).next();!t.done;t=e.next())t.value.ea();this.a.a={}}},He.prototype.removeAll=He.prototype.$a,ze.prototype.ea=function(){this.target.removeEventListener(this.type,this.listener,this.a),this.listener=this.target=null,this.a=!1},ze.prototype.unlisten=ze.prototype.ea;var We=void 0;function qe(e){if(e=new Uint8Array(e),new DataView(e.buffer,e.byteOffset,e.byteLength).getUint32(0,!0)+4!=e.byteLength)throw new RangeError("Malformed FairPlay init data");return new $(e=at(e.subarray(4),!0)).ra}function Ke(e,t,n){function r(e){new DataView(o.buffer).setUint32(a,e.byteLength,!0),a+=4,i(e)}function i(e){o.set(e,a),a+=e.byteLength}if(!n||!n.byteLength)throw new me(2,6,6015);t="string"==typeof t?new Uint8Array(lt(t,!0)):new Uint8Array(t);var o=new Uint8Array(8+e.byteLength+t.byteLength+n.byteLength),a=0;return i(new Uint8Array(e)),r(t),r(new Uint8Array(n)),o}function Ye(e,t){for(var n=h(e),r=n.next();!r.done;r=n.next())if(!t(r.value))return!1;return!0}function Xe(e){var t=new Map;return Object.keys(e).forEach((function(n){t.set(n,e[n])})),t}function Je(e){var t={};return e.forEach((function(e,n){t[n]=e})),t}function Ze(e,t){var n=e;return t&&(n+='; codecs="'+t+'"'),n}function $e(e){var t=(e=e.split("."))[0];return e.pop(),[t,e.join(".")]}G("shaka.util.FairPlayUtils.defaultGetContentId",qe),G("shaka.util.FairPlayUtils.initDataTransform",Ke);var Qe=(new Map).set("codecs","codecs").set("frameRate","framerate").set("bandwidth","bitrate").set("width","width").set("height","height").set("channelsCount","channels");function et(){return!(!e.MediaSource||!MediaSource.isTypeSupported)}function tt(e){return""!=(it||(rt||(rt=new he((function(){it=null}))),(it=document.querySelector("video")||document.querySelector("audio"))||(it=document.createElement("video")),rt.P(1),it)).canPlayType(e)}function nt(e){return(navigator.userAgent||"").includes(e)}var rt=null,it=null;function ot(e){if(!e)return"";239==(e=new Uint8Array(e))[0]&&187==e[1]&&191==e[2]&&(e=e.subarray(3)),e=ct(e),e=escape(e);try{return decodeURIComponent(e)}catch(e){throw new me(2,2,2004)}}function at(e,t,n){if(!e)return"";if(!n&&0!=e.byteLength%2)throw new me(2,2,2004);if(e instanceof ArrayBuffer)var r=e;else(n=new Uint8Array(e.byteLength)).set(new Uint8Array(e)),r=n.buffer;e=Math.floor(e.byteLength/2),n=new Uint16Array(e),r=new DataView(r);for(var i=0;i<e;i++)n[i]=r.getUint16(2*i,t);return ct(n)}function st(e){var t=new Uint8Array(e);if(239==t[0]&&187==t[1]&&191==t[2])return ot(t);if(254==t[0]&&255==t[1])return at(t.subarray(2),!1);if(255==t[0]&&254==t[1])return at(t.subarray(2),!0);var n=function(e,t){return e.byteLength<=t||32<=e[t]&&126>=e[t]}.bind(null,t);if(0==t[0]&&0==t[2])return at(e,!1);if(0==t[1]&&0==t[3])return at(e,!0);if(n(0)&&n(1)&&n(2)&&n(3))return ot(e);throw new me(2,2,2003)}function ut(e){e=encodeURIComponent(e),e=unescape(e);for(var t=new Uint8Array(e.length),n=0;n<e.length;++n)t[n]=e.charCodeAt(n);return t.buffer}function lt(e,t){for(var n=new Uint8Array(2*e.length),r=new DataView(n.buffer),i=0;i<e.length;++i)r.setUint16(2*i,e.charCodeAt(i),t);return n.buffer}function ct(e){if(!dt)for(var t=function(e){try{return D(new Uint8Array(e)),!0}catch(e){return!1}},n={size:65536};0<n.size;(n={size:n.size}).size/=2)if(t(n.size)){dt=function(e){return function(t){for(var n="",r=0;r<t.length;r+=e.size)n+=String.fromCharCode.apply(String,D(t.subarray(r,r+e.size)));return n}}(n);break}return dt(e)}G("shaka.util.StringUtils.fromUTF8",ot),G("shaka.util.StringUtils.fromUTF16",at),G("shaka.util.StringUtils.fromBytesAutoDetect",st),G("shaka.util.StringUtils.toUTF8",ut),G("shaka.util.StringUtils.toUTF16",lt);var dt=null,ht={vc:function(t,n){var r=ct(t);return n=null==n||n,r=e.btoa(r).replace(/\+/g,"-").replace(/\//g,"_"),n?r:r.replace(/=*$/,"")}};function ft(e){var t=this;this.C=e,this.v=new Set,this.l=this.h=null,this.R=!1,this.a=null,this.i=new He,this.b=new Map,this.s=[],this.m=new ve,this.f=null,this.g=function(n){t.m.reject(n),e.onError(n)},this.oa=new Map,this.T=new Map,this.L=new he((function(){return function(e){var t=e.oa,n=e.T;n.clear(),t.forEach((function(e,t){return n.set(t,e)})),(t=Array.from(n.values())).length&&t.every((function(e){return"expired"==e}))&&e.g(new me(2,6,6014)),e.C.mc(Je(n))}(t)})),this.c=!1,this.$=new ve,this.D=!1,this.F=[],this.na=!1,this.W=new he((function(){!function(e){e.b.forEach((function(t,n){var r=t.cd,i=n.expiration;isNaN(i)&&(i=1/0),i!=r&&(e.C.onExpirationUpdated(n.sessionId,i),t.cd=i)}))}(t)})).Na(1),this.m.catch((function(){}))}function pt(e,t,n){return e.s=n,e.D=0<n.length,mt(e,t)}function mt(t,n){var r=function(t){if(0==(t=Xe(t.f.clearKeys)).size)return null;var n=[],r=[];t.forEach((function(e,t){var i=ht.Mc(t),o=ht.Mc(e);i={kty:"oct",kid:ht.vc(i,!1),k:ht.vc(o,!1)},n.push(i),r.push(i.kid)})),t=JSON.stringify({keys:n});var i=JSON.stringify({kids:r});return i=[{initData:new Uint8Array(ut(i)),initDataType:"keyids"}],{keySystem:"org.w3.clearkey",licenseServerUri:"data:application/json;base64,"+e.btoa(t),distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,initData:i,keyIds:[]}}(t);if(r)for(var i=h(n),o=i.next();!o.done;o=i.next())o.value.drmInfos=[r];for((r=n.some((function(e){return 0<e.drmInfos.length})))||function(e,t){var n=[];t.forEach((function(e,t){n.push({keySystem:t,licenseServerUri:e,distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,initData:[],keyIds:[]})}));for(var r=h(e),i=r.next();!i.done;i=r.next())i.value.drmInfos=n}(n,o=Xe(t.f.servers)),o=(i=h(n)).next();!o.done;o=i.next())for(var a=(o=h(o.value.drmInfos)).next();!a.done;a=o.next())Ct(a.value,Xe(t.f.servers),Xe(t.f.advanced||{}));return(o=function(e,t){for(var n=new Set,r=h(t),i=r.next();!i.done;i=r.next()){var o=h(i.value.drmInfos);for(i=o.next();!i.done;i=o.next())n.add(i.value)}for(r=h(n),i=r.next();!i.done;i=r.next())Ct(i.value,Xe(e.f.servers),Xe(e.f.advanced||{}));o=e.D?"required":"optional";var a=e.D?["persistent-license"]:["temporary"];for(r=new Map,n=h(n),i=n.next();!i.done;i=n.next())i=i.value,r.set(i.keySystem,{audioCapabilities:[],videoCapabilities:[],distinctiveIdentifier:"optional",persistentState:o,sessionTypes:a,label:i.keySystem,drmInfos:[]});for(n=h(t),i=n.next();!i.done;i=n.next()){i=i.value,o=i.audio,a=i.video;var s=o?Ze(o.mimeType,o.codecs):"",u=a?Ze(a.mimeType,a.codecs):"",l=h(i.drmInfos);for(i=l.next();!i.done;i=l.next()){i=i.value;var c=r.get(i.keySystem);c.drmInfos.push(i),i.distinctiveIdentifierRequired&&(c.distinctiveIdentifier="required"),i.persistentStateRequired&&(c.persistentState="required"),o&&c.audioCapabilities.push({robustness:i.audioRobustness||"",contentType:s}),a&&c.videoCapabilities.push({robustness:i.videoRobustness||"",contentType:u})}}return r}(t,n)).size?(o=wt(t,o),r?o:o.catch((function(){}))):(t.R=!0,Promise.resolve())}function vt(e){return p((function t(){var n;return I(t,(function(t){switch(t.j){case 1:if(!(e.h&&e.a&&e.a.serverCertificate&&e.a.serverCertificate.length)){t.A(0);break}return x(t,3),T(t,e.h.setServerCertificate(e.a.serverCertificate),5);case 5:M(t,0);break;case 3:return n=j(t),t.return(Promise.reject(new me(2,6,6004,n.message)))}}))}))}function gt(e){var t=e.a?e.a.initData:[];return t.forEach((function(t){return St(e,t.initDataType,t.initData)})),e.s.forEach((function(t){return Tt(e,t)})),t.length||e.s.length||e.m.resolve(),e.m}function yt(e,t,n){for(var r=e.b.values(),i=(r=h(r)).next();!i.done;i=r.next())if(ht.ya(n,i.value.initData))return;St(e,t,n)}function _t(e){return e?e.keySystem:""}function bt(e,t){return!!nt("Edge/")||e.v.has(t)}function Et(e){return e=function(e,t){for(var n=[],r=h(e),i=r.next();!i.done;i=r.next())n.push(t(i.value));return n}(e=e.b.keys(),(function(e){return e.sessionId})),Array.from(e)}function wt(e,t){if(1==t.size&&t.has(""))return Promise.reject(new me(2,6,6e3));for(var n=h(t.values()),r=n.next();!r.done;r=n.next())0==(r=r.value).audioCapabilities.length&&delete r.audioCapabilities,0==r.videoCapabilities.length&&delete r.videoCapabilities;var i=n=new ve;return[!0,!1].forEach(function(e){var n=this;t.forEach((function(t,r){t.drmInfos.some((function(e){return!!e.licenseServerUri}))==e&&(i=i.catch(function(){if(!this.c)return navigator.requestMediaKeySystemAccess(r,[t])}.bind(n)))}))}.bind(e)),i=(i=i.catch((function(){return Promise.reject(new me(2,6,6001))}))).then(function(e){if(this.c)return Promise.reject();this.v.clear();var n=e.getConfiguration(),r=n.videoCapabilities||[],i=h(n.audioCapabilities||[]);for(n=i.next();!n.done;n=i.next())this.v.add(n.value.contentType);for(n=(r=h(r)).next();!n.done;n=r.next())this.v.add(n.value.contentType);r=e.keySystem,i=[];var o=[],a=[],s=[];return function(e,t,n,r,i){e.forEach((function(e){if(t.includes(e.licenseServerUri)||t.push(e.licenseServerUri),e.serverCertificate&&(n.some((function(t){return ht.ya(t,e.serverCertificate)}))||n.push(e.serverCertificate)),e.initData&&e.initData.forEach((function(e){r.some((function(t){return!(!t.keyId||t.keyId!=e.keyId)||t.initDataType==e.initDataType&&ht.ya(t.initData,e.initData)}))||r.push(e)})),e.keyIds)for(var o=0;o<e.keyIds.length;++o)i.includes(e.keyIds[o])||i.push(e.keyIds[o])}))}((n=t.get(e.keySystem)).drmInfos,i,o,a,s),this.a={keySystem:r,licenseServerUri:i[0],distinctiveIdentifierRequired:"required"==n.distinctiveIdentifier,persistentStateRequired:"required"==n.persistentState,audioRobustness:n.audioCapabilities?n.audioCapabilities[0].robustness:"",videoRobustness:n.videoCapabilities?n.videoCapabilities[0].robustness:"",serverCertificate:o[0],initData:a,keyIds:s},this.a.licenseServerUri?e.createMediaKeys():Promise.reject(new me(2,6,6012,this.a.keySystem))}.bind(e)).then(function(e){if(this.c)return Promise.reject();this.h=e,this.R=!0}.bind(e)).catch(function(e){if(!this.c)return this.a=null,this.v.clear(),e instanceof me?Promise.reject(e):Promise.reject(new me(2,6,6002,e.message))}.bind(e)),n.reject(),i}function Tt(e,t){try{var n=e.h.createSession("persistent-license")}catch(t){var r=new me(2,6,6005,t.message);return e.g(r),Promise.reject(r)}e.i.w(n,"message",e.Ud.bind(e)),e.i.w(n,"keystatuseschange",e.Sd.bind(e));var i={initData:null,loaded:!1,cd:1/0,xa:null};return e.b.set(n,i),n.load(t).then(function(e){return this.c?Promise.reject():e?(i.loaded=!0,Lt(this)&&this.m.resolve(),n):(this.b.delete(n),void this.g(new me(2,6,6013)))}.bind(e),function(e){this.c||(this.b.delete(n),this.g(new me(2,6,6005,e.message)))}.bind(e))}function St(e,t,n){try{var r=e.D?e.h.createSession("persistent-license"):e.h.createSession()}catch(t){return void e.g(new me(2,6,6005,t.message))}e.i.w(r,"message",e.Ud.bind(e)),e.i.w(r,"keystatuseschange",e.Sd.bind(e)),e.b.set(r,{initData:n,loaded:!1,cd:1/0,xa:null});try{n=e.f.initDataTransform(n,e.a)}catch(n){return t=n,n instanceof me||(t=new me(2,6,6016,n)),void e.g(t)}r.generateRequest(t,n.buffer).catch((function(t){if(!e.c){if(e.b.delete(r),t.errorCode&&t.errorCode.systemCode){var n=t.errorCode.systemCode;0>n&&(n+=Math.pow(2,32)),n="0x"+n.toString(16)}e.g(new me(2,6,6006,t.message,t,n))}}))}function xt(e,t){if(_t(t).startsWith("com.apple.fps")){var n=t.serverCertificate;e=Ke(e,qe(e),n)}return e}function At(e,t){var n=t.target,r=e.b.get(n),i=e.a.licenseServerUri,o=e.f.advanced[e.a.keySystem];"individualization-request"==t.messageType&&o&&o.individualizationServer&&(i=o.individualizationServer),(i=De([i],e.f.retryParameters)).body=t.message,i.method="POST",i.licenseRequestType=t.messageType,i.sessionId=n.sessionId,"com.microsoft.playready"!=e.a.keySystem&&"com.chromecast.playready"!=e.a.keySystem||function(e){var t=at(e.body,!0,!0);if(t.includes("PlayReadyKeyMessage")){for(var n=(t=(new DOMParser).parseFromString(t,"application/xml")).getElementsByTagName("HttpHeader"),r=0;r<n.length;++r)e.headers[n[r].querySelector("name").textContent]=n[r].querySelector("value").textContent;e.body=ht.Aa(t.querySelector("Challenge").textContent).buffer}else e.headers["Content-Type"]="text/xml; charset=utf-8"}(i),e.a.keySystem.startsWith("com.apple.fps")&&e.f.fairPlayTransform&&function(e){var t=new Uint8Array(e.body);t="spc="+ht.vc(t),e.headers["Content-Type"]="application/x-www-form-urlencoded",e.body=ut(t)}(i),e.C.tb.request(2,i).promise.then(function(e){return this.c?Promise.reject():(this.a.keySystem.startsWith("com.apple.fps")&&this.f.fairPlayTransform&&function(e){try{var t=ot(e.data)}catch(e){return}"<ckc>"===(t=t.trim()).substr(0,5)&&"</ckc>"===t.substr(-6)&&(t=t.slice(5,-6));try{t=JSON.parse(t).ckc}catch(e){}e.data=ht.Aa(t).buffer}(e),n.update(e.data).then(function(){var e=this;this.C.onEvent(new Se("drmsessionupdate")),r&&(r.xa&&r.xa.resolve(),new he((function(){r.loaded=!0,Lt(e)&&e.m.resolve()})).P(kt))}.bind(this)))}.bind(e),function(e){this.c||(e=new me(2,6,6007,e),this.g(e),r&&r.xa&&r.xa.reject(e))}.bind(e)).catch(function(e){this.c||(e=new me(2,6,6008,e.message),this.g(e),r&&r.xa&&r.xa.reject(e))}.bind(e))}function Mt(){var e=[{contentType:'video/mp4; codecs="avc1.42E01E"'},{contentType:'video/webm; codecs="vp8"'}],t=[{videoCapabilities:e,persistentState:"required",sessionTypes:["persistent-license"]},{videoCapabilities:e}],n=new Map;return e="org.w3.clearkey com.widevine.alpha com.microsoft.playready com.apple.fps.3_0 com.apple.fps.2_0 com.apple.fps.1_0 com.apple.fps com.adobe.primetime".split(" ").map((function(e){return function(e){return p((function r(){var i,o,a;return I(r,(function(r){switch(r.j){case 1:return x(r,2),T(r,navigator.requestMediaKeySystemAccess(e,t),4);case 4:return i=r.o,a=!!(o=i.getConfiguration().sessionTypes)&&o.includes("persistent-license"),nt("Tizen 3")&&(a=!1),n.set(e,{persistentState:a}),T(r,i.createMediaKeys(),5);case 5:M(r,0);break;case 2:j(r),n.set(e,null),S(r)}}))}))}(e)})),Promise.all(e).then((function(){return Je(n)}))}function jt(e,t){var n=t.audio,r=t.video;if(n&&n.encrypted&&!bt(e,Ze(n.mimeType,n.codecs))||r&&r.encrypted&&!bt(e,Ze(r.mimeType,r.codecs)))return!1;var i=_t(e.a);return 0==t.drmInfos.length||t.drmInfos.some((function(e){return e.keySystem==i}))}function Rt(e,t){if(!e.length)return t;if(!t.length)return e;for(var n=[],r=0;r<e.length;r++)for(var i=0;i<t.length;i++)if(e[r].keySystem==t[i].keySystem){var o=e[r];i=t[i];var a=[];a=(a=a.concat(o.initData||[])).concat(i.initData||[]);var s=[];s=(s=s.concat(o.keyIds)).concat(i.keyIds),n.push({keySystem:o.keySystem,licenseServerUri:o.licenseServerUri||i.licenseServerUri,distinctiveIdentifierRequired:o.distinctiveIdentifierRequired||i.distinctiveIdentifierRequired,persistentStateRequired:o.persistentStateRequired||i.persistentStateRequired,videoRobustness:o.videoRobustness||i.videoRobustness,audioRobustness:o.audioRobustness||i.audioRobustness,serverCertificate:o.serverCertificate||i.serverCertificate,initData:a,keyIds:s});break}return n}function Lt(e){return Ye(e=e.b.values(),(function(e){return e.loaded}))}function Ct(t,n,r){!t.keySystem||"org.w3.clearkey"==t.keySystem&&t.licenseServerUri||(n.size&&(n=n.get(t.keySystem)||"",t.licenseServerUri=n),t.keyIds||(t.keyIds=[]),(r=r.get(t.keySystem))&&(t.distinctiveIdentifierRequired||(t.distinctiveIdentifierRequired=r.distinctiveIdentifierRequired),t.persistentStateRequired||(t.persistentStateRequired=r.persistentStateRequired),t.videoRobustness||(t.videoRobustness=r.videoRobustness),t.audioRobustness||(t.audioRobustness=r.audioRobustness),t.serverCertificate||(t.serverCertificate=r.serverCertificate)),e.cast&&e.cast.__platform__&&"com.microsoft.playready"==t.keySystem&&(t.keySystem="com.chromecast.playready"))}G("shaka.util.Uint8ArrayUtils.toBase64",ht.vc),ht.Aa=function(t){t=e.atob(t.replace(/-/g,"+").replace(/_/g,"/"));for(var n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t.charCodeAt(r);return n},G("shaka.util.Uint8ArrayUtils.fromBase64",ht.Aa),ht.Mc=function(t){for(var n=new Uint8Array(t.length/2),r=0;r<t.length;r+=2)n[r/2]=e.parseInt(t.substr(r,2),16);return n},G("shaka.util.Uint8ArrayUtils.fromHex",ht.Mc),ht.wc=function(e){for(var t="",n=0;n<e.length;++n){var r=e[n].toString(16);1==r.length&&(r="0"+r),t+=r}return t},G("shaka.util.Uint8ArrayUtils.toHex",ht.wc),ht.ya=function(e,t){if(!e&&!t)return!0;if(!e||!t||e.length!=t.length)return!1;for(var n=0;n<e.length;++n)if(e[n]!=t[n])return!1;return!0},G("shaka.util.Uint8ArrayUtils.equal",ht.ya),ht.concat=function(e){for(var t=[],n=0;n<arguments.length;++n)t[n]=arguments[n];for(var r=n=0;r<t.length;++r)n+=t[r].length;n=new Uint8Array(n);for(var i=r=0;i<t.length;++i)n.set(t[i],r),r+=t[i].length;return n},G("shaka.util.Uint8ArrayUtils.concat",ht.concat),(r=ft.prototype).destroy=function(){var e=this;return p((function t(){return I(t,(function(t){switch(t.j){case 1:return e.c?T(t,e.$,0):(e.c=!0,T(t,function(e){return p((function t(){var n;return I(t,(function(t){switch(t.j){case 1:return e.i.release(),e.i=null,e.m.reject(),e.W.stop(),e.W=null,e.L.stop(),e.L=null,n=Array.from(e.b.keys()),e.b.clear(),T(t,Promise.all(n.map((function(e){return p((function t(){return I(t,(function(t){switch(t.j){case 1:return x(t,2),T(t,Promise.all([e.close(),e.closed]),4);case 4:M(t,0);break;case 2:j(t),S(t)}}))}))}))),2);case 2:if(!e.l){t.A(3);break}return x(t,4),T(t,e.l.setMediaKeys(null),6);case 6:M(t,5);break;case 4:j(t);case 5:e.l=null;case 3:e.a=null,e.v.clear(),e.h=null,e.s=[],e.f=null,e.g=null,e.C=null,S(t)}}))}))}(e),4));case 4:e.$.resolve(),t.A(0)}}))}))},r.configure=function(e){this.f=e},r.Gb=function(e){var t=this;if(!this.h)return this.i.da(e,"encrypted",(function(){t.g(new me(2,6,6010))})),Promise.resolve();this.l=e,this.i.da(this.l,"play",(function(){for(var e=0;e<t.F.length;e++)At(t,t.F[e]);t.na=!0,t.F=[]})),e=(e=this.l.setMediaKeys(this.h)).catch((function(e){return Promise.reject(new me(2,6,6003,e.message))}));var n=vt(this);return Promise.all([e,n]).then((function(){if(t.c)return Promise.reject();gt(t),t.a.initData.length||t.s.length||t.i.w(t.l,"encrypted",(function(e){return yt(t,e.initDataType,new Uint8Array(e.initData))}))})).catch((function(e){if(!t.c)return Promise.reject(e)}))},r.Jb=function(){for(var e=1/0,t=this.b.keys(),n=(t=h(t)).next();!n.done;n=t.next())n=n.value,isNaN(n.expiration)||(e=Math.min(e,n.expiration));return e},r.Ud=function(e){this.l&&this.f.delayLicenseRequestUntilPlayed&&this.l.paused&&!this.na?this.F.push(e):At(this,e)},r.Sd=function(e){e=e.target;var t=this.b.get(e),n=!1;e.keyStatuses.forEach(function(e,r){if("string"==typeof r){var i=r;r=e,e=i}if("com.microsoft.playready"==this.a.keySystem&&16==r.byteLength&&!nt("Tizen")){var o=(i=new DataView(r)).getUint32(0,!0),a=i.getUint16(4,!0),s=i.getUint16(6,!0);i.setUint32(0,o,!1),i.setUint16(4,a,!1),i.setUint16(6,s,!1)}"com.microsoft.playready"==this.a.keySystem&&"status-pending"==e&&(e="usable"),"status-pending"!=e&&(t.loaded=!0),"expired"==e&&(n=!0),i=ht.wc(new Uint8Array(r)),this.oa.set(i,e)}.bind(this));var r=e.expiration-Date.now();(0>r||n&&1e3>r)&&t&&!t.xa&&(this.b.delete(e),e.close().catch((function(){}))),Lt(this)&&(this.m.resolve(),this.L.P(Ot))};var kt=5,Ot=.5;function Pt(){this.a=new muxjs.mp4.CaptionParser,this.g=[],this.f={}}function It(){}function Dt(e){return!e||1==e.length&&1e-6>e.end(0)-e.start(0)?null:e.length?e.end(e.length-1):null}function Nt(e,t,n){return n=void 0===n?0:n,!(!e||!e.length||1==e.length&&1e-6>e.end(0)-e.start(0)||t>e.end(e.length-1))&&t+n>=e.start(0)}function Bt(e,t){if(!e||!e.length||1==e.length&&1e-6>e.end(0)-e.start(0))return 0;for(var n=0,r=e.length-1;0<=r&&e.end(r)>t;--r)n+=e.end(r)-Math.max(e.start(r),t);return n}function Ut(e){if(!e)return[];for(var t=[],n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t}Pt.prototype.init=function(e){var t=muxjs.mp4.probe;e=new Uint8Array(e),this.g=t.videoTrackIds(e),this.f=t.timescale(e),this.a.init()},Pt.prototype.b=function(e,t){var n=new Uint8Array(e);(n=this.a.parse(n,this.g,this.f))&&n.captions&&t(n.captions),this.a.clearParsedCaptions()},Pt.prototype.c=function(){this.a.resetCaptionStream()},It.prototype.init=function(){},It.prototype.b=function(){},It.prototype.c=function(){};var Ft={Ae:function(e,t){return e.reduce(function(e,t,n){return t.catch(e.bind(null,n))}.bind(null,t),Promise.reject())},Cc:function(e,t){return e.concat(t)},kc:function(){},Ia:function(e){return null!=e}};function Vt(e,t){if(0==t.length)return e;var n=t.map((function(e){return new $(e)}));return e.map((function(e){return new $(e)})).map((function(e){return n.map(e.resolve.bind(e))})).reduce(Ft.Cc,[]).map((function(e){return e.toString()}))}function Gt(e,t){return{keySystem:e,licenseServerUri:"",distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,initData:t||[],keyIds:[]}}var Ht={Pa:"video",Db:"audio",qa:"text",rg:"image",pg:"application"};function zt(){this.a=new muxjs.mp4.Transmuxer({keepOriginalTimestamps:!0}),this.b=null,this.g=[],this.c=[],this.f=!1,this.a.on("data",this.i.bind(this)),this.a.on("done",this.h.bind(this))}function Wt(t,n){return!(!e.muxjs||"mp2t"!=t.toLowerCase().split(";")[0].split("/")[1])&&(n?MediaSource.isTypeSupported(qt(n,t)):MediaSource.isTypeSupported(qt("audio",t))||MediaSource.isTypeSupported(qt("video",t)))}function qt(e,t){var n=t.replace(/mp2t/i,"mp4");"audio"==e&&(n=n.replace("video","audio"));var r=/avc1\.(66|77|100)\.(\d+)/.exec(n);if(r){var i="avc1.",o=r[1],a=Number(r[2]);i=("66"==o?i+"4200":"77"==o?i+"4d00":i+"6400")+(a>>4).toString(16),i+=(15&a).toString(16),n=n.replace(r[0],i)}return n}function Kt(e,t,n){this.startTime=e,this.direction=Qt,this.endTime=t,this.payload=n,this.region=new un,this.position=null,this.positionAlign=Yt,this.size=100,this.textAlign=Xt,this.writingMode=en,this.lineInterpretation=tn,this.line=null,this.lineHeight="",this.lineAlign=nn,this.displayAlign=Zt,this.fontSize=this.backgroundImage=this.backgroundColor=this.color="",this.fontWeight=on,this.fontStyle=an,this.fontFamily="",this.textDecoration=[],this.wrapLine=!0,this.id="",this.nestedCues=[],this.spacer=!1}zt.prototype.destroy=function(){return this.a.dispose(),this.a=null,Promise.resolve()},zt.prototype.i=function(e){this.c=e.captions;var t=new Uint8Array(e.data.byteLength+e.initSegment.byteLength);t.set(e.initSegment,0),t.set(e.data,e.initSegment.byteLength),this.g.push(t)},zt.prototype.h=function(){var e={data:ht.concat.apply(null,this.g),captions:this.c};this.b.resolve(e),this.f=!1},G("shaka.text.Cue",Kt);var Yt="auto";Kt.positionAlign={LEFT:"line-left",RIGHT:"line-right",CENTER:"center",AUTO:Yt};var Xt="center",Jt={LEFT:"left",RIGHT:"right",CENTER:Xt,START:"start",END:"end"};Kt.textAlign=Jt;var Zt="after",$t={BEFORE:"before",CENTER:"center",AFTER:Zt};Kt.displayAlign=$t;var Qt="ltr";Kt.direction={HORIZONTAL_LEFT_TO_RIGHT:Qt,HORIZONTAL_RIGHT_TO_LEFT:"rtl"};var en="horizontal-tb";Kt.writingMode={HORIZONTAL_TOP_TO_BOTTOM:en,VERTICAL_LEFT_TO_RIGHT:"vertical-lr",VERTICAL_RIGHT_TO_LEFT:"vertical-rl"};var tn=0;Kt.lineInterpretation={LINE_NUMBER:tn,PERCENTAGE:1};var nn="start",rn={CENTER:"center",START:nn,END:"end"};Kt.lineAlign=rn;var on=400;Kt.fontWeight={NORMAL:on,BOLD:700};var an="normal",sn={NORMAL:an,ITALIC:"italic",OBLIQUE:"oblique"};function un(){this.id="",this.regionAnchorY=this.regionAnchorX=this.viewportAnchorY=this.viewportAnchorX=0,this.height=this.width=100,this.viewportAnchorUnits=this.widthUnits=this.heightUnits=ln,this.scroll=cn}Kt.fontStyle=sn,Kt.textDecoration={UNDERLINE:"underline",LINE_THROUGH:"lineThrough",OVERLINE:"overline"},G("shaka.text.CueRegion",un);var ln=1;un.units={PX:0,PERCENTAGE:ln,LINES:2};var cn="";function dn(e){this.g=null,this.c=e,this.f=this.m=0,this.h=1/0,this.b=this.a=null,this.l="",this.i=new Map}un.scrollMode={NONE:cn,UP:"up"};var hn={};function fn(t){return!!(hn[t]||e.muxjs&&"application/cea-608"==t)}function pn(e,t){"application/cea-608"!=t&&(e.g=new hn[t])}function mn(e,t,n,r,i){for(var o=n+" "+r,a=new Map,s=(t=h(t)).next();!s.done;s=t.next()){var u=s.value;s=u.stream,a.has(s)||a.set(s,new Map),a.get(s).has(o)||a.get(s).set(o,[]),u.startTime+=i,u.endTime+=i,u.startTime>=e.f&&u.startTime<e.h&&(u=new Kt(u.startTime,u.endTime,u.text),a.get(s).get(o).push(u),s==e.l&&e.c.append([u]))}for(o=(i=h(a.keys())).next();!o.done;o=i.next())for(o=o.value,e.i.has(o)||e.i.set(o,new Map),s=(t=h(a.get(o).keys())).next();!s.done;s=t.next())s=s.value,u=a.get(o).get(s),e.i.get(o).set(s,u);e.a=null==e.a?Math.max(n,e.f):Math.min(e.a,Math.max(n,e.f)),e.b=Math.max(e.b,Math.min(r,e.h))}function vn(e,t,n){this.f=e,this.g=n,this.b={},this.a=null,this.c={},this.i=new He,this.v=!1,this.l={},this.m=t,e=this.s=new ve,t=new MediaSource,this.i.da(t,"sourceopen",e.resolve),this.f.src=gn(t),this.h=t}G("shaka.text.TextEngine.registerParser",(function(e,t){hn[e]=t})),G("shaka.text.TextEngine.unregisterParser",(function(e){delete hn[e]})),dn.prototype.destroy=function(){return this.c=this.g=null,this.i.clear(),Promise.resolve()},dn.prototype.Rc=function(e){try{return this.g.parseMedia(new Uint8Array(e),{periodStart:0,segmentStart:null,segmentEnd:0})[0].startTime}catch(e){throw new me(2,2,2009,e)}},dn.prototype.remove=function(e,t){return Promise.resolve().then(function(){!this.c||!this.c.remove(e,t)||null==this.a||t<=this.a||e>=this.b||(e<=this.a&&t>=this.b?this.a=this.b=null:e<=this.a&&t<this.b?this.a=t:e>this.a&&t>=this.b&&(this.b=e))}.bind(this))},dn.prototype.se=function(e){this.c.append(e)},dn.prototype.appendCues=dn.prototype.se,dn.prototype.tc=function(e,t){this.l=e;var n=this.i.get(e);if(n)for(var r=h(n.keys()),i=r.next();!i.done;i=r.next())(i=n.get(i.value).filter((function(e){return e.endTime<=t})))&&this.c.append(i)},dn.prototype.setSelectedClosedCaptionId=dn.prototype.tc;var gn=e.URL.createObjectURL;function yn(e){var t=Ze(e.mimeType,e.codecs),n=function(e){var t=[e.mimeType];return Qe.forEach((function(n,r){var i=e[r];i&&t.push(n+'="'+i+'"')})),t.join(";")}(e);return fn(t)||MediaSource.isTypeSupported(n)||Wt(t,e.type)}function _n(e,t){e.a||(e.a=new dn(e.g)),pn(e.a,t)}function bn(e){return!e.h||"ended"==e.h.readyState}function En(e,t){if("text"==t)var n=e.a.a;else n=!(n=Tn(e,t))||1==n.length&&1e-6>n.end(0)-n.start(0)?null:1==n.length&&0>n.start(0)?0:n.length?n.start(0):null;return n}function wn(e,t){return"text"==t?e.a.b:Dt(Tn(e,t))}function Tn(e,t){try{return e.b[t].buffered}catch(e){return null}}function Sn(t,n,r,i,o,a){return"text"==n?function(e,t,n,r){return Promise.resolve().then(function(){if(this.g&&this.c)if(null==n||null==r)this.g.parseInit(new Uint8Array(t));else{var e={periodStart:this.m,segmentStart:n,segmentEnd:r};e=this.g.parseMedia(new Uint8Array(t),e).filter(function(e){return e.startTime>=this.f&&e.startTime<this.h}.bind(this)),this.c.append(e),null==this.a&&(this.a=Math.max(n,this.f)),this.b=Math.min(r,this.h)}}.bind(e))}(t.a,r,i,o):t.l[n]?function(e,t){e.f=!0,e.b=new ve,e.g=[],e.c=[];var n=new Uint8Array(t);return e.a.push(n),e.a.flush(),e.f&&e.b.reject(new me(2,3,3018)),e.b}(t.l[n],r).then(function(e){return this.a||_n(this,"text/vtt"),e.captions&&e.captions.length&&mn(this.a,e.captions,i,o,this.b.video.timestampOffset),An(this,n,this.ge.bind(this,n,e.data.buffer))}.bind(t)):(a&&e.muxjs&&(t.a||_n(t,"text/vtt"),null==i&&null==o?t.m.init(r):t.m.b(r,(function(e){e.length&&mn(t.a,e,i,o,t.b.video.timestampOffset)}))),An(t,n,t.ge.bind(t,n,r)))}function xn(e,t){return"text"==t?e.a?(e.m.c(),e.a.remove(0,1/0)):Promise.resolve():An(e,t,e.he.bind(e,t,0,e.h.duration))}function An(e,t,n){if(e.v)return Promise.reject();if(n={start:n,p:new ve},e.c[t].push(n),1==e.c[t].length)try{n.start()}catch(r){"QuotaExceededError"==r.name?n.p.reject(new me(2,3,3017,t)):n.p.reject(new me(2,3,3015,r)),jn(e,t)}return n.p}function Mn(e,t){if(e.v)return Promise.reject();var n,r=[];for(n in e.b){var i=new ve,o={start:function(e){e.resolve()}.bind(null,i),p:i};e.c[n].push(o),r.push(i),1==e.c[n].length&&o.start()}return Promise.all(r).then(function(){try{t()}catch(t){var e=Promise.reject(new me(2,3,3015,t))}for(var n in this.b)jn(this,n);return e}.bind(e),function(e){throw e}.bind(e))}function jn(e,t){e.c[t].shift();var n=e.c[t][0];if(n)try{n.start()}catch(r){n.p.reject(new me(2,3,3015,r)),jn(e,t)}}function Rn(e,t){return e=Cn(e),t=Cn(t),e.split("-")[0]==t.split("-")[0]}function Ln(e,t){e=Cn(e),t=Cn(t);var n=e.split("-"),r=t.split("-");return n[0]==r[0]&&1==n.length&&2==r.length}function Cn(e){var t=e.split("-");return e=t[0]||"",t=t[1]||"",e=e.toLowerCase(),e=Pn.get(e)||e,(t=t.toUpperCase())?e+"-"+t:e}function kn(e){return e.language?Cn(e.language):e.audio&&e.audio.language?Cn(e.audio.language):e.video&&e.video.language?Cn(e.video.language):"und"}function On(e,t){for(var n=Cn(e),r=new Set,i=h(t),o=i.next();!o.done;o=i.next())r.add(Cn(o.value));for(o=(i=h(r)).next();!o.done;o=i.next())if((o=o.value)==n)return o;for(o=(i=h(r)).next();!o.done;o=i.next())if(Ln(o=o.value,n))return o;for(o=(i=h(r)).next();!o.done;o=i.next()){var a=o=o.value,s=n;if(a=Cn(a),s=Cn(s),a=a.split("-"),s=s.split("-"),2==a.length&&2==s.length&&a[0]==s[0])return o}for(o=(r=h(r)).next();!o.done;o=r.next())if(Ln(n,i=o.value))return i;return null}(r=vn.prototype).destroy=function(){var e=this;this.v=!0;var t,n=[];for(t in this.c){var r=this.c[t],i=r[0];for(this.c[t]=r.slice(0,1),i&&n.push(i.p.catch(Ft.kc)),i=1;i<r.length;++i)r[i].p.reject()}for(var o in this.a&&n.push(this.a.destroy()),this.g&&n.push(this.g.destroy()),this.l)n.push(this.l[o].destroy());return Promise.all(n).then((function(){e.i&&(e.i.release(),e.i=null),e.f&&(e.f.removeAttribute("src"),e.f.load(),e.f=null),e.h=null,e.a=null,e.g=null,e.b={},e.l={},e.m=null,e.c={}}))},r.init=function(e,t){var n=this;return p((function r(){var i;return I(r,(function(r){switch(r.j){case 1:return i=Ht,T(r,n.s,2);case 2:e.forEach((function(e,r){var o=Ze(e.mimeType,e.codecs);r==i.qa?_n(n,o):(!t&&MediaSource.isTypeSupported(o)||!Wt(o,r)||(n.l[r]=new zt,o=qt(r,o)),o=n.h.addSourceBuffer(o),n.i.w(o,"error",n.Yf.bind(n,r)),n.i.w(o,"updateend",n.wb.bind(n,r)),n.b[r]=o,n.c[r]=[])})),S(r)}}))}))},r.Oc=function(e){if(e.total=Ut(this.f.buffered),e.audio=Ut(Tn(this,"audio")),e.video=Ut(Tn(this,"video")),e.text=[],this.a){var t=this.a.a,n=this.a.b;null!=t&&null!=n&&e.text.push({start:t,end:n})}},r.tc=function(e){var t=wn(this,"video")||0;this.a.tc(e,t)},r.remove=function(e,t,n){return"text"==e?this.a.remove(t,n):An(this,e,this.he.bind(this,e,t,n))},r.flush=function(e){return"text"==e?Promise.resolve():An(this,e,this.Fe.bind(this,e))},r.endOfStream=function(e){return Mn(this,function(){bn(this)||(e?this.h.endOfStream(e):this.h.endOfStream())}.bind(this))},r.wa=function(e){return Mn(this,function(){this.h.duration=e}.bind(this))},r.Y=function(){return this.h.duration},r.ge=function(e,t){this.b[e].appendBuffer(t)},r.he=function(e,t,n){n<=t?this.wb(e):this.b[e].remove(t,n)},r.qe=function(e){var t=this.b[e].appendWindowStart,n=this.b[e].appendWindowEnd;this.b[e].abort(),this.b[e].appendWindowStart=t,this.b[e].appendWindowEnd=n,this.wb(e)},r.Fe=function(e){this.f.currentTime-=.001,this.wb(e)},r.Xf=function(e,t){0>t&&(t+=.001),this.b[e].timestampOffset=t,this.wb(e)},r.Uf=function(e,t,n){this.b[e].appendWindowStart=0,this.b[e].appendWindowEnd=n,this.b[e].appendWindowStart=t,this.wb(e)},r.Yf=function(e){this.c[e][0].p.reject(new me(2,3,3014,this.f.error?this.f.error.code:0))},r.wb=function(e){var t=this.c[e][0];t&&(t.p.resolve(),jn(this,e))};var Pn=new Map([["aar","aa"],["abk","ab"],["afr","af"],["aka","ak"],["alb","sq"],["amh","am"],["ara","ar"],["arg","an"],["arm","hy"],["asm","as"],["ava","av"],["ave","ae"],["aym","ay"],["aze","az"],["bak","ba"],["bam","bm"],["baq","eu"],["bel","be"],["ben","bn"],["bih","bh"],["bis","bi"],["bod","bo"],["bos","bs"],["bre","br"],["bul","bg"],["bur","my"],["cat","ca"],["ces","cs"],["cha","ch"],["che","ce"],["chi","zh"],["chu","cu"],["chv","cv"],["cor","kw"],["cos","co"],["cre","cr"],["cym","cy"],["cze","cs"],["dan","da"],["deu","de"],["div","dv"],["dut","nl"],["dzo","dz"],["ell","el"],["eng","en"],["epo","eo"],["est","et"],["eus","eu"],["ewe","ee"],["fao","fo"],["fas","fa"],["fij","fj"],["fin","fi"],["fra","fr"],["fre","fr"],["fry","fy"],["ful","ff"],["geo","ka"],["ger","de"],["gla","gd"],["gle","ga"],["glg","gl"],["glv","gv"],["gre","el"],["grn","gn"],["guj","gu"],["hat","ht"],["hau","ha"],["heb","he"],["her","hz"],["hin","hi"],["hmo","ho"],["hrv","hr"],["hun","hu"],["hye","hy"],["ibo","ig"],["ice","is"],["ido","io"],["iii","ii"],["iku","iu"],["ile","ie"],["ina","ia"],["ind","id"],["ipk","ik"],["isl","is"],["ita","it"],["jav","jv"],["jpn","ja"],["kal","kl"],["kan","kn"],["kas","ks"],["kat","ka"],["kau","kr"],["kaz","kk"],["khm","km"],["kik","ki"],["kin","rw"],["kir","ky"],["kom","kv"],["kon","kg"],["kor","ko"],["kua","kj"],["kur","ku"],["lao","lo"],["lat","la"],["lav","lv"],["lim","li"],["lin","ln"],["lit","lt"],["ltz","lb"],["lub","lu"],["lug","lg"],["mac","mk"],["mah","mh"],["mal","ml"],["mao","mi"],["mar","mr"],["may","ms"],["mkd","mk"],["mlg","mg"],["mlt","mt"],["mon","mn"],["mri","mi"],["msa","ms"],["mya","my"],["nau","na"],["nav","nv"],["nbl","nr"],["nde","nd"],["ndo","ng"],["nep","ne"],["nld","nl"],["nno","nn"],["nob","nb"],["nor","no"],["nya","ny"],["oci","oc"],["oji","oj"],["ori","or"],["orm","om"],["oss","os"],["pan","pa"],["per","fa"],["pli","pi"],["pol","pl"],["por","pt"],["pus","ps"],["que","qu"],["roh","rm"],["ron","ro"],["rum","ro"],["run","rn"],["rus","ru"],["sag","sg"],["san","sa"],["sin","si"],["slk","sk"],["slo","sk"],["slv","sl"],["sme","se"],["smo","sm"],["sna","sn"],["snd","sd"],["som","so"],["sot","st"],["spa","es"],["sqi","sq"],["srd","sc"],["srp","sr"],["ssw","ss"],["sun","su"],["swa","sw"],["swe","sv"],["tah","ty"],["tam","ta"],["tat","tt"],["tel","te"],["tgk","tg"],["tgl","tl"],["tha","th"],["tib","bo"],["tir","ti"],["ton","to"],["tsn","tn"],["tso","ts"],["tuk","tk"],["tur","tr"],["twi","tw"],["uig","ug"],["ukr","uk"],["urd","ur"],["uzb","uz"],["ven","ve"],["vie","vi"],["vol","vo"],["wel","cy"],["wln","wa"],["wol","wo"],["xho","xh"],["yid","yi"],["yor","yo"],["zha","za"],["zho","zh"],["zul","zu"]]);function In(e,t,n){function r(e,t,n){return e>=t&&e<=n}var i=e.video;return!(i&&i.width&&i.height&&!(r(i.width,t.minWidth,Math.min(t.maxWidth,n.width))&&r(i.height,t.minHeight,Math.min(t.maxHeight,n.height))&&r(i.width*i.height,t.minPixels,t.maxPixels))||!r(e.bandwidth,t.minBandwidth,t.maxBandwidth))}function Dn(e,t,n){var r=!1;return e.forEach((function(e){var i=e.allowedByApplication;e.allowedByApplication=In(e,t,n),i!=e.allowedByApplication&&(r=!0)})),r}function Nn(e,t,n,r){r.variants=r.variants.filter((function(r){if(e&&e.R&&!jt(e,r))return!1;var i=r.audio;return r=r.video,!(i&&!yn(i)||r&&!yn(r)||i&&t&&!Bn(i,t)||r&&n&&!Bn(r,n))})),r.textStreams=r.textStreams.filter((function(e){return fn(Ze(e.mimeType,e.codecs))}))}function Bn(e,t){return e.mimeType==t.mimeType&&e.codecs.split(".")[0]==t.codecs.split(".")[0]}function Un(e){var t=e.audio,n=e.video,r=t?t.codecs:null,i=n?n.codecs:null,o=[];i&&o.push(i),r&&o.push(r);var a=[];n&&a.push(n.mimeType),t&&a.push(t.mimeType),a=a[0]||null;var s=[];t&&s.push(t.kind),n&&s.push(n.kind),s=s[0]||null;var u=new Set;return t&&t.roles.forEach((function(e){return u.add(e)})),n&&n.roles.forEach((function(e){return u.add(e)})),e={id:e.id,active:!1,type:"variant",bandwidth:e.bandwidth,language:e.language,label:null,kind:s,width:null,height:null,frameRate:null,mimeType:a,codecs:o.join(", "),audioCodec:r,videoCodec:i,primary:e.primary,roles:Array.from(u),audioRoles:null,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null},n&&(e.videoId=n.id,e.originalVideoId=n.originalId,e.width=n.width||null,e.height=n.height||null,e.frameRate=n.frameRate||null,e.videoBandwidth=n.bandwidth||null),t&&(e.audioId=t.id,e.originalAudioId=t.originalId,e.channelsCount=t.channelsCount,e.audioSamplingRate=t.audioSamplingRate,e.audioBandwidth=t.bandwidth||null,e.label=t.label,e.audioRoles=t.roles),e}function Fn(e){return{id:e.id,active:!1,type:"text",bandwidth:0,language:e.language,label:e.label,kind:e.kind||null,width:null,height:null,frameRate:null,mimeType:e.mimeType,codecs:e.codecs||null,audioCodec:null,videoCodec:null,primary:e.primary,roles:e.roles,audioRoles:null,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:e.originalId}}function Vn(e){return e.__shaka_id||(e.__shaka_id=Gn++),e.__shaka_id}var Gn=0;function Hn(e){return{id:Vn(e),active:!1,type:"",bandwidth:0,language:Cn(e.language),label:e.label,kind:e.kind,width:null,height:null,frameRate:null,mimeType:null,codecs:null,audioCodec:null,videoCodec:null,primary:!1,roles:[],audioRoles:null,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null}}function zn(e){return e.allowedByApplication&&e.allowedByKeySystem}function Wn(e,t){for(var n=e.filter((function(e){return e.audio&&e.audio.channelsCount})),r=new Map,i=(n=h(n)).next();!i.done;i=n.next()){var o=(i=i.value).audio.channelsCount;r.has(o)||r.set(o,[]),r.get(o).push(i)}return 0==(n=Array.from(r.keys())).length?e:(i=n.filter((function(e){return e<=t}))).length?r.get(Math.max.apply(null,i)):r.get(Math.min.apply(null,n))}function qn(e,t,n){var r=e,i=e.filter((function(e){return e.primary}));i.length&&(r=i);var o=r.length?r[0].language:"";if(r=r.filter((function(e){return e.language==o})),t){var a=On(Cn(t),e.map((function(e){return e.language})));a&&(r=e.filter((function(e){return Cn(e.language)==a})))}if(n){if((e=Kn(r,n)).length)return e}else if((e=r.filter((function(e){return 0==e.roles.length}))).length)return e;return(e=r.map((function(e){return e.roles})).reduce(Ft.Cc,[])).length?Kn(r,e[0]):r}function Kn(e,t){return e.filter((function(e){return e.roles.includes(t)}))}function Yn(e,t,n){for(var r=0;r<n.length;r++)if(n[r].audio==e&&n[r].video==t)return n[r];return null}function Xn(){this.h=null,this.f=!1,this.b=new K,this.c=[],this.i=!1,this.a=this.g=null}function Jn(e,t){return e&&(t=t.filter((function(t){return In(t,e,{width:1/0,height:1/0})}))),t.sort((function(e,t){return e.bandwidth-t.bandwidth}))}function Zn(e,t){this.a=e,this.b=t}function $n(e,t){var n=new Zn(2,6),r=tr,i=r.a,o=n.b-i.b;(0<(n.a-i.a||o)?r.c:r.b)(r.a,n,e,t)}function Qn(e,t,n,r){X([n,"has been deprecated and will be removed in",t,". We are currently at version",e,". Additional information:",r].join(" "))}function er(e,t,n,r){Y([n,"has been deprecated and has been removed in",t,". We are now at version",e,". Additional information:",r].join(""))}G("shaka.abr.SimpleAbrManager",Xn),Xn.prototype.stop=function(){this.h=null,this.f=!1,this.c=[],this.g=null},Xn.prototype.stop=Xn.prototype.stop,Xn.prototype.init=function(e){this.h=e},Xn.prototype.init=Xn.prototype.init,Xn.prototype.chooseVariant=function(){var e=Jn(this.a.restrictions,this.c),t=this.b.getBandwidthEstimate(this.a.defaultBandwidthEstimate);this.c.length&&!e.length&&(e=[(e=Jn(null,this.c))[0]]);for(var n=e[0]||null,r=0;r<e.length;++r){var i=e[r],o=(e[r+1]||{bandwidth:1/0}).bandwidth/this.a.bandwidthUpgradeTarget;t>=i.bandwidth/this.a.bandwidthDowngradeTarget&&t<=o&&(n=i)}return this.g=Date.now(),n},Xn.prototype.chooseVariant=Xn.prototype.chooseVariant,Xn.prototype.enable=function(){this.f=!0},Xn.prototype.enable=Xn.prototype.enable,Xn.prototype.disable=function(){this.f=!1},Xn.prototype.disable=Xn.prototype.disable,Xn.prototype.segmentDownloaded=function(e,t){var n=this.b;if(!(16e3>t)){var r=8e3*t/e,i=e/1e3;n.a+=t,W(n.b,i,r),W(n.c,i,r)}if(null!=this.g&&this.f)e:{if(this.i){if(Date.now()-this.g<1e3*this.a.switchInterval)break e}else{if(!(128e3<=this.b.a))break e;this.i=!0}n=this.chooseVariant(),this.b.getBandwidthEstimate(this.a.defaultBandwidthEstimate),this.h(n)}},Xn.prototype.segmentDownloaded=Xn.prototype.segmentDownloaded,Xn.prototype.getBandwidthEstimate=function(){return this.b.getBandwidthEstimate(this.a.defaultBandwidthEstimate)},Xn.prototype.getBandwidthEstimate=Xn.prototype.getBandwidthEstimate,Xn.prototype.setVariants=function(e){this.c=e},Xn.prototype.setVariants=Xn.prototype.setVariants,Xn.prototype.configure=function(e){this.a=e},Xn.prototype.configure=Xn.prototype.configure,Zn.prototype.toString=function(){return"v"+this.a+"."+this.b};var tr=null,nr="ended play playing pause pausing ratechange seeked seeking timeupdate volumechange".split(" "),rr="buffered currentTime duration ended loop muted paused playbackRate seeking videoHeight videoWidth volume".split(" "),ir=["loop","playbackRate"],or=["pause","play"],ar="abrstatuschanged adaptation buffering emsg error loading streaming texttrackvisibility timelineregionadded timelineregionenter timelineregionexit trackschanged unloading variantchanged textchanged".split(" "),sr={getAssetUri:2,getAudioLanguages:2,getAudioLanguagesAndRoles:2,getBufferedInfo:2,getConfiguration:2,getExpiration:2,getPlaybackRate:2,getTextLanguages:2,getTextLanguagesAndRoles:2,getTextTracks:2,getStats:5,getVariantTracks:2,isAudioOnly:10,isBuffering:1,isInProgress:1,isLive:10,isTextTrackVisible:1,keySystem:10,seekRange:1,usingEmbeddedTextTrack:2,getLoadMode:10},ur={getPlayheadTimeAsDate:1,getPresentationStartTimeAsDate:20},lr=[["getConfiguration","configure"]],cr=[["isTextTrackVisible","setTextTrackVisibility"]],dr="addTextTrack cancelTrickPlay configure resetConfiguration retryStreaming selectAudioLanguage selectEmbeddedTextTrack selectTextLanguage selectTextTrack selectVariantTrack selectVariantsByLabel setTextTrackVisibility trickPlay".split(" "),hr=["attach","detach","load","unload"];function fr(e){return JSON.stringify(e,(function(e,t){if("function"!=typeof t){if(t instanceof Event||t instanceof Se){var n,r={};for(n in t){var i=t[n];i&&"object"==typeof i?"detail"==n&&(r[n]=i):n in Event||(r[n]=i)}return r}if(t instanceof TimeRanges)for(r={__type__:"TimeRanges",length:t.length,start:[],end:[]},n=0;n<t.length;++n)r.start.push(t.start(n)),r.end.push(t.end(n));else r=t instanceof Uint8Array?{__type__:"Uint8Array",entries:Array.from(t)}:"number"==typeof t?isNaN(t)?"NaN":isFinite(t)?t:0>t?"-Infinity":"Infinity":t;return r}}))}function pr(e){return JSON.parse(e,(function(e,t){return"NaN"==t?NaN:"-Infinity"==t?-1/0:"Infinity"==t?1/0:t&&"object"==typeof t&&"TimeRanges"==t.__type__?function(e){return{length:e.length,start:function(t){return e.start[t]},end:function(t){return e.end[t]}}}(t):t&&"object"==typeof t&&"Uint8Array"==t.__type__?new Uint8Array(t.entries):t}))}function mr(e,t,n,r,i,o){this.T=e,this.f=new he(t),this.R=n,this.l=!1,this.F=r,this.L=i,this.C=o,this.b=this.h=!1,this.D="",this.i=null,this.m=this.Qd.bind(this),this.s=this.pf.bind(this),this.a={video:{},player:{}},this.v=0,this.c={},this.g=null}var vr=!1,gr=null;function yr(e){var t=gr;t.removeUpdateListener(e.m),t.removeMessageListener("urn:x-cast:com.google.shaka.v2",e.s)}function _r(e){for(var t in e.c){var n=e.c[t];delete e.c[t],n.reject(new me(1,7,7e3))}}function br(e){e=fr(e),gr.sendMessage("urn:x-cast:com.google.shaka.v2",e,(function(){}),J)}function Er(e,t,n){var r=this;Ae.call(this),this.c=e,this.b=t,this.i=this.g=this.f=this.l=this.h=null,(this.m=n)&&(this.a=new mr(n,(function(){return Tr(r)}),(function(){return Sr(r)}),(function(e,t){return Ar(r,e,t)}),(function(){return xr(r)}),(function(){return wr(r)}))),function(e){for(var t in e.a&&e.a.init(),e.i=new He,nr.forEach(function(e){this.i.w(this.c,e,this.ng.bind(this))}.bind(e)),ar.forEach(function(e){this.i.w(this.b,e,this.Cf.bind(this))}.bind(e)),e.h={},e.c)Object.defineProperty(e.h,t,{configurable:!1,enumerable:!0,get:e.mg.bind(e,t),set:e.og.bind(e,t)});for(var n in e.l={},e.b)Object.defineProperty(e.l,n,{configurable:!1,enumerable:!0,get:e.Xd.bind(e,n)});e.f=new Ae,e.f.Yb=e.h,e.g=new Ae,e.g.Yb=e.l}(this)}function wr(e){var t={video:{},player:{},playerAfterLoad:{},manifest:e.b.ec(),startTime:null};return e.c.pause(),ir.forEach(function(e){t.video[e]=this.c[e]}.bind(e)),e.c.ended||(t.startTime=e.c.currentTime),lr.forEach(function(e){var n=e[1];e=this.b[e[0]](),t.player[n]=e}.bind(e)),cr.forEach(function(e){var n=e[1];e=this.b[e[0]](),t.playerAfterLoad[n]=e}.bind(e)),t}function Tr(e){e.dispatchEvent(new Se("caststatuschanged"))}function Sr(e){e.f.dispatchEvent(new Se(e.h.paused?"pause":"play"))}function xr(e){lr.forEach(function(e){var t=e[1];e=this.a.get("player",e[0])(),this.b[t](e)}.bind(e));var t=e.a.get("player","getAssetUri")(),n=e.a.get("video","ended"),r=Promise.resolve(),i=e.c.autoplay,o=null;n||(o=e.a.get("video","currentTime")),t&&(e.c.autoplay=!1,r=e.b.load(t,o));var a={};ir.forEach(function(e){a[e]=this.a.get("video",e)}.bind(e)),r.then((function(){e.c&&(ir.forEach(function(e){this.c[e]=a[e]}.bind(e)),cr.forEach(function(e){var t=e[1];e=this.a.get("player",e[0])(),this.b[t](e)}.bind(e)),e.c.autoplay=i,t&&e.c.play())}),(function(t){e.b.dispatchEvent(new Se("error",{detail:t}))}))}function Ar(e,t,n){e.a.ga()&&("video"==t?e.f.dispatchEvent(n):"player"==t&&e.g.dispatchEvent(n))}function Mr(e,t,n,r){var i=this;Ae.call(this),this.a=e,this.b=t,this.c=new He,this.D={video:e,player:t},this.s=n||function(){},this.F=r||function(e){return e},this.v=!1,this.h=!0,this.g=0,this.m=!1,this.l=!0,this.i=this.f=null,this.C=new he((function(){Rr(i)})),function(e){var t=cast.receiver.CastReceiverManager.getInstance();t.onSenderConnected=e.Td.bind(e),t.onSenderDisconnected=e.Td.bind(e),t.onSystemVolumeChanged=e.Ee.bind(e),e.i=t.getCastMessageBus("urn:x-cast:com.google.cast.media"),e.i.onMessage=e.jf.bind(e),e.f=t.getCastMessageBus("urn:x-cast:com.google.shaka.v2"),e.f.onMessage=e.vf.bind(e),t.start(),nr.forEach(function(e){this.c.w(this.a,e,this.Zd.bind(this,"video"))}.bind(e)),ar.forEach(function(e){this.c.w(this.b,e,this.Zd.bind(this,"player"))}.bind(e)),cast.__platform__&&cast.__platform__.canDisplayType('video/mp4; codecs="avc1.640028"; width=3840; height=2160')?e.b.qd(3840,2160):e.b.qd(1920,1080),e.c.w(e.a,"loadeddata",function(){this.m=!0}.bind(e)),e.c.w(e.b,"loading",function(){this.h=!1,jr(this)}.bind(e)),e.c.w(e.a,"playing",function(){this.h=!1,jr(this)}.bind(e)),e.c.w(e.a,"pause",function(){jr(this)}.bind(e)),e.c.w(e.b,"unloading",function(){this.h=!0,jr(this)}.bind(e)),e.c.w(e.a,"ended",function(){var e=this;new he((function(){e.a&&e.a.ended&&(e.h=!0,jr(e))})).P(5)}.bind(e))}(this)}function jr(e){Promise.resolve().then(function(){this.b&&(this.dispatchEvent(new Se("caststatuschanged")),Lr(this)||Or(this,0))}.bind(e))}function Rr(e){e.C.P(.5);var t={video:{},player:{}};if(rr.forEach(function(e){t.video[e]=this.a[e]}.bind(e)),e.b.V())for(var n in ur)0==e.g%ur[n]&&(t.player[n]=e.b[n]());for(var r in sr)0==e.g%sr[r]&&(t.player[r]=e.b[r]());(n=cast.receiver.CastReceiverManager.getInstance().getSystemVolume())&&(t.video.volume=n.level,t.video.muted=n.muted),e.m&&(e.g+=1),kr(e,{type:"update",update:t},e.f),Lr(e)}function Lr(e){return!(!e.l||!e.a.duration&&!e.b.V())&&(Cr(e),e.l=!1,!0)}function Cr(e){var t={contentId:e.b.ec(),streamType:e.b.V()?"LIVE":"BUFFERED",duration:e.a.duration,contentType:""};Or(e,0,t)}function kr(e,t,n,r){e.v&&(e=fr(t),r?n.getCastChannel(r).send(e):n.broadcast(e))}function Or(e,t,n){var r=e.a.playbackRate,i=Pr;r={mediaSessionId:0,playbackRate:r,playerState:i=e.h?i.IDLE:e.b.Tc()?i.le:e.a.paused?i.ne:i.oe,currentTime:e.a.currentTime,supportedMediaCommands:15,volume:{level:e.a.volume,muted:e.a.muted}},n&&(r.media=n),kr(e,{requestId:t,type:"MEDIA_STATUS",status:[r]},e.i)}(r=mr.prototype).destroy=function(){return _r(this),gr&&yr(this),this.f&&(this.f.stop(),this.f=null),this.L=this.F=null,this.b=this.h=!1,this.s=this.m=this.g=this.c=this.a=this.i=null,Promise.resolve()},r.ga=function(){return this.b},r.hd=function(){return this.D},r.init=function(){if(e.chrome&&chrome.cast&&chrome.cast.isAvailable){delete e.__onGCastApiAvailable,this.h=!0,this.f.uc();var t=new chrome.cast.SessionRequest(this.T);t=new chrome.cast.ApiConfig(t,this.Rd.bind(this),this.tf.bind(this),"origin_scoped"),chrome.cast.initialize(t,(function(){}),(function(){})),vr&&this.f.P(.02),(t=gr)&&t.status!=chrome.cast.SessionStatus.STOPPED?this.Rd(t):gr=null}else e.__onGCastApiAvailable=function(e){e&&this.init()}.bind(this)},r.pd=function(e){this.i=e,this.b&&br({type:"appData",appData:this.i})},r.cast=function(e){return this.h?vr?this.b?Promise.reject(new me(1,8,8002)):(this.g=new ve,chrome.cast.requestSession(this.ed.bind(this,e),this.Pd.bind(this)),this.g):Promise.reject(new me(1,8,8001)):Promise.reject(new me(1,8,8e3))},r.Ib=function(){this.b&&(_r(this),gr&&(yr(this),gr.stop((function(){}),(function(){})),gr=null))},r.get=function(e,t){if("video"==e){if(or.includes(t))return this.ae.bind(this,e,t)}else if("player"==e){if(ur[t]&&!this.get("player","isLive")())return function(){};if(dr.includes(t))return this.ae.bind(this,e,t);if(hr.includes(t))return this.If.bind(this,e,t);if(sr[t])return this.Yd.bind(this,e,t)}return this.Yd(e,t)},r.set=function(e,t,n){this.a[e][t]=n,br({type:"set",targetName:e,property:t,value:n})},r.ed=function(e,t){gr=t,t.addUpdateListener(this.m),t.addMessageListener("urn:x-cast:com.google.shaka.v2",this.s),this.Qd(),br({type:"init",initState:e,appData:this.i}),this.g.resolve()},r.Pd=function(e){var t=8003;switch(e.code){case"cancel":t=8004;break;case"timeout":t=8005;break;case"receiver_unavailable":t=8006}this.g.reject(new me(2,8,t,e))},r.Yd=function(e,t){return this.a[e][t]},r.ae=function(e,t,n){for(var r=[],i=2;i<arguments.length;++i)r[i-2]=arguments[i];br({type:"call",targetName:e,methodName:t,args:r})},r.If=function(e,t,n){for(var r=[],i=2;i<arguments.length;++i)r[i-2]=arguments[i];i=new ve;var o=this.v.toString();return this.v++,this.c[o]=i,br({type:"asyncCall",targetName:e,methodName:t,args:r,id:o}),i},r.Rd=function(e){var t=this.C();this.g=new ve,this.l=!0,this.ed(t,e)},r.tf=function(e){vr="available"==e,this.f.uc()},r.Qd=function(){var e=!!gr&&"connected"==gr.status;if(this.b&&!e){for(var t in this.L(),this.a)this.a[t]={};_r(this)}this.D=(this.b=e)?gr.receiver.friendlyName:"",this.f.uc()},r.pf=function(e,t){var n=pr(t);switch(n.type){case"event":var r=n.event;this.F(n.targetName,new Se(r.type,r));break;case"update":for(var i in r=n.update)for(var o in n=this.a[i]||{},r[i])n[o]=r[i][o];this.l&&(this.R(),this.l=!1);break;case"asyncComplete":if(i=n.id,n=n.error,o=this.c[i],delete this.c[i],o)if(n){for(r in i=new me(n.severity,n.category,n.code),n)i[r]=n[r];o.reject(i)}else o.resolve()}},H(Er,Ae),G("shaka.cast.CastProxy",Er),Er.prototype.destroy=function(e){return e&&this.a&&this.a.Ib(),this.i&&(this.i.release(),this.i=null),e=[],this.b&&(e.push(this.b.destroy()),this.b=null),this.a&&(e.push(this.a.destroy()),this.a=null),this.l=this.h=this.c=null,Promise.all(e)},Er.prototype.destroy=Er.prototype.destroy,Er.prototype.bf=function(){return this.h},Er.prototype.getVideo=Er.prototype.bf,Er.prototype.Ve=function(){return this.l},Er.prototype.getPlayer=Er.prototype.Ve,Er.prototype.ue=function(){return!!this.a&&(this.a.h&&vr)},Er.prototype.canCast=Er.prototype.ue,Er.prototype.ga=function(){return!!this.a&&this.a.ga()},Er.prototype.isCasting=Er.prototype.ga,Er.prototype.hd=function(){return this.a?this.a.hd():""},Er.prototype.receiverName=Er.prototype.hd,Er.prototype.cast=function(){if(!this.a)throw new me(1,8,8007);var e=wr(this);return this.a.cast(e).then(function(){if(this.b)return this.b.xd()}.bind(this))},Er.prototype.cast=Er.prototype.cast,Er.prototype.pd=function(e){this.a&&this.a.pd(e)},Er.prototype.setAppData=Er.prototype.pd,Er.prototype.eg=function(){if(this.a){var e=this.a;if(e.b){var t=e.C();chrome.cast.requestSession(e.ed.bind(e,t),e.Pd.bind(e))}}},Er.prototype.suggestDisconnect=Er.prototype.eg,Er.prototype.xe=function(e){var t=this;return p((function n(){return I(n,(function(n){switch(n.j){case 1:if(e==t.m)return n.return();if(t.m=e,!t.a){n.A(2);break}return t.a.Ib(),T(n,t.a.destroy(),3);case 3:t.a=null;case 2:t.a=new mr(e,(function(){return Tr(t)}),(function(){return Sr(t)}),(function(e,n){return Ar(t,e,n)}),(function(){return xr(t)}),(function(){return wr(t)})),t.a.init(),S(n)}}))}))},Er.prototype.changeReceiverId=Er.prototype.xe,Er.prototype.Ib=function(){this.a&&this.a.Ib()},Er.prototype.forceDisconnect=Er.prototype.Ib,(r=Er.prototype).mg=function(e){if("addEventListener"==e)return this.f.addEventListener.bind(this.f);if("removeEventListener"==e)return this.f.removeEventListener.bind(this.f);if(this.a&&this.a.ga()&&0==Object.keys(this.a.a.video).length){var t=this.c[e];if("function"!=typeof t)return t}return this.a&&this.a.ga()?this.a.get("video",e):("function"==typeof(e=this.c[e])&&(e=e.bind(this.c)),e)},r.og=function(e,t){this.a&&this.a.ga()?this.a.set("video",e,t):this.c[e]=t},r.ng=function(e){this.a&&this.a.ga()||this.f.dispatchEvent(new Se(e.type,e))},r.Xd=function(e){if("addEventListener"==e)return this.g.addEventListener.bind(this.g);if("removeEventListener"==e)return this.g.removeEventListener.bind(this.g);if("getMediaElement"==e)return function(){return this.h}.bind(this);if("getSharedConfiguration"==e)return this.a?this.a.get("player","getConfiguration"):this.b.getConfiguration();if("getNetworkingEngine"==e)return this.b.Kb.bind(this.b);if(this.a&&this.a.ga()){if("getManifest"==e||"drmInfo"==e)return function(){return X(e+"() does not work while casting!"),null};if("getManifestUri"==e)return $n("getManifestUri",'Please use "getAssetUri" instead.'),this.Xd("getAssetUri");if("attach"==e||"detach"==e)return function(){return X(e+"() does not work while casting!"),Promise.resolve()}}return this.a&&this.a.ga()&&0==Object.keys(this.a.a.video).length&&sr[e]||!this.a||!this.a.ga()?this.b[e].bind(this.b):this.a.get("player",e)},r.Cf=function(e){this.a&&this.a.ga()||this.g.dispatchEvent(e)},H(Mr,Ae),G("shaka.cast.CastReceiver",Mr),Mr.prototype.isConnected=function(){return this.v},Mr.prototype.isConnected=Mr.prototype.isConnected,Mr.prototype.ff=function(){return this.h},Mr.prototype.isIdle=Mr.prototype.ff,Mr.prototype.destroy=function(){var e=this;return p((function t(){var n;return I(t,(function(t){switch(t.j){case 1:return e.c&&(e.c.release(),e.c=null),n=[],e.b&&(n.push(e.b.destroy()),e.b=null),e.C&&(e.C.stop(),e.C=null),e.a=null,e.D=null,e.s=null,e.v=!1,e.h=!0,e.f=null,e.i=null,T(t,Promise.all(n),2);case 2:cast.receiver.CastReceiverManager.getInstance().stop(),S(t)}}))}))},Mr.prototype.destroy=Mr.prototype.destroy,(r=Mr.prototype).Td=function(){this.g=0,this.l=!0,this.v=0!=cast.receiver.CastReceiverManager.getInstance().getSenders().length,jr(this)},r.Zd=function(e,t){this.b&&(Rr(this),kr(this,{type:"event",targetName:e,event:t},this.f))},r.Ee=function(){var e=cast.receiver.CastReceiverManager.getInstance().getSystemVolume();e&&kr(this,{type:"update",update:{video:{volume:e.level,muted:e.muted}}},this.f),kr(this,{type:"event",targetName:"video",event:{type:"volumechange"}},this.f)},r.vf=function(e){var t=pr(e.data);switch(t.type){case"init":this.g=0,this.m=!1,this.l=!0,function(e,t,n){for(var r in t.player)e.b[r](t.player[r]);e.s(n),n=Promise.resolve();var i=e.a.autoplay;t.manifest&&(e.a.autoplay=!1,n=e.b.load(t.manifest,t.startTime)),n.then((function(){if(e.b){for(var n in t.video)e.a[n]=t.video[n];for(var r in t.playerAfterLoad)e.b[r](t.playerAfterLoad[r]);e.a.autoplay=i,t.manifest&&(e.a.play(),Or(e,0))}}),(function(t){e.b.dispatchEvent(new Se("error",{detail:t}))}))}(this,t.initState,t.appData),Rr(this);break;case"appData":this.s(t.appData);break;case"set":var n=t.targetName,r=t.property;if(t=t.value,"video"==n){var i=cast.receiver.CastReceiverManager.getInstance();if("volume"==r){i.setSystemVolumeLevel(t);break}if("muted"==r){i.setSystemVolumeMuted(t);break}}this.D[n][r]=t;break;case"call":(n=this.D[t.targetName])[t.methodName].apply(n,t.args);break;case"asyncCall":n=t.targetName,r=t.methodName,"player"==n&&"load"==r&&(this.g=0,this.m=!1),i=t.id,e=e.senderId;var o=this.D[n];t=o[r].apply(o,t.args),"player"==n&&"load"==r&&(t=t.then(function(){this.l=!0}.bind(this))),t.then(this.de.bind(this,e,i,null),this.de.bind(this,e,i))}},r.jf=function(e){var t=pr(e.data);switch(t.type){case"PLAY":this.a.play(),Or(this,0);break;case"PAUSE":this.a.pause(),Or(this,0);break;case"SEEK":e=t.currentTime;var n=t.resumeState;null!=e&&(this.a.currentTime=Number(e)),n&&"PLAYBACK_START"==n?(this.a.play(),Or(this,0)):n&&"PLAYBACK_PAUSE"==n&&(this.a.pause(),Or(this,0));break;case"STOP":this.b.xd().then(function(){this.b&&Or(this,0)}.bind(this));break;case"GET_STATUS":Or(this,Number(t.requestId));break;case"VOLUME":e=(n=t.volume).level,n=n.muted;var r=this.a.volume,i=this.a.muted;null!=e&&(this.a.volume=Number(e)),null!=n&&(this.a.muted=n),r==this.a.volume&&i==this.a.muted||Or(this,0);break;case"LOAD":this.g=0,this.l=this.m=!1,e=t.media,n=t.currentTime,r=this.F(e.contentId),i=t.autoplay||!0,this.s(e.customData),i&&(this.a.autoplay=!0),this.b.load(r,n).then(function(){this.b&&Cr(this)}.bind(this)).catch(function(e){var n="LOAD_FAILED";7==e.category&&7e3==e.code&&(n="LOAD_CANCELLED"),kr(this,{requestId:Number(t.requestId),type:n},this.i)}.bind(this));break;default:kr(this,{requestId:Number(t.requestId),type:"INVALID_REQUEST",reason:"INVALID_COMMAND"},this.i)}},r.de=function(e,t,n){this.b&&kr(this,{type:"asyncComplete",id:t,error:n},this.f,e)};var Pr={IDLE:"IDLE",oe:"PLAYING",le:"BUFFERING",ne:"PAUSED"};function Ir(e,t){this.J=e,this.b=t==Dr,this.a=0}G("shaka.util.DataViewReader",Ir);var Dr=1;function Nr(){throw new me(2,3,3e3)}function Br(){this.c=[],this.b=[],this.a=!1}function Ur(e){for(var t=null!=e.flags?12:8;e.reader.ta()&&!e.parser.a;)e.parser.oc(e.start+t,e.reader,e.partialOkay)}function Fr(e){for(var t=null!=e.flags?12:8,n=e.reader.G();0<n&&!e.parser.a;--n)e.parser.oc(e.start+t,e.reader,e.partialOkay)}function Vr(e){return function(t){e(t.reader.Za(t.reader.J.byteLength-t.reader.ca()))}}function Gr(e){for(var t=0,n=0;n<e.length;n++)t=t<<8|e.charCodeAt(n);return t}function Hr(e){return String.fromCharCode(e>>24&255,e>>16&255,e>>8&255,255&e)}function zr(e){var t=this;this.b=[],this.a=[],this.data=[],(new Br).H("moov",Ur).fa("pssh",(function(e){if(!(1<e.version)){var n=e.reader.J;if(n=new Uint8Array(n.buffer,n.byteOffset-12,e.size),t.data.push(n),t.b.push(ht.wc(e.reader.Za(16))),0<e.version){n=e.reader.G();for(var r=0;r<n;++r){var i=ht.wc(e.reader.Za(16));t.a.push(i)}}}})).parse(e)}Ir.Endianness={qg:0,sg:Dr},Ir.prototype.ta=function(){return this.a<this.J.byteLength},Ir.prototype.hasMoreData=Ir.prototype.ta,Ir.prototype.ca=function(){return this.a},Ir.prototype.getPosition=Ir.prototype.ca,Ir.prototype.Le=function(){return this.J.byteLength},Ir.prototype.getLength=Ir.prototype.Le,Ir.prototype.la=function(){try{var e=this.J.getUint8(this.a);return this.a+=1,e}catch(e){Nr()}},Ir.prototype.readUint8=Ir.prototype.la,Ir.prototype.Rb=function(){try{var e=this.J.getUint16(this.a,this.b);return this.a+=2,e}catch(e){Nr()}},Ir.prototype.readUint16=Ir.prototype.Rb,Ir.prototype.G=function(){try{var e=this.J.getUint32(this.a,this.b);return this.a+=4,e}catch(e){Nr()}},Ir.prototype.readUint32=Ir.prototype.G,Ir.prototype.$d=function(){try{var e=this.J.getInt32(this.a,this.b);return this.a+=4,e}catch(e){Nr()}},Ir.prototype.readInt32=Ir.prototype.$d,Ir.prototype.Ab=function(){try{if(this.b)var e=this.J.getUint32(this.a,!0),t=this.J.getUint32(this.a+4,!0);else t=this.J.getUint32(this.a,!1),e=this.J.getUint32(this.a+4,!1)}catch(e){Nr()}if(2097151<t)throw new me(2,3,3001);return this.a+=8,t*Math.pow(2,32)+e},Ir.prototype.readUint64=Ir.prototype.Ab,Ir.prototype.Za=function(e){this.a+e>this.J.byteLength&&Nr();var t=new Uint8Array(this.J.buffer,this.J.byteOffset+this.a,e);return this.a+=e,t},Ir.prototype.readBytes=Ir.prototype.Za,Ir.prototype.M=function(e){this.a+e>this.J.byteLength&&Nr(),this.a+=e},Ir.prototype.skip=Ir.prototype.M,Ir.prototype.be=function(e){this.a<e&&Nr(),this.a-=e},Ir.prototype.rewind=Ir.prototype.be,Ir.prototype.seek=function(e){(0>e||e>this.J.byteLength)&&Nr(),this.a=e},Ir.prototype.seek=Ir.prototype.seek,Ir.prototype.gd=function(){for(var e=this.a;this.ta()&&0!=this.J.getUint8(this.a);)this.a+=1;return e=new Uint8Array(this.J.buffer,this.J.byteOffset+e,this.a-e),this.a+=1,ot(e)},Ir.prototype.readTerminatedString=Ir.prototype.gd,G("shaka.util.Mp4Parser",Br),Br.prototype.H=function(e,t){var n=Gr(e);return this.c[n]=0,this.b[n]=t,this},Br.prototype.box=Br.prototype.H,Br.prototype.fa=function(e,t){var n=Gr(e);return this.c[n]=1,this.b[n]=t,this},Br.prototype.fullBox=Br.prototype.fa,Br.prototype.stop=function(){this.a=!0},Br.prototype.stop=Br.prototype.stop,Br.prototype.parse=function(e,t){var n=new Uint8Array(e);for(n=new Ir(new DataView(n.buffer,n.byteOffset,n.byteLength),0),this.a=!1;n.ta()&&!this.a;)this.oc(0,n,t)},Br.prototype.parse=Br.prototype.parse,Br.prototype.oc=function(e,t,n){var r=t.ca(),i=t.G(),o=t.G();switch(i){case 0:i=t.J.byteLength-r;break;case 1:i=t.Ab()}var a=this.b[o];if(a){var s=null,u=null;1==this.c[o]&&(s=(u=t.G())>>>24,u&=16777215),o=r+i,n&&o>t.J.byteLength&&(o=t.J.byteLength),o-=t.ca(),t=0<o?t.Za(o):new Uint8Array(0),a({parser:this,partialOkay:n||!1,version:s,flags:u,reader:t=new Ir(new DataView(t.buffer,t.byteOffset,t.byteLength),0),size:i,start:r+e})}else t.M(Math.min(r+i-t.ca(),t.J.byteLength-t.ca()))},Br.prototype.parseNext=Br.prototype.oc,Br.children=Ur,Br.sampleDescription=Fr,Br.allData=Vr,Br.typeToString=Hr,(new Map).set("org.w3.clearkey","1077efecc0b24d02ace33c1e52e2fb4b").set("com.widevine.alpha","edef8ba979d64acea3c827dcd51d21ed").set("com.microsoft.playready","9a04f07998404286ab92e65be0885f95").set("com.adobe.primetime","f239e769efa348509c16a903c6932efb");var Wr={dc:function(e,t){var n=Wr.O(e,t);return 1!=n.length?null:n[0]},Kc:function(e,t,n){return 1!=(e=Wr.Dd(e,t,n)).length?null:e[0]},O:function(e,t){return Array.prototype.filter.call(e.childNodes,(function(e){return e instanceof Element&&e.tagName==t}))},Dd:function(e,t,n){return Array.prototype.filter.call(e.childNodes,(function(e){return e instanceof Element&&e.localName==n&&e.namespaceURI==t}))},getAttributeNS:function(e,t,n){return e.hasAttributeNS(t,n)?e.getAttributeNS(t,n):null},fc:function(e){return Array.prototype.every.call(e.childNodes,(function(e){return e.nodeType==Node.TEXT_NODE||e.nodeType==Node.CDATA_SECTION_NODE}))?e.textContent.trim():null},I:function(e,t,n,r){r=void 0===r?null:r;var i=null;return null!=(e=e.getAttribute(t))&&(i=n(e)),null==i?r:i},zf:function(e){return e?(/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(e)&&(e+="Z"),e=Date.parse(e),isNaN(e)?null:Math.floor(e/1e3)):null},Da:function(e){return e&&(e=/^P(?:([0-9]*)Y)?(?:([0-9]*)M)?(?:([0-9]*)D)?(?:T(?:([0-9]*)H)?(?:([0-9]*)M)?(?:([0-9.]*)S)?)?$/.exec(e))?(e=31536e3*Number(e[1]||null)+2592e3*Number(e[2]||null)+86400*Number(e[3]||null)+3600*Number(e[4]||null)+60*Number(e[5]||null)+Number(e[6]||null),isFinite(e)?e:null):null},qc:function(e){var t=/([0-9]+)-([0-9]+)/.exec(e);return t?(e=Number(t[1]),isFinite(e)?(t=Number(t[2]),isFinite(t)?{start:e,end:t}:null):null):null},parseInt:function(e){return 0==(e=Number(e))%1?e:null},pc:function(e){return 0==(e=Number(e))%1&&0<e?e:null},xb:function(e){return 0==(e=Number(e))%1&&0<=e?e:null},parseFloat:function(e){return e=Number(e),isNaN(e)?null:e},Ce:function(e){var t;return e=(t=e.match(/^(\d+)\/(\d+)$/))?Number(t[1])/Number(t[2]):Number(e),isNaN(e)?null:e},Wd:function(e,t){var n=new DOMParser;try{var r=n.parseFromString(e,"text/xml")}catch(e){}if(r&&r.documentElement.tagName==t)var i=r.documentElement;return i&&0<i.getElementsByTagName("parsererror").length?null:i},Vd:function(e,t){try{var n=ot(e);return Wr.Wd(n,t)}catch(e){}}},qr=(new Map).set("urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b","org.w3.clearkey").set("urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine.alpha").set("urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95","com.microsoft.playready").set("urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb","com.adobe.primetime");function Kr(e,t,n){var r=function(e){for(var t=[],n=(e=h(e)).next();!n.done;n=e.next())(n=Jr(n.value))&&t.push(n);return t}(e),i=null;e=[];var o=[],a=new Set(r.map((function(e){return e.keyId})));if(a.delete(null),1<a.size)throw new me(2,4,4010);if(n||(o=r.filter((function(e){return"urn:mpeg:dash:mp4protection:2011"!=e.ce||(i=e.init||i,!1)}))).length&&(0==(e=function(e,t,n){for(var r=[],i=(n=h(n)).next();!i.done;i=n.next()){i=i.value;var o=qr.get(i.ce);if(o){var a;if(a=Wr.Kc(i.node,"urn:microsoft:playready","pro")){a=ht.Aa(a.textContent);var s=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),u=a.length,l=s.length+16+u,c=new ArrayBuffer(l),d=new Uint8Array(c);c=new DataView(c);var f=0;c.setUint32(f,l),f+=4,c.setUint32(f,1886614376),f+=4,c.setUint32(f,0),f+=4,d.set(s,f),f+=s.length,c.setUint32(f,u),f+=4,d.set(a,f),a=[{initData:d,initDataType:"cenc",keyId:i.keyId}]}else a=null;a=Gt(o,i.init||e||a),(o=Xr.get(o))&&(a.licenseServerUri=o(i)),r.push(a)}else for(i=h(i=t(i.node)||[]),o=i.next();!o.done;o=i.next())r.push(o.value)}return r}(i,t,o)).length&&(e=[Gt("",i)])),r.length&&(n||!o.length))for(e=[],n=(t=h(qr.values())).next();!n.done;n=t.next())"org.w3.clearkey"!=(n=n.value)&&e.push(Gt(n,i));if(a=Array.from(a)[0]||null)for(n=(t=h(e)).next();!n.done;n=t.next())for(r=(n=h(n.value.initData)).next();!r.done;r=n.next())r.value.keyId=a;return{Bd:a,ug:i,drmInfos:e,Ed:!0}}var Yr,Xr=(new Map).set("com.widevine.alpha",(function(e){return(e=Wr.Kc(e.node,"urn:microsoft","laurl"))&&e.getAttribute("licenseUrl")||""})).set("com.microsoft.playready",(function(e){return(e=Wr.Kc(e.node,"urn:microsoft:playready","pro"))&&(e=function(e){var t=0,n=new DataView(e).getUint32(t,!0);if(n!==e.byteLength)return[];t+=6,n=[];for(var r=new DataView(e);t<e.byteLength-1;){var i=r.getUint16(t,!0);t+=2;var o=r.getUint16(t,!0);t+=2;var a=new Uint8Array(e,t,o);n.push({type:i,value:a}),t+=o}return n}((e=ht.Aa(e.textContent)).buffer).filter((function(e){return 1===e.type}))[0])?(e=at(e.value,!0),(e=Wr.Wd(e,"WRMHEADER"))?function(e){return(e=e.querySelector("DATA > LA_URL"))?e.textContent:""}(e):""):""}));function Jr(e){var t=e.getAttribute("schemeIdUri"),n=Wr.getAttributeNS(e,"urn:mpeg:cenc:2013","default_KID"),r=Wr.Dd(e,"urn:mpeg:cenc:2013","pssh").map(Wr.fc);if(!t)return null;if(t=t.toLowerCase(),n&&(n=n.replace(/-/g,"").toLowerCase()).includes(" "))throw new me(2,4,4009);var i=[];try{i=r.map((function(e){return{initDataType:"cenc",initData:ht.Aa(e),keyId:null}}))}catch(e){throw new me(2,4,4007)}return{node:e,ce:t,keyId:n,init:0<i.length?i:null}}function Zr(t,n,r,i,o){var a={RepresentationID:n,Number:r,Bandwidth:i,Time:o};return t.replace(/\$(RepresentationID|Number|Bandwidth|Time)?(?:%0([0-9]+)([diouxX]))?\$/g,(function(t,n,r,i){if("$$"==t)return"$";var o=a[n];if(null==o)return t;switch("RepresentationID"==n&&r&&(r=void 0),"Time"==n&&(o=Math.round(o)),i){case void 0:case"d":case"i":case"u":t=o.toString();break;case"o":t=o.toString(8);break;case"x":t=o.toString(16);break;case"X":t=o.toString(16).toUpperCase();break;default:t=o.toString()}return r=e.parseInt(r,10)||1,Array(Math.max(0,r-t.length)+1).join("0")+t}))}function $r(e,t){var n=Qr(e,t,"timescale"),r=1;n&&(r=Wr.pc(n)||1),n=Qr(e,t,"duration"),(n=Wr.pc(n||""))&&(n/=r);var i=Qr(e,t,"startNumber"),o=Number(Qr(e,t,"presentationTimeOffset"))||0,a=Wr.xb(i||"");null!=i&&null!=a||(a=1);var s=ei(e,t,"SegmentTimeline");if(i=null,s){i=r;var u=e.S.duration||1/0;s=Wr.O(s,"S");for(var l=[],c=0,d=0;d<s.length;++d){var h=s[d],f=Wr.I(h,"t",Wr.xb),p=Wr.I(h,"d",Wr.xb);if(h=Wr.I(h,"r",Wr.parseInt),null!=f&&(f-=o),!p)break;if(f=null!=f?f:c,0>(h=h||0))if(d+1<s.length){if(null==(h=Wr.I(s[d+1],"t",Wr.xb)))break;if(f>=h)break;h=Math.ceil((h-f)/p)-1}else{if(1/0==u)break;if(f/i>=u)break;h=Math.ceil((u*i-f)/p)-1}0<l.length&&f!=c&&(l[l.length-1].end=f/i);for(var m=0;m<=h;++m)c=f+p,l.push({start:f/i,end:c/i,jg:f}),f=c}i=l}return{timescale:r,Z:n,ab:a,ma:o/r||0,yd:o,N:i}}function Qr(e,t,n){return[t(e.B),t(e.aa),t(e.ka)].filter(Ft.Ia).map((function(e){return e.getAttribute(n)})).reduce((function(e,t){return e||t}))}function ei(e,t,n){return[t(e.B),t(e.aa),t(e.ka)].filter(Ft.Ia).map((function(e){return Wr.dc(e,n)})).reduce((function(e,t){return e||t}))}function ti(e,t,n,r,i,o){if(o=void 0===o?0:o,Wr.getAttributeNS(e,"http://www.w3.org/1999/xlink","href")){var a=function(e,t,n,r,i,o){for(var a=Wr.getAttributeNS(e,"http://www.w3.org/1999/xlink","href"),s=Wr.getAttributeNS(e,"http://www.w3.org/1999/xlink","actuate")||"onRequest",u=0;u<e.attributes.length;u++){var l=e.attributes[u];"http://www.w3.org/1999/xlink"==l.namespaceURI&&(e.removeAttributeNS(l.namespaceURI,l.localName),--u)}if(5<=o)return ye(new me(2,4,4028));if("onLoad"!=s)return ye(new me(2,4,4027));var c=Vt([r],[a]);return i.request(0,De(c,t)).U((function(r){if(!(r=Wr.Vd(r.data,e.tagName)))return ye(new me(2,4,4001,a));for(;e.childNodes.length;)e.removeChild(e.childNodes[0]);for(;r.childNodes.length;){var s=r.childNodes[0];r.removeChild(s),e.appendChild(s)}for(s=0;s<r.attributes.length;s++){var u=r.attributes[s].nodeName,l=r.getAttribute(u);e.setAttribute(u,l)}return ti(e,t,n,c[0],i,o+1)}))}(e,t,n,r,i,o);return n&&(a=a.U(void 0,(function(){return ti(e,t,n,r,i,o)}))),a}a=[];for(var s=0;s<e.childNodes.length;s++){var u=e.childNodes[s];u instanceof Element&&("urn:mpeg:dash:resolve-to-zero:2013"==Wr.getAttributeNS(u,"http://www.w3.org/1999/xlink","href")?(e.removeChild(u),--s):"SegmentTimeline"!=u.tagName&&a.push(ti(u,t,n,r,i,o)))}return we(a).U((function(){return e}))}function ni(e,t,n){this.c=e,this.b=t,this.a=n}function ri(e,t,n,r,i,o){this.position=e,this.startTime=t,this.endTime=n,this.c=r,this.b=i,this.a=o}function ii(e,t,n,r){var i,o=(new Br).fa("sidx",(function(e){i=function(e,t,n,r){var i=[];r.reader.M(4);var o=r.reader.G();if(0==o)throw new me(2,3,3005);if(0==r.version)var a=r.reader.G(),s=r.reader.G();else a=r.reader.Ab(),s=r.reader.Ab();r.reader.M(2);var u=r.reader.Rb();for(e=e+r.size+s,s=0;s<u;s++){var l=r.reader.G(),c=(2147483648&l)>>>31;l&=2147483647;var d=r.reader.G();if(r.reader.M(4),1==c)throw new me(2,3,3006);i.push(new ri(i.length,a/o-t,(a+d)/o-t,(function(){return n}),e,e+l-1)),a+=d,e+=l}return r.parser.stop(),i}(t,r,n,e)}));if(e&&o.parse(e),i)return i;throw new me(2,3,3004)}function oi(e){this.a=e}function ai(e,t){for(;e.a.length&&e.a[e.a.length-1].startTime>=t;)e.a.pop();for(;e.a.length&&0>=e.a[0].endTime;)e.a.shift();if(0!=e.a.length){var n=e.a[e.a.length-1];e.a[e.a.length-1]=new ri(n.position,n.startTime,t,n.c,n.b,n.a)}}function si(e){this.b=e,this.a=new Ir(e,0),Yr||(Yr=[new Uint8Array([255]),new Uint8Array([127,255]),new Uint8Array([63,255,255]),new Uint8Array([31,255,255,255]),new Uint8Array([15,255,255,255,255]),new Uint8Array([7,255,255,255,255,255]),new Uint8Array([3,255,255,255,255,255,255]),new Uint8Array([1,255,255,255,255,255,255,255])])}function ui(e){var t=li(e);if(7<t.length)throw new me(2,3,3002);for(var n=0,r=0;r<t.length;r++)n=256*n+t[r];t=n,n=li(e);e:{r=ht.ya;for(var i=0;i<Yr.length;i++)if(r(n,Yr[i])){r=!0;break e}r=!1}if(r)n=e.b.byteLength-e.a.ca();else{if(8==n.length&&224&n[1])throw new me(2,3,3001);for(r=n[0]&(1<<8-n.length)-1,i=1;i<n.length;i++)r=256*r+n[i];n=r}return n=e.a.ca()+n<=e.b.byteLength?n:e.b.byteLength-e.a.ca(),r=new DataView(e.b.buffer,e.b.byteOffset+e.a.ca(),n),e.a.M(n),new ci(t,r)}function li(e){var t,n=e.a.la();for(t=1;8>=t&&!(n&1<<8-t);t++);if(8<t)throw new me(2,3,3002);var r=new Uint8Array(t);for(r[0]=n,n=1;n<t;n++)r[n]=e.a.la();return r}function ci(e,t){this.id=e,this.a=t}function di(e){if(8<e.a.byteLength)throw new me(2,3,3002);if(8==e.a.byteLength&&224&e.a.getUint8(0))throw new me(2,3,3001);for(var t=0,n=0;n<e.a.byteLength;n++){t=256*t+e.a.getUint8(n)}return t}function hi(){}function fi(e){var t=new si(e.a);if(179!=(e=ui(t)).id)throw new me(2,3,3013);if(e=di(e),183!=(t=ui(t)).id)throw new me(2,3,3012);t=new si(t.a);for(var n=0;t.ta();){var r=ui(t);if(241==r.id){n=di(r);break}}return{kg:e,Hf:n}}function pi(e,t){var n=ei(e,t,"Initialization");if(!n)return null;var r=e.B.pa,i=n.getAttribute("sourceURL");i&&(r=Vt(e.B.pa,[i])),i=0;var o=null;return(n=Wr.I(n,"range",Wr.qc))&&(i=n.start,o=n.end),new ni((function(){return r}),i,o)}function mi(e,t,n,r,i,o,a,s){var u=e.presentationTimeline,l=!e.mb||!e.S.Vc,c=e.S.start,d=e.S.duration,h=t,f=null;return{createSegmentIndex:function(){var e=[h(r,i,o),"webm"==a?h(n.c(),n.b,n.a):null];return h=null,Promise.all(e).then((function(e){var t=e[0];e=e[1]||null,t="mp4"==a?ii(t,i,r,s):(new hi).parse(t,e,r,s),u.ub(t,c),f=new oi(t),l&&ai(f,d)}))},findSegmentPosition:function(e){return f.find(e)},getSegmentReference:function(e){return f.get(e)}}}function vi(e){return e.Sb}function gi(e,t){var n=pi(e,yi),r=function(e){return[e.B.La,e.aa.La,e.ka.La].filter(Ft.Ia).map((function(e){return Wr.O(e,"SegmentURL")})).reduce((function(e,t){return 0<e.length?e:t})).map((function(t){return t.getAttribute("indexRange")&&!e.Id&&(e.Id=!0),{gf:t.getAttribute("media"),start:(t=Wr.I(t,"mediaRange",Wr.qc,{start:0,end:null})).start,end:t.end}}))}(e),i=$r(e,yi),o=i.ab;0==o&&(o=1);var a=0;if(i.Z?a=i.Z*(o-1):i.N&&0<i.N.length&&(a=i.N[0].start),!(r={Z:i.Z,startTime:a,ab:o,ma:i.ma,N:i.N,sb:r}).Z&&!r.N&&1<r.sb.length)throw new me(2,4,4002);if(!r.Z&&!e.S.duration&&!r.N&&1==r.sb.length)throw new me(2,4,4002);if(r.N&&0==r.N.length)throw new me(2,4,4002);return o=i=null,e.ka.id&&e.B.id&&(i=t[o=e.ka.id+","+e.B.id]),a=function(e,t,n,r){var i=r.sb.length;r.N&&r.N.length!=r.sb.length&&(i=Math.min(r.N.length,r.sb.length));for(var o=[],a=r.startTime,s=0;s<i;s++){var u,l=r.sb[s],c=Vt(n,[l.gf]);u=null!=r.Z?a+r.Z:r.N?r.N[s].end:a+e,o.push(new ri(s+t,a,u,function(e){return e}.bind(null,c),l.start,l.end)),a=u}return o}(e.S.duration,r.ab,e.B.pa,r),i?(i.Yc(a),o=e.presentationTimeline.Mb(),i.Hc(o-e.S.start)):(e.presentationTimeline.ub(a,e.S.start),i=new oi(a),o&&e.mb&&(t[o]=i)),e.mb&&e.S.Vc||ai(i,e.S.duration),{createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:i.find.bind(i),getSegmentReference:i.get.bind(i),initSegmentReference:n,ma:r.ma}}function yi(e){return e.La}function _i(e,t,n,r){var i=function(e){var t=Qr(e,bi,"initialization");if(!t)return null;var n=e.B.id,r=e.bandwidth||null,i=e.B.pa;return new ni((function(){var e=Zr(t,n,null,r,null);return Vt(i,[e])}),0,null)}(e),o=$r(e,bi),a=Qr(e,bi,"media"),s=Qr(e,bi,"index");if(a=(o={Z:o.Z,timescale:o.timescale,ab:o.ab,ma:o.ma,yd:o.yd,N:o.N,Xc:a,Ob:s}).Ob?1:0,a+=o.N?1:0,0==(a+=o.Z?1:0))throw new me(2,4,4002);if(1!=a&&(o.Ob&&(o.N=null),o.Z=null),!o.Ob&&!o.Xc)throw new me(2,4,4002);if(o.Ob){if("mp4"!=(n=e.B.mimeType.split("/")[1])&&"webm"!=n)throw new me(2,4,4006);if("webm"==n&&!i)throw new me(2,4,4005);r=Zr(o.Ob,e.B.id,null,e.bandwidth||null,null),e=mi(e,t,i,r=Vt(e.B.pa,[r]),0,null,n,o.ma)}else o.Z?(r||(e.presentationTimeline.$c(o.Z),e.presentationTimeline.ad(e.S.start)),e=function(e,t){var n=e.S.duration,r=t.Z,i=t.ab,o=t.timescale,a=t.Xc,s=e.bandwidth||null,u=e.B.id,l=e.B.pa;return{createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(e){return 0>e||n&&e>=n?null:Math.floor(e/r)},getSegmentReference:function(e){var t=e*r,c=t+r;return n&&(c=Math.min(c,n)),0>c||n&&t>=n?null:new ri(e,t,c,(function(){var n=Zr(a,u,e+i,s,t*o);return Vt(l,[n])}),0,null)}}}(e,o)):(a=t=null,e.ka.id&&e.B.id&&(t=n[a=e.ka.id+","+e.B.id]),s=function(e,t){for(var n=[],r=0;r<t.N.length;r++){var i=r+t.ab;n.push(new ri(i,t.N[r].start,t.N[r].end,function(e,t,n,r,i,o){return Vt(r,[e=Zr(e,t,i,n,o)]).map((function(e){return e.toString()}))}.bind(null,t.Xc,e.B.id,e.bandwidth||null,e.B.pa,i,t.N[r].jg+t.yd),0,null))}return n}(e,o),r=!e.mb||!e.S.Vc,t?(r&&ai(new oi(s),e.S.duration),t.Yc(s),n=e.presentationTimeline.Mb(),t.Hc(n-e.S.start)):(e.presentationTimeline.ub(s,e.S.start),t=new oi(s),a&&e.mb&&(n[a]=t)),r&&ai(t,e.S.duration),e={createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:t.find.bind(t),getSegmentReference:t.get.bind(t)});return{createSegmentIndex:e.createSegmentIndex,findSegmentPosition:e.findSegmentPosition,getSegmentReference:e.getSegmentReference,initSegmentReference:i,ma:o.ma}}function bi(e){return e.Ub}G("shaka.media.InitSegmentReference",ni),ni.prototype.Ec=function(){return this.c()},ni.prototype.createUris=ni.prototype.Ec,ni.prototype.Qc=function(){return this.b},ni.prototype.getStartByte=ni.prototype.Qc,ni.prototype.Pc=function(){return this.a},ni.prototype.getEndByte=ni.prototype.Pc,G("shaka.media.SegmentReference",ri),ri.prototype.ca=function(){return this.position},ri.prototype.getPosition=ri.prototype.ca,ri.prototype.Rc=function(){return this.startTime},ri.prototype.getStartTime=ri.prototype.Rc,ri.prototype.Je=function(){return this.endTime},ri.prototype.getEndTime=ri.prototype.Je,ri.prototype.Ec=function(){return this.c()},ri.prototype.createUris=ri.prototype.Ec,ri.prototype.Qc=function(){return this.b},ri.prototype.getStartByte=ri.prototype.Qc,ri.prototype.Pc=function(){return this.a},ri.prototype.getEndByte=ri.prototype.Pc,G("shaka.media.SegmentIndex",oi),oi.prototype.destroy=function(){return this.a=null,Promise.resolve()},oi.prototype.destroy=oi.prototype.destroy,oi.prototype.find=function(e){for(var t=this.a.length-1;0<=t;--t){var n=this.a[t];if(e>=n.startTime&&e<n.endTime)return n.position}return this.a.length&&e<this.a[0].startTime?this.a[0].position:null},oi.prototype.find=oi.prototype.find,oi.prototype.get=function(e){return 0==this.a.length||0>(e-=this.a[0].position)||e>=this.a.length?null:this.a[e]},oi.prototype.get=oi.prototype.get,oi.prototype.offset=function(e){for(var t=0;t<this.a.length;++t)this.a[t].startTime+=e,this.a[t].endTime+=e},oi.prototype.offset=oi.prototype.offset,oi.prototype.Yc=function(e){for(var t=[],n=0,r=0;n<this.a.length&&r<e.length;){var i=this.a[n],o=e[r];i.startTime<o.startTime?(t.push(i),n++):(i.startTime>o.startTime?0==n&&t.push(o):(.1<Math.abs(i.endTime-o.endTime)?t.push(new ri(i.position,o.startTime,o.endTime,o.c,o.b,o.a)):t.push(i),n++),r++)}for(;n<this.a.length;)t.push(this.a[n++]);if(t.length)for(n=t[t.length-1].position+1;r<e.length;)i=new ri(n++,(i=e[r++]).startTime,i.endTime,i.c,i.b,i.a),t.push(i);else t=e;this.a=t},oi.prototype.merge=oi.prototype.Yc,oi.prototype.Hc=function(e){for(var t=0;t<this.a.length;++t)if(this.a[t].endTime>e)return void this.a.splice(0,t);this.a=[]},oi.prototype.evict=oi.prototype.Hc,si.prototype.ta=function(){return this.a.ta()},hi.prototype.parse=function(e,t,n,r){var i;if(440786851!=ui(t=new si(new DataView(t))).id)throw new me(2,3,3008);var o=ui(t);if(408125543!=o.id)throw new me(2,3,3009);for(t=o.a.byteOffset,o=new si(o.a),i=null;o.ta();){var a=ui(o);if(357149030==a.id){i=a;break}}if(!i)throw new me(2,3,3010);for(o=new si(i.a),i=1e6,a=null;o.ta();){var s=ui(o);if(2807729==s.id)i=di(s);else if(17545==s.id)if(4==(a=s).a.byteLength)a=a.a.getFloat32(0);else{if(8!=a.a.byteLength)throw new me(2,3,3003);a=a.a.getFloat64(0)}}if(null==a)throw new me(2,3,3011);if(i=a*(o=i/1e9),475249515!=(e=ui(new si(new DataView(e)))).id)throw new me(2,3,3007);return function(e,t,n,r,i,o){function a(){return i}var s=[];e=new si(e.a);for(var u=null,l=null;e.ta();){var c=ui(e);if(187==c.id){var d=fi(c);d&&(c=n*d.kg,d=t+d.Hf,null!=u&&s.push(new ri(s.length,u-o,c-o,a,l,d-1)),u=c,l=d)}}return null!=u&&s.push(new ri(s.length,u-o,r-o,a,l,null)),s}(e,t,o,i,n,r)};var Ei={yb:{},Qb:{},kd:function(e,t){Ei.Qb[e]=t}};function wi(e,t,n){this.f=e,this.rc=t,this.h=this.g=1/0,this.a=1,this.b=this.c=null,this.l=0,this.m=!0,this.i=0,this.s=void 0===n||n}function Ti(e,t,n,r){return e=De(e,r),0==t&&null==n||(e.headers.Range=n?"bytes="+t+"-"+n:"bytes="+t+"-"),e}function Si(){var e=this;this.b=this.a=null,this.f=[],this.c=null,this.l=[],this.h=1,this.m={},this.s=0,this.v=new z(5),this.i=new he((function(){!function(e){p((function t(){var n,r;return I(t,(function(t){switch(t.j){case 1:return n=0,x(t,2),T(t,xi(e),4);case 4:n=t.o,M(t,3);break;case 2:r=j(t),e.b&&(r.severity=1,e.b.onError(r));case 3:if(!e.b)return t.return();Ri(e,n),S(t)}}))}))}(e)})),this.g=new Ce}function xi(e){var t=Date.now(),n=e.b.networkingEngine.request(0,De(e.f,e.a.retryParameters));return ke(e.g,n),n.promise.then((function(t){if(e.b)return t.uri&&!e.f.includes(t.uri)&&e.f.unshift(t.uri),function(e,t,n){if(!(t=Wr.Vd(t,"MPD")))throw new me(2,4,4001,n);return t=ti(t,e.a.retryParameters,e.a.dash.xlinkFailGracefully,n,e.b.networkingEngine),ke(e.g,t),t.promise.then((function(t){return function(e,t,n){return p((function r(){var i,o,a,s,u,l,c,d,h,f,p,m,v,g,y,_,b,E,w,x,A,M,j,R;return I(r,(function(r){switch(r.j){case 1:s=Ft,l=[n],0<(c=(u=Wr).O(t,"Location").map(u.fc).filter(s.Ia)).length&&(d=Vt(l,c),l=e.f=d),h=u.O(t,"BaseURL").map(u.fc),f=Vt(l,h),p=e.a.dash.ignoreMinBufferTime,m=0,p||(m=u.I(t,"minBufferTime",u.Da)),e.s=u.I(t,"minimumUpdatePeriod",u.Da,-1),v=u.I(t,"availabilityStartTime",u.zf),g=u.I(t,"timeShiftBufferDepth",u.Da),y=u.I(t,"maxSegmentDuration",u.Da),_=t.getAttribute("type")||"static",b=e.a.dash.ignoreSuggestedPresentationDelay,E=null,b||(E=u.I(t,"suggestedPresentationDelay",u.Da)),e.c?w=e.c.presentationTimeline:(x=Math.max(e.a.dash.defaultPresentationDelay,1.5*m),w=new wi(v,null!=E?E:x,e.a.dash.autoCorrectDrift));for(var L={mb:"static"!=_,presentationTimeline:w,ka:null,S:null,aa:null,B:null,bandwidth:0,Id:!1},C=f,k=Wr.I(t,"mediaPresentationDuration",Wr.Da),O=[],P=0,I=Wr.O(t,"Period"),D=0;D<I.length;D++){var N=I[D];P=Wr.I(N,"start",Wr.Da,P);var B=Wr.I(N,"duration",Wr.Da),U=null;if(D!=I.length-1){var F=Wr.I(I[D+1],"start",Wr.Da);null!=F&&(U=F-P)}else null!=k&&(U=k-P);if(null==U&&(U=B),N=Ai(e,L,C,{start:P,duration:U,node:N,Vc:null==U||D==I.length-1}),O.push(N),B=L.ka.id,e.l.includes(B)||(e.l.push(B),e.c&&(e.b.filterNewPeriod(N),e.c.periods.push(N))),null==U){P=null;break}P+=U}if(null==e.c&&e.b.filterAllPeriods(O),null!=k?(i=O,o=k,a=!1):(i=O,o=P,a=!0),A=o,M=i,w.Vb("static"==_),"static"!=_&&a||w.wa(A||1/0),w.V()&&!isNaN(e.a.availabilityWindowOverride)&&(g=e.a.availabilityWindowOverride),null==g&&(g=1/0),w.sd(g),w.$c(y||1),e.c){r.A(0);break}if(e.c={presentationTimeline:w,periods:M,offlineSessionIds:[],minBufferTime:m||0},!w.je()){r.A(0);break}return j=u.O(t,"UTCTiming"),T(r,function(e,t,n){n=n.map((function(e){return{scheme:e.getAttribute("schemeIdUri"),value:e.getAttribute("value")}}));var r=e.a.dash.clockSyncUri;return!n.length&&r&&n.push({scheme:"urn:mpeg:dash:utc:http-head:2014",value:r}),Ft.Ae(n,function(e){var n=e.scheme;switch(e=e.value,n){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":return Ci(this,t,e,"HEAD");case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":return Ci(this,t,e,"GET");case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":return n=Date.parse(e),isNaN(n)?0:n-Date.now();case"urn:mpeg:dash:utc:http-ntp:2014":case"urn:mpeg:dash:utc:ntp:2014":case"urn:mpeg:dash:utc:sntp:2014":return X("NTP UTCTiming scheme is not supported"),Promise.reject();default:return X("Unrecognized scheme in UTCTiming element",n),Promise.reject()}}.bind(e)).catch((function(){return X("A UTCTiming element should always be given in live manifests! This content may not play on clients with bad clocks!"),0}))}(e,f,j),4);case 4:if(R=r.o,!e.b)return r.return();w.ee(R),S(r)}}))}))}(e,t,n)}))}(e,t.data,t.uri)})).then((function(){var n=(Date.now()-t)/1e3;return W(e.v,1,n),n}))}function Ai(e,t,n,r){if(t.ka=Li(r.node,null,n),t.S=r,t.ka.id||(t.ka.id="__shaka_period_"+r.start),Wr.O(r.node,"EventStream").forEach(e.Af.bind(e,r.start,r.duration)),n=Wr.O(r.node,"AdaptationSet").map(e.yf.bind(e,t)).filter(Ft.Ia),t.mb){t=[];for(var i=h(n),o=i.next();!o.done;o=i.next())for(var a=(o=h(o.value.Kf)).next();!a.done;a=o.next())t.push(a.value);if(t.length!=new Set(t).size)throw new me(2,4,4018)}var s=n.filter((function(e){return!e.wd}));if(n.filter((function(e){return e.wd})).forEach((function(e){var t=e.streams[0],n=e.wd;s.forEach((function(e){e.id==n&&e.streams.forEach((function(e){e.trickModeVideo=t}))}))})),t=Mi(s,"video"),i=Mi(s,"audio"),!t.length&&!i.length)throw new me(2,4,4004);for(n=e.a.disableAudio,i.length&&!n||(i=[null]),n=e.a.disableVideo,t.length&&!n||(t=[null]),n=[],o=0;o<i.length;o++)for(a=0;a<t.length;a++)ji(e,i[o],t[a],n);if(t=[],!e.a.disableText)for(e=Mi(s,"text"),i=0;i<e.length;i++)t.push.apply(t,e[i].streams);return{startTime:r.start,textStreams:t,variants:n}}function Mi(e,t){return e.filter((function(e){return e.contentType==t}))}function ji(e,t,n,r){if(t||n)if(t&&n){var i=t.drmInfos,o=n.drmInfos;if(!i.length||!o.length||0<Rt(i,o).length){o=Rt(t.drmInfos,n.drmInfos);for(var a=0;a<t.streams.length;a++)for(var s=0;s<n.streams.length;s++)i=(n.streams[s].bandwidth||0)+(t.streams[a].bandwidth||0),i={id:e.h++,language:t.language,primary:t.Wc||n.Wc,audio:t.streams[a],video:n.streams[s],bandwidth:i,drmInfos:o,allowedByApplication:!0,allowedByKeySystem:!0},r.push(i)}}else for(o=t||n,a=0;a<o.streams.length;a++)i=o.streams[a].bandwidth||0,i={id:e.h++,language:o.language||"und",primary:o.Wc,audio:t?o.streams[a]:null,video:n?o.streams[a]:null,bandwidth:i,drmInfos:o.drmInfos,allowedByApplication:!0,allowedByKeySystem:!0},r.push(i)}function Ri(e,t){0>e.s||e.i.P(Math.max(3,e.s-t,q(e.v)))}function Li(e,t,n){t=t||{contentType:"",mimeType:"",codecs:"",emsgSchemeIdUris:[],frameRate:void 0,bd:null,audioSamplingRate:null},n=n||t.pa;var r=Wr.xb,i=Wr.Ce,o=Wr.O(e,"BaseURL").map(Wr.fc),a=e.getAttribute("contentType")||t.contentType,s=e.getAttribute("mimeType")||t.mimeType,u=e.getAttribute("codecs")||t.codecs;i=Wr.I(e,"frameRate",i)||t.frameRate;for(var l=Wr.O(e,"InbandEventStream"),c=t.emsgSchemeIdUris.slice(),d=(l=h(l)).next();!d.done;d=l.next())d=d.value.getAttribute("schemeIdUri"),c.includes(d)||c.push(d);return l=function(e){for(var t=0;t<e.length;++t){var n=e[t],r=n.getAttribute("schemeIdUri");if(r&&(n=n.getAttribute("value")))switch(r){case"urn:mpeg:dash:outputChannelPositionList:2012":return n.trim().split(/ +/).length;case"urn:mpeg:dash:23003:3:audio_channel_configuration:2011":case"urn:dts:dash:audio_channel_configuration:2012":if(!(r=parseInt(n,10)))continue;return r;case"tag:dolby.com,2014:dash:audio_channel_configuration:2011":case"urn:dolby:dash:audio_channel_configuration:2011":if(r=parseInt(n,16)){for(e=0;r;)1&r&&++e,r>>=1;return e}}}return null}(l=Wr.O(e,"AudioChannelConfiguration"))||t.bd,d=Wr.I(e,"audioSamplingRate",r)||t.audioSamplingRate,a||(a=ki(s,u)),{pa:Vt(n,o),Sb:Wr.dc(e,"SegmentBase")||t.Sb,La:Wr.dc(e,"SegmentList")||t.La,Ub:Wr.dc(e,"SegmentTemplate")||t.Ub,width:Wr.I(e,"width",r)||t.width,height:Wr.I(e,"height",r)||t.height,contentType:a,mimeType:s,codecs:u,frameRate:i,emsgSchemeIdUris:c,id:e.getAttribute("id"),bd:l,audioSamplingRate:d}}function Ci(e,t,n,r){return(t=De(t=Vt(t,[n]),e.a.retryParameters)).method=r,t=e.b.networkingEngine.request(4,t),ke(e.g,t),t.promise.then((function(e){if("HEAD"==r){if(!e.headers||!e.headers.date)return 0;e=e.headers.date}else e=ot(e.data);return e=Date.parse(e),isNaN(e)?0:e-Date.now()}))}function ki(e,t){return fn(Ze(e,t))?"text":e.split("/")[0]}function Oi(e,t,n,r){this.b=e,this.type=t,this.a=n,this.segments=r||null}function Pi(e,t,n,r){this.id=e,this.name=t,this.a=n,this.value=void 0===r?null:r}function Ii(e,t){this.name=e,this.value=t}function Di(e,t,n){return(e=e.getAttribute(t))?e.value:n||null}function Ni(e,t){this.b=t,this.a=e}G("shaka.media.ManifestParser.registerParserByExtension",Ei.kd),Ei.Bb=function(e,t){Ei.yb[e]=t},G("shaka.media.ManifestParser.registerParserByMime",Ei.Bb),Ei.Ef=function(){var e={};if(et()){for(var t in Ei.yb)e[t]=!0;for(var n in Ei.Qb)e[n]=!0}t={mpd:"application/dash+xml",m3u8:"application/x-mpegurl",ism:"application/vnd.ms-sstr+xml"};for(var r=(n=h(["application/dash+xml","application/x-mpegurl","application/vnd.apple.mpegurl","application/vnd.ms-sstr+xml"])).next();!r.done;r=n.next())e[r=r.value]=et()?!!Ei.yb[r]:tt(r);for(var i in t)e[i]=et()?!!Ei.Qb[i]:tt(t[i]);return e},Ei.create=function(e,t,n,r){return p((function i(){var o,a;return I(i,(function(i){switch(i.j){case 1:return x(i,2),T(i,Ei.Ke(e,t,n,r),4);case 4:return o=i.o,i.return(new o);case 2:throw(a=j(i)).severity=2,a}}))}))},Ei.Ke=function(e,t,n,r){return p((function i(){var o,a,s,u,l;return I(i,(function(i){switch(i.j){case 1:if(o=Ei,r&&(a=o.yb[r.toLowerCase()]))return i.return(a);if((s=o.getExtension(e))&&(u=o.Qb[s]))return i.return(u);if(r){i.A(2);break}return T(i,o.Se(e,t,n),3);case 3:if((r=i.o)&&(l=Ei.yb[r]))return i.return(l);case 2:throw new me(2,4,4e3,e)}}))}))},Ei.Se=function(e,t,n){return p((function r(){var i,o,a;return I(r,(function(r){switch(r.j){case 1:return(i=De([e],n)).method="HEAD",T(r,t.request(0,i).promise,2);case 2:return o=r.o,a=o.headers["content-type"],r.return(a?a.toLowerCase().split(";").shift():"")}}))}))},Ei.getExtension=function(e){return 1==(e=new $(e).ja.split("/").pop().split(".")).length?"":e.pop().toLowerCase()},Ei.isSupported=function(e,t){return!!et()&&(t in Ei.yb||Ei.getExtension(e)in Ei.Qb)},G("shaka.media.PresentationTimeline",wi),wi.prototype.Y=function(){return this.g},wi.prototype.getDuration=wi.prototype.Y,wi.prototype.Qe=function(){return this.a},wi.prototype.getMaxSegmentDuration=wi.prototype.Qe,wi.prototype.wa=function(e){this.g=e},wi.prototype.setDuration=wi.prototype.wa,wi.prototype.Xe=function(){return this.f},wi.prototype.getPresentationStartTime=wi.prototype.Xe,wi.prototype.ee=function(e){this.l=e},wi.prototype.setClockOffset=wi.prototype.ee,wi.prototype.Vb=function(e){this.m=e},wi.prototype.setStatic=wi.prototype.Vb,wi.prototype.sd=function(e){this.h=e},wi.prototype.setSegmentAvailabilityDuration=wi.prototype.sd,wi.prototype.Vf=function(e){this.rc=e},wi.prototype.setDelay=wi.prototype.Vf,wi.prototype.Ie=function(){return this.rc},wi.prototype.getDelay=wi.prototype.Ie,wi.prototype.ub=function(e,t){if(0!=e.length){var n=e[e.length-1].endTime+t;this.ad(e[0].startTime+t),this.a=e.reduce((function(e,t){return Math.max(e,t.endTime-t.startTime)}),this.a),this.b=Math.max(this.b,n),null!=this.f&&this.s&&(this.f=(Date.now()+this.l)/1e3-this.b-this.a)}},wi.prototype.notifySegments=wi.prototype.ub,wi.prototype.ad=function(e){this.c=null==this.c?e:Math.min(this.c,e)},wi.prototype.notifyMinSegmentStartTime=wi.prototype.ad,wi.prototype.$c=function(e){this.a=Math.max(this.a,e)},wi.prototype.notifyMaxSegmentDuration=wi.prototype.$c,wi.prototype.offset=function(e){null!=this.c&&(this.c+=e),null!=this.b&&(this.b+=e)},wi.prototype.offset=wi.prototype.offset,wi.prototype.V=function(){return 1/0==this.g&&!this.m},wi.prototype.isLive=wi.prototype.V,wi.prototype.Xa=function(){return 1/0!=this.g&&!this.m},wi.prototype.isInProgress=wi.prototype.Xa,wi.prototype.Mb=function(){if(1/0==this.h)return this.i;var e=this.pb()-this.h;return Math.max(this.i,e)},wi.prototype.getSegmentAvailabilityStart=wi.prototype.Mb,wi.prototype.fe=function(e){this.i=e},wi.prototype.setUserSeekStart=wi.prototype.fe,wi.prototype.pb=function(){return this.V()||this.Xa()?Math.min(Math.max(0,(Date.now()+this.l)/1e3-this.a-this.f),this.g):this.g},wi.prototype.getSegmentAvailabilityEnd=wi.prototype.pb,wi.prototype.Lb=function(e){var t=Math.max(this.c,this.i);if(1/0==this.h)return t;var n=this.pb()-this.h;return e=Math.min(n+e,this.Ba()),Math.max(t,e)},wi.prototype.getSafeSeekRangeStart=wi.prototype.Lb,wi.prototype.ob=function(){return this.Lb(0)},wi.prototype.getSeekRangeStart=wi.prototype.ob,wi.prototype.Ba=function(){var e=this.V()||this.Xa()?this.rc:0;return Math.max(0,this.pb()-e)},wi.prototype.getSeekRangeEnd=wi.prototype.Ba,wi.prototype.je=function(){return null!=this.f&&null==this.b},wi.prototype.usingPresentationStartTime=wi.prototype.je,G("shaka.dash.DashParser",Si),(r=Si.prototype).configure=function(e){this.a=e},r.start=function(e,t){var n=this;return p((function r(){var i;return I(r,(function(r){switch(r.j){case 1:return n.f=[e],n.b=t,T(r,xi(n),2);case 2:if(i=r.o,n.b&&Ri(n,i),!n.b)throw new me(2,7,7001);return r.return(n.c)}}))}))},r.stop=function(){return this.a=this.b=null,this.f=[],this.c=null,this.l=[],this.m={},null!=this.i&&(this.i.stop(),this.i=null),this.g.destroy()},r.update=function(){xi(this).catch(function(e){this.b&&this.b.onError(e)}.bind(this))},r.onExpirationUpdated=function(){},r.yf=function(e,t){if(e.aa=Li(t,e.ka,null),"image"==e.aa.contentType)return null;var n=!1,r=Wr.O(t,"Role"),i=r.map((function(e){return e.getAttribute("value")})).filter(Ft.Ia),o=void 0,a="text"==e.aa.contentType;a&&(o="subtitle");for(var s=0;s<r.length;s++){var u=r[s].getAttribute("schemeIdUri");if(null==u||"urn:mpeg:dash:role:2011"==u)switch(u=r[s].getAttribute("value"),u){case"main":n=!0;break;case"caption":case"subtitle":o=u}}var l=null,c=!1;Wr.O(t,"EssentialProperty").forEach((function(e){"http://dashif.org/guidelines/trickmode"==e.getAttribute("schemeIdUri")?l=e.getAttribute("value"):c=!0})),s=Wr.O(t,"Accessibility");var d=new Map;for(r={},u=(s=h(s)).next();!u.done;r={Hb:r.Hb},u=s.next()){var f=u.value;u=f.getAttribute("schemeIdUri"),f=f.getAttribute("value"),"urn:scte:dash:cc:cea-608:2015"==u||"urn:scte:dash:cc:cea-708:2015"==u?(r.Hb=1,null!=f?f.split(";").forEach(function(e){return function(t){if(t.includes("=")){var n=(t=t.split("="))[0].startsWith("CC")?t[0]:"CC"+t[0];t=t[1].split(",")[0].split(":").pop()}else n="CC"+e.Hb,e.Hb+=2;d.set(n,Cn(t))}}(r)):d.set("CC1","und")):"urn:mpeg:dash:role:2011"==u&&null!=f&&(i.push(f),"captions"==f&&(o="caption"))}if(c)return null;var p=Kr(r=Wr.O(t,"ContentProtection"),this.a.dash.customScheme,this.a.dash.ignoreDrmInfo);if(r=Cn(t.getAttribute("lang")||"und"),s=t.getAttribute("label"),(u=Wr.O(t,"Label"))&&u.length&&((u=u[0]).textContent&&(s=u.textContent)),0==(i=(u=Wr.O(t,"Representation")).map(this.Bf.bind(this,e,p,o,r,s,n,i,d)).filter((function(e){return!!e}))).length){if(a)return null;throw new me(2,4,4003)}return e.aa.contentType&&"application"!=e.aa.contentType||(e.aa.contentType=ki(i[0].mimeType,i[0].codecs),i.forEach((function(t){t.type=e.aa.contentType}))),i.forEach((function(e){p.drmInfos.forEach((function(t){e.keyId&&t.keyIds.push(e.keyId)}))})),a=u.map((function(e){return e.getAttribute("id")})).filter(Ft.Ia),{id:e.aa.id||"__fake__"+this.h++,contentType:e.aa.contentType,language:r,Wc:n,streams:i,drmInfos:p.drmInfos,wd:l,Kf:a}},r.Bf=function(e,t,n,r,i,o,a,s,u){if(e.B=Li(u,e.aa,null),!function(e){var t=e.Sb?1:0;return t+=e.La?1:0,0==(t+=e.Ub?1:0)?"text"==e.contentType||"application"==e.contentType:(1!=t&&(e.Sb&&(e.La=null),e.Ub=null),!0)}(e.B))return null;e.bandwidth=Wr.I(u,"bandwidth",Wr.pc)||0;var l=e.B.contentType;l="text"==l||"application"==l;try{var c=this.Lf.bind(this);if(e.B.Sb)var d=function(e,t){var n=Number(Qr(e,vi,"presentationTimeOffset"))||0,r=Qr(e,vi,"timescale"),i=1;r&&(i=Wr.pc(r)||1),n=n/i||0,r=pi(e,vi);var o=e.B.contentType;if(i=e.B.mimeType.split("/")[1],"text"!=o&&"mp4"!=i&&"webm"!=i)throw new me(2,4,4006);if("webm"==i&&!r)throw new me(2,4,4005);o=ei(e,vi,"RepresentationIndex");var a=Qr(e,vi,"indexRange"),s=e.B.pa;if(a=Wr.qc(a||""),o){var u=o.getAttribute("sourceURL");u&&(s=Vt(e.B.pa,[u])),a=Wr.I(o,"range",Wr.qc,a)}if(!a)throw new me(2,4,4002);return{createSegmentIndex:(i=mi(e,t,r,s,a.start,a.end,i,n)).createSegmentIndex,findSegmentPosition:i.findSegmentPosition,getSegmentReference:i.getSegmentReference,initSegmentReference:r,ma:n}}(e,c);else if(e.B.La)d=gi(e,this.m);else if(e.B.Ub)d=_i(e,c,this.m,!!this.c);else{var h=e.B.pa,f=e.S.duration||0;d={createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(e){return 0<=e&&e<f?1:null},getSegmentReference:function(e){return 1!=e?null:new ri(1,0,f,(function(){return h}),0,null)},initSegmentReference:null,ma:0}}}catch(e){if(l&&4002==e.code)return null;throw e}return u=function(e,t,n,r){var i=Kr(e,t,r);if(n.Ed)e=1==n.drmInfos.length&&!n.drmInfos[0].keySystem,t=0==i.drmInfos.length,(0==n.drmInfos.length||e&&!t)&&(n.drmInfos=i.drmInfos),n.Ed=!1;else if(0<i.drmInfos.length&&(n.drmInfos=n.drmInfos.filter((function(e){return i.drmInfos.some((function(t){return t.keySystem==e.keySystem}))})),0==n.drmInfos.length))throw new me(2,4,4008);return i.Bd||n.Bd}(u=Wr.O(u,"ContentProtection"),this.a.dash.customScheme,t,this.a.dash.ignoreDrmInfo),{id:this.h++,originalId:e.B.id,createSegmentIndex:d.createSegmentIndex,findSegmentPosition:d.findSegmentPosition,getSegmentReference:d.getSegmentReference,initSegmentReference:d.initSegmentReference,presentationTimeOffset:d.ma,mimeType:e.B.mimeType,codecs:e.B.codecs,frameRate:e.B.frameRate,bandwidth:e.bandwidth,width:e.B.width,height:e.B.height,kind:n,encrypted:0<t.drmInfos.length,keyId:u,language:r,label:i,type:e.aa.contentType,primary:o,trickModeVideo:null,emsgSchemeIdUris:e.B.emsgSchemeIdUris,roles:a,channelsCount:e.B.bd,audioSamplingRate:e.B.audioSamplingRate,closedCaptions:s}},r.Af=function(e,t,n){var r=Wr.xb,i=n.getAttribute("schemeIdUri")||"",o=n.getAttribute("value")||"",a=Wr.I(n,"timescale",r)||1;Wr.O(n,"Event").forEach(function(n){var s=Wr.I(n,"presentationTime",r)||0,u=Wr.I(n,"duration",r)||0;u=(s=s/a+e)+u/a,null!=t&&(s=Math.min(s,e+t),u=Math.min(u,e+t)),n={schemeIdUri:i,value:o,startTime:s,endTime:u,id:n.getAttribute("id")||"",eventElement:n},this.b.onTimelineRegionAdded(n)}.bind(this))},r.Lf=function(e,t,n){return e=Ti(e,t,n,this.a.retryParameters),e=this.b.networkingEngine.request(1,e),ke(this.g,e),e.promise.then((function(e){return e.data}))},Ei.kd("mpd",Si),Ei.Bb("application/dash+xml",Si),Ei.Bb("video/vnd.mpeg.dash.mpd",Si),Pi.prototype.toString=function(){var e="#"+this.name,t=this.a?this.a.map((function(e){return e.name+"="+(isNaN(Number(e.value))?'"'+e.value+'"':e.value)})):[];return this.value&&t.unshift(this.value),0<t.length&&(e+=":"+t.join(",")),e},Pi.prototype.getAttribute=function(e){var t=this.a.filter((function(t){return t.name==e}));return t.length?t[0]:null};var Bi={nb:function(e,t){return e.filter((function(e){return e.name==t}))},Ta:function(e,t){var n=Bi.nb(e,t);return n.length?n[0]:null},Lc:function(e,t,n){return e.filter((function(e){var r=e.getAttribute("TYPE");return e=e.getAttribute("GROUP-ID"),r.value==t&&e.value==n}))},Dc:function(e,t){return Vt([e],[t])[0]},Uc:function(e){return/^#(?!EXT)/m.test(e)}};function Ui(e){this.b=e,this.a=0}function Fi(e){Vi(e,/[ \t]+/gm)}function Vi(e,t){t.lastIndex=e.a;var n=t.exec(e.b);return n=null==n?null:{position:n.index,length:n[0].length,Nf:n},e.a==e.b.length||null==n||n.position!=e.a?null:(e.a+=n.length,n.Nf)}function Gi(e){return e.a==e.b.length?null:(e=Vi(e,/[^ \t\n]*/gm))?e[0]:null}function Hi(){this.a=0}function zi(e,t,n){var r=(t=(t=ot(t)).replace(/\r\n|\r(?=[^\n]|$)/gm,"\n").trim()).split(/\n+/m);if(!/^#EXTM3U($|[ \t\n])/m.test(r[0]))throw new me(2,4,4015);t=0;for(var i=1;i<r.length;i++)if(!Bi.Uc(r[i])){var o=qi(e,r[i]);if(--e.a,Ki.includes(o.name)){t=1;break}"EXT-X-STREAM-INF"==o.name&&(i+=1)}for(i=[],o=1;o<r.length;)if(Bi.Uc(r[o]))o+=1;else{var a=qi(e,r[o]);if(Yi.includes(a.name)){if(1!=t)throw new me(2,4,4017);return new Oi(n,t,i,e=Wi(e,n,r=r.splice(o,r.length-o),i))}i.push(a),o+=1,"EXT-X-STREAM-INF"==a.name&&(a.a.push(new Ii("URI",r[o])),o+=1)}return new Oi(n,t,i)}function Wi(e,t,n,r){var i=[],o=[];return n.forEach((function(n){if(/^(#EXT)/.test(n))n=qi(e,n),Ki.includes(n.name)?r.push(n):o.push(n);else{if(Bi.Uc(n))return[];n=Bi.Dc(t,n.trim()),i.push(new Ni(n,o)),o=[]}})),i}function qi(e,t){var n=e.a++,r=t.match(/^#(EXT[^:]*)(?::(.*))?$/);if(!r)throw new me(2,4,4016,t);var i,o=r[1],a=r[2];if(r=[],a){var s;(s=Vi(a=new Ui(a),/^([^,=]+)(?:,|$)/g))&&(i=s[1]);for(var u=/([^=]+)=(?:"([^"]*)"|([^",]*))(?:,|$)/g;s=Vi(a,u);)r.push(new Ii(s[1],s[2]||s[3]))}return new Pi(n,o,r,i)}var Ki="EXT-X-TARGETDURATION EXT-X-MEDIA-SEQUENCE EXT-X-DISCONTINUITY-SEQUENCE EXT-X-PLAYLIST-TYPE EXT-X-MAP EXT-X-I-FRAMES-ONLY EXT-X-ENDLIST".split(" "),Yi="EXTINF EXT-X-BYTERANGE EXT-X-DISCONTINUITY EXT-X-PROGRAM-DATE-TIME EXT-X-KEY EXT-X-DATERANGE".split(" ");function Xi(e){try{var t=Xi.parse(e);return be({uri:e,fd:e,data:t.data,headers:{"content-type":t.contentType}})}catch(e){return ye(e)}}function Ji(){var e=this;this.a=this.g=null,this.$=1,this.D=new Map,this.T=new Set,this.b=new Map,this.c=null,this.v="",this.s=new Hi,this.R=0,this.h=new he((function(){!function(e){p((function t(){var n,r;return I(t,(function(t){switch(t.j){case 1:return e.g?(x(t,2),T(t,e.update(),4)):t.return();case 4:n=e.R,e.h.P(n),M(t,0);break;case 2:(r=j(t)).severity=1,e.g.onError(r),e.h.P(.1),S(t)}}))}))}(e)})),this.f=vo,this.m=null,this.C=0,this.F=1/0,this.i=new Ce,this.L=[],this.l=new Map,this.W=!1}function Zi(e,t){return p((function n(){var r,i,o,a,s,u,l,c,d,h;return I(n,(function(n){switch(n.j){case 1:return r=Bi,i=go,o=t.re,T(n,po(e,De([o],e.a.retryParameters),0),2);case 2:if(a=n.o,1!=(s=zi(e.s,a.data,a.uri)).type)throw new me(2,4,4017);return l=(u=r.Ta(s.a,"EXT-X-MEDIA-SEQUENCE"))?Number(u.value):0,c=t.stream,T(n,oo(e,t.xc,s,l,c.mimeType,c.codecs),3);case 3:d=n.o,t.Tb.a=d,h=d[d.length-1],r.Ta(s.a,"EXT-X-ENDLIST")&&(fo(e,i.Qa),e.c.wa(h.endTime)),S(n)}}))}))}function $i(e){e.forEach((function(e){var t=e.stream.codecs.split(",");t=t.filter((function(e){return"mp4a.40.34"!=e})),e.stream.codecs=t.join(",")}))}function Qi(e,t,n,r,i){return{id:e.$++,language:t?t.language:"und",primary:!!t&&t.primary||!!n&&n.primary,audio:t,video:n,bandwidth:r,drmInfos:i,allowedByApplication:!0,allowedByKeySystem:!0}}function eo(e,t,n){return p((function r(){var i,o,a,s,u,l,c,d,h;return I(r,(function(r){switch(r.j){case 1:if(i=uo(t,"URI"),e.b.has(i))return r.return(e.b.get(i));if(o=uo(t,"TYPE").toLowerCase(),a=Ht,"subtitles"==o&&(o=a.qa),s=Cn(Di(t,"LANGUAGE","und")),u=Di(t,"NAME"),l=t.getAttribute("DEFAULT"),c=t.getAttribute("AUTOSELECT"),d=Di(t,"CHANNELS"),"audio"==o)if(d){var f=d.split("/")[0];f=parseInt(f,10)}else f=null;else f=null;return T(r,to(e,i,n,o,s,!!l||!!c,u,f,null),2);case 2:return null==(h=r.o)?r.return(null):e.b.has(i)?r.return(e.b.get(i)):(e.D.set(t.id,h),e.b.set(i,h),r.return(h))}}))}))}function to(e,t,n,r,i,o,a,s,u){return p((function l(){var c,d,f,m,v,g,y,_,b,E,w,S,x,A,M,j,R,L,C,k,O,P,D,N,B;return I(l,(function(l){switch(l.j){case 1:return d=(c=Bi).Dc(e.v,t),m="",T(l,po(e,De([d],e.a.retryParameters),0),2);case 2:if(g=l.o,d=g.uri,1!=(f=zi(e.s,g.data,d)).type)throw new me(2,4,4017);y=[],f.segments.forEach((function(e){e=c.nb(e.b,"EXT-X-KEY"),y.push.apply(y,e)})),_=!1,b=[],E=null;for(var U=h(y),F=U.next();!F.done;F=U.next())if(w=F.value,"NONE"!=(S=uo(w,"METHOD"))){if(_=!0,"AES-128"==S)return e.W=!0,l.return(null);x=uo(w,"KEYFORMAT"),(M=(A=mo[x])?A(w):null)&&(M.keyIds.length&&(E=M.keyIds[0]),b.push(M))}if(_&&!b.length)throw new me(2,4,4026);return function(e,t){var n=go,r=Bi.Ta(t.a,"EXT-X-PLAYLIST-TYPE"),i=Bi.Ta(t.a,"EXT-X-ENDLIST");i=r&&"VOD"==r.value||i,r=r&&"EVENT"==r.value&&!i,r=!i&&!r,i?fo(e,n.Qa):(fo(e,r?n.zd:n.me),n=lo(t.a,"EXT-X-TARGETDURATION"),n=Number(n.value),e.C=Math.max(n,e.C),e.F=Math.min(n,e.F))}(e,f),m=function(e,t){if(1==t.length)return t[0];var n=so(e,t);if(null!=n)return n;throw new me(2,4,4025,t)}(r,n),T(l,function(e,t,n,r){return p((function i(){var o,a,s,u,l,c,d,h,f;return I(i,(function(i){switch(i.j){case 1:return o=Ht,a=r.segments[0].a,s=new $(a),u=s.ja.split(".").pop(),l=ho[t],(c=l[u])?i.return(c):t==o.qa?n&&"vtt"!=n?i.return("application/mp4"):i.return("text/vtt"):((d=De([a],e.a.retryParameters)).method="HEAD",T(i,po(e,d,1),2));case 2:if(h=i.o,!(f=h.headers["content-type"]))throw new me(2,4,4021,u);return i.return(f.split(";")[0])}}))}))}(e,r,m,f),3);case 3:return v=l.o,R=(j=c.Ta(f.a,"EXT-X-MEDIA-SEQUENCE"))?Number(j.value):0,T(l,oo(e,t,f,R,v,m),4);case 4:return L=l.o,C=L[0].startTime,k=L[L.length-1].endTime,O=k-C,P=new oi(L),D=no(f),N=void 0,"text"==r&&(N="subtitle"),B={id:e.$++,originalId:a,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:P.find.bind(P),getSegmentReference:P.get.bind(P),initSegmentReference:D,presentationTimeOffset:0,mimeType:v,codecs:m,kind:N,encrypted:_,keyId:E,language:i,label:a,type:r,primary:o,trickModeVideo:null,emsgSchemeIdUris:null,frameRate:void 0,width:void 0,height:void 0,bandwidth:void 0,roles:[],channelsCount:s,audioSamplingRate:null,closedCaptions:u},l.return({stream:B,Tb:P,drmInfos:b,xc:t,re:d,Zc:C,vg:k,duration:O})}}))}))}function no(e){var t=Bi.nb(e.a,"EXT-X-MAP");if(!t.length)return null;if(1<t.length)throw new me(2,4,4020);var n=uo(t=t[0],"URI"),r=Bi.Dc(e.b,n);return e=0,n=null,(t=Di(t,"BYTERANGE"))&&(e=t.split("@"),t=Number(e[0]),n=(e=Number(e[1]))+t-1),new ni((function(){return[r]}),e,n)}function ro(e,t,n,r){var i=t.b,o=t.a;t=lo(i,"EXTINF").value.split(","),t=r+Number(t[0]);var a=0,s=null;return(i=Bi.Ta(i,"EXT-X-BYTERANGE"))&&(a=i.value.split("@"),i=Number(a[0]),s=(a=a[1]?Number(a[1]):e.a+1)+i-1),new ri(n,r,t,(function(){return[o]}),a,s)}function io(e){e.c&&(e.L.forEach((function(t){e.c.ub(t,0)})),e.L=[])}function oo(e,t,n,r,i,o){return p((function a(){var s,u,l,c,d,h,f,m,v,g;return I(a,(function(a){switch(a.j){case 1:return s=n.segments,u=[],l=s[0].a,c=ro(null,s[0],r,0),d=no(n),T(a,function(e,t,n,r,i,o){return p((function a(){var s,u,l,c,d,h,f,p,m;return I(a,(function(a){switch(a.j){case 1:if(e.m&&(s=e.b.get(t),u=s.Tb,l=u.get(r.position)))return a.return(l.startTime);if("audio/mpeg"==i)return a.return(0);if("video/mp4"!=i&&"audio/mp4"!=i){a.A(2);break}return c=[ao(e,r)],n&&c.push(ao(e,n)),T(a,Promise.all(c),3);case 3:return d=a.o,h=d[0],f=d[1]||d[0],a.return(function(e,t){var n=0;if((new Br).H("moov",Ur).H("trak",Ur).H("mdia",Ur).fa("mdhd",(function(e){e.reader.M(0==e.version?8:16),n=e.reader.G(),e.parser.stop()})).parse(t,!0),!n)throw new me(2,4,4030);var r=0,i=!1;if((new Br).H("moof",Ur).H("traf",Ur).fa("tfdt",(function(e){r=(0==e.version?e.reader.G():e.reader.Ab())/n,i=!0,e.parser.stop()})).parse(e,!0),!i)throw new me(2,4,4030);return r}(h.data,f.data));case 2:if("video/mp2t"!=i){a.A(4);break}return T(a,ao(e,r),5);case 5:return p=a.o,a.return(function(e){function t(){throw new me(2,4,4030)}e=new Ir(new DataView(e),0);for(var n=0,r=0;;){if(n=e.ca(),71!=(r=e.la())&&t(),16384&e.Rb()||t(),0!=(r=(48&e.la())>>4)&&2!=r||t(),3==r&&(r=e.la(),e.M(r)),1==e.G()>>8)return e.M(3),0!=(n=e.la()>>6)&&1!=n||t(),0==e.la()&&t(),n=e.la(),r=e.Rb(),e=e.Rb(),(1073741824*((14&n)>>1)+((65534&r)<<14|(65534&e)>>1))/9e4;e.seek(n+188),71!=(r=e.la())&&(e.seek(n+192),r=e.la()),71!=r&&(e.seek(n+204),r=e.la()),71!=r&&t(),e.be(1)}}(p.data));case 4:if("application/mp4"!=i&&!i.startsWith("text/")){a.A(6);break}return T(a,ao(e,r),7);case 7:return m=a.o,a.return(function(e,t,n){return fn(e=Ze(e,t))?(pn(t=new dn(null),e),t.Rc(n)):0}(i,o,m.data));case 6:if("video/webm"==i)return a.return(null);throw new me(2,4,4030)}}))}))}(e,t,d,c,i,o),2);case 2:h=a.o,l.split("/").pop();for(var y=0;y<s.length;++y)f=s[y],m=u[u.length-1],v=0==y?h:m.endTime,g=ro(m,f,r+y,v),u.push(g);return e.L.push(u),io(e),a.return(u)}}))}))}function ao(e,t){return p((function n(){var r,i,o,a,s,u;return I(n,(function(n){switch(n.j){case 1:return r=1,i=Ti(t.c(),t.b,t.b+2048-1,e.a.retryParameters),o=Ti(t.c(),t.b,t.a,e.a.retryParameters),x(n,2),T(n,po(e,i,r),4);case 4:return a=n.o,n.return(a);case 2:if(7001==(s=j(n)).code)throw s;return X("Unable to fetch a partial HLS segment! Falling back to a full segment request, which is expensive!  Your server should support Range requests and CORS preflights.",i.uris[0]),T(n,po(e,o,r),5);case 5:return u=n.o,n.return(u)}}))}))}function so(e,t){for(var n=co[e],r=0;r<n.length;r++)for(var i=0;i<t.length;i++)if(n[r].test(t[i].trim()))return t[i].trim();return"text"==e?"":null}function uo(e,t){var n=e.getAttribute(t);if(!n)throw new me(2,4,4023,t);return n.value}function lo(e,t){var n=Bi.Ta(e,t);if(!n)throw new me(2,4,4024,t);return n}G("shaka.net.DataUriPlugin",Xi),Xi.parse=function(t){var n=t.split(":");if(2>n.length||"data"!=n[0])throw new me(2,1,1004,t);if(2>(n=n.slice(1).join(":").split(",")).length)throw new me(2,1,1004,t);var r=n[0];n=e.decodeURIComponent(n.slice(1).join(","));var i=null;if(1<(r=r.split(";")).length&&(i=r[1]),"base64"==i)t=ht.Aa(n).buffer;else{if(i)throw new me(2,1,1005,t);t=ut(n)}return{data:t,contentType:r[0]}},Ie("data",Xi),G("shaka.hls.HlsParser",Ji),(r=Ji.prototype).configure=function(e){this.a=e},r.start=function(e,t){var n=this;return p((function r(){var i,o;return I(r,(function(r){switch(r.j){case 1:return n.g=t,T(r,po(n,De([e],n.a.retryParameters),0),2);case 2:return i=r.o,n.v=i.uri,T(r,function(e,t){return p((function n(){var r,i,o,a,s,u,l,c,d,f,m;return I(n,(function(n){switch(n.j){case 1:if(0!=(r=zi(e.s,t,e.v)).type)throw new me(2,4,4022);return T(n,function(e,t){return p((function n(){var r,i,o,a,s,u,l,c,d,f,m,v;return I(n,(function(n){switch(n.j){case 1:return r=Bi,i=Ft,o=t.a,a=r.nb(t.a,"EXT-X-MEDIA"),s=a.filter(function(e){return"SUBTITLES"==uo(e,"TYPE")}.bind(e)),u=s.map(function(e){var t=this;return p((function n(){var r;return I(n,(function(n){switch(n.j){case 1:return t.a.disableText?n.return(null):(x(n,2),T(n,function(e,t){return p((function n(){var r;return I(n,(function(n){switch(n.j){case 1:return uo(t,"TYPE"),T(n,eo(e,t,[]),2);case 2:return r=n.o,n.return(r.stream)}}))}))}(t,e),4));case 4:return n.return(n.o);case 2:if(r=j(n),t.a.hls.ignoreTextStreamFailures)return n.return(null);throw r}}))}))}.bind(e)),l=a.filter((function(e){return"CLOSED-CAPTIONS"==uo(e,"TYPE")})),function(e,t){for(var n=h(t),r=n.next();!r.done;r=n.next()){uo(r=r.value,"TYPE");var i=Di(r,"LANGUAGE")||"und";i=Cn(i);var o=uo(r,"GROUP-ID");r=uo(r,"INSTREAM-ID"),e.l.get(o)||e.l.set(o,new Map),e.l.get(o).set(r,i)}}(e,l),T(n,Promise.all(u),2);case 2:return c=n.o,d=r.nb(o,"EXT-X-STREAM-INF"),f=d.map(function(e){return function(e,t,n){return p((function r(){var i,o,a,s,u,l,c,d,f,m,v,g,y,_,b,E,w,S,x,A,M,j,R,L,C,k,O;return I(r,(function(r){switch(r.j){case 1:return i=Ht,o=Bi,a=Di(t,"CODECS","avc1.42E01E,mp4a.40.2"),s=function(e){for(var t=new Set,n=[],r=(e=h(e)).next();!r.done;r=e.next()){var i=$e(r=r.value)[0];t.has(i)||(n.push(r),t.add(i))}return n}(a.split(/\s*,\s*/)),u=t.getAttribute("RESOLUTION"),c=l=null,d=Di(t,"FRAME-RATE"),f=Number(uo(t,"BANDWIDTH")),u&&(m=u.value.split("x"),l=m[0],c=m[1]),v=(v=(v=o.nb(n.a,"EXT-X-MEDIA")).filter((function(e){return"CLOSED-CAPTIONS"!=uo(e,"TYPE")}))).filter((function(e){var t=Di(e,"URI")||"";return"SUBTITLES"==(Di(e,"TYPE")||"")||""!=t})),g=Di(t,"AUDIO"),y=Di(t,"VIDEO"),g?v=o.Lc(v,"AUDIO",g):y&&(v=o.Lc(v,"VIDEO",y)),(_=so(i.qa,s))&&((b=Di(t,"SUBTITLES"))&&((E=o.Lc(v,"SUBTITLES",b)).length&&(w=e.D.get(E[0].id))&&(w.stream.codecs=_)),Re(s,_)),S=v.map(function(e){return eo(this,e,s)}.bind(e)),x=[],A=[],T(r,Promise.all(S),2);case 2:if(j=(j=r.o).filter((function(e){return null!=e})),g?x=j:y&&(A=j),L=!1,x.length||A.length?x.length?(k=uo(t,"URI"),O=x[0].xc,k==O?(R=i.Db,L=!0):R=i.Pa):R=i.Db:1==s.length?(C=so(i.Pa,s),R=u||d||C?i.Pa:i.Db):(R=i.Pa,s=[s.join(",")]),L){r.A(3);break}return T(r,function(e,t,n,r){return p((function i(){var o,a,s,u,l;return I(i,(function(i){switch(i.j){case 1:return o=Ht,a=uo(t,"URI"),e.b.has(a)?i.return(e.b.get(a)):(s=Di(t,"CLOSED-CAPTIONS"),u=null,r==o.Pa&&s&&"NONE"!=s&&(u=e.l.get(s)),T(i,to(e,a,n,r,"und",!1,null,null,u),2));case 2:return null==(l=i.o)?i.return(null):e.b.has(a)?i.return(e.b.get(a)):(e.b.set(a,l),i.return(l))}}))}))}(e,t,s,R),4);case 4:M=r.o;case 3:if(M)M.stream.type==i.Db?x=[M]:A=[M];else if(null===M)return r.return([]);return A&&$i(A),x&&$i(x),r.return(function(e,t,n,r,i,o,a){n.forEach(function(e){(e=e.stream)&&(e.width=Number(i)||void 0,e.height=Number(o)||void 0,e.frameRate=Number(a)||void 0)}.bind(e));var s=!!e.a&&e.a.disableAudio;t.length&&!s||(t=[null]);s=!!e.a&&e.a.disableVideo,(!n.length||s)&&(n=[null]);s=[];for(var u=(t=h(t)).next();!u.done;u=t.next()){u=u.value;for(var l=h(n),c=l.next();!c.done;c=l.next()){var d=c.value;c=u?u.stream:null;var f=d?d.stream:null,p=u?u.drmInfos:null,m=d?d.drmInfos:null;d=(d?d.xc:"")+" - "+(u?u.xc:"");var v=void 0;if(c&&f){if(p.length&&m.length&&!(0<Rt(p,m).length))continue;v=Rt(p,m)}else c?v=p:f&&(v=m);e.T.has(d)||(c=Qi(e,c,f,r,v),s.push(c),e.T.add(d))}}return s}(e,x,A,f,l,c,d))}}))}))}(this,e,t)}.bind(e)),T(n,Promise.all(f),3);case 3:return m=n.o,v=(v=m.reduce(i.Cc,[])).filter((function(e){return null!=e})),n.return({startTime:0,variants:v,textStreams:c.filter((function(e){return null!=e}))})}}))}))}(e,r),2);case 2:if(i=n.o,!e.g)throw new me(2,7,7001);if(e.W&&0==i.variants.length)throw new me(2,4,4034);e.g.filterAllPeriods([i]),o=1/0,a=0,s=1/0;for(var v=h(e.b.values()),g=v.next();!g.done;g=v.next())u=g.value,o=Math.min(o,u.Zc),a=Math.max(a,u.Zc),"text"!=u.stream.type&&(s=Math.min(s,u.duration));if(e.f!=go.Qa?(e.c=new wi(0,3*e.C),e.c.Vb(!1)):(e.c=new wi(null,0),e.c.Vb(!0)),io(e),e.f!=go.Qa){for(e.R=e.F,l=go,e.f==l.zd&&(c=e.c.rc,isNaN(e.a.availabilityWindowOverride)||(c=e.a.availabilityWindowOverride),e.c.sd(c)),d=0;95443.7176888889<=a;)d+=95443.7176888889,a-=95443.7176888889;if(d)for(g=(v=h(e.b.values())).next();!g.done;g=v.next())95443.7176888889>(f=g.value).Zc&&(f.stream.presentationTimeOffset=-d,f.Tb.offset(d))}else for(e.c.wa(s),e.c.offset(-o),g=(v=h(e.b.values())).next();!g.done;g=v.next())(m=g.value).stream.presentationTimeOffset=o,m.Tb.offset(-o),ai(m.Tb,s);e.m={presentationTimeline:e.c,periods:[i],offlineSessionIds:[],minBufferTime:0},S(n)}}))}))}(n,i.data),3);case 3:return 0<(o=n.R)&&n.h.P(o),r.return(n.m)}}))}))},r.stop=function(){this.h&&(this.h.stop(),this.h=null);var e=[];return this.i&&(e.push(this.i.destroy()),this.i=null),this.a=this.g=null,this.D.clear(),this.T.clear(),this.b.clear(),this.m=null,Promise.all(e)},r.update=function(){if(this.f!=go.Qa){for(var e=[],t=h(this.b.values()),n=t.next();!n.done;n=t.next())e.push(Zi(this,n.value));return Promise.all(e)}},r.onExpirationUpdated=function(){};var co={audio:[/^vorbis$/,/^opus$/,/^flac$/,/^mp4a/,/^[ae]c-3$/],video:[/^avc/,/^hev/,/^hvc/,/^vp0?[89]/,/^av1$/],text:[/^vtt$/,/^wvtt/,/^stpp/]},ho={audio:{mp4:"audio/mp4",m4s:"audio/mp4",m4i:"audio/mp4",m4a:"audio/mp4",ts:"video/mp2t"},video:{mp4:"video/mp4",m4s:"video/mp4",m4i:"video/mp4",m4v:"video/mp4",ts:"video/mp2t"},text:{mp4:"application/mp4",m4s:"application/mp4",m4i:"application/mp4",vtt:"text/vtt",ttml:"application/ttml+xml"}};function fo(e,t){e.f=t,e.c&&e.c.Vb(e.f==go.Qa),e.f!=go.Qa||e.h.stop()}function po(e,t,n){if(!e.i)throw new me(2,7,7001);return t=e.g.networkingEngine.request(n,t),ke(e.i,t),t.promise}var mo={"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":function(e){var t=uo(e,"METHOD");return $n("HLS SAMPLE-AES-CENC","SAMPLE-AES-CENC will no longer be supported, see Issue #1227"),["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].includes(t)?(t=uo(e,"URI"),t=Xi.parse(t),t=Gt("com.widevine.alpha",[{initDataType:"cenc",initData:t=new Uint8Array(t.data)}]),(e=Di(e,"KEYID"))&&(t.keyIds=[e.substr(2).toLowerCase()]),t):null}},vo="VOD",go={Qa:vo,me:"EVENT",zd:"LIVE"};function yo(){this.a=new Map}function _o(e,t,n){bo(e,t).text=n}function bo(e,t){return e.a.has(t)||e.a.set(t,new Eo),e.a.get(t)}function Eo(){this.text=this.variant=null}function wo(e,t){this.a=e,this.b=new Set([e]);for(var n=h(t=t||[]),r=n.next();!r.done;r=n.next())this.add(r.value)}function To(e,t){var n;if(!(n=!!e.audio!=!!t.audio||!!e.video!=!!t.video||e.language!=t.language)&&(n=e.audio&&t.audio)){n=e.audio;var r=t.audio;n=!(n.channelsCount==r.channelsCount&&So(n,r)&&xo(n.roles,r.roles))}return!n&&(n=e.video&&t.video)&&(n=!(So(n=e.video,r=t.video)&&xo(n.roles,r.roles))),!n}function So(e,t){if(e.mimeType!=t.mimeType)return!1;var n=e.codecs.split(",").map((function(e){return $e(e)[0]})),r=t.codecs.split(",").map((function(e){return $e(e)[0]}));if(n.length!=r.length)return!1;n.sort(),r.sort();for(var i=0;i<n.length;i++)if(n[i]!=r[i])return!1;return!0}function xo(e,t){var n=new Set(e),r=new Set(t);if(n.delete("main"),r.delete("main"),n.size!=r.size)return!1;for(var i=(n=h(n)).next();!i.done;i=n.next())if(!r.has(i.value))return!1;return!0}function Ao(e){this.a=e,this.b=new Mo(e.language,"",e.audio&&e.audio.channelsCount?e.audio.channelsCount:0,"")}function Mo(e,t,n,r){this.f=e,this.c=t,this.a=n,this.b=void 0===r?"":r}function jo(){this.a=Co,this.b=(new Map).set(Co,2).set(Lo,1)}function Ro(e,t,n){e.b.set(Co,n).set(Lo,t)}Ei.kd("m3u8",Ji),Ei.Bb("application/x-mpegurl",Ji),Ei.Bb("application/vnd.apple.mpegurl",Ji),wo.prototype.add=function(e){return!!To(this.a,e)&&(this.b.add(e),!0)},wo.prototype.values=function(){return this.b.values()},Ao.prototype.create=function(e){var t=this,n=e.filter((function(e){return To(t.a,e)}));return n.length?new wo(n[0],n):this.b.create(e)},Mo.prototype.create=function(e){var t=[];t=function(e,t){var n=On(Cn(t),e.map((function(e){return kn(e)})));return n?e.filter((function(e){return n==kn(e)})):[]}(e,this.f);var n=e.filter((function(e){return e.primary}));for(t=t.length?t:n.length?n:e,this.c&&((e=function(e,t){return e.filter((function(e){var n=e.audio;return e=e.video,n&&0<=n.roles.indexOf(t)||e&&0<=e.roles.indexOf(t)}))}(t,this.c)).length&&(t=e)),this.a&&((e=Wn(t,this.a)).length&&(t=e)),this.b&&((e=function(e,t){return e.filter((function(e){return!!e.audio&&e.audio.label.toLowerCase()==t.toLowerCase()}))}(t,this.b)).length&&(t=e)),e=new wo(t[0]),n=(t=h(t)).next();!n.done;n=t.next())n=n.value,To(e.a,n)&&e.add(n);return e};var Lo=0,Co=1;function ko(e,t){this.g=e,this.h=Po(e),this.a=e.a.currentTime,this.f=Date.now()/1e3,this.b=!1,this.i=t,this.c=function(){}}function Oo(e){this.a=e}function Po(e){if(e.a.paused||0==e.a.playbackRate||null==e.a.buffered)var t=!1;else e:{t=e.a.buffered,e=e.a.currentTime;for(var n=0;n<t.length;n++){var r=t.start(n),i=t.end(n);if(!(e<r||e>i-.5)){t=!0;break e}}t=!1}return t}function Io(e,t,n,r,i){var o=this;this.a=e,this.v=t,this.s=n,this.l=i,this.f=new He,this.i=!1,this.m=e.readyState,this.c=!1,this.b=r,this.h=!1,this.f.w(e,"waiting",(function(){return Do(o)})),this.g=new he((function(){Do(o)})).Na(.25)}function Do(e){if(0!=e.a.readyState){if(e.a.seeking){if(!e.i)return}else e.i=!1;if(!e.a.paused){e.a.readyState!=e.m&&(e.c=!1,e.m=e.a.readyState);var t=e.s.smallGapLimit,n=e.a.currentTime,r=e.a.buffered;e:{if(r&&r.length&&!(1==r.length&&1e-6>r.end(0)-r.start(0)))for(var i=nt("Edge/")||nt("Trident/")||nt("Tizen")||nt("CrKey")?.5:.1,o=0;o<r.length;o++)if(r.start(o)>n&&(0==o||r.end(o-1)-n<=i)){i=o;break e}i=null}if(null==i)e.b&&(n=Po(r=(e=e.b).g),i=r.a.currentTime,o=Date.now()/1e3,e.a==i&&e.h==n||(e.f=o,e.a=i,e.h=n,e.b=!1),(i=o-e.f)>=e.i&&n&&!e.b&&(e.c(e.a,i),e.b=!0,e.a=r.a.currentTime));else if(0!=i||e.h){o=r.start(i);var a=e.v.Ba();if(!(o>=a)){t=(a=o-n)<=t;var s=!1;.001>a||(t||e.c||(e.c=!0,(n=new Se("largegap",{currentTime:n,gapSize:a})).cancelable=!0,e.l(n),e.s.jumpLargeGaps&&!n.defaultPrevented&&(s=!0)),!t&&!s)||(0!=i&&r.end(i-1),e.a.currentTime=o)}}}}}function No(e){var t=this;this.c=e,this.a=new Set,this.b=new he((function(){Bo(t,!1)})).Na(.25)}function Bo(e,t){for(var n=h(e.a),r=n.next();!r.done;r=n.next())r.value.g(e.c.currentTime,t)}function Uo(e){for(var t=[],n=(e=h(e)).next();!n.done;n=e.next())for(var r=(n=h(n.value.variants)).next();!r.done;r=n.next())t.push(r.value);return t}function Fo(e,t){for(var n=null,r=h(e),i=r.next();!i.done;i=r.next())t>=(i=i.value).startTime&&(n=i);return n}function Vo(e){this.c=e,this.a=null,this.b=function(){}}function Go(e){var t=this;this.a=e,this.f=!1,this.c=this.a.gc(),this.b=new he((function(){t.a.Ld(.25*t.c)}))}function Ho(e){e.b.stop();var t=e.f?0:e.c;if(0<=t)try{return void(e.a.gc()!=t&&e.a.rd(t))}catch(e){}e.b.Na(.25),0!=e.a.gc()&&e.a.rd(0)}function zo(e,t,n){this.a=e,this.f=t,this.g=n,this.h=!1,this.b=new He,this.c=new Xo(e),0<e.readyState?Ko(this,n):qo(this,n)}function Wo(e){return e.h?e.a.currentTime:e.g}function qo(e,t){e.g=t,e.b.ea(e.a,"loadedmetadata"),e.b.da(e.a,"loadedmetadata",(function(){Ko(e,t)}))}function Ko(e,t){.001>Math.abs(e.a.currentTime-t)?Yo(e):(e.b.da(e.a,"seeking",(function(){Yo(e)})),Jo(e.c,0==e.a.currentTime?t:e.a.currentTime))}function Yo(e){e.h=!0,e.b.w(e.a,"seeking",(function(){return e.f()}))}function Xo(e){var t=this;this.b=e,this.h=10,this.g=this.f=this.c=0,this.a=new he((function(){0>=t.c||t.b.currentTime!=t.f?t.a.stop():(t.b.currentTime=t.g,t.c--)}))}function Jo(e,t){e.f=e.b.currentTime,e.g=t,e.c=e.h,e.b.currentTime=t,e.a.Na(.1)}function Zo(e){function t(){null==n.c?n.f=!0:(n.b.da(n.a,"seeking",(function(){n.f=!0})),n.a.currentTime=n.c)}var n=this;this.a=e,this.f=!1,this.c=null,this.b=new He,0==this.a.readyState?this.b.da(this.a,"loadedmetadata",t):t()}function $o(e,t,n,r,i,o){var a=this;this.b=e,this.a=t.presentationTimeline,this.C=t.minBufferTime||0,this.g=n,this.v=i,this.l=null,this.f=new Io(e,t.presentationTimeline,n,function(e,t){if(!t.stallEnabled)return null;var n=t.stallSkip,r=new ko(new Oo(e),t.stallThreshold);return function(e,t){e.c=t}(r,(function(){e.currentTime+=n})),r}(e,n),o),this.c=new zo(e,(function(){var e=a.f;e.i=!0,e.h=!1,e.c=!1;var t=Wo(a.c);return e=ea(a,t),.001<Math.abs(e-t)&&(t=(new Date).getTime()/1e3,!a.l||a.l<t-1)?(a.l=t,0<(t=a.c).a.readyState?Jo(t.c,e):qo(t,e),e=void 0):(a.v(),e=void 0),e}),function(e,t){return null==t?t=1/0>e.a.Y()?e.a.ob():e.a.Ba():0>t&&(t=e.a.Ba()+t),Qo(e,ta(e,t))}(this,r)),this.i=new he((function(){if(0!=a.b.readyState&&!a.b.paused){var e=a.b.currentTime,t=a.a.ob(),n=a.a.Ba();3>n-t&&(t=n-3),e<t&&(e=ea(a,e),a.b.currentTime=e)}})).Na(.25)}function Qo(e,t){var n=e.a.Y();return t>=n?n-e.g.durationBackoff:t}function ea(e,t){var n=Nt.bind(null,e.b.buffered),r=Math.max(e.C,e.g.rebufferingGoal),i=e.g.safeSeekOffset,o=e.a.ob(),a=e.a.Ba(),s=e.a.Y();3>a-o&&(o=a-3);var u=e.a.Lb(r),l=e.a.Lb(i);return r=e.a.Lb(r+i),t>=s?Qo(e,t):t>a?a:t<o?n(l)?l:r:t>=u||n(t)?t:r}function ta(e,t){var n=e.a.ob();return t<n||t>(n=e.a.Ba())?n:t}function na(){this.b=function(){},this.a=new Set}function ra(e){var t=this;this.h=e,this.f=new Map,this.a=function(){},this.b=function(){},this.c=function(){},this.i=[{eb:null,cb:oa,Wa:function(e,n){return t.a(e,n)}},{eb:ia,cb:oa,Wa:function(e,n){return t.a(e,n)}},{eb:aa,cb:oa,Wa:function(e,n){return t.a(e,n)}},{eb:oa,cb:ia,Wa:function(e,n){return t.b(e,n)}},{eb:oa,cb:aa,Wa:function(e,n){return t.b(e,n)}},{eb:ia,cb:aa,Wa:function(e,n){return t.c(e,n)}},{eb:aa,cb:ia,Wa:function(e,n){return t.c(e,n)}}]}ko.prototype.release=function(){this.g=null,this.c=function(){}},Io.prototype.release=function(){this.f&&(this.f.release(),this.f=null),null!=this.g&&(this.g.stop(),this.g=null),this.b&&(this.b.release(),this.b=null),this.a=this.v=this.l=null},Io.prototype.dd=function(){this.h=!0,Do(this)},No.prototype.release=function(){this.b.stop();for(var e=h(this.a),t=e.next();!t.done;t=e.next())t.value.release();this.a.clear()},Vo.prototype.release=function(){this.a=this.c=null,this.b=function(){}},Vo.prototype.g=function(e){var t=this.a,n=this.c.periods;t!=(e=Fo(n,e)||n[0])&&this.b(e),this.a=e},Go.prototype.release=function(){this.b&&(this.b.stop(),this.b=null),this.a=null},Go.prototype.set=function(e){this.c=e,Ho(this)},zo.prototype.release=function(){this.b&&(this.b.release(),this.b=null),null!=this.c&&(this.c.release(),this.c=null),this.f=function(){},this.a=null},Xo.prototype.release=function(){this.a&&(this.a.stop(),this.a=null),this.b=null},Zo.prototype.release=function(){this.b&&(this.b.release(),this.b=null),this.a=null},Zo.prototype.m=function(e){this.c=this.f?this.c:e},Zo.prototype.h=function(){return(this.f?this.a.currentTime:this.c)||0},Zo.prototype.s=function(){},$o.prototype.release=function(){this.c&&(this.c.release(),this.c=null),this.f&&(this.f.release(),this.f=null),this.i&&(this.i.stop(),this.i=null),this.b=this.c=this.a=this.g=null,this.v=function(){}},$o.prototype.m=function(e){var t=this.c;0<t.a.readyState?Jo(t.c,e):qo(t,e)},$o.prototype.h=function(){var e=Wo(this.c);return 0<this.b.readyState&&!this.b.paused?ta(this,e):e},$o.prototype.s=function(){this.f.dd()},na.prototype.release=function(){this.b=function(){},this.a.clear()},ra.prototype.release=function(){this.h=null,this.f.clear(),this.a=function(){},this.b=function(){},this.c=function(){}},ra.prototype.g=function(e,t){for(var n=h(this.h.a),r=n.next();!r.done;r=n.next()){r=r.value;var i=this.f.get(r),o=e<r.startTime?ia:e>r.endTime?aa:oa;this.f.set(r,o);for(var a=h(this.i),s=a.next();!s.done;s=a.next())(s=s.value).eb==i&&s.cb==o&&s.Wa(r,t)}};var ia=1,oa=2,aa=3;function sa(e,t){this.a=t,this.c=e,this.g=null,this.l=1,this.v=Promise.resolve(),this.h=[],this.i=new Map,this.b=new Map,this.s=!1,this.F=null,this.D=this.f=this.m=!1,this.C=0}function ua(e){return ca(e,"audio")}function la(e){return ca(e,"video")}function ca(e,t){var n=e.b.get(t);return n?n.Ka||n.stream:null}function da(e,t){return p((function n(){var r,i,o,a,s,u,l,c,d;return I(n,(function(n){switch(n.j){case 1:return r=Ht,T(n,xn(e.a.K,r.qa),2);case 2:return e.C++,e.D=!1,i=e.C,o=e.a.K,a=new Map,s=new Set,a.set(r.qa,t),s.add(t),T(n,o.init(a,!1),3);case 3:return e.f?n.return():T(n,_a(e,s),4);case 4:if(e.f)return n.return();u=e.a.K.g.isTextVisible()||e.g.alwaysStreamText,e.C!=i||e.b.has(r.qa)||e.D||!u||(l=e.a.Ua(),c=Aa(e,l),d=ga(t,c,0),e.b.set(r.qa,d),La(e,d,0)),S(n)}}))}))}function ha(e,t){var n=e.b.get("video");if(n){var r=n.stream;if(r)if(t){var i=r.trickModeVideo;i&&!n.Ka&&(pa(e,i,!1,0,!1),n.Ka=r)}else(r=n.Ka)&&(n.Ka=null,pa(e,r,!0,0,!1))}}function fa(e,t,n,r){t.video&&pa(e,t.video,n,r,!1),t.audio&&pa(e,t.audio,n,r,!1)}function pa(e,t,n,r,i){var o=e.b.get(t.type);if(!o&&"text"==t.type&&e.g.ignoreTextStreamFailures)da(e,t);else if(o){var a=Ma(e,t),s=Array.from(e.b.values()).every((function(e){return e.ia==o.ia}));n&&a!=o.ia&&s?e.b.forEach((function(t){ma(e,t)})):(o.Ka&&(t.trickModeVideo?(o.Ka=t,t=t.trickModeVideo):o.Ka=null),(s=e.h[a])&&s.Cb&&(s=e.i.get(t.id))&&s.Cb&&(o.stream!=t||i)&&("text"==t.type&&_n(e.a.K,Ze(t.mimeType,t.codecs)),o.stream=t,o.jc=!0,function(e,t,n){if(!t.Pb)return!1;var r=e.a.Ua(),i=wn(e.a.K,t.type);if(null==(n=(n=wa(e,t,r,i,n))&&n.a?n.a-n.b:null))return!1;var o=t.stream.initSegmentReference;return o&&(n+=(o.a?o.a-o.b:null)||0),o=e.a.getBandwidthEstimate(),8*n/o<i-r-Math.max(e.c.minBufferTime||0,e.g.rebufferingGoal)||t.Pb.b.a>n}(e,o,a)&&o.Pb.abort(),n&&(o.Ra?o.yc=!0:o.Ja?(o.Oa=!0,o.bc=r,o.yc=!0):(Ca(o),Ra(e,o,!0,r).catch((function(t){e.a&&e.a.onError(t)}))))))}}function ma(e,t){t.Ra||t.Oa||(t.Ja?(t.Oa=!0,t.bc=0):null==En(e.a.K,t.type)?null==t.Fa&&La(e,t,0):(Ca(t),Ra(e,t,!1,0).catch((function(t){e.a&&e.a.onError(t)}))))}function va(e,t,n,r,i){return p((function o(){var a,s,u,l,c,d,h;return I(o,(function(o){switch(o.j){case 1:return a=e.a.Ua(),s=Aa(e,a),u=Ht,l=new Map,c=new Set,t&&(l.set(u.Db,t),c.add(t)),n&&(l.set(u.Pa,n),c.add(n)),r&&(l.set(u.qa,r),c.add(r)),d=e.a.K,h=e.g.forceTransmuxTS,T(o,d.init(l,h),2);case 2:return e.f?o.return():(function(e){var t=e.c.presentationTimeline.Y();1/0>t?e.a.K.wa(t):e.a.K.wa(Math.pow(2,32))}(e),T(o,_a(e,c),3));case 3:if(e.f)return o.return();l.forEach((function(t,n){if(!e.b.has(n)){var r=ga(t,s,i);e.b.set(n,r),La(e,r,0)}})),S(o)}}))}))}function ga(e,t,n){return{stream:e,type:e.type,rb:null,Ca:null,Ka:null,jc:!0,ia:t,endOfStream:!1,Ja:!1,Fa:null,Oa:!1,bc:0,yc:!1,Ra:!1,jd:!1,Nb:!1,md:n||0,Pb:null}}function ya(e,t){var n=e.h[t];if(n)return n.promise;n={promise:new ve,Cb:!1},e.h[t]=n;for(var r=new Set,i=h(e.c.periods[t].variants),o=i.next();!o.done;o=i.next())(o=o.value).video&&r.add(o.video),o.video&&o.video.trickModeVideo&&r.add(o.video.trickModeVideo),o.audio&&r.add(o.audio);for(o=(i=h(e.c.periods[t].textStreams)).next();!o.done;o=i.next())r.add(o.value);return e.v=e.v.then(function(){if(!this.f)return _a(this,r)}.bind(e)).then(function(){this.f||(this.h[t].promise.resolve(),this.h[t].Cb=!0)}.bind(e)).catch(function(e){this.f||(this.h[t].promise.catch((function(){})),this.h[t].promise.reject(),delete this.h[t],this.a.onError(e))}.bind(e)),n.promise}function _a(e,t){return p((function n(){var r,i,o,a,s,u,l;return I(n,(function(n){switch(n.j){case 1:r=[];for(var c=h(t),d=c.next();!d.done;d=c.next())i=d.value,(o=e.i.get(i.id))?r.push(o.promise):(e.i.set(i.id,{promise:new ve,Cb:!1}),r.push(i.createSegmentIndex()));return x(n,2),T(n,Promise.all(r),4);case 4:if(e.f)return n.return();M(n,3);break;case 2:if(a=j(n),e.f)return n.return();for(d=(n=h(t)).next();!d.done;d=n.next())s=d.value,e.i.get(s.id).promise.catch((function(){})),e.i.get(s.id).promise.reject(),e.i.delete(s.id);throw a;case 3:for(d=(c=h(t)).next();!d.done;d=c.next())u=d.value,(l=e.i.get(u.id)).Cb||(l.promise.resolve(),l.Cb=!0);S(n)}}))}))}function ba(e,t){if(!e.f&&!t.Ja&&null!=t.Fa&&!t.Ra)if(t.Fa=null,t.Oa)Ra(e,t,t.yc,t.bc);else{try{var n=function(e,t){if(Sa(t))return e.a.K.tc(t.stream.originalId||""),null;var n=e.a.Ua(),r=Ea(e,t,n),i=Ma(e,t.stream),o=Aa(e,r),a=function(e,t,n){return"text"==t?null==(e=e.a).b||e.b<n?0:e.b-Math.max(n,e.a):Bt(e=Tn(e,t),n)}(e.a.K,t.type,n),s=Math.max(e.c.minBufferTime||0,e.g.rebufferingGoal,e.g.bufferingGoal)*e.l;if(r>=e.c.presentationTimeline.Y())return t.endOfStream=!0,"video"==t.type&&(r=e.b.get("text"))&&"application/cea-608"==r.stream.mimeType&&(r.endOfStream=!0),null;if(t.endOfStream=!1,t.ia=o,o!=i)return null;if(a>=s)return.5;if(o=wn(e.a.K,t.type),!(o=wa(e,t,n,o,i)))return 1;var u=1/0;return Array.from(e.b.values()).forEach((function(t){Sa(t)||(t=Ea(e,t,n),u=Math.min(u,t))})),r>=u+e.c.presentationTimeline.a?1:(t.md=0,function(e,t,n,r,i){var o=e.c.periods[r],a=t.stream,s=e.c.presentationTimeline.Y(),u=e.c.periods[r+1];r=function(e,t,n,r,i){return t.jc?(n=function(e,t,n,r,i){return"text"==t?(e.a.m=n,(e=e.a).f=r,e.h=i,Promise.resolve()):Promise.all([An(e,t,e.qe.bind(e,t)),An(e,t,e.Xf.bind(e,t,n)),An(e,t,e.Uf.bind(e,t,r,i))])}(e.a.K,t.type,e.c.periods[n].startTime-t.stream.presentationTimeOffset,r,i),t.stream.initSegmentReference?(e=ja(e,t,t.stream.initSegmentReference).then(function(e){if(!this.f)return Sn(this.a.K,t.type,e,null,null,t.stream.closedCaptions&&0<t.stream.closedCaptions.size)}.bind(e)).catch((function(e){return t.jc=!0,Promise.reject(e)})),Promise.all([n,e])):n):Promise.resolve()}(e,t,r,Math.max(0,o.startTime-.1),u?u.startTime+.01:s),t.Ja=!0,t.jc=!1,s=ja(e,t,i),Promise.all([r,s]).then(function(e){if(!this.f&&!this.m)return function(e,t,n,r,i,o,a){var s=i.closedCaptions&&0<i.closedCaptions.size;return null!=i.emsgSchemeIdUris&&0<i.emsgSchemeIdUris.length&&(new Br).fa("emsg",e.L.bind(e,r,o,i.emsgSchemeIdUris)).parse(a),function(e,t,n){var r=Math.max(e.g.bufferBehind,e.c.presentationTimeline.a),i=En(e.a.K,t.type);return null==i||0>=(n=n-i-r)?Promise.resolve():e.a.K.remove(t.type,i,i+n).then(function(){}.bind(e))}(e,t,n).then(function(){if(!this.f)return Sn(this.a.K,t.type,a,o.startTime+r.startTime,o.endTime+r.startTime,s)}.bind(e)).then(function(){if(!this.f)return t.rb=i,t.Ca=o,Promise.resolve()}.bind(e))}(this,t,n,o,a,i,e[1])}.bind(e)).then(function(){this.f||this.m||(t.Ja=!1,t.jd=!1,t.Oa||this.a.dd(),La(this,t,0),function(e,t){if(!e.s){var n=Array.from(e.b.values());if(1==n.length&&"text"==n[0].type||(e.s=n.every((function(e){return"text"==e.type||!e.Oa&&!e.Ra&&e.Ca}))),e.s){for(n=Ma(e,t),e.h[n]||ya(e,n).then(function(){this.f||this.a.Nd()}.bind(e)).catch(Ft.kc),n=0;n<e.c.periods.length;++n)ya(e,n).catch(Ft.kc);e.a.wf&&e.a.wf()}}}(this,a))}.bind(e)).catch(function(e){this.f||this.m||(t.Ja=!1,"text"==t.type&&this.g.ignoreTextStreamFailures?this.b.delete("text"):7001==e.code?(t.Ja=!1,t.Fa=null,La(this,t,0)):3017==e.code?function(e,t,n){if(!Array.from(e.b.values()).some((function(e){return e!=t&&e.jd}))){var r=Math.round(100*e.l);if(20<r)e.l-=.2;else{if(!(4<r))return t.Nb=!0,e.m=!0,void e.a.onError(n);e.l-=.04}t.jd=!0}La(e,t,4)}(this,t,e):(t.Nb=!0,e.severity=2,ka(this,e)))}.bind(e))}(e,t,n,i,o),null)}(e,t);null!=n&&(La(e,t,n),t.Nb=!1)}catch(t){return void ka(e,t)}n=Array.from(e.b.values()),function(e,t){var n=Ma(e,t.stream);if(t.ia!=n){var r=t.ia,i=Array.from(e.b.values());i.every((function(e){return e.ia==r||Sa(e)}))&&i.every(xa)&&ya(e,r).then(function(){if(!this.f&&i.every(function(e){var t=xa(e),n=Ma(this,e.stream);return!!Sa(e)||t&&e.ia==r&&n!=r}.bind(this))){var e=this.c.periods[r],t=this.a.Od(e),n=new Map;t.variant&&t.variant.video&&n.set("video",t.variant.video),t.variant&&t.variant.audio&&n.set("audio",t.variant.audio),t.text&&n.set("text",t.text);for(var o=(t=h(this.b.keys())).next();!o.done;o=t.next())if(o=o.value,!n.has(o)&&"text"!=o)return void this.a.onError(new me(2,5,5005));for(o=(t=h(Array.from(n.keys()))).next();!o.done;o=t.next())if(o=o.value,!this.b.has(o)){if("text"!=o)return void this.a.onError(new me(2,5,5005));va(this,null,null,n.get("text"),e.startTime),n.delete(o)}for(o=(t=h(Array.from(this.b.keys()))).next();!o.done;o=t.next()){o=o.value;var a=this.b.get(o),s=n.get(o);if(s){var u=Sa(a);u&&(a.ia=r,a.md=e.startTime),pa(this,s,!1,0,!1),u&&Sa(a)||La(this,this.b.get(o),0)}else this.b.delete(o)}this.a.Nd()}}.bind(e)).catch(Ft.kc)}}(e,t),e.s&&n.every((function(e){return e.endOfStream}))&&e.a.K.endOfStream().then(function(){if(!this.f){var e=this.a.K.Y();0!=e&&e<this.c.presentationTimeline.Y()&&this.c.presentationTimeline.wa(e)}}.bind(e))}}function Ea(e,t,n){return t.rb&&t.Ca?(n=Ma(e,t.rb),e.c.periods[n].startTime+t.Ca.endTime):Math.max(n,t.md)}function wa(e,t,n,r,i){if(t.Ca&&t.stream==t.rb)return Ta(e,t,i,t.Ca.position+1);if(t.Ca?(n=Ma(e,t.rb),n=t.stream.findSegmentPosition(Math.max(0,e.c.periods[n].startTime+t.Ca.endTime-e.c.periods[i].startTime))):n=t.stream.findSegmentPosition(Math.max(0,(r||n)-e.c.periods[i].startTime)),null==n)return null;var o=null;return null==r&&(o=Ta(e,t,i,Math.max(0,n-1))),o||Ta(e,t,i,n)}function Ta(e,t,n,r){return n=e.c.periods[n],(t=t.stream.getSegmentReference(r))?(e=(r=e.c.presentationTimeline).Mb(),r=r.pb(),n.startTime+t.endTime<e||n.startTime+t.startTime>r?null:t):null}function Sa(e){return e&&"text"==e.type&&"application/cea-608"==e.stream.mimeType}function xa(e){return!e.Ja&&null==e.Fa&&!e.Oa&&!e.Ra}function Aa(e,t){var n=Fo(e.c.periods,t+1/15);return n?e.c.periods.indexOf(n):0}function Ma(e,t){for(var n=e.c.periods,r=0;r<n.length;r++){for(var i=n[r],o=new Set,a=h(i.variants),s=a.next();!s.done;s=a.next())(s=s.value).audio&&o.add(s.audio),s.video&&o.add(s.video),s.video&&s.video.trickModeVideo&&o.add(s.video.trickModeVideo);for(a=(i=h(i.textStreams)).next();!a.done;a=i.next())o.add(a.value);if(o.has(t))return r}return-1}function ja(e,t,n){return n=Ti(n.c(),n.b,n.a,e.g.retryParameters),e=e.a.tb.request(1,n),t.Pb=e,e.promise.then((function(e){return t.Pb=null,e.data}))}function Ra(e,t,n,r){return p((function i(){var o,a,s;return I(i,(function(i){switch(i.j){case 1:return t.Oa=!1,t.yc=!1,t.bc=0,t.Ra=!0,r?(a=e.a.Ua(),s=e.a.K.Y(),o=e.a.K.remove(t.type,a+r,s)):o=xn(e.a.K,t.type).then(function(){if(!this.f&&n)return this.a.K.flush(t.type)}.bind(e)),T(i,o,2);case 2:if(e.f)return i.return();t.rb=null,t.Ca=null,t.Ra=!1,t.endOfStream=!1,La(e,t,0),S(i)}}))}))}function La(e,t,n){t.Fa=new de((function(){return p((function n(){var r;return I(n,(function(n){switch(n.j){case 1:return x(n,2),T(n,ba(e,t),4);case 4:M(n,0);break;case 2:r=j(n),e.a&&e.a.onError(r),S(n)}}))}))})).P(n)}function Ca(e){null!=e.Fa&&(e.Fa.stop(),e.Fa=null)}function ka(e,t){pe(e.F).then(function(){this.f||(this.a.onError(t),t.handled||this.g.failureCallback(t))}.bind(e))}function Oa(e,t,n,r,i,o){if(200<=n&&299>=n&&202!=n)return{uri:i||r,fd:r,data:t,headers:e,fromCache:!!e["x-shaka-from-cache"]};i=null;try{i=st(t)}catch(e){}throw new me(401==n||403==n?2:1,1,1001,r,n,i,e,o)}function Pa(e,t,n,r){var i=new Pa.b;Xe(t.headers).forEach((function(e,t){i.append(t,e)}));var o=new Pa.a,a={Ad:!1,ie:!1};if(e=new ge(e=Pa.l(e,n,{body:t.body||void 0,headers:i,method:t.method,signal:o.signal,credentials:t.allowCrossSiteCredentials?"include":void 0},a,r),(function(){return a.Ad=!0,o.abort(),Promise.resolve()})),t=t.retryParameters.timeout){var s=new he((function(){a.ie=!0,o.abort()}));s.P(t/1e3),e.finally((function(){s.stop()}))}return e}function Ia(e,t,n,r){var i=new Ia.f,o=Date.now(),a=0;return new ge(new Promise((function(s,u){for(var l in i.open(t.method,e,!0),i.responseType="arraybuffer",i.timeout=t.retryParameters.timeout,i.withCredentials=t.allowCrossSiteCredentials,i.onabort=function(){u(new me(1,1,7001,e,n))},i.onload=function(t){for(var r=(t=t.target).getAllResponseHeaders().trim().split("\r\n"),i={},o=(r=h(r)).next();!o.done;o=r.next())i[(o=o.value.split(": "))[0].toLowerCase()]=o.slice(1).join(": ");try{var a=Oa(i,t.response,t.status,e,t.responseURL,n);s(a)}catch(e){u(e)}},i.onerror=function(t){u(new me(1,1,1002,e,t,n))},i.ontimeout=function(){u(new me(1,1,1003,e,n))},i.onprogress=function(e){var t=Date.now();(100<t-o||e.lengthComputable&&e.loaded==e.total)&&(r(t-o,e.loaded-a,e.total-e.loaded),a=e.loaded,o=t)},t.headers)i.setRequestHeader(l.toLowerCase(),t.headers[l]);i.send(t.body)})),(function(){return i.abort(),Promise.resolve()}))}function Da(){this.a=this.f=this.b=0,this.c=new Map,this.g=0}function Na(e,t,n){this.h=e,this.b=new Map,this.c=!1,this.g=t,this.f=n,this.a=new Da}function Ba(e,t,n,r,i,o){var a=function(e,t){e.b+=t;var n=e.g;return e.g++,e.c.set(n,t),n}(e.a,r);r=e.b.get(t)||Promise.resolve(),e.b.set(t,r.then((function(){return p((function t(){var r,s,u;return I(t,(function(t){switch(t.j){case 1:return T(t,function(e,t){return p((function n(){var r;return I(n,(function(n){switch(n.j){case 1:return T(n,e.h.request(1,t).promise,2);case 2:return r=n.o,n.return(r.data)}}))}))}(e,n),2);case 2:if(r=t.o,e.c)throw new me(2,9,7001);if(i){s=new Uint8Array(r);for(var l=h(new zr(s).data),c=l.next();!c.done;c=l.next())u=c.value,e.f(u)}return e.a.close(a,r.byteLength),l=e.a,e.g(0==l.b?0:l.f/l.b,e.a.a),t.return(o(r))}}))}))})))}function Ua(e,t){var n=this;this.c=e,this.b=e.objectStore(t),this.a=new ve,e.onabort=function(e){e.preventDefault(),n.a.reject()},e.onerror=function(e){e.preventDefault(),n.a.reject()},e.oncomplete=function(){n.a.resolve()}}function Fa(e,t){return new Promise((function(n,r){var i=e.b.openCursor();i.onerror=r,i.onsuccess=function(e){if(!(e=e.target.result))return n();t(e.key,e.value,e),e.continue()}}))}function Va(e){this.b=e,this.a=[]}function Ga(e,t){return za(e,t,"readonly")}function Ha(e,t){return za(e,t,"readwrite")}function za(e,t,n){var r=new Ua(n=e.b.transaction([t],n),t);return e.a.push(r),r.promise().then((function(){Re(e.a,r)}),(function(){Re(e.a,r)})),r}function Wa(e){this.a=new Va(e)}function qa(){this.a=new Map}function Ka(e,t,n){if(!(e=e.a.get(t)))throw new me(2,9,9013,"Could not find mechanism with name "+t);if(!(t=e.getCells().get(n)))throw new me(2,9,9013,"Could not find cell with name "+n);return t}function Ya(e,t){Xa.set(e,t)}sa.prototype.destroy=function(){for(var e=h(this.b.values()),t=e.next();!t.done;t=e.next())Ca(t.value);return this.b.clear(),this.i.clear(),this.g=this.h=this.v=this.c=this.a=null,this.f=!0,Promise.resolve()},sa.prototype.configure=function(e){this.g=e,this.F=new fe({maxAttempts:Math.max(e.retryParameters.maxAttempts,2),baseDelay:e.retryParameters.baseDelay,backoffFactor:e.retryParameters.backoffFactor,fuzzFactor:e.retryParameters.fuzzFactor,timeout:0},!0)},sa.prototype.start=function(){var e=this;return p((function t(){var n,r,i;return I(t,(function(t){switch(t.j){case 1:return n=e.a.Ua(),r=Aa(e,n),(i=e.a.Od(e.c.periods[r])).variant||i.text?T(t,va(e,i.variant?i.variant.audio:null,i.variant?i.variant.video:null,i.text,n),2):t.return(new me(2,5,5005));case 2:if(e.f)return t.return();e.a&&e.a.lf&&e.a.lf(),S(t)}}))}))},sa.prototype.L=function(e,t,n,r){var i=r.reader.gd(),o=r.reader.gd(),a=r.reader.G(),s=r.reader.G(),u=r.reader.G(),l=r.reader.G();r=r.reader.Za(r.reader.J.byteLength-r.reader.ca()),e=e.startTime+t.startTime+s/a,n.includes(i)&&("urn:mpeg:dash:event:2012"==i?this.a.mf():this.a.onEvent(new Se("emsg",{detail:{startTime:e,endTime:e+u/a,schemeIdUri:i,value:o,timescale:a,presentationTimeDelta:s,eventDuration:u,id:l,messageData:r}})))},G("shaka.net.HttpFetchPlugin",Pa),Pa.l=function(e,t,n,r,i){return p((function o(){var a,s,u,l,c,d,h,f,m,v,g,y;return I(o,(function(o){switch(o.j){case 1:return a=Pa.g,s=Pa.c,d=c=0,h=Date.now(),x(o,2),T(o,a(e,n),4);case 4:return u=o.o,f=u.clone().body.getReader(),v=(m=u.headers.get("Content-Length"))?parseInt(m,10):0,new s({start:function(e){!function t(){return p((function n(){var r,o;return I(n,(function(n){switch(n.j){case 1:return x(n,2),T(n,f.read(),4);case 4:r=n.o,M(n,3);break;case 2:return j(n),n.return();case 3:r.done||(c+=r.value.byteLength),(100<(o=Date.now())-h||r.done)&&(i(o-h,c-d,v-c),d=c,h=o),r.done?e.close():(e.enqueue(r.value),t()),S(n)}}))}))}()}}),T(o,u.arrayBuffer(),5);case 5:l=o.o,M(o,3);break;case 2:if(g=j(o),r.Ad)throw new me(1,1,7001,e,t);if(r.ie)throw new me(1,1,1003,e,t);throw new me(1,1,1002,e,g,t);case 3:return y={},u.headers.forEach((function(e,t){y[t.trim()]=e})),o.return(Oa(y,l,u.status,e,u.url,t))}}))}))},Pa.isSupported=function(){if(!e.ReadableStream)return!1;try{new ReadableStream({})}catch(e){return!1}return!(!e.fetch||!e.AbortController)},Pa.isSupported=Pa.isSupported,Pa.g=e.fetch,Pa.a=e.AbortController,Pa.c=e.ReadableStream,Pa.b=e.Headers,Pa.isSupported()&&(Ie("http",Pa,2),Ie("https",Pa,2)),G("shaka.net.HttpXHRPlugin",Ia),Ia.f=e.XMLHttpRequest,Ie("http",Ia,1),Ie("https",Ia,1),Da.prototype.close=function(e,t){if(this.c.has(e)){var n=this.c.get(e);this.c.delete(e),this.f+=n,this.a+=t}},Na.prototype.destroy=function(){return this.c=!0,Promise.all(this.b.values()).then((function(){}),(function(){}))},Ua.prototype.abort=function(){try{this.c.abort()}catch(e){}return this.a.catch((function(){}))},Ua.prototype.store=function(){return this.b},Ua.prototype.promise=function(){return this.a},Va.prototype.destroy=function(){return Promise.all(this.a.map((function(e){return e.abort()})))},Wa.prototype.destroy=function(){return this.a.destroy()},Wa.prototype.getAll=function(){var e=this;return p((function t(){var n,r;return I(t,(function(t){switch(t.j){case 1:return n=Ga(e.a,"session-ids"),r=[],T(t,Fa(n,(function(e,t){r.push(t)})),2);case 2:return T(t,n.promise(),3);case 3:return t.return(r)}}))}))},Wa.prototype.add=function(e){for(var t=Ha(this.a,"session-ids"),n=t.store(),r=(e=h(e)).next();!r.done;r=e.next())n.add(r.value);return t.promise()},Wa.prototype.remove=function(e){var t=this;return p((function n(){var r;return I(n,(function(n){switch(n.j){case 1:return T(n,Fa(r=Ha(t.a,"session-ids"),(function(t,n,r){0<=e.indexOf(n.sessionId)&&r.delete()})),2);case 2:return T(n,r.promise(),0)}}))}))},qa.prototype.destroy=function(){for(var e=[],t=h(this.a.values()),n=t.next();!n.done;n=t.next())e.push(n.value.destroy());return this.a.clear(),Promise.all(e)},qa.prototype.init=function(){var e=this;Xa.forEach((function(t,n){var r=t();r&&e.a.set(n,r)}));for(var t=[],n=h(this.a.values()),r=n.next();!r.done;r=n.next())t.push(r.value.init());return Promise.all(t)},qa.prototype.erase=function(){var e=this;return p((function t(){var n,r;return I(t,(function(t){switch(t.j){case 1:return n=Array.from(e.a.values()),(r=0<n.length)||Xa.forEach((function(e){(e=e())&&n.push(e)})),T(t,Promise.all(n.map((function(e){return e.erase()}))),2);case 2:if(!r)return T(t,Promise.all(n.map((function(e){return e.destroy()}))),0);t.A(0)}}))}))},G("shaka.offline.StorageMuxer.register",Ya),G("shaka.offline.StorageMuxer.unregister",(function(e){Xa.delete(e)}));var Xa=new Map;function Ja(e){this.a=new Va(e)}function Za(e){return Promise.reject(new me(2,9,9011,"Cannot add new value to "+e))}function $a(e,t,n,r){var i=(e=Ha(e.a,t)).store();return n.forEach((function(e){i.delete(e).onsuccess=function(){return r(e)}})),e.promise()}function Qa(e,t,n){var r=(e=Ga(e.a,t)).store(),i={},o=[];return n.forEach((function(e){r.get(e).onsuccess=function(t){null==(t=t.target.result)&&o.push(e),i[e]=t}})),e.promise().then((function(){return o.length?Promise.reject(new me(2,9,9012,"Could not find values for "+o)):n.map((function(e){return i[e]}))}))}function es(e){return{originalManifestUri:e.originalManifestUri,duration:e.duration,size:e.size,expiration:null==e.expiration?1/0:e.expiration,periods:e.periods.map(ts),sessionIds:e.sessionIds,drmInfo:e.drmInfo,appMetadata:e.appMetadata}}function ts(e){return function(e){var t=e.streams.filter((function(e){return"audio"==e.contentType})),n=e.streams.filter((function(e){return"video"==e.contentType}));if(!t.every((function(e){return e.variantIds}))||!n.every((function(e){return e.variantIds}))){t.forEach((function(e){e.variantIds=[]})),n.forEach((function(e){e.variantIds=[]}));var r=0;if(n.length&&!t.length){var i=r++;n.forEach((function(e){e.variantIds.push(i)}))}if(!n.length&&t.length){var o=r++;t.forEach((function(e){e.variantIds.push(o)}))}n.length&&t.length&&t.forEach((function(e){n.forEach((function(t){var n=r++;e.variantIds.push(n),t.variantIds.push(n)}))}))}}(e),e.streams.forEach((function(){})),{startTime:e.startTime,streams:e.streams.map(ns)}}function ns(e){var t=e.df?os(e.df):null;return{id:e.id,originalId:null,primary:e.primary,presentationTimeOffset:e.presentationTimeOffset,contentType:e.contentType,mimeType:e.mimeType,codecs:e.codecs,frameRate:e.frameRate,kind:e.kind,language:e.language,label:e.label,width:e.width,height:e.height,initSegmentKey:t,encrypted:e.encrypted,keyId:e.keyId,segments:e.segments.map(rs),variantIds:e.variantIds}}function rs(e){var t=os(e.uri);return{startTime:e.startTime,endTime:e.endTime,dataKey:t}}function is(e){return{data:e.data}}function os(e){var t;if((t=/^offline:[0-9]+\/[0-9]+\/([0-9]+)$/.exec(e))||(t=/^offline:segment\/([0-9]+)$/.exec(e)))return Number(t[1]);throw new me(2,9,9004,"Could not parse uri "+e)}function as(e,t,n,r){this.a=new Va(e),this.c=t,this.b=n,this.f=r}function ss(e,t,n){if(e.f)return Promise.reject(new me(1,9,9011,"Cannot add new value to "+t));var r=(e=Ha(e.a,t)).store(),i=[];return n.forEach((function(e){r.add(e).onsuccess=function(e){i.push(e.target.result)}})),e.promise().then((function(){return i}))}function us(e,t,n,r){var i=(e=Ha(e.a,t)).store();return n.forEach((function(e){i.delete(e).onsuccess=function(){return r(e)}})),e.promise()}function ls(e,t,n){var r=(e=Ga(e.a,t)).store(),i={},o=[];return n.forEach((function(e){var t=r.get(e);t.onsuccess=function(){null==t.result&&o.push(e),i[e]=t.result}})),e.promise().then((function(){return o.length?Promise.reject(new me(1,9,9012,"Could not find values for "+o)):n.map((function(e){return i[e]}))}))}function cs(){this.g=this.c=this.b=this.a=this.f=null}function ds(e,t,n,r){this.a=e,this.g=t,this.f=n,this.c=r,this.b=["offline:",e,"/",t,"/",n,"/",r].join("")}function hs(e){if(null==(e=/^offline:([a-z]+)\/([^/]+)\/([^/]+)\/([0-9]+)$/.exec(e)))return null;var t=e[1];if("manifest"!=t&&"segment"!=t)return null;var n=e[2];if(!n)return null;var r=e[3];return r&&null!=t?new ds(t,n,r,Number(e[4])):null}function fs(e,t){this.b=e,this.a=t}function ps(e,t,n){var r=t.streams.filter((function(e){return"audio"==e.contentType})),i=t.streams.filter((function(e){return"video"==e.contentType}));return r=function(e,t,n){for(var r=new Set,i=h(t),o=i.next();!o.done;o=i.next()){var a=h(o.value.variantIds);for(o=a.next();!o.done;o=a.next())r.add(o.value)}for(i=h(n),o=i.next();!o.done;o=i.next())for(a=h(o.value.variantIds),o=a.next();!o.done;o=a.next())r.add(o.value);for(i=new Map,r=h(r),o=r.next();!o.done;o=r.next())o=o.value,i.set(o,{id:o,language:"",primary:!1,audio:null,video:null,bandwidth:0,drmInfos:[],allowedByApplication:!0,allowedByKeySystem:!0});for(t=h(t),r=t.next();!r.done;r=t.next())for(r=r.value,o=ms(e,r),a=h(r.variantIds),r=a.next();!r.done;r=a.next())(r=i.get(r.value)).language=o.language,r.primary=r.primary||o.primary,r.audio=o;for(n=h(n),t=n.next();!t.done;t=n.next())for(r=t.value,t=ms(e,r),o=h(r.variantIds),r=o.next();!r.done;r=o.next())(r=i.get(r.value)).primary=r.primary||t.primary,r.video=t;return i}(e,r,i),i=t.streams.filter((function(e){return"text"==e.contentType})).map((function(t){return ms(e,t)})),t.streams.forEach((function(r){r=r.segments.map((function(t,n){return vs(e,n,t)})),n.ub(r,t.startTime)})),{startTime:t.startTime,variants:Array.from(r.values()),textStreams:i}}function ms(e,t){var n=t.segments.map((function(t,n){return vs(e,n,t)})),r=new oi(n);return n={id:t.id,originalId:t.originalId,createSegmentIndex:function(){return Promise.resolve()},findSegmentPosition:function(e){return r.find(e)},getSegmentReference:function(e){return r.get(e)},initSegmentReference:null,presentationTimeOffset:t.presentationTimeOffset,mimeType:t.mimeType,codecs:t.codecs,width:t.width||void 0,height:t.height||void 0,frameRate:t.frameRate||void 0,kind:t.kind,encrypted:t.encrypted,keyId:t.keyId,language:t.language,label:t.label||null,type:t.contentType,primary:t.primary,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],channelsCount:null,audioSamplingRate:null,closedCaptions:null},null!=t.initSegmentKey&&(n.initSegmentReference=function(e,t){var n=new ds("segment",e.b,e.a,t);return new ni((function(){return[n.toString()]}),0,null)}(e,t.initSegmentKey)),n}function vs(e,t,n){var r=new ds("segment",e.b,e.a,n.dataKey);return new ri(t,n.startTime,n.endTime,(function(){return[r.toString()]}),0,null)}function gs(){this.a=null}function ys(e){var t=hs(e);return t&&"manifest"==t.a?ys.h(e):t&&"segment"==t.a?ys.i(t.key(),t):ye(new me(2,1,9004,e))}function _s(e,t,n){return p((function r(){var i,o,a,s,u,l;return I(r,(function(r){switch(r.j){case 1:i=[];for(var c=[],d=h(n),f=d.next();!f.done;f=d.next()){f=f.value;for(var m=!1,v=h(c),g=v.next();!g.done;g=v.next())if(bs((g=g.value).info,f)){g.sessionIds.push(f.sessionId),m=!0;break}m||c.push({info:f,sessionIds:[f.sessionId]})}o=h(c),a=o.next();case 2:if(a.done){r.A(4);break}return s=a.value,u=function(e,t,n){return p((function r(){var i,o;return I(r,(function(r){switch(r.j){case 1:return i=new ft({tb:t,onError:function(){},mc:function(){},onExpirationUpdated:function(){},onEvent:function(){}}),x(r,2),i.configure(e),T(r,function(e,t,n,r,i,o){var a=new Map;return a.set(t,{audioCapabilities:i,videoCapabilities:o,distinctiveIdentifier:"optional",persistentState:"required",sessionTypes:["persistent-license"],label:t,drmInfos:[{keySystem:t,licenseServerUri:n,distinctiveIdentifierRequired:!1,persistentStateRequired:!0,audioRobustness:"",videoRobustness:"",serverCertificate:r,initData:null,keyIds:null}]}),wt(e,a)}(i,n.info.keySystem,n.info.licenseUri,n.info.serverCertificate,n.info.audioCapabilities,n.info.videoCapabilities),4);case 4:M(r,3);break;case 2:return j(r),T(r,i.destroy(),5);case 5:return r.return([]);case 3:return x(r,6),T(r,vt(i),8);case 8:M(r,7);break;case 6:return j(r),T(r,i.destroy(),9);case 9:return r.return([]);case 7:return o=[],T(r,Promise.all(n.sessionIds.map((function(e){return p((function t(){return I(t,(function(t){switch(t.j){case 1:return x(t,2),T(t,function(e,t){return p((function n(){var r,i,o;return I(n,(function(n){switch(n.j){case 1:return T(n,Tt(e,t),2);case 2:return(r=n.o)?(i=[],(o=e.b.get(r))&&(o.xa=new ve,i.push(o.xa)),i.push(r.remove()),T(n,Promise.all(i),0)):n.return()}}))}))}(i,e),4);case 4:o.push(e),M(t,0);break;case 2:j(t),S(t)}}))}))}))),10);case 10:return T(r,i.destroy(),11);case 11:return r.return(o)}}))}))}(e,t,s),T(r,u,5);case 5:l=r.o,i=i.concat(l),a=o.next(),r.A(2);break;case 4:return r.return(i)}}))}))}function bs(e,t){function n(e,t){return e.robustness==t.robustness&&e.contentType==t.contentType}return e.keySystem==t.keySystem&&e.licenseUri==t.licenseUri&&Le(e.audioCapabilities,t.audioCapabilities,n)&&Le(e.videoCapabilities,t.videoCapabilities,n)}function Es(e,t){var n={za:null,u:null,mimeType:null,startTime:null,ud:null,uri:null},r=this;this.g=t,this.c=e,this.i=n,this.h=null,this.f=[],this.b=this.a=null,this.l=!0,this.m=Promise.resolve().then((function(){return function(e){return p((function t(){return I(t,(function(t){switch(t.j){case 1:if(e.l){if(0==e.f.length||e.a&&!e.a.Va)var n=!1;else{e.a&&(e.a.ua.Ya(),e.a=null);var r=(n=e.f.shift()).create(e.i);r?(n.ua.vb(),e.a={node:r.node,payload:r.payload,Va:r.Va,ua:n.ua}):n.ua.nc(),n=!0}return n?n=Promise.resolve():e.a?n=function(e){return p((function t(){var n,r;return I(t,(function(t){switch(t.j){case 1:return e.c=e.g.Te(e.c,e.i,e.a.node,e.a.payload),x(t,2),e.b=e.g.Be(e.c,e.i,e.a.payload),T(t,e.b.promise,4);case 4:e.b=null,e.c==e.a.node&&(e.a.ua.lc(),e.a=null),M(t,0);break;case 2:return 7001==(n=j(t)).code?e.a.ua.Ya():e.a.ua.onError(n),e.a=null,e.b=null,r=e,T(t,e.g.handleError(e.i,n),5);case 5:r.c=t.o,S(t)}}))}))}(e):(e.g.kf(e.c),e.h=new ve,n=e.h),T(t,n,1)}t.A(0)}}))}))}(r)}))}function ws(e,t){var n={vb:function(){},lc:function(){},Ya:function(){},onError:function(){},nc:function(){},xg:function(){}};return e.f.push({create:t,ua:n}),e.b&&e.b.abort(),Ts(e),n}function Ts(e){e.h&&(e.h.resolve(),e.h=null)}function Ss(e){this.a=null;for(var t=0;t<e.textTracks.length;++t){var n=e.textTracks[t];n.mode="disabled","Shaka Player TextTrack"==n.label&&(this.a=n)}this.a||(this.a=e.addTextTrack("subtitles","Shaka Player TextTrack")),this.a.mode="hidden"}function xs(e){if(e.startTime>=e.endTime)return null;var t=new VTTCue(e.startTime,e.endTime,e.payload);t.lineAlign=e.lineAlign,t.positionAlign=e.positionAlign,t.size=e.size;try{t.align=e.textAlign}catch(e){}return"center"==e.textAlign&&"center"!=t.align&&(t.align="middle"),"vertical-lr"==e.writingMode?t.vertical="lr":"vertical-rl"==e.writingMode&&(t.vertical="rl"),1==e.lineInterpretation&&(t.snapToLines=!1),null!=e.line&&(t.line=e.line),null!=e.position&&(t.position=e.position),t}function As(e,t){var n=e.mode;e.mode="showing"==n?"showing":"hidden";for(var r=e.cues,i=r.length-1;0<=i;i--){var o=r[i];o&&t(o)&&e.removeCue(o)}e.mode=n}function Ms(e,t,n,r,i){var o,a=i in r,s=!0;for(o in t){var u=i+"."+o,l=a?r[i]:n[o];a||o in n?void 0===t[o]?void 0===l||a?delete e[o]:e[o]=Me(l):l.constructor==Object&&t[o]&&t[o].constructor==Object?(e[o]||(e[o]=Me(l)),u=Ms(e[o],t[o],l,r,u),s=s&&u):typeof t[o]!=typeof l||null==t[o]||t[o].constructor!=l.constructor?s=!1:e[o]=t[o]:s=!1}return s}function js(e,t){for(var n={},r=n,i=0,o=0;!(0>(i=e.indexOf(".",i)));)0!=i&&"\\"==e[i-1]||(r[o=e.substring(o,i).replace(/\\\./g,".")]={},r=r[o],o=i+1),i+=1;return r[e.substring(o).replace(/\\\./g,".")]=t,n}function Rs(){}function Ls(){var e=5e5,t=1/0;navigator.connection&&(e=1e6*navigator.connection.downlink,navigator.connection.saveData&&(t=360));var n={retryParameters:{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:0},servers:{},clearKeys:{},advanced:{},delayLicenseRequestUntilPlayed:!1,initDataTransform:xt,fairPlayTransform:!0},r={retryParameters:{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:0},availabilityWindowOverride:NaN,disableAudio:!1,disableVideo:!1,disableText:!1,dash:{customScheme:function(e){if(e)return null},clockSyncUri:"",ignoreDrmInfo:!1,xlinkFailGracefully:!1,defaultPresentationDelay:10,ignoreMinBufferTime:!1,autoCorrectDrift:!0,ignoreSuggestedPresentationDelay:!1},hls:{ignoreTextStreamFailures:!1}},i={retryParameters:{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:0},failureCallback:function(){},rebufferingGoal:2,bufferingGoal:10,bufferBehind:30,ignoreTextStreamFailures:!1,alwaysStreamText:!1,startAtSegmentBoundary:!1,smallGapLimit:.5,jumpLargeGaps:!1,durationBackoff:1,forceTransmuxTS:!1,safeSeekOffset:5,stallEnabled:!0,stallThreshold:1,stallSkip:.1,useNativeHlsOnSafari:!0};nt("Web0S")&&(i.stallEnabled=!1);var o={trackSelectionCallback:function(e){return e},progressCallback:function(){},usePersistentLicense:!0},a={drm:n,manifest:r,streaming:i,offline:o,abrFactory:Xn,abr:{enabled:!0,defaultBandwidthEstimate:e,switchInterval:8,bandwidthUpgradeTarget:.85,bandwidthDowngradeTarget:.95,restrictions:{minWidth:0,maxWidth:1/0,minHeight:0,maxHeight:t,minPixels:0,maxPixels:1/0,minBandwidth:0,maxBandwidth:1/0}},preferredAudioLanguage:"",preferredTextLanguage:"",preferredVariantRole:"",preferredTextRole:"",preferredAudioChannelCount:2,restrictions:{minWidth:0,maxWidth:1/0,minHeight:0,maxHeight:1/0,minPixels:0,maxPixels:1/0,minBandwidth:0,maxBandwidth:1/0},playRangeStart:0,playRangeEnd:1/0,textDisplayFactory:function(){return null}};return o.trackSelectionCallback=function(e){return function(e,t){var n=e.filter((function(e){return"variant"==e.type})),r=[],i=On(t,n.map((function(e){return e.language})));i&&(r=n.filter((function(e){return Cn(e.language)==i}))),0==r.length&&(r=n.filter((function(e){return e.primary}))),0==r.length&&(n.map((function(e){return e.language})),r=n);var o=r.filter((function(e){return e.height&&480>=e.height}));if(o.length&&(o.sort((function(e,t){return t.height-e.height})),r=o.filter((function(e){return e.height==o[0].height}))),n=[],r.length){var a=Math.floor(r.length/2);r.sort((function(e,t){return e.bandwidth-t.bandwidth})),n.push(r[a])}for(r=h(e),a=r.next();!a.done;a=r.next())"text"==(a=a.value).type&&n.push(a);return n}(e,a.preferredAudioLanguage)},a}function Cs(e,t,n){var r={".drm.servers":"",".drm.clearKeys":"",".drm.advanced":{distinctiveIdentifierRequired:!1,persistentStateRequired:!1,videoRobustness:"",audioRobustness:"",serverCertificate:new Uint8Array(0),individualizationServer:""}};return Ms(e,t,n||Ls(),r,"")}function ks(){this.a=null,this.b=[]}function Os(e,t){if(null==e.a)e.a={timestamp:Date.now()/1e3,state:t,duration:0};else{var n=Date.now()/1e3;e.a.duration=n-e.a.timestamp,e.a.state!=t&&(e.b.push(e.a),e.a={timestamp:n,state:t,duration:0})}}function Ps(e,t){var n=0;e.a&&e.a.state==t&&(n+=e.a.duration);for(var r=h(e.b),i=r.next();!i.done;i=r.next())n+=(i=i.value).state==t?i.duration:0;return n}function Is(){this.b=this.c=null,this.a=[]}function Ds(){this.f=this.l=this.b=this.h=this.i=this.g=this.m=NaN,this.a=new ks,this.c=new Is}function Ns(t,n){var r=this;Ae.call(this),this.h=Tu,this.a=null,this.gb=!1,this.g=new He,this.zc=this.l=this.Eb=this.b=this.s=this.f=this.Wb=this.C=this.Xb=this.W=this.ib=this.m=this.F=this.i=this.L=null,this.Kd=1e9,this.Zb=new Set,this.kb=!0,this.Ga=null,this.Hd=!1,this.Fd=0,this.oa=null,this.$=new yo,this.c=Ks(this),this.$b={width:1/0,height:1/0},this.v=null,this.Fb=new Mo(this.c.preferredAudioLanguage,this.c.preferredVariantRole,this.c.preferredAudioChannelCount),this.na=this.c.preferredTextLanguage,this.fb=this.c.preferredTextRole,n&&n(this),this.L=function(e){return new Oe((function(t,n){e.l&&e.l.segmentDownloaded(t,n)}))}(this),this.g.w(e,"online",(function(){r.nd()})),this.D={name:"detach"},this.R={name:"attach"},this.Ha={name:"unload"},this.Ic={name:"manifest-parser"},this.Gc={name:"manifest"},this.hb={name:"media-source"},this.Ac={name:"drm-engine"},this.T={name:"load"},this.Nc={name:"src-equals-drm-engine"},this.jb={name:"src-equals"};var i=new Map;i.set(this.R,(function(e,t){return Ee(function(e,t,n){return null==t.u&&(t.u=n.u,e.g.w(t.u,"error",(function(){var t=lu(e);t&&e.Ma(t)}))),e.a=t.u,Promise.resolve()}(r,e,t))})),i.set(this.D,(function(e){return e.u&&(r.g.ea(e.u,"error"),e.u=null),r.a=null,Ee(e=Promise.resolve())})),i.set(this.Ha,(function(e){return Ee(Vs(r,e))})),i.set(this.hb,(function(t){return Ee(t=function(t,n){return p((function r(){var i,o,a,s;return I(r,(function(r){switch(r.j){case 1:return i=e.muxjs?new Pt:new It,o=t.c.textDisplayFactory,a=new o,t.Bc=o,T(r,(s=new vn(n.u,i,a)).s,2);case 2:t.F=s,S(r)}}))}))}(r,t))})),i.set(this.Ic,(function(e,t){return Ee(function(e,t,n){return p((function r(){var i,o,a;return I(r,(function(r){switch(r.j){case 1:if(t.za=n.za,t.mimeType=n.mimeType,t.uri=n.uri,i=t.uri,o=e.L,e.Eb=i,t.za){e.s=t.za(),r.A(2);break}return a=e,T(r,Ei.create(i,o,e.c.manifest.retryParameters,t.mimeType),3);case 3:a.s=r.o;case 2:e.s.configure(e.c.manifest),S(r)}}))}))}(r,e,t))})),i.set(this.Gc,(function(e){return function(e,t){var n=t.uri,r=e.L;e.Wb=new na,function(e,t){e.b=t}(e.Wb,(function(t){uu(e,"timelineregionadded",t)}));var i={networkingEngine:r,filterNewPeriod:function(t){return e.Jc(t)},filterAllPeriods:function(t){return Ys(e,t)},onTimelineRegionAdded:function(t){var n=e.Wb;e:{for(var r=h(n.a),i=r.next();!i.done;i=r.next())if((i=i.value).schemeIdUri==t.schemeIdUri&&i.id==t.id&&i.startTime==t.startTime&&i.endTime==t.endTime){r=i;break e}r=null}null==r&&(n.a.add(t),n.b(t))},onEvent:function(t){return e.dispatchEvent(t)},onError:function(t){return e.Ma(t)}};return new ge(Promise.resolve().then((function(){return p((function t(){var r;return I(t,(function(t){switch(t.j){case 1:return r=e,T(t,e.s.start(n,i),2);case 2:if(r.b=t.o,e.dispatchEvent(new Se("manifestparsed")),0==e.b.periods.length)throw new me(2,4,4014);!function(e){function t(e){return e.video&&e.audio||e.video&&e.video.codecs.includes(",")}e.some((function(e){return e.variants.some(t)}))&&e.forEach((function(e){e.variants=e.variants.filter(t)}))}(e.b.periods),S(t)}}))}))})),(function(){return e.s.stop()}))}(r,e)})),i.set(this.Ac,(function(){return Ee(function(e){return p((function t(){return I(t,(function(t){switch(t.j){case 1:return e.i=new ft({tb:e.L,onError:function(t){e.Ma(t)},mc:function(t){cu(e,t)},onExpirationUpdated:function(t,n){du(e,t,n)},onEvent:function(t){e.dispatchEvent(t)}}),e.i.configure(e.c.drm),T(t,pt(e.i,Uo(e.b.periods),e.b.offlineSessionIds),2);case 2:Ys(e,e.b.periods),S(t)}}))}))}(r))})),i.set(this.T,(function(e,t){return Ee(function(e,t,n){return p((function r(){var i,o,a,s,u,l,c,d,f;return I(r,(function(r){switch(r.j){case 1:return t.startTime=n.startTime,i=t.u,o=t.uri,e.Eb=o,e.v=new Ds,a=function(){return $s(e)},s=function(){var t=e.a.playbackRate;0!=t&&e.W.set(t)},e.g.w(i,"playing",a),e.g.w(i,"pause",a),e.g.w(i,"ended",a),e.g.w(i,"ratechange",s),u=e.c.abrFactory,e.l&&e.zc==u||(e.zc=u,e.l=new u,e.l.configure(e.c.abr)),function(e,t){for(var n=0;n<t.length;n++){for(var r=t[n],i=new Map,o=h(r.variants),a=o.next();!a.done;a=o.next())if((a=a.value).video&&a.video.closedCaptions)for(var s=h((a=a.video).closedCaptions.keys()),u=s.next();!u.done;u=s.next())if(u=u.value,!i.has(u)){var l={id:e.Kd++,originalId:u,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(){return null},getSegmentReference:function(){return null},initSegmentReference:null,presentationTimeOffset:0,mimeType:"application/cea-608",codecs:"",kind:"caption",encrypted:!1,keyId:null,language:a.closedCaptions.get(u),label:null,type:"text",primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:a.roles,channelsCount:null,audioSamplingRate:null,closedCaptions:null};i.set(u,l)}for(i=h(i.values()),o=i.next();!o.done;o=i.next())r.textStreams.push(o.value)}}(e,e.b.periods),e.Fb=new Mo(e.c.preferredAudioLanguage,e.c.preferredVariantRole,e.c.preferredAudioChannelCount),e.na=e.c.preferredTextLanguage,function(e,t,n){0<t&&(e.V()||e.fe(t)),n<e.Y()&&(e.V()||e.wa(n))}(e.b.presentationTimeline,e.c.playRangeStart,e.c.playRangeEnd),T(r,e.i.Gb(i),2);case 2:return e.l.init((function(t,n,r){n=void 0!==n&&n,r=void 0===r?0:r;e:{for(var i=h(e.b.periods),o=i.next();!o.done;o=i.next())if((o=o.value).variants.includes(t)){i=o;break e}i=null}Ws(e,i,t,!0),e.f&&(fa(e.f,t,n,r),nu(e))})),e.m=function(e,t){return new $o(e.a,e.b,e.c.streaming,t,(function(){e.ib&&Bo(e.ib,!0),e.f&&function(e){function t(t){var i=e.a.K;return"text"==t?t=null!=(t=i.a).a&&null!=t.b&&(n>=t.a&&n<t.b):t=Nt(t=Tn(i,t),n,r),t}var n=e.a.Ua(),r=e.g.smallGapLimit,i=Aa(e,n);if(Ye(e.b.values(),(function(e){return e.ia==i})))for(var o=h(e.b.keys()),a=o.next();!a.done;a=o.next())t(a=a.value)||ma(e,e.b.get(a));else Ye(e.b.keys(),t)||e.b.forEach((function(t){ma(e,t)}))}(e.f),e.C&&Hs(e)}),(function(t){return e.dispatchEvent(t)}))}(e,t.startTime),e.ib=function(e){var t=new Vo(e.b);!function(e,t){e.b=t}(t,(function(){ru(e)}));var n=new ra(e.Wb);!function(e,t,n,r){e.a=t,e.b=n,e.c=r}(n,(function(t){uu(e,"timelineregionenter",t)}),(function(t){uu(e,"timelineregionexit",t)}),(function(t,n){n||(uu(e,"timelineregionenter",t),uu(e,"timelineregionexit",t))}));var r=new No(e.a);return r.a.add(t),r.a.add(n),r}(e),e.W=new Go({gc:function(){return t.u.playbackRate},rd:function(e){t.u.playbackRate=e},Ld:function(e){t.u.currentTime+=e}}),l=Math.max(e.b.minBufferTime,e.c.streaming.rebufferingGoal),Gs(e,l),e.f=function(e){return new sa(e.b,{Ua:function(){return e.m.h()},getBandwidthEstimate:function(){return e.l.getBandwidthEstimate()},K:e.F,tb:e.L,Od:e.hf.bind(e),Nd:e.ve.bind(e),onError:e.Ma.bind(e),onEvent:function(t){return e.dispatchEvent(t)},mf:e.nf.bind(e),dd:e.uf.bind(e)})}(e),e.f.configure(e.c.streaming),function(e){function t(e){var t="";e.video&&(t=$e(e.video.codecs)[0]);var n="";return e.audio&&(n=$e(e.audio.codecs)[0]),t+"-"+n}var n=e.b.periods.reduce((function(e,t){return e.concat(t.variants)}),[]);n=Wn(n,e.c.preferredAudioChannelCount);var r=new xe;n.forEach((function(e){var n=t(e);r.push(n,e)}));var i=null,o=1/0;r.forEach((function(e,t){var n=0,r=0;t.forEach((function(e){n+=e.bandwidth||0,++r}));var a=n/r;a<o&&(i=e,o=a)})),e.b.periods.forEach((function(e){e.variants=e.variants.filter((function(e){return t(e)==i}))}))}(e),e.h=Su,e.dispatchEvent(new Se("streaming")),T(r,e.f.start(),3);case 3:e.c.streaming.startAtSegmentBoundary&&(c=e.m.h(),d=function(e,t){function n(e,t){if(!e)return null;var n=e.findSegmentPosition(t-o.startTime);return null==n?null:(n=e.getSegmentReference(n))?n.startTime+o.startTime:null}var r=ua(e.f),i=la(e.f),o=gu(e);return r=n(r,t),null!=(i=n(i,t))&&null!=r?Math.max(i,r):null!=i?i:null!=r?r:t}(e,c),e.m.m(d)),e.b.periods.forEach(e.Jc.bind(e)),ru(e),nu(e),(f=gu(e)||e.b.periods[0]).variants.some((function(e){return e.primary})),Qs(e,f.variants),e.g.da(i,"loadeddata",(function(){e.v.b=Date.now()/1e3-n.ud})),S(r)}}))}))}(r,e,t))})),i.set(this.Nc,(function(e){return Ee(e=function(e,t){return p((function n(){var r,i;return I(n,(function(n){switch(n.j){case 1:return r=Ht,e.i=new ft({tb:e.L,onError:function(t){e.Ma(t)},mc:function(t){cu(e,t)},onExpirationUpdated:function(t,n){du(e,t,n)},onEvent:function(t){e.dispatchEvent(t)}}),e.i.configure(e.c.drm),i={id:0,language:"und",primary:!1,audio:null,video:{id:0,originalId:null,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(){return null},getSegmentReference:function(){return null},initSegmentReference:null,presentationTimeOffset:0,mimeType:"video/mp4",codecs:"",encrypted:!0,keyId:null,language:"und",label:null,type:r.Pa,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],channelsCount:null,audioSamplingRate:null,closedCaptions:null},bandwidth:100,drmInfos:[],allowedByApplication:!0,allowedByKeySystem:!0},T(n,pt(e.i,[i],[]),2);case 2:return T(n,e.i.Gb(t.u),0)}}))}))}(r,e))})),i.set(this.jb,(function(e,t){return function(e,t,n){function r(){return $s(e)}if(t.uri=n.uri,t.startTime=n.startTime,e.Eb=t.uri,e.v=new Ds,e.m=new Zo(t.u),null!=t.startTime&&e.m.m(t.startTime),e.W=new Go({gc:function(){return t.u.playbackRate},rd:function(e){t.u.playbackRate=e},Ld:function(e){t.u.currentTime+=e}}),Gs(e,e.c.streaming.rebufferingGoal),e.g.w(t.u,"playing",r),e.g.w(t.u,"pause",r),e.g.w(t.u,"ended",r),e.g.da(t.u,"loadeddata",(function(){e.v.b=Date.now()/1e3-n.ud})),e.a.audioTracks&&(e.g.w(e.a.audioTracks,"addtrack",(function(){return ru(e)})),e.g.w(e.a.audioTracks,"removetrack",(function(){return ru(e)})),e.g.w(e.a.audioTracks,"change",(function(){return ru(e)}))),e.a.textTracks){var i=e.a.textTracks;e.g.w(i,"addtrack",(function(){return ru(e)})),e.g.w(i,"removetrack",(function(){return ru(e)})),e.g.w(i,"change",(function(){return ru(e)}))}t.u.src=t.uri,e.h=xu,e.dispatchEvent(new Se("streaming"));var o=new ve;return e.a.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA?o.resolve():e.a.error?o.reject(lu(e)):(e.g.da(e.a,"loadeddata",(function(){o.resolve()})),e.g.da(e.a,"error",(function(){o.reject(lu(e))}))),new ge(o,(function(){return o.reject(new me(2,7,7001)),Promise.resolve()}))}(r,e,t)})),this.lb=new Es(this.D,{Te:function(e,t,n,i){var o=null;return e==r.D&&(o=n==r.D?r.D:r.R),e==r.R&&(o=n==r.D||t.u!=i.u?r.D:n==r.R?r.R:n==r.hb||n==r.T?r.hb:n==r.jb?r.Nc:null),e==r.hb&&(o=n==r.T&&t.u==i.u?r.Ic:r.Ha),e==r.Ic&&(o=bu(r.T,r.Gc,r.Ha,n,t,i)),e==r.Gc&&(o=bu(r.T,r.Ac,r.Ha,n,t,i)),e==r.Ac&&(o=bu(r.T,r.T,r.Ha,n,t,i)),e==r.Nc&&(o=n==r.jb&&t.u==i.u?r.jb:r.Ha),e!=r.T&&e!=r.jb||(o=r.Ha),e==r.Ha&&(o=i.u&&t.u==i.u?r.R:r.D),o},Be:function(e,t,n){return r.dispatchEvent(new Se("onstatechange",{state:e.name})),i.get(e)(t,n)},handleError:function(e){return p((function t(){return I(t,(function(t){switch(t.j){case 1:return T(t,Vs(r,e),2);case 2:return t.return(e.u?r.R:r.D)}}))}))},kf:function(e){r.dispatchEvent(new Se("onstateidle",{state:e.name}))}}),t&&this.Gb(t,!0)}(r=Ja.prototype).destroy=function(){return this.a.destroy()},r.hasFixedKeySpace=function(){return!0},r.addSegments=function(){return Za("segment")},r.removeSegments=function(e,t){return $a(this,"segment",e,t)},r.getSegments=function(e){return Qa(this,"segment",e).then((function(e){return e.map(is)}))},r.addManifests=function(){return Za("manifest")},r.updateManifestExpiration=function(e,t){var n=Ha(this.a,"manifest"),r=n.store(),i=new ve;return r.get(e).onsuccess=function(n){(n=n.target.result)?(n.expiration=t,r.put(n),i.resolve()):i.reject(new me(2,9,9012,"Could not find values for "+e))},n.promise().then((function(){return i}))},r.removeManifests=function(e,t){return $a(this,"manifest",e,t)},r.getManifests=function(e){return Qa(this,"manifest",e).then((function(e){return e.map(es)}))},r.getAllManifests=function(){var e=this;return p((function t(){var n,r;return I(t,(function(t){switch(t.j){case 1:return n=Ga(e.a,"manifest"),r=new Map,T(t,Fa(n,(function(e,t){r.set(e,es(t))})),2);case 2:return T(t,n.promise(),3);case 3:return t.return(r)}}))}))},(r=as.prototype).destroy=function(){return this.a.destroy()},r.hasFixedKeySpace=function(){return this.f},r.addSegments=function(e){return ss(this,this.c,e)},r.removeSegments=function(e,t){return us(this,this.c,e,t)},r.getSegments=function(e){return ls(this,this.c,e)},r.addManifests=function(e){return ss(this,this.b,e)},r.updateManifestExpiration=function(e,t){var n=Ha(this.a,this.b),r=n.store();return r.get(e).onsuccess=function(n){(n=n.target.result)&&(n.expiration=t,r.put(n,e))},n.promise()},r.removeManifests=function(e,t){return us(this,this.b,e,t)},r.getManifests=function(e){return ls(this,this.b,e)},r.getAllManifests=function(){var e=this;return p((function t(){var n,r;return I(t,(function(t){switch(t.j){case 1:return n=Ga(e.a,e.b),r=new Map,T(t,Fa(n,(function(e,t){r.set(e,t)})),2);case 2:return T(t,n.promise(),3);case 3:return t.return(r)}}))}))},(r=cs.prototype).init=function(){var t=this,n=new ve,r=e.indexedDB.open("shaka_offline_db",4);return r.onsuccess=function(e){e=e.target.result,t.f=e;var r=e.objectStoreNames;r=r.contains("manifest")&&r.contains("segment")?new Ja(e):null,t.a=r,r=(r=e.objectStoreNames).contains("manifest-v2")&&r.contains("segment-v2")?new as(e,"segment-v2","manifest-v2",!0):null,t.b=r,r=(r=e.objectStoreNames).contains("manifest-v3")&&r.contains("segment-v3")?new as(e,"segment-v3","manifest-v3",!1):null,t.c=r,e=e.objectStoreNames.contains("session-ids")?new Wa(e):null,t.g=e,n.resolve()},r.onupgradeneeded=function(e){e=e.target.result;for(var t=h(["segment-v3","manifest-v3","session-ids"]),n=t.next();!n.done;n=t.next())n=n.value,e.objectStoreNames.contains(n)||e.createObjectStore(n,{autoIncrement:!0})},r.onerror=function(e){n.reject(new me(2,9,9001,r.error)),e.preventDefault()},n},r.destroy=function(){var e=this;return p((function t(){return I(t,(function(t){switch(t.j){case 1:if(!e.a){t.A(2);break}return T(t,e.a.destroy(),2);case 2:if(!e.b){t.A(4);break}return T(t,e.b.destroy(),4);case 4:if(!e.c){t.A(6);break}return T(t,e.c.destroy(),6);case 6:if(!e.g){t.A(8);break}return T(t,e.g.destroy(),8);case 8:e.f&&e.f.close(),S(t)}}))}))},r.getCells=function(){var e=new Map;return this.a&&e.set("v1",this.a),this.b&&e.set("v2",this.b),this.c&&e.set("v3",this.c),e},r.getEmeSessionCell=function(){return this.g},r.erase=function(){var t=this;return p((function n(){return I(n,(function(n){switch(n.j){case 1:if(!t.a){n.A(2);break}return T(n,t.a.destroy(),2);case 2:if(!t.b){n.A(4);break}return T(n,t.b.destroy(),4);case 4:if(!t.c){n.A(6);break}return T(n,t.c.destroy(),6);case 6:return t.f&&t.f.close(),T(n,function(){var t=new ve,n=e.indexedDB.deleteDatabase("shaka_offline_db");return n.onblocked=function(){},n.onsuccess=function(){t.resolve()},n.onerror=function(e){t.reject(new me(2,9,9001,n.error)),e.preventDefault()},t}(),8);case 8:return t.f=null,t.a=null,t.b=null,t.c=null,T(n,t.init(),0)}}))}))},Ya("idb",(function(){return e.indexedDB?new cs:null})),ds.prototype.va=function(){return this.g},ds.prototype.ba=function(){return this.f},ds.prototype.key=function(){return this.c},ds.prototype.toString=function(){return this.b},(r=gs.prototype).configure=function(){},r.start=function(e){var t=this;return p((function n(){var r,i,o,a,s;return I(n,(function(n){switch(n.j){case 1:return r=hs(e),t.a=r,null==r||"manifest"!=r.a?n.return(Promise.reject(new me(2,1,9004,r))):(i=new qa,A(n,2),T(n,i.init(),4));case 4:return T(n,Ka(i,r.va(),r.ba()),5);case 5:return T(n,n.o.getManifests([r.key()]),6);case 6:return o=n.o,a=o[0],s=new fs(r.va(),r.ba()),n.return(function(e,t){var n=new wi(null,0);n.wa(t.duration);var r=t.periods.map((function(t){return ps(e,t,n)})),i=t.drmInfo?[t.drmInfo]:[];return t.drmInfo&&r.forEach((function(e){e.variants.forEach((function(e){e.drmInfos=i}))})),{presentationTimeline:n,minBufferTime:2,offlineSessionIds:t.sessionIds,periods:r}}(s,a));case 2:return R(n),T(n,i.destroy(),7);case 7:L(n,0)}}))}))},r.stop=function(){return Promise.resolve()},r.update=function(){},r.onExpirationUpdated=function(e,t){var n=this;return p((function r(){var i,o,a,s,u,l,c;return I(r,(function(r){switch(r.j){case 1:return i=n.a,o=new qa,x(r,2,3),T(r,o.init(),5);case 5:return T(r,Ka(o,i.va(),i.ba()),6);case 6:return T(r,(a=r.o).getManifests([i.key()]),7);case 7:if(s=r.o,u=s[0],l=u.sessionIds.includes(e),c=null==u.expiration||u.expiration>t,!l||!c){r.A(3);break}return T(r,a.updateManifestExpiration(i.key(),t),3);case 3:return R(r),T(r,o.destroy(),10);case 10:L(r,0);break;case 2:j(r),r.A(3)}}))}))},Ei.Bb("application/x-offline-manifest",gs),G("shaka.offline.OfflineScheme",ys),ys.h=function(e){return be(e={uri:e,fd:e,data:new ArrayBuffer(0),headers:{"content-type":"application/x-offline-manifest"}})},ys.i=function(e,t){var n=new qa;return be(void 0).U((function(){return n.init()})).U((function(){return Ka(n,t.va(),t.ba())})).U((function(e){return e.getSegments([t.key()])})).U((function(e){return{uri:t,fd:t,data:e[0].data,headers:{}}})).finally((function(){return n.destroy()}))},Ie("offline",ys),Es.prototype.destroy=function(){var e=this;return p((function t(){return I(t,(function(t){switch(t.j){case 1:return e.l=!1,e.b&&e.b.abort(),Ts(e),T(t,e.m,2);case 2:e.a&&e.a.ua.Ya();for(var n=h(e.f),r=n.next();!r.done;r=n.next())r.value.ua.Ya();e.a=null,e.f=[],e.g=null,S(t)}}))}))},G("shaka.text.SimpleTextDisplayer",Ss),Ss.prototype.remove=function(e,t){return!!this.a&&(As(this.a,(function(n){return n.startTime<t&&n.endTime>e})),!0)},Ss.prototype.remove=Ss.prototype.remove,Ss.prototype.append=function(e){for(var t=xs,n=[],r=0;r<e.length;r++){var i=t(e[r]);i&&n.push(i)}n.slice().sort((function(e,t){return e.startTime!=t.startTime?e.startTime-t.startTime:e.endTime!=t.endTime?e.endTime-t.startTime:n.indexOf(t)-n.indexOf(e)})).forEach(function(e){this.a.addCue(e)}.bind(this))},Ss.prototype.append=Ss.prototype.append,Ss.prototype.destroy=function(){return this.a&&As(this.a,(function(){return!0})),this.a=null,Promise.resolve()},Ss.prototype.destroy=Ss.prototype.destroy,Ss.prototype.isTextVisible=function(){return"showing"==this.a.mode},Ss.prototype.isTextVisible=Ss.prototype.isTextVisible,Ss.prototype.setTextVisibility=function(e){this.a.mode=e?"showing":"hidden"},Ss.prototype.setTextVisibility=Ss.prototype.setTextVisibility,G("shaka.util.ConfigUtils.mergeConfigObjects",Ms),G("shaka.util.ConfigUtils.convertToConfigObject",js),G("shaka.util.PlayerConfiguration",Rs),Rs.mergeConfigObjects=Cs,H(Ns,Ae),G("shaka.Player",Ns),Ns.prototype.destroy=function(){var e=this;return p((function t(){var n;return I(t,(function(t){switch(t.j){case 1:return e.h==wu?t.return():(e.h=wu,n=ws(e.lb,(function(){return{node:e.D,payload:{za:null,u:null,mimeType:null,startTime:null,ud:null,uri:null},Va:!1}})),T(t,new Promise((function(e){n.vb=function(){},n.lc=function(){e()},n.Ya=function(){e()},n.onError=function(){e()},n.nc=function(){e()}})),2));case 2:return T(t,e.lb.destroy(),3);case 3:if(e.g&&(e.g.release(),e.g=null),e.zc=null,e.l=null,e.c=null,!e.L){t.A(0);break}return T(t,e.L.destroy(),5);case 5:e.L=null,S(t)}}))}))},Ns.prototype.destroy=Ns.prototype.destroy,Ns.version="v2.5.7";var Bs=["2","5"];tr=new function(e){this.a=e,this.c=Qn,this.b=er}(new Zn(Number(Bs[0]),Number(Bs[1])));var Us=["output-restricted","internal-error"],Fs={};function Vs(e,t){return p((function n(){return I(n,(function(n){switch(n.j){case 1:if(e.h!=wu&&(e.h=Tu),e.dispatchEvent(new Se("unloading")),t.za=null,t.mimeType=null,t.startTime=null,t.uri=null,t.u&&(e.g.ea(t.u,"loadeddata"),e.g.ea(t.u,"playing"),e.g.ea(t.u,"pause"),e.g.ea(t.u,"ended"),e.g.ea(t.u,"ratechange")),e.ib&&(e.ib.release(),e.ib=null),e.Xb&&(e.Xb.stop(),e.Xb=null),!e.s){n.A(2);break}return T(n,e.s.stop(),3);case 3:e.s=null;case 2:if(!e.l){n.A(4);break}return T(n,e.l.stop(),4);case 4:if(!e.f){n.A(6);break}return T(n,e.f.destroy(),7);case 7:e.f=null;case 6:if(e.m&&(e.m.release(),e.m=null),!e.F){n.A(8);break}return T(n,e.F.destroy(),9);case 9:e.F=null;case 8:if(!t.u||!t.u.src){n.A(10);break}return T(n,new Promise((function(e){return new he(e).P(.1)})),11);case 11:t.u.removeAttribute("src"),t.u.load();case 10:if(!e.i){n.A(12);break}return T(n,e.i.destroy(),13);case 13:e.i=null;case 12:e.$.a.clear(),e.Eb=null,e.C=null,e.Zb.clear(),e.b=null,e.v=null,e.Bc=null,e.kb=!0,Zs(e),S(n)}}))}))}function Gs(e,t){e.C=new jo,e.C.a=Lo,Ro(e.C,t,Math.min(.5,t/2)),Zs(e),e.Xb=new he((function(){Hs(e)})).Na(.25)}function Hs(e){switch(e.h){case xu:var t=!!e.a.ended||Dt(e.a.buffered)>=e.a.duration-1;break;case Su:e:if(e.a.ended||bn(e.F))t=!0;else{if(e.b.presentationTimeline.V()){var n=e.b.presentationTimeline.pb();if(Dt(e.a.buffered)>=n){t=!0;break e}}t=!1}break;default:t=!1}var r=Bt(e.a.buffered,e.a.currentTime),i=t,o=(n=e.C).b.get(n.a);t=n.a,r=i||r>=o?Co:Lo,n.a=r,t!=r&&Zs(e)}function zs(e){if(e.s&&e.s.configure(e.c.manifest),e.i&&e.i.configure(e.c.drm),e.f){e.f.configure(e.c.streaming);try{e.b.periods.forEach(e.Jc.bind(e))}catch(t){e.Ma(t)}var t=ua(e.f),n=la(e.f),r=gu(e);t=Yn(t,n,r.variants),e.l&&t&&t.allowedByApplication&&t.allowedByKeySystem?Qs(e,r.variants):eu(e,r)}if(e.F&&(r=e.c.textDisplayFactory,e.Bc!=r)){t=new r;var i=(n=e.F).g;n.g=t,i&&(t.setTextVisibility(i.isTextVisible()),i.destroy()),n.a&&(n.a.c=t),e.Bc=r,e.f&&((t=(r=e.f).b.get("text"))&&pa(r,t.stream,!0,0,!0))}e.l&&(e.l.configure(e.c.abr),e.c.abr.enabled&&!e.kb?e.l.enable():e.l.disable(),su(e)),e.C&&(r=e.c.streaming.rebufferingGoal,e.b&&(r=Math.max(r,e.b.minBufferTime)),Ro(e.C,r,Math.min(.5,r/2)))}function Ws(e,t,n,r){bo(e.$,t).variant=n,(e=e.v.c).c!=n&&(e.c=n,e.a.push({timestamp:Date.now()/1e3,id:n.id,type:"variant",fromAdaptation:r,bandwidth:n.bandwidth}))}function qs(e,t,n,r){_o(e.$,t,n),(e=e.v.c).b!=n&&(e.b=n,e.a.push({timestamp:Date.now()/1e3,id:n.id,type:"text",fromAdaptation:r,bandwidth:null}))}function Ks(e){var t=Ls();return t.streaming.failureCallback=function(t){e.V()&&[1001,1002,1003].includes(t.code)&&(t.severity=1,e.nd())},t.textDisplayFactory=function(){return new Ss(e.a)},t}function Ys(e,t){var n=e.f?ua(e.f):null,r=e.f?la(e.f):null;if(t.forEach(Nn.bind(null,e.i,n,r)),0==(n=function(e,t){var n=0;return e.forEach((function(e){n+=t(e)?1:0})),n}(t,(function(e){return e.variants.some(zn)}))))throw new me(2,4,4032);if(n<t.length)throw new me(2,4,4011);t.forEach(function(e){Dn(e.variants,this.c.restrictions,this.$b)&&this.f&&gu(this)==e&&ru(this),hu(this,e.variants)}.bind(e))}function Xs(e,t,n,r){n=void 0!==n&&n,r=void 0===r?0:r,e.kb?(e.Ga=t,e.Hd=n,e.Fd=r):(fa(e.f,t,n,r),iu(e))}function Js(e,t){e.kb?e.oa=t:(pa(e.f,t,!0,0,!1),ou(e))}function Zs(e){var t=e.Tc();if(e.v&&e.C&&e.m){var n=e.W;n.f=t,Ho(n),$s(e)}e.dispatchEvent(new Se("buffering",{buffering:t}))}function $s(e){if(e.v&&e.C){var t=e.v.a;e.C.a==Lo?Os(t,"buffering"):e.a.paused?Os(t,"paused"):e.a.ended?Os(t,"ended"):Os(t,"playing")}}function Qs(e,t){try{hu(e,t)}catch(t){return e.Ma(t),null}var n=t.filter((function(e){return zn(e)}));return n=e.Fb.create(n),e.l.setVariants(Array.from(n.values())),e.l.chooseVariant()}function eu(e,t){tu(e,t,!1);var n=!1;n=void 0===n||n;var r=qn(t.textStreams,e.na,e.fb)[0]||null;r&&(e.c.streaming.alwaysStreamText||e.ic())&&(qs(e,t,r,!0),Js(e,r)),n&&nu(e),nu(e)}function tu(e,t,n){n=void 0===n||n;var r=Qs(e,t.variants);r&&(Ws(e,t,r,!0),Xs(e,r,!0)),n&&nu(e)}function nu(e){fu(e,new Se("adaptation"))}function ru(e){fu(e,new Se("trackschanged"))}function iu(e){fu(e,new Se("variantchanged"))}function ou(e){fu(e,new Se("textchanged"))}function au(e){fu(e,new Se("texttrackvisibility"))}function su(e){fu(e,new Se("abrstatuschanged",{wg:e.c.abr.enabled}))}function uu(e,t,n){e.dispatchEvent(new Se(t,{detail:{schemeIdUri:n.schemeIdUri,value:n.value,startTime:n.startTime,endTime:n.endTime,id:n.id,eventElement:n.eventElement}}))}function lu(e){if(!e.a.error)return null;var t=e.a.error.code;if(1==t)return null;var n=e.a.error.msExtendedCode;return n&&(0>n&&(n+=Math.pow(2,32)),n=n.toString(16)),new me(2,3,3016,t,n,e.a.error.message)}function cu(e,t){if(e.f){var n=gu(e),r=!1,i=Object.keys(t),o=1==i.length&&"00"==i[0];i.length&&e.b.periods.forEach((function(e){e.variants.forEach((function(e){(function(e){var t=[];return e.audio&&t.push(e.audio),e.video&&t.push(e.video),t})(e).forEach((function(n){var i=e.allowedByKeySystem;n.keyId&&(n=t[o?"00":n.keyId],e.allowedByKeySystem=!!n&&!Us.includes(n)),i!=e.allowedByKeySystem&&(r=!0)}))}))})),(i=Yn(i=ua(e.f),la(e.f),n.variants))&&!i.allowedByKeySystem&&tu(e,n),r&&(ru(e),Qs(e,n.variants))}}function du(e,t,n){e.s&&e.s.onExpirationUpdated&&e.s.onExpirationUpdated(t,n),e.dispatchEvent(new Se("expirationupdated"))}function hu(e,t){var n=e.i?Je(e.i.T):{},r=Object.keys(n);r=r.length&&"00"==r[0];for(var i=!1,o=!1,a=[],s=[],u=h(t),l=u.next();!l.done;l=u.next()){var c=[];(l=l.value).audio&&c.push(l.audio),l.video&&c.push(l.video);for(var d=(c=h(c)).next();!d.done;d=c.next())if((d=d.value).keyId){var f=n[r?"00":d.keyId];f?Us.includes(f)&&(s.includes(f)||s.push(f)):a.includes(d.keyId)||a.push(d.keyId)}l.allowedByApplication?l.allowedByKeySystem&&(i=!0):o=!0}if(!i)throw new me(2,4,4012,{hasAppRestrictions:o,missingKeys:a,restrictedKeyStatuses:s})}function fu(e,t){p((function n(){return I(n,(function(n){switch(n.j){case 1:return T(n,Promise.resolve(),2);case 2:e.h!=wu&&e.dispatchEvent(t),S(n)}}))}))}function pu(e){for(var t=new Set,n=(e=h(e)).next();!n.done;n=e.next())(n=n.value).language?t.add(Cn(n.language)):t.add("und");return t}function mu(e){for(var t=new Map,n=(e=h(e)).next();!n.done;n=e.next()){var r=n.value;n="und";var i=[];for(r.language&&(n=Cn(r.language)),(i="variant"==r.type?r.audioRoles:r.roles)&&i.length||(i=[""]),t.has(n)||t.set(n,new Set),i=(r=h(i)).next();!i.done;i=r.next())i=i.value,t.get(n).add(i)}var o=[];return t.forEach((function(e,t){for(var n=h(e),r=n.next();!r.done;r=n.next())o.push({language:t,role:r.value})})),o}function vu(e){return null==(e=gu(e))?[]:e.variants.filter((function(e){return zn(e)}))}function gu(e){for(var t=e.m.h(),n=null,r=(e=h(e.b.periods)).next();!r.done;r=e.next())(r=r.value).startTime<=t&&(n=r);return n}function yu(e){var t=gu(e);return bo(e.$,t).variant}function _u(){return new me(2,7,7e3)}function bu(e,t,n,r,i,o){return r==e&&i.u==o.u&&i.uri==o.uri&&i.mimeType==o.mimeType&&i.za==o.za?t:n}function Eu(e){return new Promise((function(t,n){e.Ya=function(){return n(_u())},e.lc=function(){return t()},e.onError=function(e){return n(e)},e.nc=function(){return n(_u())}}))}Ns.registerSupportPlugin=function(e,t){Fs[e]=t},Ns.isBrowserSupported=function(){return!!(e.Promise&&e.Uint8Array&&Array.prototype.forEach&&e.MediaKeys&&e.navigator&&e.navigator.requestMediaKeySystemAccess&&e.MediaKeySystemAccess&&e.MediaKeySystemAccess.prototype.getConfiguration)&&(!!et()||tt("application/x-mpegurl"))},Ns.probeSupport=function(){return Mt().then((function(e){for(var t=Ei.Ef(),n={},r=h('video/mp4; codecs="avc1.42E01E",video/mp4; codecs="avc3.42E01E",video/mp4; codecs="hev1.1.6.L93.90",video/mp4; codecs="hvc1.1.6.L93.90",video/mp4; codecs="hev1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="hvc1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="vp9",video/mp4; codecs="vp09.00.10.08",video/mp4; codecs="av01.0.01M.08",audio/mp4; codecs="mp4a.40.2",audio/mp4; codecs="ac-3",audio/mp4; codecs="ec-3",audio/mp4; codecs="opus",audio/mp4; codecs="flac",video/webm; codecs="vp8",video/webm; codecs="vp9",video/webm; codecs="vp09.00.10.08",audio/webm; codecs="vorbis",audio/webm; codecs="opus",video/mp2t; codecs="avc1.42E01E",video/mp2t; codecs="avc3.42E01E",video/mp2t; codecs="hvc1.1.6.L93.90",video/mp2t; codecs="mp4a.40.2",video/mp2t; codecs="ac-3",video/mp2t; codecs="ec-3",text/vtt,application/mp4; codecs="wvtt",application/ttml+xml,application/mp4; codecs="stpp"'.split(",")),i=r.next();!i.done;i=r.next()){n[i=i.value]=et()?!!fn(i)||(MediaSource.isTypeSupported(i)||Wt(i)):tt(i);var o=i.split(";")[0];n[o]=n[o]||n[i]}for(var a in e={manifest:t,media:n,drm:e},Fs)e[a]=Fs[a]();return e}))},Ns.prototype.Gb=function(e,t){if(t=void 0===t||t,this.h==wu)return Promise.reject(_u());var n={za:null,u:null,mimeType:null,startTime:null,ud:null,uri:null};n.u=e,et()||(t=!1);var r=t?this.hb:this.R,i=ws(this.lb,(function(){return{node:r,payload:n,Va:!1}}));return i.vb=function(){},Eu(i)},Ns.prototype.attach=Ns.prototype.Gb,Ns.prototype.detach=function(){var e=this;if(this.h==wu)return Promise.reject(_u());var t=ws(this.lb,(function(){return{node:e.D,payload:{za:null,u:null,mimeType:null,startTime:null,ud:null,uri:null},Va:!1}}));return t.vb=function(){},Eu(t)},Ns.prototype.detach=Ns.prototype.detach,Ns.prototype.xd=function(e){var t=this;if(e=void 0===e||e,this.h==wu)return Promise.reject(_u());et()||(e=!1);var n={za:null,u:null,mimeType:null,startTime:null,ud:null,uri:null},r=ws(this.lb,(function(r){var i=r.u&&e?t.hb:r.u?t.R:t.D;return n.u=r.u,{node:i,payload:n,Va:!1}}));return r.vb=function(){},Eu(r)},Ns.prototype.unload=Ns.prototype.xd,Ns.prototype.load=function(e,t,n){if(this.h==wu)return Promise.reject(_u());this.dispatchEvent(new Se("loading"));var r={za:null,u:null,mimeType:null,startTime:null,ud:null,uri:null};r.uri=e,r.ud=Date.now()/1e3,n&&"string"!=typeof n&&($n("Loading with a manifest parser factory","Please register a manifest parser and for the mime-type."),r.za=function(){return new n}),n&&"string"==typeof n&&(r.mimeType=n),void 0!==t&&(r.startTime=t);var i=function(e,t){if(t.za)return!1;if(!et())return!0;var n=t.mimeType,r=t.uri||"";return n||(n={mp4:"video/mp4",m4v:"video/mp4",m4a:"audio/mp4",webm:"video/webm",weba:"audio/webm",mkv:"video/webm",ts:"video/mp2t",ogv:"video/ogg",ogg:"audio/ogg",mpg:"video/mpeg",mpeg:"video/mpeg",m3u8:"application/x-mpegurl",mp3:"audio/mpeg",aac:"audio/aac",flac:"audio/flac",wav:"audio/wav"}[Ei.getExtension(r)]),!!n&&(!!tt(n)&&(!Ei.isSupported(r,n)||!!navigator.vendor&&navigator.vendor.includes("Apple")&&e.c.streaming.useNativeHlsOnSafari))}(this,r)?this.jb:this.T,o=ws(this.lb,(function(e){return null==e.u?null:(r.u=e.u,{node:i,payload:r,Va:!0})}));return o.vb=function(){},new Promise((function(e,t){o.nc=function(){return t(new me(2,7,7002))},o.lc=function(){return e()},o.Ya=function(){return t(_u())},o.onError=function(e){return t(e)}}))},Ns.prototype.load=Ns.prototype.load,Ns.prototype.configure=function(e,t){2==arguments.length&&"string"==typeof e&&(e=js(e,t));var n=Cs(this.c,e,Ks(this));return zs(this),n},Ns.prototype.configure=Ns.prototype.configure,Ns.prototype.getConfiguration=function(){var e=Ks(this);return Cs(e,this.c,Ks(this)),e},Ns.prototype.getConfiguration=Ns.prototype.getConfiguration,Ns.prototype.Mf=function(){for(var e in this.c)delete this.c[e];Cs(this.c,Ks(this),Ks(this)),zs(this)},Ns.prototype.resetConfiguration=Ns.prototype.Mf,Ns.prototype.Me=function(){return this.h},Ns.prototype.getLoadMode=Ns.prototype.Me,Ns.prototype.Re=function(){return this.a},Ns.prototype.getMediaElement=Ns.prototype.Re,Ns.prototype.Kb=function(){return this.L},Ns.prototype.getNetworkingEngine=Ns.prototype.Kb,Ns.prototype.ec=function(){return this.Eb},Ns.prototype.getAssetUri=Ns.prototype.ec,Ns.prototype.Pe=function(){return $n("getManifestUri",'Please use "getAssetUri" instead.'),this.ec()},Ns.prototype.getManifestUri=Ns.prototype.Pe,Ns.prototype.V=function(){return this.b?this.b.presentationTimeline.V():!(!this.a||!this.a.src)&&1/0==this.a.duration},Ns.prototype.isLive=Ns.prototype.V,Ns.prototype.Xa=function(){return!!this.b&&this.b.presentationTimeline.Xa()},Ns.prototype.isInProgress=Ns.prototype.Xa,Ns.prototype.ef=function(){if(this.b){if(!this.b.periods.length)return!1;var e=this.b.periods[0].variants;return!!e.length&&!e[0].video}return!(!this.a||!this.a.src)&&(this.a.videoTracks?0==this.a.videoTracks.length:0==this.a.videoHeight)},Ns.prototype.isAudioOnly=Ns.prototype.ef,Ns.prototype.Of=function(){if(this.b){var e=this.b.presentationTimeline;return{start:e.ob(),end:e.Ba()}}return this.a&&this.a.src&&(e=this.a.seekable).length?{start:e.start(0),end:e.end(e.length-1)}:{start:0,end:0}},Ns.prototype.seekRange=Ns.prototype.Of,Ns.prototype.keySystem=function(){return _t(this.drmInfo())},Ns.prototype.keySystem=Ns.prototype.keySystem,Ns.prototype.drmInfo=function(){return this.i?this.i.a:null},Ns.prototype.drmInfo=Ns.prototype.drmInfo,Ns.prototype.Jb=function(){return this.i?this.i.Jb():1/0},Ns.prototype.getExpiration=Ns.prototype.Jb,Ns.prototype.Tc=function(){return!!this.C&&this.C.a==Lo},Ns.prototype.isBuffering=Ns.prototype.Tc,Ns.prototype.Ue=function(){if(this.W){var e=this.W;e=e.f?0:e.c}else e=0;return e},Ns.prototype.getPlaybackRate=Ns.prototype.Ue,Ns.prototype.gg=function(e){0==e?X("A trick play rate of 0 is unsupported!"):(this.a.paused&&this.a.play(),this.W.set(e),this.h==Su&&ha(this.f,1<Math.abs(e)))},Ns.prototype.trickPlay=Ns.prototype.gg,Ns.prototype.we=function(){this.h==xu&&this.W.set(1),this.h==Su&&(this.W.set(1),ha(this.f,!1))},Ns.prototype.cancelTrickPlay=Ns.prototype.we,Ns.prototype.Sc=function(){if(this.b&&this.m){for(var e=yu(this),t=[],n=h(vu(this)),r=n.next();!r.done;r=n.next()){var i=Un(r=r.value);i.active=r==e,t.push(i)}return t}return this.a&&this.a.audioTracks?Array.from(this.a.audioTracks).map((function(e){var t=Hn(e);return t.active=e.enabled,t.type="variant",t.originalAudioId=e.id,"main"==e.kind?(t.primary=!0,t.roles=["main"],t.audioRoles=["main"]):t.audioRoles=[],t})):[]},Ns.prototype.getVariantTracks=Ns.prototype.Sc,Ns.prototype.qb=function(){if(this.b&&this.m){for(var e=function(e){var t=gu(e);if(null==t)return null;if(!bo(e.$,t).text){var n=qn(t.textStreams,e.na,e.fb);n.length&&_o(e.$,t,n[0])}return bo(e.$,t).text}(this),t=[],n=h(function(e){var t=gu(e);return null==t?[]:t.textStreams.filter((function(t){return!e.Zb.has(t)}))}(this)),r=n.next();!r.done;r=n.next()){var i=Fn(r=r.value);i.active=r==e,t.push(i)}return t}return this.a&&this.a.src&&this.a.textTracks?Array.from(this.a.textTracks).map((function(e){var t=Hn(e);return t.active="disabled"!=e.mode,t.type="text",t.originalTextId=e.id,"captions"==e.kind&&(t.mimeType="application/cea-608"),t})):[]},Ns.prototype.getTextTracks=Ns.prototype.qb,Ns.prototype.od=function(e){if(this.b&&this.f){var t=gu(this),n=t.textStreams.find((function(t){return t.id==e.id}));n&&(qs(this,t,n,!1),Js(this,n),this.na=n.language)}else if(this.a&&this.a.src&&this.a.textTracks){for(n=(t=h(t=Array.from(this.a.textTracks))).next();!n.done;n=t.next())Vn(n=n.value)==e.id?n.mode=this.gb?"showing":"hidden":n.mode="disabled";ou(this)}},Ns.prototype.selectTextTrack=Ns.prototype.od,Ns.prototype.Qf=function(){$n("selectEmbeddedTextTrack","If closed captions are signaled in the manifest, a text stream will be created to represent them. Please use SelectTextTrack.");var e=this.qb().filter((function(e){return"application/cea-608"==e.mimeType}));0<e.length&&this.od(e[0])},Ns.prototype.selectEmbeddedTextTrack=Ns.prototype.Qf,Ns.prototype.lg=function(){$n("usingEmbeddedTextTrack","If closed captions are signaled in the manifest, a text stream will be created to represent them. There should be no reason to know if the player is playing embedded text.");var e=this.qb().filter((function(e){return e.active}))[0];return!!e&&"application/cea-608"==e.mimeType},Ns.prototype.usingEmbeddedTextTrack=Ns.prototype.lg,Ns.prototype.Sf=function(e,t,n){if(n=void 0===n?0:n,this.b&&this.f){var r=gu(this);this.c.abr.enabled&&X("Changing tracks while abr manager is enabled will likely result in the selected track being overriden. Consider disabling abr before calling selectVariantTrack().");var i=r.variants.find((function(t){return t.id==e.id}));i&&zn(i)&&(Ws(this,r,i,!1),Xs(this,i,t,n),this.Fb=new Ao(i),Qs(this,r.variants))}else if(this.a&&this.a.audioTracks){for(n=(t=h(t=Array.from(this.a.audioTracks))).next();!n.done;n=t.next())Vn(n=n.value)==e.id&&(n.enabled=!0);iu(this)}},Ns.prototype.selectVariantTrack=Ns.prototype.Sf,Ns.prototype.He=function(){return mu(this.Sc())},Ns.prototype.getAudioLanguagesAndRoles=Ns.prototype.He,Ns.prototype.af=function(){return mu(this.qb())},Ns.prototype.getTextLanguagesAndRoles=Ns.prototype.af,Ns.prototype.Ge=function(){return Array.from(pu(this.Sc()))},Ns.prototype.getAudioLanguages=Ns.prototype.Ge,Ns.prototype.$e=function(){return Array.from(pu(this.qb()))},Ns.prototype.getTextLanguages=Ns.prototype.$e,Ns.prototype.Pf=function(e,t){if(this.b&&this.m){var n=gu(this);this.Fb=new Mo(e,t||"",0),tu(this,n)}else if(this.a&&this.a.audioTracks){for(var r=(n=h(n=Array.from(this.a.audioTracks))).next();!r.done;r=n.next())(r=r.value).language==e&&(r.enabled=!0);iu(this)}},Ns.prototype.selectAudioLanguage=Ns.prototype.Pf,Ns.prototype.Rf=function(e,t){if(this.b&&this.m){var n=gu(this);this.na=e,this.fb=t||"";var r=qn(n.textStreams,this.na,this.fb)[0]||null;r&&(qs(this,n,r,!1),(this.c.streaming.alwaysStreamText||this.ic())&&Js(this,r))}else(n=this.qb().filter((function(t){return t.language==e}))[0])&&this.od(n)},Ns.prototype.selectTextLanguage=Ns.prototype.Rf,Ns.prototype.Tf=function(e){if(this.b&&this.m){for(var t=gu(this),n=null,r=h(vu(this)),i=r.next();!i.done;i=r.next())if((i=i.value).audio.label==e){n=i;break}null!=n&&(this.Fb=new Mo(n.language,"",0,e),tu(this,t))}},Ns.prototype.selectVariantsByLabel=Ns.prototype.Tf,Ns.prototype.ic=function(){var e=this.gb;return this.b?this.F.g.isTextVisible():this.a&&this.a.src&&this.a.textTracks?Array.from(this.a.textTracks).some((function(e){return"showing"==e.mode})):e},Ns.prototype.isTextTrackVisible=Ns.prototype.ic,Ns.prototype.Wf=function(e){var t=this;return p((function n(){var r,i,o,a;return I(n,(function(n){switch(n.j){case 1:if(t.gb==(r=e))return n.return();if(t.gb=r,t.h!=Su){if(t.a&&t.a.src&&t.a.textTracks)for(var s=h(Array.from(t.a.textTracks)),u=s.next();!u.done;u=s.next())"disabled"!=(i=u.value).mode&&(i.mode=e?"showing":"hidden");n.A(2);break}if(t.F.g.setTextVisibility(e),t.c.streaming.alwaysStreamText){n.A(2);break}if(!e){(s=t.f).D=!0,(u=s.b.get("text"))&&(Ca(u),s.b.delete("text")),n.A(2);break}if(o=gu(t),!(0<(a=qn(o.textStreams,t.na,t.fb)).length)){n.A(2);break}return T(n,da(t.f,a[0]),2);case 2:au(t),S(n)}}))}))},Ns.prototype.setTextTrackVisibility=Ns.prototype.Wf,Ns.prototype.We=function(){if(!this.V())return null;if(this.b)return new Date(1e3*(this.b.presentationTimeline.f+this.a.currentTime));if(this.a&&this.a.getStartDate){var e=this.a.getStartDate();return isNaN(e.getTime())?null:new Date(e.getTime()+1e3*this.a.currentTime)}return null},Ns.prototype.getPlayheadTimeAsDate=Ns.prototype.We,Ns.prototype.Ye=function(){if(!this.V())return null;if(this.b)return new Date(1e3*this.b.presentationTimeline.f);if(this.a&&this.a.getStartDate){var e=this.a.getStartDate();return isNaN(e.getTime())?null:e}return null},Ns.prototype.getPresentationStartTimeAsDate=Ns.prototype.Ye,Ns.prototype.Oc=function(){var e={total:[],audio:[],video:[],text:[]};return this.h==xu&&(e.total=Ut(this.a.buffered)),this.h==Su&&this.F.Oc(e),e},Ns.prototype.getBufferedInfo=Ns.prototype.Oc,Ns.prototype.getStats=function(){if(this.h!=Su&&this.h!=xu)return{width:NaN,height:NaN,streamBandwidth:NaN,decodedFrames:NaN,droppedFrames:NaN,estimatedBandwidth:NaN,loadLatency:NaN,playTime:NaN,pauseTime:NaN,bufferingTime:NaN,switchHistory:[],stateHistory:[]};$s(this);var e=this.a;if(e.getVideoPlaybackQuality){e=e.getVideoPlaybackQuality();var t=this.v,n=Number(e.totalVideoFrames);t.i=Number(e.droppedVideoFrames),t.h=n}this.h==Su&&((e=yu(this))&&(this.v.l=e.bandwidth),e&&e.video&&(t=this.v,n=e.video.height||NaN,t.m=e.video.width||NaN,t.g=n),e=this.l.getBandwidthEstimate(),this.v.f=e);var r=this.v;e=r.m,t=r.g,n=r.l;for(var i=r.h,o=r.i,a=r.f,s=r.b,u=Ps(r.a,"playing"),l=Ps(r.a,"paused"),c=Ps(r.a,"buffering"),d=function(e){function t(e){return{timestamp:e.timestamp,state:e.state,duration:e.duration}}for(var n=[],r=h(e.b),i=r.next();!i.done;i=r.next())n.push(t(i.value));return e.a&&n.push(t(e.a)),n}(r.a),f=[],p=(r=h(r.c.a)).next();!p.done;p=r.next())p=p.value,f.push({timestamp:p.timestamp,id:p.id,type:p.type,fromAdaptation:p.fromAdaptation,bandwidth:p.bandwidth});return{width:e,height:t,streamBandwidth:n,decodedFrames:i,droppedFrames:o,estimatedBandwidth:a,loadLatency:s,playTime:u,pauseTime:l,bufferingTime:c,stateHistory:d,switchHistory:f}},Ns.prototype.getStats=Ns.prototype.getStats,Ns.prototype.addTextTrack=function(e,t,n,r,i,o){var a=this;return p((function s(){var u,l,c,d,h,f,p,m,v;return I(s,(function(s){switch(s.j){case 1:if(a.h==xu)throw Error("State error!");if(a.h!=Su)throw Error("State error!");if(u=gu(a),l=Ht,c=a.b.periods.indexOf(u),h=(d=c+1)>=a.b.periods.length?a.b.presentationTimeline.Y():a.b.periods[d].startTime,1/0==(f=h-u.startTime))throw new me(1,4,4033);return p=new ri(1,0,f,(function(){return[e]}),0,null),m={id:a.Kd++,originalId:null,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(){return 1},getSegmentReference:function(e){return 1==e?p:null},initSegmentReference:null,presentationTimeOffset:0,mimeType:r,codecs:i||"",kind:n,encrypted:!1,keyId:null,language:t,label:o||null,type:l.qa,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],channelsCount:null,audioSamplingRate:null,closedCaptions:null},a.Zb.add(m),u.textStreams.push(m),T(s,da(a.f,m),2);case 2:return(v=ca(a.f,"text"))&&_o(a.$,u,v),a.Zb.delete(m),eu(a,u),ru(a),s.return(Fn(m))}}))}))},Ns.prototype.addTextTrack=Ns.prototype.addTextTrack,Ns.prototype.qd=function(e,t){this.$b.width=e,this.$b.height=t},Ns.prototype.setMaxHardwareResolution=Ns.prototype.qd,Ns.prototype.nd=function(){if(this.h==Su){var e=this.f;if(e.f)e=!1;else if(e.m)e=!1;else{for(var t=h(e.b.values()),n=t.next();!n.done;n=t.next())(n=n.value).Nb&&(n.Nb=!1,La(e,n,.1));e=!0}}else e=!1;return e},Ns.prototype.retryStreaming=Ns.prototype.nd,Ns.prototype.Ne=function(){return this.b},Ns.prototype.getManifest=Ns.prototype.Ne,Ns.prototype.Oe=function(){return this.s?this.s.constructor:null},Ns.prototype.getManifestParserFactory=Ns.prototype.Oe,(r=Ns.prototype).Jc=function(e){var t=this.f?ua(this.f):null,n=this.f?la(this.f):null;if(Nn(this.i,t,n,e),!(t=e.variants).some(zn))throw new me(2,4,4011);if(hu(this,e.variants),Dn(t,this.c.restrictions,this.$b)&&this.f&&gu(this)==e&&ru(this),e=this.i?this.i.a:null)for(n=(t=h(t)).next();!n.done;n=t.next())for(var r=(n=h(n.value.drmInfos)).next();!r.done;r=n.next())if((r=r.value).keySystem==e.keySystem)for(var i=(r=h(r.initData||[])).next();!i.done;i=r.next())i=i.value,yt(this.i,i.initDataType,i.initData)},r.hf=function(e){try{this.kb=!0,this.l.disable(),su(this);var t=Qs(this,e.variants),n=qn(e.textStreams,this.na,this.fb)[0]||null;this.Ga&&(e.variants.includes(this.Ga)&&(t=this.Ga),this.Ga=null),this.oa&&(e.textStreams.includes(this.oa)&&(n=this.oa),this.oa=null),t&&Ws(this,e,t,!0),n&&qs(this,e,n,!0);var r=this.f,i=r.b.get("video");if(i)var o=r.c.periods[i.ia];else{var a=r.b.get("audio");o=a?r.c.periods[a.ia]:null}var s=t?t.audio:null;if(!o&&n){var u;if(u=s){e=n;var l=Cn(this.c.preferredTextLanguage),c=Cn(s.language),d=Cn(e.language);u=Rn(d,l)&&!Rn(c,d)}u&&(this.gb=!0),this.gb&&this.F.g.setTextVisibility(!0),au(this)}return this.c.streaming.alwaysStreamText||this.ic()?{variant:t,text:n}:{variant:t,text:null}}catch(e){return this.Ma(e),{variant:null,text:null}}},r.ve=function(){this.kb=!1,this.c.abr.enabled&&(this.l.enable(),su(this)),this.Ga&&(fa(this.f,this.Ga,this.Hd,this.Fd),iu(this),this.Ga=null),this.oa&&(pa(this.f,this.oa,!0,0,!1),ou(this),this.oa=null)},r.nf=function(){this.s&&this.s.update&&this.s.update()},r.uf=function(){this.m&&this.m.s()},r.Ma=function(e){if(this.h!=wu){var t=new Se("error",{detail:e});this.dispatchEvent(t),t.defaultPrevented&&(e.handled=!0)}};var wu=0,Tu=1,Su=2,xu=3;function Au(e,t){var n=ps(new fs(e.va(),e.ba()),t.periods[0],new wi(null,0)),r=t.appMetadata||{};return n=Mu(n),{offlineUri:e.toString(),originalManifestUri:t.originalManifestUri,duration:t.duration,size:t.size,expiration:t.expiration,tracks:n,appMetadata:r}}function Mu(e){for(var t=[],n=function(e){return e.filter((function(e){return zn(e)}))}(e.variants),r=(n=h(n)).next();!r.done;r=n.next())t.push(Un(r.value));for(n=(e=h(e.textStreams)).next();!n.done;n=e.next())t.push(Fn(n.value));return t}function ju(){this.a={}}function Ru(e,t){var n=e.a[t];return null==n&&(n=0),n}function Lu(e){this.a=!1,this.b=new ve,this.c=e}function Cu(e){var t=new Ou;e.periods.forEach((function(e,n){var r=Iu(e.variants);if(0==n)for(var i=(r=h(r.a)).next();!i.done;i=r.next())t.add(i.value);else!function(e,t){e.a=e.a.filter((function(e){return Pu(t,e)}))}(t,r)}));for(var n=(e=h(e.periods)).next();!n.done;n=e.next())(n=n.value).variants=n.variants.filter((function(e){return Pu(t,new ku(e))}))}function ku(e){var t=e.audio;e=e.video,this.b=t?t.mimeType:null,this.a=t?t.codecs.split(".")[0]:null,this.f=e?e.mimeType:null,this.c=e?e.codecs.split(".")[0]:null}function Ou(){this.a=[]}function Pu(e,t){return e.a.some((function(e){return t.b==e.b&&t.a==e.a&&t.f==e.f&&t.c==e.c}))}function Iu(e){for(var t=new Ou,n=(e=h(e)).next();!n.done;n=e.next())t.add(new ku(n.value));return t}function Du(e){var t=this;if(e&&e.constructor!=Ns)throw new me(2,9,9008);this.b=this.a=null,e?(this.a=e.c,this.b=e.Kb()):(this.a=Ls(),this.b=new Oe),this.f=!1,this.c=[],this.g=[];var n=!e;this.h=new Lu((function(){return p((function e(){var r;return I(e,(function(e){switch(e.j){case 1:return r=function(){},T(e,Promise.all(t.g.map((function(e){return e.then(r,r)}))),2);case 2:if(!n){e.A(3);break}return T(e,t.b.destroy(),3);case 3:t.a=null,t.b=null,S(e)}}))}))}))}function Nu(){if(et())e:{for(var e=h(Xa.values()),t=e.next();!t.done;t=e.next())if(t=(t=t.value)()){t.destroy(),e=!0;break e}e=!1}else e=!1;return e}function Bu(e,t){for(var n=[],r=h(e.periods),i=r.next();!i.done;i=r.next())for(var o=(i=h(i.value.streams)).next();!o.done;o=i.next())o=o.value,t&&"video"==o.contentType?n.push({contentType:Ze(o.mimeType,o.codecs),robustness:e.drmInfo.videoRobustness}):t||"audio"!=o.contentType||n.push({contentType:Ze(o.mimeType,o.codecs),robustness:e.drmInfo.audioRobustness});return n}function Uu(e,t,n){return p((function r(){return I(r,(function(r){switch(r.j){case 1:return T(r,function(e,t,n,r){return p((function i(){var o,a,s;return I(i,(function(i){switch(i.j){case 1:return r.drmInfo?(o=function(e){var t=Array.from(e.a.keys());if(!t.length)throw new me(2,9,9e3,"No supported storage mechanisms found");return e.a.get(t[0]).getEmeSessionCell()}(n),a=r.sessionIds.map((function(e){return{sessionId:e,keySystem:r.drmInfo.keySystem,licenseUri:r.drmInfo.licenseServerUri,serverCertificate:r.drmInfo.serverCertificate,audioCapabilities:Bu(r,!1),videoCapabilities:Bu(r,!0)}})),T(i,_s(t,e,a),2)):i.return();case 2:return s=i.o,T(i,o.remove(s),3);case 3:return T(i,o.add(a.filter((function(e){return-1==s.indexOf(e.sessionId)}))),0)}}))}))}(e.b,e.a.drm,n,t),0)}}))}))}function Fu(e,t,n,r){function i(){s+=1,e.a.offline.progressCallback(u,s/a)}var o=function(e){var t=[];return e.periods.forEach((function(e){e.streams.forEach((function(e){null!=e.initSegmentKey&&t.push(e.initSegmentKey),e.segments.forEach((function(e){t.push(e.dataKey)}))}))})),t}(r),a=o.length+1,s=0,u=Au(n,r);return Promise.all([t.removeSegments(o,i),t.removeManifests([n.key()],i)])}function Vu(e,t,n,r,i,o){var a={id:o.id,originalId:o.originalId,primary:o.primary,presentationTimeOffset:o.presentationTimeOffset||0,contentType:o.type,mimeType:o.mimeType,codecs:o.codecs,frameRate:o.frameRate,kind:o.kind,language:o.language,label:o.label,width:o.width||null,height:o.height||null,initSegmentKey:null,encrypted:o.encrypted,keyId:o.keyId,segments:[],variantIds:[]};i=i.presentationTimeline.Mb();var s=o.id,u=o.initSegmentReference;return u&&(u=Ti(u.c(),u.b,u.a,e.a.streaming.retryParameters),Ba(t,s,u,.5*Ru(r,o.id),!0,(function(t){return p((function r(){var i;return I(r,(function(r){switch(r.j){case 1:return T(r,n.addSegments([{data:t}]),2);case 2:i=r.o,e.c.push(i[0]),a.initSegmentKey=i[0],S(r)}}))}))}))),function(e,t,n){for(var r=null==(t=e.findSegmentPosition(t))?null:e.getSegmentReference(t);r;)n(r),r=e.getSegmentReference(++t)}(o,i,(function(i){var u=Ti(i.c(),i.b,i.a,e.a.streaming.retryParameters);Ba(t,s,u,function(e,t,n){return n=n.endTime-n.startTime,Ru(e,t)*n}(r,o.id,i),!1,(function(t){return p((function r(){var o;return I(r,(function(r){switch(r.j){case 1:return T(r,n.addSegments([{data:t}]),2);case 2:o=r.o,e.c.push(o[0]),a.segments.push({startTime:i.startTime,endTime:i.endTime,dataKey:o[0]}),S(r)}}))}))}))})),a}function Gu(e){if(e.h.a)throw new me(2,9,7001)}function Hu(){if(!Nu())throw new me(2,9,9e3)}function zu(e,t){return p((function n(){return I(n,(function(n){switch(n.j){case 1:return e.g.push(t),A(n,2),T(n,t,4);case 4:return n.return(n.o);case 2:R(n),Re(e.g,t),L(n,0)}}))}))}function Wu(e){for(var t=new Set,n=(e=h(e.periods)).next();!n.done;n=e.next()){for(var r=h((n=n.value).textStreams),i=r.next();!i.done;i=r.next())t.add(i.value);for(r=(n=h(n.variants)).next();!r.done;r=n.next())(r=r.value).audio&&t.add(r.audio),r.video&&t.add(r.video)}return t}function qu(e){e.variants.map((function(e){return e.video}));var t=new Set(e.variants.map((function(e){return e.audio})));e=e.textStreams;for(var n=h(t),r=n.next();!r.done;r=n.next())for(var i=(r=h(t)).next();!i.done;i=r.next());for(n=(t=h(e)).next();!n.done;n=t.next())for(r=(n=h(e)).next();!r.done;r=n.next());}Ns.LoadMode={DESTROYED:wu,NOT_LOADED:Tu,MEDIA_SOURCE:Su,SRC_EQUALS:xu},Lu.prototype.destroy=function(){var e=this;return this.a?this.b:(this.a=!0,this.c().then((function(){e.b.resolve()}),(function(){e.b.resolve()})))},Ou.prototype.add=function(e){Pu(this,e)||this.a.push(e)},G("shaka.offline.Storage",Du),Du.support=Nu,Du.prototype.destroy=function(){return this.h.destroy()},Du.prototype.destroy=Du.prototype.destroy,Du.prototype.configure=function(e,t){2==arguments.length&&"string"==typeof e&&(e=js(e,t));var n=e,r=!1;return null!=n.trackSelectionCallback&&(r=!0,n.offline=n.offline||{},n.offline.trackSelectionCallback=n.trackSelectionCallback,delete n.trackSelectionCallback),null!=n.progressCallback&&(r=!0,n.offline=n.offline||{},n.offline.progressCallback=n.progressCallback,delete n.progressCallback),null!=n.usePersistentLicense&&(r=!0,n.offline=n.offline||{},n.offline.usePersistentLicense=n.usePersistentLicense,delete n.usePersistentLicense),r&&$n("Storage.configure with OfflineConfig","Please configure storage with a player configuration."),Cs(this.a,e)},Du.prototype.configure=Du.prototype.configure,Du.prototype.getConfiguration=function(){var e=Ls();return Cs(e,this.a,Ls()),e},Du.prototype.getConfiguration=Du.prototype.getConfiguration,Du.prototype.Kb=function(){return this.b},Du.prototype.getNetworkingEngine=Du.prototype.Kb,Du.prototype.store=function(e,t,n){var r=this;return zu(this,function(e,t,n,r){return p((function i(){var o,a,s,u,l,c,d,f,m;return I(i,(function(i){switch(i.j){case 1:return Hu(),e.f?i.return(Promise.reject(new me(2,9,9006))):(e.f=!0,T(i,function(e,t,n){return p((function r(){var i,o,a,s,u,l;return I(r,(function(r){switch(r.j){case 1:return i=null,o=e.b,a={networkingEngine:o,filterAllPeriods:function(){},filterNewPeriod:function(){},onTimelineRegionAdded:function(){},onEvent:function(){},onError:function(e){i=e}},T(r,n(),2);case 2:return(s=r.o).configure(e.a.manifest),Gu(e),A(r,3),T(r,s.start(t,a),5);case 5:return u=r.o,Gu(e),l=Wu(u),T(r,Promise.all(Array.from(l).map((function(e){return e.createSegmentIndex()}))),6);case 6:if(Gu(e),i)throw i;return r.return(u);case 3:return R(r),T(r,s.stop(),7);case 7:L(r,0)}}))}))}(e,t,r),2));case 2:if(o=i.o,Gu(e),!(!o.presentationTimeline.V()&&!o.presentationTimeline.Xa()))throw new me(2,9,9005,t);return a=null,s=new qa,l=u=null,x(i,3,4),T(i,function(e,t,n){return p((function r(){var i,o,a;return I(r,(function(r){switch(r.j){case 1:return i=new ft({tb:e.b,onError:n,mc:function(){},onExpirationUpdated:function(){},onEvent:function(){}}),o=Uo(t.periods),a=e.a,i.configure(a.drm),T(r,function(e,t,n){return e.s=[],e.D=n,mt(e,t)}(i,o,a.offline.usePersistentLicense),2);case 2:return T(r,vt(i),3);case 3:return T(r,gt(i),4);case 4:return r.return(i)}}))}))}(e,o,(function(e){l=l||e})),6);case 6:if(a=i.o,Gu(e),l)throw l;return function(e,t,n){(function(e,t){for(var n={width:1/0,height:1/0},r=h(e.periods),i=r.next();!i.done;i=r.next())(i=i.value).variants=i.variants.filter((function(e){return In(e,t,n)}))})(t,e.a.restrictions),function(e){for(var t=(e=h(e.periods)).next();!t.done;t=e.next())(t=t.value).variants=t.variants.filter((function(e){var t=!0;return e.audio&&(t=t&&yn(e.audio)),e.video&&(t=t&&yn(e.video)),t}))}(t),function(e,t){for(var n=h(e.periods),r=n.next();!r.done;r=n.next())(r=r.value).variants=r.variants.filter((function(e){return jt(t,e)}))}(t,n),Cu(t),function(e,t){var n=new Ou;e.periods.forEach((function(e,r){0<r&&(e.variants=e.variants.filter((function(e){return Pu(n,new ku(e))}))),t(e),n=Iu(e.variants)}))}(t,(function(t){for(var n=[],r=h(t.variants),i=r.next();!i.done;i=r.next())n.push(Un(i.value));for(i=(r=h(t.textStreams)).next();!i.done;i=r.next())n.push(Fn(i.value));n=e.a.offline.trackSelectionCallback(n);var o=new Set,a=new Set;for(r=(n=h(n)).next();!r.done;r=n.next())"variant"==(r=r.value).type&&o.add(r.id),"text"==r.type&&a.add(r.id);t.variants=t.variants.filter((function(e){return o.has(e.id)})),t.textStreams=t.textStreams.filter((function(e){return a.has(e.id)}))})),function(e){if(0==e.periods.length)throw new me(2,4,4014);for(var t=(e=h(e.periods)).next();!t.done;t=e.next())qu(t.value)}(t)}(e,o,a),T(i,s.init(),7);case 7:return Gu(e),T(i,function(e){var t=null;if(e.a.forEach((function(e,n){e.getCells().forEach((function(e,r){e.hasFixedKeySpace()||t||(t={path:{va:n,ba:r},ba:e})}))})),t)return t;throw new me(2,9,9013,"Could not find a cell that supports add-operations")}(s),8);case 8:return u=i.o,Gu(e),T(i,function(e,t,n,r,i,o){return p((function a(){var s,u,l,c,d,f,m,v;return I(a,(function(a){switch(a.j){case 1:return s=function(e,t,n){var r=null==t.expiration?1/0:t.expiration;return{offlineUri:null,originalManifestUri:e,duration:t.presentationTimeline.Y(),size:0,expiration:r,tracks:t=Mu(t.periods[0]),appMetadata:n}}(i,r,o),u=r.periods.some((function(e){return e.variants.some((function(e){return e.drmInfos&&e.drmInfos.length}))})),l=r.periods.some((function(e){return e.variants.some((function(e){return e.drmInfos.some((function(e){return e.initData&&e.initData.length}))}))})),c=u&&!l,d=new Na(e.b,(function(t,n){s.size=n,e.a.offline.progressCallback(s,t)}),(function(t){c&&e.a.offline.usePersistentLicense&&yt(n,"cenc",t)})),A(a,2),m=f=function(e,t,n,r,i,o,a){var s=new ju,u=i.periods.map((function(r){return function(e,t,n,r,i,o){i.periods.forEach((function(e){e.variants.forEach((function(e){var t=e.audio,n=e.video;if(t&&!n&&(r.a[t.id]=t.bandwidth||e.bandwidth),!t&&n&&(r.a[n.id]=n.bandwidth||e.bandwidth),t&&n){var i=t.bandwidth||393216,o=n.bandwidth||e.bandwidth-i;0>=o&&(o=e.bandwidth),r.a[t.id]=i,r.a[n.id]=o}})),e.textStreams.forEach((function(e){r.a[e.id]=52}))}));for(var a=Wu(i),s=new Map,u=(a=h(a)).next();!u.done;u=a.next()){u=u.value;var l=Vu(e,t,n,r,i,u);s.set(u.id,l)}return o.variants.forEach((function(e){e.audio&&s.get(e.audio.id).variantIds.push(e.id),e.video&&s.get(e.video.id).variantIds.push(e.id)})),{startTime:o.startTime,streams:Array.from(s.values())}}(e,t,n,s,i,r)})),l=r.a,c=e.a.offline.usePersistentLicense;return l&&c&&(l.initData=[]),{originalManifestUri:o,duration:i.presentationTimeline.Y(),size:0,expiration:r.Jb(),periods:u,sessionIds:c?Et(r):[],drmInfo:l,appMetadata:a}}(e,d,t,n,r,i,o),T(a,function(e){return p((function t(){return I(t,(function(t){switch(t.j){case 1:return T(t,Promise.all(e.b.values()),2);case 2:return t.return(e.a.a)}}))}))}(d),4);case 4:if(m.size=a.o,f.expiration=n.Jb(),v=Et(n),f.sessionIds=e.a.offline.usePersistentLicense?v:[],u&&e.a.offline.usePersistentLicense&&!v.length)throw new me(2,9,9007);return a.return(f);case 2:return R(a),T(a,d.destroy(),5);case 5:L(a,0)}}))}))}(e,u.ba,a,o,t,n),9);case 9:if(c=i.o,Gu(e),l)throw l;return T(i,u.ba.addManifests([c]),10);case 10:return d=i.o,Gu(e),f=new ds("manifest",u.path.va,u.path.ba,d[0]),i.return(Au(f,c));case 4:return R(i),e.f=!1,e.c=[],T(i,s.destroy(),11);case 11:if(!a){i.A(12);break}return T(i,a.destroy(),12);case 12:L(i,0);break;case 3:if(m=j(i),!u){i.A(14);break}return T(i,u.ba.removeSegments(e.c,(function(){})),14);case 14:throw l||m}}))}))}(this,e,t||{},(function(){return p((function t(){var i,o;return I(t,(function(t){switch(t.j){case 1:return n&&"string"!=typeof n?($n("Storing with a manifest parser factory","Please register a manifest parser and for the mime-type."),i=n,t.return(new i)):T(t,Ei.create(e,r.b,r.a.manifest.retryParameters,n),2);case 2:return o=t.o,t.return(o)}}))}))})))},Du.prototype.store=Du.prototype.store,Du.prototype.Ze=function(){return this.f},Du.prototype.getStoreInProgress=Du.prototype.Ze,Du.prototype.remove=function(e){return zu(this,function(e,t){return p((function n(){var r,i,o,a,s,u;return I(n,(function(n){switch(n.j){case 1:return Hu(),null==(r=hs(t))||"manifest"!=r.a?n.return(Promise.reject(new me(2,9,9004,t))):(i=r,o=new qa,A(n,2),T(n,o.init(),4));case 4:return T(n,Ka(o,i.va(),i.ba()),5);case 5:return T(n,(a=n.o).getManifests([i.key()]),6);case 6:return s=n.o,u=s[0],T(n,Promise.all([Uu(e,u,o),Fu(e,a,i,u)]),2);case 2:return R(n),T(n,o.destroy(),8);case 8:L(n,0)}}))}))}(this,e))},Du.prototype.remove=Du.prototype.remove,Du.prototype.Jf=function(){return zu(this,function(e){return p((function t(){var n,r,i,o,a,s,u,l,c;return I(t,(function(t){switch(t.j){case 1:return Hu(),n=e.b,r=e.a.drm,i=new qa,o=!1,A(t,2),T(t,i.init(),4);case 4:for(a=[],function(e,t){e.a.forEach((function(e){t(e.getEmeSessionCell())}))}(i,(function(e){return a.push(e)})),s=Promise.resolve(),u={},l=h(a),c=l.next();!c.done;u={sc:u.sc},c=l.next())u.sc=c.value,s=s.then(function(e){return function(){return p((function t(){var i,a;return I(t,(function(t){switch(t.j){case 1:return T(t,e.sc.getAll(),2);case 2:return i=t.o,T(t,_s(r,n,i),3);case 3:return a=t.o,T(t,e.sc.remove(a),4);case 4:a.length!=i.length&&(o=!0),S(t)}}))}))}}(u));return T(t,s,2);case 2:return R(t),T(t,i.destroy(),6);case 6:L(t,3);break;case 3:return t.return(!o)}}))}))}(this))},Du.prototype.removeEmeSessions=Du.prototype.Jf,Du.prototype.list=function(){return zu(this,p((function e(){var t,n,r;return I(e,(function(e){switch(e.j){case 1:return Hu(),t=[],n=new qa,A(e,2),T(e,n.init(),4);case 4:return r=Promise.resolve(),function(e,t){e.a.forEach((function(e,n){e.getCells().forEach((function(e,r){t({va:n,ba:r},e)}))}))}(n,(function(e,n){r=r.then((function(){return p((function r(){return I(r,(function(r){switch(r.j){case 1:return T(r,n.getAllManifests(),2);case 2:r.o.forEach((function(n,r){var i=Au(new ds("manifest",e.va,e.ba,r),n);t.push(i)})),S(r)}}))}))}))})),T(e,r,2);case 2:return R(e),T(e,n.destroy(),6);case 6:L(e,3);break;case 3:return e.return(t)}}))})))},Du.prototype.list=Du.prototype.list,Du.deleteAll=function(){return p((function e(){var t;return I(e,(function(e){switch(e.j){case 1:return t=new qa,A(e,2),T(e,t.erase(),2);case 2:return R(e),T(e,t.destroy(),5);case 5:L(e,0)}}))}))},Fs.offline=Nu,G("shaka.polyfill.installAll",(function(){for(var e=0;e<Xu.length;++e)try{Xu[e].te()}catch(e){X("Error installing polyfill!",e)}}));var Ku,Yu,Xu=[];function Ju(e,t){for(var n={priority:t=t||0,te:e},r=0;r<Xu.length;r++)if(Xu[r].priority<t)return void Xu.splice(r,0,n);Xu.push(n)}function Zu(e){var t=e.type.replace(/^(webkit|moz|MS)/,"").toLowerCase();if("function"==typeof Event)var n=new Event(t,e);else(n=document.createEvent("Event")).initEvent(t,e.bubbles,e.cancelable);e.target.dispatchEvent(n)}function $u(e,t,n){if("input"==e)switch(this.type){case"range":e="change"}HTMLInputElement.prototype.originalAddEventListener.call(this,e,t,n)}function Qu(){var e=MediaSource.prototype.addSourceBuffer;MediaSource.prototype.addSourceBuffer=function(t){for(var n=[],r=0;r<arguments.length;++r)n[r]=arguments[r];return(n=e.apply(this,n)).abort=function(){},n}}function el(e,t){try{var n=new tl(e,t);return Promise.resolve(n)}catch(e){return Promise.reject(e)}}function tl(e,t){if(this.keySystem=e,e.startsWith("com.apple.fps"))for(var n=h(t),r=n.next();!r.done;r=n.next()){var i=r.value;if("required"==i.persistentState)r=null;else{r={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:i.initDataTypes,sessionTypes:["temporary"],label:i.label};var o=!1,a=!1;if(i.audioCapabilities)for(var s=h(i.audioCapabilities),u=s.next();!u.done;u=s.next())if((u=u.value).contentType){o=!0;var l=u.contentType.split(";")[0];WebKitMediaKeys.isTypeSupported(this.keySystem,l)&&(r.audioCapabilities.push(u),a=!0)}if(i.videoCapabilities)for(u=(i=h(i.videoCapabilities)).next();!u.done;u=i.next())(s=u.value).contentType&&(o=!0,u=s.contentType.split(";")[0],WebKitMediaKeys.isTypeSupported(this.keySystem,u)&&(r.videoCapabilities.push(s),a=!0));o||(a=WebKitMediaKeys.isTypeSupported(this.keySystem,"video/mp4")),r=a?r:null}if(r)return void(this.a=r)}throw(n=Error("Unsupported keySystem")).name="NotSupportedError",n.code=DOMException.NOT_SUPPORTED_ERR,n}function nl(e){var t=this.mediaKeys;return t&&t!=e&&il(t,null),delete this.mediaKeys,(this.mediaKeys=e)?il(e,this):Promise.resolve()}function rl(e){this.b=new WebKitMediaKeys(e),this.a=new He}function il(e,t){if(e.a.$a(),!t)return Promise.resolve();e.a.w(t,"webkitneedkey",al);try{return 1<=t.readyState?t.webkitSetMediaKeys(e.b):e.a.da(t,"loadedmetadata",(function(){t.webkitSetMediaKeys(e.b)})),Promise.resolve()}catch(e){return Promise.reject(e)}}function ol(e){Ae.call(this),this.b=null,this.g=e,this.c=this.a=null,this.f=new He,this.sessionId="",this.expiration=NaN,this.closed=new ve,this.keyStatuses=new ul}function al(e){var t=new Event("encrypted");t.initDataType="cenc",t.initData=e.initData,this.dispatchEvent(t)}function sl(e,t){var n=e.keyStatuses;n.size=null==t?0:1,n.a=t,e.dispatchEvent(new Se("keystatuseschange"))}function ul(){this.size=0,this.a=void 0}function ll(e,t){try{var n=new cl(e,t);return Promise.resolve(n)}catch(e){return Promise.reject(e)}}function cl(e,t){this.keySystem=e;for(var n=!1,r=0;r<t.length;++r){var i=t[r],o={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:i.initDataTypes,sessionTypes:["temporary"],label:i.label},a=!1;if(i.audioCapabilities)for(var s=0;s<i.audioCapabilities.length;++s){var u=i.audioCapabilities[s];if(u.contentType){a=!0;var l=u.contentType.split(";")[0];MSMediaKeys.isTypeSupported(this.keySystem,l)&&(o.audioCapabilities.push(u),n=!0)}}if(i.videoCapabilities)for(s=0;s<i.videoCapabilities.length;++s)(u=i.videoCapabilities[s]).contentType&&(a=!0,l=u.contentType.split(";")[0],MSMediaKeys.isTypeSupported(this.keySystem,l)&&(o.videoCapabilities.push(u),n=!0));if(a||(n=MSMediaKeys.isTypeSupported(this.keySystem,"video/mp4")),"required"==i.persistentState&&(n=!1),n)return void(this.a=o)}throw(n=Error("Unsupported keySystem")).name="NotSupportedError",n.code=DOMException.NOT_SUPPORTED_ERR,n}function dl(e){var t=this.mediaKeys;return t&&t!=e&&fl(t,null),delete this.mediaKeys,(this.mediaKeys=e)?fl(e,this):Promise.resolve()}function hl(e){this.a=new MSMediaKeys(e),this.b=new He}function fl(e,t){if(e.b.$a(),!t)return Promise.resolve();e.b.w(t,"msneedkey",ml);var n=e;try{return 1<=t.readyState?t.msSetMediaKeys(e.a):t.addEventListener("loadedmetadata",(function e(){t.msSetMediaKeys(n.a),t.removeEventListener("loadedmetadata",e)})),Promise.resolve()}catch(e){return Promise.reject(e)}}function pl(e){Ae.call(this),this.c=null,this.g=e,this.b=this.a=null,this.f=new He,this.sessionId="",this.expiration=NaN,this.closed=new ve,this.keyStatuses=new gl}function ml(e){if(e.initData){var t=document.createEvent("CustomEvent");t.initCustomEvent("encrypted",!1,!1,null),t.initDataType="cenc",t.initData=function(e){if(!e)return e;var t=new zr(e);if(1>=t.data.length)return e;e=[];for(var n={},r=(t=h(t.data)).next();!r.done;n={hc:n.hc},r=t.next())n.hc=r.value,e.some(function(e){return function(t){return ht.ya(t,e.hc)}}(n))||e.push(n.hc);return ht.concat.apply(ht,D(e))}(e.initData),this.dispatchEvent(t)}}function vl(e,t){var n=e.keyStatuses;n.size=null==t?0:1,n.a=t,e.dispatchEvent(new Se("keystatuseschange"))}function gl(){this.size=0,this.a=void 0}function yl(){return Promise.reject(Error("The key system specified is not supported."))}function _l(e){return null==e?Promise.resolve():Promise.reject(Error("MediaKeys not supported."))}function bl(){throw new TypeError("Illegal constructor.")}function El(){throw new TypeError("Illegal constructor.")}G("shaka.polyfill.register",Ju),Ju((function(){gc()}),-1),Ju((function(){if(e.Document){var t=Element.prototype;t.requestFullscreen=t.requestFullscreen||t.mozRequestFullScreen||t.msRequestFullscreen||t.webkitRequestFullscreen,(t=Document.prototype).exitFullscreen=t.exitFullscreen||t.mozCancelFullScreen||t.msExitFullscreen||t.webkitExitFullscreen,"fullscreenElement"in document||(Object.defineProperty(document,"fullscreenElement",{get:function(){return document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement}}),Object.defineProperty(document,"fullscreenEnabled",{get:function(){return document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitSupportsFullscreen||document.webkitFullscreenEnabled}})),document.addEventListener("webkitfullscreenchange",Zu),document.addEventListener("webkitfullscreenerror",Zu),document.addEventListener("mozfullscreenchange",Zu),document.addEventListener("mozfullscreenerror",Zu),document.addEventListener("MSFullscreenChange",Zu),document.addEventListener("MSFullscreenError",Zu)}})),Ju((function(){var t=!1;if(nt("CrKey"))t=!0;else try{e.indexedDB&&(t=!1)}catch(e){t=!0}t&&delete e.indexedDB})),Ju((function(){nt("Trident/")&&!HTMLInputElement.prototype.originalAddEventListener&&(HTMLInputElement.prototype.originalAddEventListener=HTMLInputElement.prototype.addEventListener,HTMLInputElement.prototype.addEventListener=$u)})),Ju((function(){navigator.languages||Object.defineProperty(navigator,"languages",{get:function(){return navigator.language?[navigator.language]:["en"]}})})),Ju((function(){})),Ju((function(){if(e.MediaSource)if(e.cast&&cast.__platform__&&cast.__platform__.canDisplayType)!function(){var e=MediaSource.isTypeSupported,t=/^dv(?:h[e1]|a[v1])\./;MediaSource.isTypeSupported=function(n){for(var r=n.split(/ *; */),i=r[0],o={},a=1;a<r.length;++a){var s=r[a].split("="),u=s[0];s=s[1].replace(/"(.*)"/,"$1"),o[u]=s}if(!(r=o.codecs))return e(n);var l=!1,c=!1;for(var d in n=r.split(",").filter((function(e){return t.test(e)&&(c=!0),/^(hev|hvc)1\.2/.test(e)&&(l=!0),!0})),c&&(l=!1),o.codecs=n.join(","),l&&(o.eotf="smpte2084"),o)i+="; "+d+'="'+o[d]+'"';return cast.__platform__.canDisplayType(i)}}();else if(navigator.vendor&&navigator.vendor.includes("Apple")){var t=navigator.appVersion.match(/Version\/(\d+)/);t=parseInt(t[1],10),function(){var e=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(t){return"mp2t"!=t.split(/ *; */)[0].split("/")[1].toLowerCase()&&e(t)}}(),10>=t?e.MediaSource=null:12>=t?(Qu(),function(){var e=SourceBuffer.prototype.remove;SourceBuffer.prototype.remove=function(t,n){return e.call(this,t,n-.001)}}()):Qu()}else nt("Tizen")&&function(){var e=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(t){return"opus"!=$e(t)[0]&&e(t)}}()})),tl.prototype.createMediaKeys=function(){var e=new rl(this.keySystem);return Promise.resolve(e)},tl.prototype.getConfiguration=function(){return this.a},rl.prototype.createSession=function(e){if("temporary"!=(e=e||"temporary"))throw new TypeError("Session type "+e+" is unsupported on this platform.");return new ol(this.b,e)},rl.prototype.setServerCertificate=function(e){return e&&new Uint8Array(e),Promise.resolve(!0)},H(ol,Ae),(r=ol.prototype).generateRequest=function(e,t){this.a=new ve;try{this.b=this.g.createSession("video/mp4",new Uint8Array(t)),this.sessionId=this.b.sessionId||"",this.f.w(this.b,"webkitkeymessage",this.ag.bind(this)),this.f.w(this.b,"webkitkeyadded",this.Zf.bind(this)),this.f.w(this.b,"webkitkeyerror",this.$f.bind(this)),sl(this,"status-pending")}catch(e){this.a.reject(e)}return this.a},r.load=function(){return Promise.reject(Error("MediaKeySession.load not yet supported"))},r.update=function(e){this.c=new ve;try{this.b.update(new Uint8Array(e))}catch(e){this.c.reject(e)}return this.c},r.close=function(){try{this.b.close(),this.closed.resolve(),this.f.$a()}catch(e){this.closed.reject(e)}return this.closed},r.remove=function(){return Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"))},r.ag=function(e){this.a&&(this.a.resolve(),this.a=null),this.dispatchEvent(new Se("message",{messageType:null==this.keyStatuses.a?"license-request":"license-renewal",message:e.message.buffer}))},r.Zf=function(){this.c&&(sl(this,"usable"),this.c.resolve(),this.c=null)},r.$f=function(){var e=Error("EME PatchedMediaKeysApple key error");if(e.errorCode=this.b.error,null!=this.a)this.a.reject(e),this.a=null;else if(null!=this.c)this.c.reject(e),this.c=null;else switch(this.b.error.code){case WebKitMediaKeyError.MEDIA_KEYERR_OUTPUT:case WebKitMediaKeyError.MEDIA_KEYERR_HARDWARECHANGE:sl(this,"output-not-allowed");break;default:sl(this,"internal-error")}},(r=ul.prototype).forEach=function(e){this.a&&e(this.a,Ku)},r.get=function(e){if(this.has(e))return this.a},r.has=function(e){var t=Ku;return!(!this.a||!ht.ya(new Uint8Array(e),new Uint8Array(t)))},r.entries=function(){},r.keys=function(){},r.values=function(){},Ju((function(){e.HTMLVideoElement&&e.WebKitMediaKeys&&(Ku=new Uint8Array([0]).buffer,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=nl,e.MediaKeys=rl,e.MediaKeySystemAccess=tl,navigator.requestMediaKeySystemAccess=el)})),cl.prototype.createMediaKeys=function(){var e=new hl(this.keySystem);return Promise.resolve(e)},cl.prototype.getConfiguration=function(){return this.a},hl.prototype.createSession=function(e){if("temporary"!=(e=e||"temporary"))throw new TypeError("Session type "+e+" is unsupported on this platform.");return new pl(this.a,e)},hl.prototype.setServerCertificate=function(){return Promise.resolve(!1)},H(pl,Ae),(r=pl.prototype).generateRequest=function(e,t){this.a=new ve;try{this.c=this.g.createSession("video/mp4",new Uint8Array(t),null),this.f.w(this.c,"mskeymessage",this.sf.bind(this)),this.f.w(this.c,"mskeyadded",this.qf.bind(this)),this.f.w(this.c,"mskeyerror",this.rf.bind(this)),vl(this,"status-pending")}catch(e){this.a.reject(e)}return this.a},r.load=function(){return Promise.reject(Error("MediaKeySession.load not yet supported"))},r.update=function(e){this.b=new ve;try{this.c.update(new Uint8Array(e))}catch(e){this.b.reject(e)}return this.b},r.close=function(){try{this.c.close(),this.closed.resolve(),this.f.$a()}catch(e){this.closed.reject(e)}return this.closed},r.remove=function(){return Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"))},r.sf=function(e){this.a&&(this.a.resolve(),this.a=null),this.dispatchEvent(new Se("message",{messageType:null==this.keyStatuses.a?"license-request":"license-renewal",message:e.message.buffer}))},r.qf=function(){this.a?(vl(this,"usable"),this.a.resolve(),this.a=null):this.b&&(vl(this,"usable"),this.b.resolve(),this.b=null)},r.rf=function(){var e=Error("EME PatchedMediaKeysMs key error");if(e.errorCode=this.c.error,null!=this.a)this.a.reject(e),this.a=null;else if(null!=this.b)this.b.reject(e),this.b=null;else switch(this.c.error.code){case MSMediaKeyError.MS_MEDIA_KEYERR_OUTPUT:case MSMediaKeyError.MS_MEDIA_KEYERR_HARDWARECHANGE:vl(this,"output-not-allowed");break;default:vl(this,"internal-error")}},(r=gl.prototype).forEach=function(e){this.a&&e(this.a,Yu)},r.get=function(e){if(this.has(e))return this.a},r.has=function(e){var t=Yu;return!(!this.a||!ht.ya(new Uint8Array(e),new Uint8Array(t)))},r.entries=function(){},r.keys=function(){},r.values=function(){},Ju((function(){!e.HTMLVideoElement||!e.MSMediaKeys||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration||(Yu=new Uint8Array([0]).buffer,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=dl,e.MediaKeys=hl,e.MediaKeySystemAccess=cl,navigator.requestMediaKeySystemAccess=ll)})),bl.prototype.createSession=function(){},bl.prototype.setServerCertificate=function(){},El.prototype.getConfiguration=function(){},El.prototype.createMediaKeys=function(){},Ju((function(){!e.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration||(navigator.requestMediaKeySystemAccess=yl,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=_l,e.MediaKeys=bl,e.MediaKeySystemAccess=El)}),-10);var wl,Tl="";function Sl(e){return Tl?Tl+e.charAt(0).toUpperCase()+e.slice(1):e}function xl(e,t){try{var n=new Ml(e,t);return Promise.resolve(n)}catch(e){return Promise.reject(e)}}function Al(e){var t=this.mediaKeys;return t&&t!=e&&Rl(t,null),delete this.mediaKeys,(this.mediaKeys=e)&&Rl(e,this),Promise.resolve()}function Ml(e,t){this.a=this.keySystem=e;var n=!1;"org.w3.clearkey"==e&&(this.a="webkit-org.w3.clearkey",n=!1);var r=!1,i=document.getElementsByTagName("video");i=i.length?i[0]:document.createElement("video");for(var o=0;o<t.length;++o){var a=t[o],s={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:a.initDataTypes,sessionTypes:["temporary"],label:a.label},u=!1;if(a.audioCapabilities)for(var l=0;l<a.audioCapabilities.length;++l){var c=a.audioCapabilities[l];if(c.contentType){u=!0;var d=c.contentType.split(";")[0];i.canPlayType(d,this.a)&&(s.audioCapabilities.push(c),r=!0)}}if(a.videoCapabilities)for(l=0;l<a.videoCapabilities.length;++l)(c=a.videoCapabilities[l]).contentType&&(u=!0,i.canPlayType(c.contentType,this.a)&&(s.videoCapabilities.push(c),r=!0));if(u||(r=i.canPlayType("video/mp4",this.a)||i.canPlayType("video/webm",this.a)),"required"==a.persistentState&&(n?(s.persistentState="required",s.sessionTypes=["persistent-license"]):r=!1),r)return void(this.b=s)}throw n="Unsupported keySystem","org.w3.clearkey"!=e&&"com.widevine.alpha"!=e||(n="None of the requested configurations were supported."),(n=Error(n)).name="NotSupportedError",n.code=DOMException.NOT_SUPPORTED_ERR,n}function jl(e){this.g=e,this.b=null,this.a=new He,this.c=[],this.f={}}function Rl(e,t){e.b=t,e.a.$a();var n=Tl;t&&(e.a.w(t,n+"needkey",e.xf.bind(e)),e.a.w(t,n+"keymessage",e.dg.bind(e)),e.a.w(t,n+"keyadded",e.bg.bind(e)),e.a.w(t,n+"keyerror",e.cg.bind(e)))}function Ll(e,t){var n=e.f[t];return n||((n=e.c.shift())?(n.sessionId=t,e.f[t]=n):null)}function Cl(e,t,n){Ae.call(this),this.f=e,this.h=!1,this.a=this.b=null,this.c=t,this.g=n,this.sessionId="",this.expiration=NaN,this.closed=new ve,this.keyStatuses=new Pl}function kl(e,t,n){if(e.h)return Promise.reject(Error("The session is already initialized."));e.h=!0;try{if("persistent-license"==e.g)if(n)var r=new Uint8Array(ut("LOAD_SESSION|"+n));else{var i=ut("PERSISTENT|"),o=new Uint8Array(i.byteLength+t.byteLength);o.set(new Uint8Array(i),0),o.set(new Uint8Array(t),i.byteLength),r=o}else r=new Uint8Array(t)}catch(e){return Promise.reject(e)}e.b=new ve;var a=Sl("generateKeyRequest");try{e.f[a](e.c,r)}catch(t){if("InvalidStateError"!=t.name)return e.b=null,Promise.reject(t);new he((function(){try{e.f[a](e.c,r)}catch(t){e.b.reject(t),e.b=null}})).P(.01)}return e.b}function Ol(e,t){var n=e.keyStatuses;n.size=null==t?0:1,n.a=t,e.dispatchEvent(new Se("keystatuseschange"))}function Pl(){this.size=0,this.a=void 0}function Il(e){if("picture-in-picture"==(e=e.target).webkitPresentationMode){document.pictureInPictureElement=e;var t=new Event("enterpictureinpicture");e.dispatchEvent(t)}else document.pictureInPictureElement==e&&(document.pictureInPictureElement=null),t=new Event("leavepictureinpicture"),e.dispatchEvent(t)}function Dl(){return this.webkitSupportsPresentationMode("picture-in-picture")?(this.webkitSetPresentationMode("picture-in-picture"),document.pictureInPictureElement=this,Promise.resolve()):Promise.reject(Error("PiP not allowed by video element"))}function Nl(){var e=document.pictureInPictureElement;return e?(e.webkitSetPresentationMode("inline"),document.pictureInPictureElement=null,Promise.resolve()):Promise.reject(Error("No picture in picture element found"))}function Bl(){return{droppedVideoFrames:this.webkitDroppedFrameCount,totalVideoFrames:this.webkitDecodedFrameCount,corruptedVideoFrames:0,creationTime:NaN,totalFrameDelay:0}}function Ul(t,n,r){return new e.TextTrackCue(t,n,r)}function Fl(t,n,r){return new e.TextTrackCue(t+"-"+n+"-"+r,t,n,r)}function Vl(){}Ml.prototype.createMediaKeys=function(){var e=new jl(this.a);return Promise.resolve(e)},Ml.prototype.getConfiguration=function(){return this.b},(r=jl.prototype).createSession=function(e){if("temporary"!=(e=e||"temporary")&&"persistent-license"!=e)throw new TypeError("Session type "+e+" is unsupported on this platform.");var t=this.b||document.createElement("video");return t.src||(t.src="about:blank"),e=new Cl(t,this.g,e),this.c.push(e),e},r.setServerCertificate=function(){return Promise.resolve(!1)},r.xf=function(e){var t=document.createEvent("CustomEvent");t.initCustomEvent("encrypted",!1,!1,null),t.initDataType="webm",t.initData=e.initData,this.b.dispatchEvent(t)},r.dg=function(e){var t=Ll(this,e.sessionId);t&&(e=new Se("message",{messageType:null==t.keyStatuses.a?"licenserequest":"licenserenewal",message:e.message}),t.b&&(t.b.resolve(),t.b=null),t.dispatchEvent(e))},r.bg=function(e){(e=Ll(this,e.sessionId))&&(Ol(e,"usable"),e.a&&e.a.resolve(),e.a=null)},r.cg=function(e){var t=Ll(this,e.sessionId);t&&t.handleError(e)},H(Cl,Ae),(r=Cl.prototype).handleError=function(e){var t=Error("EME v0.1b key error");t.errorCode=e.errorCode,t.errorCode.systemCode=e.systemCode,!e.sessionId&&this.b?(t.method="generateRequest",45==e.systemCode&&(t.message="Unsupported session type."),this.b.reject(t),this.b=null):e.sessionId&&this.a?(t.method="update",this.a.reject(t),this.a=null):(t=e.systemCode,e.errorCode.code==MediaKeyError.MEDIA_KEYERR_OUTPUT?Ol(this,"output-restricted"):Ol(this,1==t?"expired":"internal-error"))},r.td=function(e,t){if(this.a)this.a.then(this.td.bind(this,e,t)).catch(this.td.bind(this,e,t));else{if(this.a=e,"webkit-org.w3.clearkey"==this.c){var n=ot(t),r=JSON.parse(n);"oct"!=r.keys[0].kty&&(this.a.reject(Error("Response is not a valid JSON Web Key Set.")),this.a=null),n=ht.Aa(r.keys[0].k),r=ht.Aa(r.keys[0].kid)}else n=new Uint8Array(t),r=null;var i=Sl("addKey");try{this.f[i](this.c,n,r,this.sessionId)}catch(e){this.a.reject(e),this.a=null}}},r.generateRequest=function(e,t){return kl(this,t,null)},r.load=function(e){return"persistent-license"==this.g?kl(this,null,e):Promise.reject(Error("Not a persistent session."))},r.update=function(e){var t=new ve;return this.td(t,e),t},r.close=function(){if("persistent-license"!=this.g){if(!this.sessionId)return this.closed.reject(Error("The session is not callable.")),this.closed;var e=Sl("cancelKeyRequest");try{this.f[e](this.c,this.sessionId)}catch(e){}}return this.closed.resolve(),this.closed},r.remove=function(){return"persistent-license"!=this.g?Promise.reject(Error("Not a persistent session.")):this.close()},(r=Pl.prototype).forEach=function(e){this.a&&e(this.a,wl)},r.get=function(e){if(this.has(e))return this.a},r.has=function(e){var t=wl;return!(!this.a||!ht.ya(new Uint8Array(e),new Uint8Array(t)))},r.entries=function(){},r.keys=function(){},r.values=function(){},Ju((function(){if(!(!e.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration)){if(HTMLMediaElement.prototype.webkitGenerateKeyRequest)Tl="webkit";else if(!HTMLMediaElement.prototype.generateKeyRequest)return;wl=new Uint8Array([0]).buffer,navigator.requestMediaKeySystemAccess=xl,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=Al,e.MediaKeys=jl,e.MediaKeySystemAccess=Ml}})),Ju((function(){if(e.HTMLVideoElement){var t=HTMLVideoElement.prototype;t.requestPictureInPicture&&document.exitPictureInPicture||!t.webkitSupportsPresentationMode||(document.pictureInPictureEnabled=!0,document.pictureInPictureElement=null,t.requestPictureInPicture=Dl,document.exitPictureInPicture=Nl,document.addEventListener("webkitpresentationmodechanged",Il,!0))}})),Ju((function(){if(e.HTMLMediaElement){var t=HTMLMediaElement.prototype.play;HTMLMediaElement.prototype.play=function(){var e=t.apply(this);return e&&e.catch((function(){})),e}}})),Ju((function(){if(e.HTMLVideoElement){var t=HTMLVideoElement.prototype;!t.getVideoPlaybackQuality&&"webkitDroppedFrameCount"in t&&(t.getVideoPlaybackQuality=Bl)}})),Ju((function(){if(!e.VTTCue&&e.TextTrackCue){var t=TextTrackCue.length;if(3==t)e.VTTCue=Ul;else if(6==t)e.VTTCue=Fl;else{try{var n=!!Ul(1,2,"")}catch(e){n=!1}n&&(e.VTTCue=Ul)}}})),Vl.prototype.parseInit=function(){},Vl.prototype.parseMedia=function(e,t){var n=ot(e),r=[],i=new DOMParser,o=null;if(""==n)return r;try{o=i.parseFromString(n,"text/xml")}catch(e){throw new me(2,2,2005,"Failed to parse TTML.")}if(o){if(n=o.getElementsByTagName("parsererror")[0])throw new me(2,2,2005,n.textContent);if(!(i=o.getElementsByTagName("tt")[0]))throw new me(2,2,2005,"TTML does not contain <tt> tag.");var a=Wr.getAttributeNS(i,"http://www.w3.org/ns/ttml#parameter","frameRate"),s=Wr.getAttributeNS(i,"http://www.w3.org/ns/ttml#parameter","subFrameRate"),u=Wr.getAttributeNS(i,"http://www.w3.org/ns/ttml#parameter","frameRateMultiplier"),l=Wr.getAttributeNS(i,"http://www.w3.org/ns/ttml#parameter","tickRate");if(o=i.getAttribute("xml:space")||"default",n=i.getAttribute("tts:extent"),"default"!=o&&"preserve"!=o)throw new me(2,2,2005,"Invalid xml:space value: "+o);o="default"==o,a=new lc(a,s,u,l),s=ec(i.getElementsByTagName("metadata")[0]),u=ec(i.getElementsByTagName("styling")[0]),l=ec(i.getElementsByTagName("layout")[0]);for(var c=[],d=0;d<l.length;d++){var f,p,m=l[d],v=u,g=n,y=new un,_=m.getAttribute("xml:id");if(_)y.id=_,_=null,g&&(_=Hl.exec(g)||Wl.exec(g)),g=_?Number(_[1]):null,_=_?Number(_[2]):null,(f=ic(m,v,"extent"))&&(null!=(f=(p=Hl.exec(f))||Wl.exec(f))&&(y.width=null!=g?100*Number(f[1])/g:Number(f[1]),y.height=null!=_?100*Number(f[2])/_:Number(f[2]),y.widthUnits=p||null!=g?ln:0,y.heightUnits=p||null!=_?ln:0)),(m=ic(m,v,"origin"))&&(null!=(f=(p=Hl.exec(m))||Wl.exec(m))&&(y.viewportAnchorX=null!=_?100*Number(f[1])/_:Number(f[1]),y.viewportAnchorY=null!=g?100*Number(f[2])/g:Number(f[2]),y.viewportAnchorUnits=p||null!=g?ln:0));else y=null;y&&c.push(y)}for(n=(n=i.getElementsByTagName("body")[0])?Array.from(n.querySelectorAll("[begin]")):[],i=(n=h(n)).next();!i.done;i=n.next())(i=tc(i.value,t.periodStart,a,s,u,l,c,o,!1))&&r.push(i)}return r};var Gl,Hl=/^(\d{1,2}(?:\.\d+)?|100)% (\d{1,2}(?:\.\d+)?|100)%$/,zl=/^(\d+px|\d+em)$/,Wl=/^(\d+)px (\d+)px$/,ql=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Kl=/^(?:(\d{2,}):)?(\d{2}):(\d{2})$/,Yl=/^(?:(\d{2,}):)?(\d{2}):(\d{2}\.\d{2,})$/,Xl=/^(\d*(?:\.\d*)?)f$/,Jl=/^(\d*(?:\.\d*)?)t$/,Zl=/^(?:(\d*(?:\.\d*)?)h)?(?:(\d*(?:\.\d*)?)m)?(?:(\d*(?:\.\d*)?)s)?(?:(\d*(?:\.\d*)?)ms)?$/,$l={left:nn,center:"center",right:"end",start:nn,end:"end"},Ql={left:"line-left",center:"center",right:"line-right"};function ec(e){var t=[];if(!e)return t;for(var n=h(e.childNodes),r=n.next();!r.done;r=n.next())(r=r.value).nodeType==Node.ELEMENT_NODE&&"br"!==r.nodeName&&(r=ec(r),t=t.concat(r));return t.length||t.push(e),t}function tc(e,t,n,r,i,o,a,s,u){if(u&&"br"==e.nodeName)return(e=new Kt(0,0,"")).spacer=!0,e;var l=/^[\s\n]*$/.test(e.textContent),c=e.nodeType==Node.ELEMENT_NODE&&!e.hasAttribute("begin")&&!e.hasAttribute("end");if(e.nodeType!=Node.ELEMENT_NODE||c&&l||c&&!u)return null;l=sc(e.getAttribute("begin"),n),c=sc(e.getAttribute("end"),n);var d=sc(e.getAttribute("dur"),n);if(null==c&&null!=d&&(c=l+d),!u&&(null==l||null==c))throw new me(2,2,2001);if(l+=t,c+=t,d="",u=[],Array.from(e.childNodes).find((function(e){return e.nodeType===Node.TEXT_NODE&&/\w+/.test(e.textContent)})))d=function e(t,n){for(var r="",i=h(t.childNodes),o=i.next();!o.done;o=i.next())"br"==(o=o.value).nodeName&&t.childNodes[0]!==o?r+="\n":o.childNodes&&0<o.childNodes.length?r+=e(o,n):n?r+=o=(o=o.textContent.trim()).replace(/\s+/g," "):r+=o.textContent;return r}(e,s);else for(var f=h(e.childNodes),p=f.next();!p.done;p=f.next())(p=tc(p.value,t,n,r,i,o,a,s,!0))&&u.push(p);if((t=new Kt(l,c,d)).nestedCues=u,(o=ac(e,"region",o,"")[0])&&o.getAttribute("xml:id")){var m=o.getAttribute("xml:id");t.region=a.filter((function(e){return e.id==m}))[0]}return function(e,t,n,r,i){"rtl"==rc(t,n,i,"direction")&&(e.direction="rtl");var o=rc(t,n,i,"writingMode");"tb"==o||"tblr"==o?e.writingMode="vertical-lr":"tbrl"==o?e.writingMode="vertical-rl":"rltb"==o||"rl"==o?e.direction="rtl":o&&(e.direction=Qt),(o=rc(t,n,i,"textAlign"))?(e.positionAlign=Ql[o],e.lineAlign=$l[o],e.textAlign=Jt[o.toUpperCase()]):e.textAlign="start",(o=rc(t,n,i,"displayAlign"))&&(e.displayAlign=$t[o.toUpperCase()]);(o=rc(t,n,i,"color"))&&(e.color=o);(o=rc(t,n,i,"backgroundColor"))&&(e.backgroundColor=o);(o=rc(t,n,i,"fontFamily"))&&(e.fontFamily=o);(o=rc(t,n,i,"fontWeight"))&&"bold"==o&&(e.fontWeight=700),(o=rc(t,n,i,"wrapOption"))&&"noWrap"==o&&(e.wrapLine=!1),(o=rc(t,n,i,"lineHeight"))&&o.match(zl)&&(e.lineHeight=o),(o=rc(t,n,i,"fontSize"))&&o.match(zl)&&(e.fontSize=o),(o=rc(t,n,i,"fontStyle"))&&(e.fontStyle=sn[o.toUpperCase()]);if(r){o=r.getAttribute("imagetype");var a=r.getAttribute("encoding");r=r.textContent.trim(),"PNG"==o&&"Base64"==a&&r&&(e.backgroundImage="data:image/png;base64,"+r)}(n=ic(n,i,"textDecoration"))&&nc(e,n),(t=oc(t,i,"textDecoration"))&&nc(e,t)}(t,e,o,r=ac(e,"smpte:backgroundImage",r,"#")[0],i),t}function nc(e,t){for(var n=t.split(" "),r=0;r<n.length;r++)switch(n[r]){case"underline":e.textDecoration.includes("underline")||e.textDecoration.push("underline");break;case"noUnderline":e.textDecoration.includes("underline")&&Re(e.textDecoration,"underline");break;case"lineThrough":e.textDecoration.includes("lineThrough")||e.textDecoration.push("lineThrough");break;case"noLineThrough":e.textDecoration.includes("lineThrough")&&Re(e.textDecoration,"lineThrough");break;case"overline":e.textDecoration.includes("overline")||e.textDecoration.push("overline");break;case"noOverline":e.textDecoration.includes("overline")&&Re(e.textDecoration,"overline")}}function rc(e,t,n,r){return(e=oc(e,n,r))?e:ic(t,n,r)}function ic(e,t,n){for(var r=ec(e),i=0;i<r.length;i++){var o=Wr.getAttributeNS(r[i],"http://www.w3.org/ns/ttml#styling",n);if(o)return o}return(e=ac(e,"style",t,"")[0])?Wr.getAttributeNS(e,"http://www.w3.org/ns/ttml#styling",n):null}function oc(e,t,n){var r=Wr.getAttributeNS(e,"http://www.w3.org/ns/ttml#styling",n);if(r)return r;for(e=ac(e,"style",t,""),t=null,r=0;r<e.length;r++){var i=Wr.getAttributeNS(e[r],"http://www.w3.org/ns/ttml#styling",n);i&&(t=i)}return t}function ac(e,t,n,r){var i=[];if(!e||1>n.length)return i;var o=e;for(e=null;o&&!(e=o.getAttribute(t))&&(o=o.parentNode)instanceof Element;);if(t=e)for(e=(t=h(t=t.split(" "))).next();!e.done;e=t.next()){e=e.value;for(var a=(o=h(n)).next();!a.done;a=o.next())if(r+(a=a.value).getAttribute("xml:id")==e){i.push(a);break}}return i}function sc(e,t){var n=null;if(ql.test(e)){n=ql.exec(e);var r=Number(n[1]),i=Number(n[2]),o=Number(n[3]),a=Number(n[4]);n=(o+=(a+=(Number(n[5])||0)/t.b)/t.frameRate)+60*i+3600*r}else Kl.test(e)?n=uc(Kl,e):Yl.test(e)?n=uc(Yl,e):Xl.test(e)?(n=Xl.exec(e),n=Number(n[1])/t.frameRate):Jl.test(e)?(n=Jl.exec(e),n=Number(n[1])/t.a):Zl.test(e)&&(n=uc(Zl,e));return n}function uc(e,t){var n=e.exec(t);return null==n||""==n[0]?null:(Number(n[4])||0)/1e3+(Number(n[3])||0)+60*(Number(n[2])||0)+3600*(Number(n[1])||0)}function lc(e,t,n,r){this.frameRate=Number(e)||30,this.b=Number(t)||1,this.a=Number(r),0==this.a&&(this.a=e?this.frameRate*this.b:1),n&&(e=/^(\d+) (\d+)$/g.exec(n))&&(this.frameRate*=Number(e[1])/Number(e[2]))}function cc(){this.a=new Vl}function dc(){}function hc(e,t,n){var r;(r=/^align:(start|middle|center|end|left|right)$/.exec(t))?(t=r[1],e.textAlign="middle"==t?Xt:Jt[t.toUpperCase()]):(r=/^vertical:(lr|rl)$/.exec(t))?e.writingMode="lr"==r[1]?"vertical-lr":"vertical-rl":(r=/^size:([\d.]+)%$/.exec(t))?e.size=Number(r[1]):(r=/^position:([\d.]+)%(?:,(line-left|line-right|center|start|end))?$/.exec(t))?(e.position=Number(r[1]),r[2]&&(t=r[2],e.positionAlign="line-left"==t||"start"==t?"line-left":"line-right"==t||"end"==t?"line-right":"center")):(r=/^region:(.*)$/.exec(t))?(t=function(e,t){var n=e.filter((function(e){return e.id==t}));return n.length?n[0]:null}(n,r[1]))&&(e.region=t):(n=/^line:([\d.]+)%(?:,(start|end|center))?$/.exec(t))?(e.lineInterpretation=1,e.line=Number(n[1]),n[2]&&(e.lineAlign=rn[n[2].toUpperCase()])):(n=/^line:(-?\d+)(?:,(start|end|center))?$/.exec(t))&&(e.lineInterpretation=tn,e.line=Number(n[1]),n[2]&&(e.lineAlign=rn[n[2].toUpperCase()]))}function fc(e){if(null==(e=Vi(e,/(?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{3})/g)))return null;var t=Number(e[2]),n=Number(e[3]);return 59<t||59<n?null:Number(e[4])/1e3+n+60*t+3600*(Number(e[1])||0)}function pc(){this.a=null}function mc(e,t,n){var r,i,o;return(new Br).H("payl",Vr((function(e){r=ot(e)}))).H("iden",Vr((function(e){i=ot(e)}))).H("sttg",Vr((function(e){o=ot(e)}))).parse(e),r?function(e,t,n,r,i){if(e=new Kt(r,i,e),t&&(e.id=t),n)for(t=new Ui(n),n=Gi(t);n;)hc(e,n,[]),Fi(t),n=Gi(t);return e}(r,i,o,t,n):null}function vc(){}function gc(){Gl?console.debug("EmeEncryptionSchemePolyfill: Already installed."):navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration?(Gl=navigator.requestMediaKeySystemAccess,console.debug("EmeEncryptionSchemePolyfill: Waiting to detect encryptionScheme support."),navigator.requestMediaKeySystemAccess=yc):console.debug("EmeEncryptionSchemePolyfill: EME not found")}function yc(e,t){var n=this;return p((function r(){var i,o,a,s;return I(r,(function(r){switch(r.j){case 1:return console.assert(n==navigator,'bad "this" for requestMediaKeySystemAccess'),T(r,Gl.call(n,e,t),2);case 2:return i=r.o,o=i.getConfiguration(),a=o.videoCapabilities&&o.videoCapabilities[0],s=o.audioCapabilities&&o.audioCapabilities[0],void 0!==(a||s).encryptionScheme?(console.debug("EmeEncryptionSchemePolyfill: Native encryptionScheme support found."),navigator.requestMediaKeySystemAccess=Gl,r.return(i)):(console.debug("EmeEncryptionSchemePolyfill: No native encryptionScheme support found. Patching encryptionScheme support."),navigator.requestMediaKeySystemAccess=_c,r.return(_c.call(n,e,t)))}}))}))}function _c(e,t){var n=this;return p((function r(){var i,o,a,s,u,l,c,d;return I(r,(function(r){switch(r.j){case 1:console.assert(n==navigator,'bad "this" for requestMediaKeySystemAccess'),e.startsWith("com.widevine")||e.startsWith("com.microsoft")||e.startsWith("com.adobe")||e.startsWith("org.w3")?i="cenc":e.startsWith("com.apple")?i="cbcs-1-9":(console.warn("EmeEncryptionSchemePolyfill: Unknown key system:",e,"Please contribute!"),i=null),o=[];for(var f=h(t),p=f.next();!p.done;p=f.next())a=p.value,s=bc(a.videoCapabilities,i),u=bc(a.audioCapabilities,i),a.videoCapabilities&&a.videoCapabilities.length&&!s.length||a.audioCapabilities&&a.audioCapabilities.length&&!u.length||((l=Object.assign({},a)).videoCapabilities=s,l.audioCapabilities=u,o.push(l));if(!o.length)throw(c=Error("Unsupported keySystem or supportedConfigurations.")).name="NotSupportedError",c.code=DOMException.NOT_SUPPORTED_ERR,c;return T(r,Gl.call(n,e,o),2);case 2:return d=r.o,r.return(new Ec(d,i))}}))}))}function bc(e,t){return e?e.filter((function(e){return!e.encryptionScheme||e.encryptionScheme==t})):e}function Ec(e,t){this.b=e,this.a=t,this.keySystem=e.keySystem}hn["application/ttml+xml"]=Vl,cc.prototype.parseInit=function(e){var t=!1;if((new Br).H("moov",Ur).H("trak",Ur).H("mdia",Ur).H("minf",Ur).H("stbl",Ur).fa("stsd",Fr).H("stpp",(function(e){t=!0,e.parser.stop()})).parse(e),!t)throw new me(2,2,2007)},cc.prototype.parseMedia=function(e,t){var n=!1,r=[];if((new Br).H("mdat",Vr(function(e){n=!0,r=r.concat(this.a.parseMedia(e,t))}.bind(this))).parse(e),!n)throw new me(2,2,2007);return r},hn['application/mp4; codecs="stpp"']=cc,hn['application/mp4; codecs="stpp.TTML.im1t"']=cc,dc.prototype.parseInit=function(){},dc.prototype.parseMedia=function(e,t){var n=ot(e);if(n=(n=n.replace(/\r\n|\r(?=[^\n]|$)/gm,"\n")).split(/\n{2,}/m),!/^WEBVTT($|[ \t\n])/m.test(n[0]))throw new me(2,2,2e3);var r=t.segmentStart;if(null==r&&(r=0,n[0].includes("X-TIMESTAMP-MAP"))){var i=n[0].match(/LOCAL:((?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{3}))/m),o=n[0].match(/MPEGTS:(\d+)/m);if(i&&o){if(null==(r=fc(new Ui(i[1]))))throw new me(2,2,2e3);r=t.periodStart+(Number(o[1])/9e4-r)}}o=[];var a=n[0].split("\n");for(i=1;i<a.length;i++)if(/^Region:/.test(a[i])){var s=new Ui(a[i]),u=new un;Gi(s),Fi(s);for(var l=Gi(s);l;){var c=u,d=l;(l=/^id=(.*)$/.exec(d))?c.id=l[1]:(l=/^width=(\d{1,2}|100)%$/.exec(d))?c.width=Number(l[1]):(l=/^lines=(\d+)$/.exec(d))?(c.height=Number(l[1]),c.heightUnits=2):(l=/^regionanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(d))?(c.regionAnchorX=Number(l[1]),c.regionAnchorY=Number(l[2])):(l=/^viewportanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(d))?(c.viewportAnchorX=Number(l[1]),c.viewportAnchorY=Number(l[2])):/^scroll=up$/.exec(d)&&(c.scroll="up"),Fi(s),l=Gi(s)}o.push(u)}for(i=[],s=1;s<n.length;s++){if(l=a=n[s].split("\n"),d=r,a=o,1==l.length&&!l[0]||/^NOTE($|[ \t])/.test(l[0])||"STYLE"==l[0])a=null;else{u=null,l[0].includes("--\x3e")||(u=l[0],l.splice(0,1));var h=fc(c=new Ui(l[0])),f=Vi(c,/[ \t]+--\x3e[ \t]+/g),p=fc(c);if(null==h||null==f||null==p)throw new me(2,2,2001);for(l=new Kt(h+d,p+d,l.slice(1).join("\n").trim()),Fi(c),d=Gi(c);d;)hc(l,d,a),Fi(c),d=Gi(c);null!=u&&(l.id=u),a=l}a&&i.push(a)}return i},hn["text/vtt"]=dc,hn['text/vtt; codecs="vtt"']=dc,pc.prototype.parseInit=function(e){var t=!1;if((new Br).H("moov",Ur).H("trak",Ur).H("mdia",Ur).fa("mdhd",function(e){0==e.version?(e.reader.M(4),e.reader.M(4),this.a=e.reader.G(),e.reader.M(4)):(e.reader.M(8),e.reader.M(8),this.a=e.reader.G(),e.reader.M(8)),e.reader.M(4)}.bind(this)).H("minf",Ur).H("stbl",Ur).fa("stsd",Fr).H("wvtt",(function(){t=!0})).parse(e),!this.a)throw new me(2,2,2008);if(!t)throw new me(2,2,2008)},pc.prototype.parseMedia=function(e,t){var n=this;if(!this.a)throw new me(2,2,2008);var r,i=0,o=[],a=[],s=!1,u=!1,l=!1,c=null;if((new Br).H("moof",Ur).H("traf",Ur).fa("tfdt",(function(e){s=!0,i=0==e.version?e.reader.G():e.reader.Ab()})).fa("tfhd",(function(e){var t=e.flags;(e=e.reader).M(4),1&t&&e.M(8),2&t&&e.M(4),c=8&t?e.G():null})).fa("trun",(function(e){u=!0;var t=e.version,n=e.flags,r=(e=e.reader).G();1&n&&e.M(4),4&n&&e.M(4);for(var i=[],a=0;a<r;a++){var s={duration:null,sampleSize:null,vd:null};256&n&&(s.duration=e.G()),512&n&&(s.sampleSize=e.G()),1024&n&&e.M(4),2048&n&&(s.vd=0==t?e.G():e.$d()),i.push(s)}o=i})).H("mdat",Vr((function(e){l=!0,r=e}))).parse(e),!l&&!s&&!u)throw new me(2,2,2008);var d=i,h=new Ir(new DataView(r.buffer,r.byteOffset,r.byteLength),0);return o.forEach((function(e){var r=e.duration||c,o=e.vd?i+e.vd:d;d=o+(r||0);var s=0;do{var u=h.G();s+=u;var l=null;"vttc"==Hr(h.G())?8<u&&(l=h.Za(u-8)):h.M(u-8),r&&l&&a.push(mc(l,t.periodStart+o/n.a,t.periodStart+d/n.a))}while(e.sampleSize&&s<e.sampleSize)})),a.filter(Ft.Ia)},hn['application/mp4; codecs="wvtt"']=pc,G("shaka.util.Dom.createHTMLElement",(function(e){return document.createElement(e)})),G("shaka.util.Dom.createVideoElement",(function(){var e=document.createElement("video");return e.muted=!0,e.width=600,e.height=400,e})),G("shaka.util.Dom.asHTMLElement",(function(e){return e})),G("shaka.util.Dom.asHTMLMediaElement",(function(e){return e})),G("shaka.util.Dom.removeAllChildren",(function(e){for(;e.firstChild;)e.removeChild(e.firstChild)})),G("EmeEncryptionSchemePolyfill",vc),vc.install=gc,Ec.prototype.getConfiguration=function(){var e=this.b.getConfiguration();if(e.videoCapabilities)for(var t=h(e.videoCapabilities),n=t.next();!n.done;n=t.next())n.value.encryptionScheme=this.a;if(e.audioCapabilities)for(n=(t=h(e.audioCapabilities)).next();!n.done;n=t.next())n.value.encryptionScheme=this.a;return e},Ec.prototype.createMediaKeys=function(){return this.b.createMediaKeys()},n.De&&(n.De=vc)}.call(i,r,r),i.shaka)t[o]=i.shaka[o]}()}).call(this,n("./node_modules/webpack/buildin/global.js"),n("./node_modules/webpack/buildin/module.js")(e))},"./node_modules/three/build/three.module.js":function(e,t,n){"use strict";n.r(t),n.d(t,"ACESFilmicToneMapping",(function(){return ue})),n.d(t,"AddEquation",(function(){return L})),n.d(t,"AddOperation",(function(){return ne})),n.d(t,"AdditiveBlending",(function(){return A})),n.d(t,"AlphaFormat",(function(){return Ge})),n.d(t,"AlwaysDepth",(function(){return K})),n.d(t,"AlwaysStencilFunc",(function(){return dn})),n.d(t,"AmbientLight",(function(){return Jc})),n.d(t,"AmbientLightProbe",(function(){return _d})),n.d(t,"AnimationClip",(function(){return rc})),n.d(t,"AnimationLoader",(function(){return dc})),n.d(t,"AnimationMixer",(function(){return Xd})),n.d(t,"AnimationObjectGroup",(function(){return Kd})),n.d(t,"AnimationUtils",(function(){return zl})),n.d(t,"ArcCurve",(function(){return _c})),n.d(t,"ArrayCamera",(function(){return ps})),n.d(t,"ArrowHelper",(function(){return Nh})),n.d(t,"Audio",(function(){return Rd})),n.d(t,"AudioAnalyser",(function(){return Id})),n.d(t,"AudioContext",(function(){return pd})),n.d(t,"AudioListener",(function(){return jd})),n.d(t,"AudioLoader",(function(){return md})),n.d(t,"AxesHelper",(function(){return Bh})),n.d(t,"AxisHelper",(function(){return zf})),n.d(t,"BackSide",(function(){return g})),n.d(t,"BasicDepthPacking",(function(){return Wt})),n.d(t,"BasicShadowMap",(function(){return h})),n.d(t,"BinaryTextureLoader",(function(){return Xf})),n.d(t,"Bone",(function(){return qs})),n.d(t,"BooleanKeyframeTrack",(function(){return Jl})),n.d(t,"BoundingBoxHelper",(function(){return Wf})),n.d(t,"Box2",(function(){return ih})),n.d(t,"Box3",(function(){return xr})),n.d(t,"Box3Helper",(function(){return kh})),n.d(t,"BoxBufferGeometry",(function(){return no})),n.d(t,"BoxGeometry",(function(){return to})),n.d(t,"BoxHelper",(function(){return Ch})),n.d(t,"BufferAttribute",(function(){return ci})),n.d(t,"BufferGeometry",(function(){return Ri})),n.d(t,"BufferGeometryLoader",(function(){return nd})),n.d(t,"ByteType",(function(){return Ce})),n.d(t,"Cache",(function(){return oc})),n.d(t,"Camera",(function(){return so})),n.d(t,"CameraHelper",(function(){return jh})),n.d(t,"CanvasRenderer",(function(){return Zf})),n.d(t,"CanvasTexture",(function(){return yu})),n.d(t,"CatmullRomCurve3",(function(){return xc})),n.d(t,"CineonToneMapping",(function(){return se})),n.d(t,"CircleBufferGeometry",(function(){return Cl})),n.d(t,"CircleGeometry",(function(){return Ll})),n.d(t,"ClampToEdgeWrapping",(function(){return ye})),n.d(t,"Clock",(function(){return Td})),n.d(t,"ClosedSplineCurve3",(function(){return Vf})),n.d(t,"Color",(function(){return ti})),n.d(t,"ColorKeyframeTrack",(function(){return Zl})),n.d(t,"CompressedTexture",(function(){return gu})),n.d(t,"CompressedTextureLoader",(function(){return hc})),n.d(t,"ConeBufferGeometry",(function(){return Rl})),n.d(t,"ConeGeometry",(function(){return jl})),n.d(t,"CubeCamera",(function(){return lo})),n.d(t,"CubeGeometry",(function(){return to})),n.d(t,"CubeReflectionMapping",(function(){return ce})),n.d(t,"CubeRefractionMapping",(function(){return de})),n.d(t,"CubeTexture",(function(){return Po})),n.d(t,"CubeTextureLoader",(function(){return mc})),n.d(t,"CubeUVReflectionMapping",(function(){return me})),n.d(t,"CubeUVRefractionMapping",(function(){return ve})),n.d(t,"CubicBezierCurve",(function(){return Rc})),n.d(t,"CubicBezierCurve3",(function(){return Lc})),n.d(t,"CubicInterpolant",(function(){return ql})),n.d(t,"CullFaceBack",(function(){return s})),n.d(t,"CullFaceFront",(function(){return u})),n.d(t,"CullFaceFrontBack",(function(){return l})),n.d(t,"CullFaceNone",(function(){return a})),n.d(t,"Curve",(function(){return gc})),n.d(t,"CurvePath",(function(){return Nc})),n.d(t,"CustomBlending",(function(){return R})),n.d(t,"CylinderBufferGeometry",(function(){return Ml})),n.d(t,"CylinderGeometry",(function(){return Al})),n.d(t,"Cylindrical",(function(){return nh})),n.d(t,"DataTexture",(function(){return ho})),n.d(t,"DataTexture2DArray",(function(){return Io})),n.d(t,"DataTexture3D",(function(){return Do})),n.d(t,"DataTextureLoader",(function(){return fc})),n.d(t,"DecrementStencilOp",(function(){return Qt})),n.d(t,"DecrementWrapStencilOp",(function(){return tn})),n.d(t,"DefaultLoadingManager",(function(){return sc})),n.d(t,"DepthFormat",(function(){return Ye})),n.d(t,"DepthStencilFormat",(function(){return Xe})),n.d(t,"DepthTexture",(function(){return _u})),n.d(t,"DirectionalLight",(function(){return Xc})),n.d(t,"DirectionalLightHelper",(function(){return xh})),n.d(t,"DirectionalLightShadow",(function(){return Yc})),n.d(t,"DiscreteInterpolant",(function(){return Yl})),n.d(t,"DodecahedronBufferGeometry",(function(){return ku})),n.d(t,"DodecahedronGeometry",(function(){return Cu})),n.d(t,"DoubleSide",(function(){return y})),n.d(t,"DstAlphaFactor",(function(){return V})),n.d(t,"DstColorFactor",(function(){return H})),n.d(t,"DynamicBufferAttribute",(function(){return Cf})),n.d(t,"DynamicCopyUsage",(function(){return _n})),n.d(t,"DynamicDrawUsage",(function(){return fn})),n.d(t,"DynamicReadUsage",(function(){return vn})),n.d(t,"EdgesGeometry",(function(){return xl})),n.d(t,"EdgesHelper",(function(){return qf})),n.d(t,"EllipseCurve",(function(){return yc})),n.d(t,"EqualDepth",(function(){return J})),n.d(t,"EqualStencilFunc",(function(){return an})),n.d(t,"EquirectangularReflectionMapping",(function(){return he})),n.d(t,"EquirectangularRefractionMapping",(function(){return fe})),n.d(t,"Euler",(function(){return Xn})),n.d(t,"EventDispatcher",(function(){return En})),n.d(t,"ExtrudeBufferGeometry",(function(){return dl})),n.d(t,"ExtrudeGeometry",(function(){return cl})),n.d(t,"Face3",(function(){return oi})),n.d(t,"Face4",(function(){return _f})),n.d(t,"FaceColors",(function(){return w})),n.d(t,"FileLoader",(function(){return cc})),n.d(t,"FlatShading",(function(){return _})),n.d(t,"Float32Attribute",(function(){return Uf})),n.d(t,"Float32BufferAttribute",(function(){return yi})),n.d(t,"Float64Attribute",(function(){return Ff})),n.d(t,"Float64BufferAttribute",(function(){return _i})),n.d(t,"FloatType",(function(){return De})),n.d(t,"Fog",(function(){return _s})),n.d(t,"FogExp2",(function(){return ys})),n.d(t,"Font",(function(){return dd})),n.d(t,"FontLoader",(function(){return fd})),n.d(t,"FrontFaceDirectionCCW",(function(){return d})),n.d(t,"FrontFaceDirectionCW",(function(){return c})),n.d(t,"FrontSide",(function(){return v})),n.d(t,"Frustum",(function(){return mo})),n.d(t,"GammaEncoding",(function(){return Ut})),n.d(t,"Geometry",(function(){return eo})),n.d(t,"GeometryUtils",(function(){return Jf})),n.d(t,"GreaterDepth",(function(){return $})),n.d(t,"GreaterEqualDepth",(function(){return Z})),n.d(t,"GreaterEqualStencilFunc",(function(){return cn})),n.d(t,"GreaterStencilFunc",(function(){return un})),n.d(t,"GridHelper",(function(){return bh})),n.d(t,"Group",(function(){return ms})),n.d(t,"HalfFloatType",(function(){return Ne})),n.d(t,"HemisphereLight",(function(){return Vc})),n.d(t,"HemisphereLightHelper",(function(){return _h})),n.d(t,"HemisphereLightProbe",(function(){return yd})),n.d(t,"IcosahedronBufferGeometry",(function(){return Lu})),n.d(t,"IcosahedronGeometry",(function(){return Ru})),n.d(t,"ImageBitmapLoader",(function(){return ld})),n.d(t,"ImageLoader",(function(){return pc})),n.d(t,"ImageUtils",(function(){return On})),n.d(t,"ImmediateRenderObject",(function(){return uh})),n.d(t,"IncrementStencilOp",(function(){return $t})),n.d(t,"IncrementWrapStencilOp",(function(){return en})),n.d(t,"InstancedBufferAttribute",(function(){return td})),n.d(t,"InstancedBufferGeometry",(function(){return ed})),n.d(t,"InstancedInterleavedBuffer",(function(){return Zd})),n.d(t,"InstancedMesh",(function(){return Zs})),n.d(t,"Int16Attribute",(function(){return If})),n.d(t,"Int16BufferAttribute",(function(){return pi})),n.d(t,"Int32Attribute",(function(){return Nf})),n.d(t,"Int32BufferAttribute",(function(){return vi})),n.d(t,"Int8Attribute",(function(){return kf})),n.d(t,"Int8BufferAttribute",(function(){return di})),n.d(t,"IntType",(function(){return Pe})),n.d(t,"InterleavedBuffer",(function(){return bs})),n.d(t,"InterleavedBufferAttribute",(function(){return Ts})),n.d(t,"Interpolant",(function(){return Wl})),n.d(t,"InterpolateDiscrete",(function(){return jt})),n.d(t,"InterpolateLinear",(function(){return Rt})),n.d(t,"InterpolateSmooth",(function(){return Lt})),n.d(t,"InvertStencilOp",(function(){return nn})),n.d(t,"JSONLoader",(function(){return $f})),n.d(t,"KeepStencilOp",(function(){return Jt})),n.d(t,"KeyframeTrack",(function(){return Xl})),n.d(t,"LOD",(function(){return Vs})),n.d(t,"LatheBufferGeometry",(function(){return El})),n.d(t,"LatheGeometry",(function(){return bl})),n.d(t,"Layers",(function(){return Jn})),n.d(t,"LensFlare",(function(){return ep})),n.d(t,"LessDepth",(function(){return Y})),n.d(t,"LessEqualDepth",(function(){return X})),n.d(t,"LessEqualStencilFunc",(function(){return sn})),n.d(t,"LessStencilFunc",(function(){return on})),n.d(t,"Light",(function(){return Fc})),n.d(t,"LightProbe",(function(){return gd})),n.d(t,"LightShadow",(function(){return Gc})),n.d(t,"Line",(function(){return iu})),n.d(t,"Line3",(function(){return sh})),n.d(t,"LineBasicMaterial",(function(){return $s})),n.d(t,"LineCurve",(function(){return Cc})),n.d(t,"LineCurve3",(function(){return kc})),n.d(t,"LineDashedMaterial",(function(){return Gl})),n.d(t,"LineLoop",(function(){return uu})),n.d(t,"LinePieces",(function(){return Ef})),n.d(t,"LineSegments",(function(){return su})),n.d(t,"LineStrip",(function(){return bf})),n.d(t,"LinearEncoding",(function(){return Nt})),n.d(t,"LinearFilter",(function(){return xe})),n.d(t,"LinearInterpolant",(function(){return Kl})),n.d(t,"LinearMipMapLinearFilter",(function(){return Re})),n.d(t,"LinearMipMapNearestFilter",(function(){return Me})),n.d(t,"LinearMipmapLinearFilter",(function(){return je})),n.d(t,"LinearMipmapNearestFilter",(function(){return Ae})),n.d(t,"LinearToneMapping",(function(){return ie})),n.d(t,"Loader",(function(){return uc})),n.d(t,"LoaderUtils",(function(){return Qc})),n.d(t,"LoadingManager",(function(){return ac})),n.d(t,"LogLuvEncoding",(function(){return Vt})),n.d(t,"LoopOnce",(function(){return xt})),n.d(t,"LoopPingPong",(function(){return Mt})),n.d(t,"LoopRepeat",(function(){return At})),n.d(t,"LuminanceAlphaFormat",(function(){return qe})),n.d(t,"LuminanceFormat",(function(){return We})),n.d(t,"MOUSE",(function(){return i})),n.d(t,"Material",(function(){return si})),n.d(t,"MaterialLoader",(function(){return $c})),n.d(t,"Math",(function(){return Sn})),n.d(t,"Matrix3",(function(){return kn})),n.d(t,"Matrix4",(function(){return qn})),n.d(t,"MaxEquation",(function(){return P})),n.d(t,"Mesh",(function(){return Ki})),n.d(t,"MeshBasicMaterial",(function(){return ui})),n.d(t,"MeshDepthMaterial",(function(){return as})),n.d(t,"MeshDistanceMaterial",(function(){return ss})),n.d(t,"MeshFaceMaterial",(function(){return wf})),n.d(t,"MeshLambertMaterial",(function(){return Fl})),n.d(t,"MeshMatcapMaterial",(function(){return Vl})),n.d(t,"MeshNormalMaterial",(function(){return Ul})),n.d(t,"MeshPhongMaterial",(function(){return Nl})),n.d(t,"MeshPhysicalMaterial",(function(){return Dl})),n.d(t,"MeshStandardMaterial",(function(){return Il})),n.d(t,"MeshToonMaterial",(function(){return Bl})),n.d(t,"MinEquation",(function(){return O})),n.d(t,"MirroredRepeatWrapping",(function(){return _e})),n.d(t,"MixOperation",(function(){return te})),n.d(t,"MultiMaterial",(function(){return Tf})),n.d(t,"MultiplyBlending",(function(){return j})),n.d(t,"MultiplyOperation",(function(){return ee})),n.d(t,"NearestFilter",(function(){return be})),n.d(t,"NearestMipMapLinearFilter",(function(){return Se})),n.d(t,"NearestMipMapNearestFilter",(function(){return we})),n.d(t,"NearestMipmapLinearFilter",(function(){return Te})),n.d(t,"NearestMipmapNearestFilter",(function(){return Ee})),n.d(t,"NeverDepth",(function(){return q})),n.d(t,"NeverStencilFunc",(function(){return rn})),n.d(t,"NoBlending",(function(){return S})),n.d(t,"NoColors",(function(){return E})),n.d(t,"NoToneMapping",(function(){return re})),n.d(t,"NormalBlending",(function(){return x})),n.d(t,"NotEqualDepth",(function(){return Q})),n.d(t,"NotEqualStencilFunc",(function(){return ln})),n.d(t,"NumberKeyframeTrack",(function(){return $l})),n.d(t,"Object3D",(function(){return cr})),n.d(t,"ObjectLoader",(function(){return id})),n.d(t,"ObjectSpaceNormalMap",(function(){return Yt})),n.d(t,"OctahedronBufferGeometry",(function(){return ju})),n.d(t,"OctahedronGeometry",(function(){return Mu})),n.d(t,"OneFactor",(function(){return D})),n.d(t,"OneMinusDstAlphaFactor",(function(){return G})),n.d(t,"OneMinusDstColorFactor",(function(){return z})),n.d(t,"OneMinusSrcAlphaFactor",(function(){return F})),n.d(t,"OneMinusSrcColorFactor",(function(){return B})),n.d(t,"OrthographicCamera",(function(){return Kc})),n.d(t,"PCFShadowMap",(function(){return f})),n.d(t,"PCFSoftShadowMap",(function(){return p})),n.d(t,"PMREMGenerator",(function(){return af})),n.d(t,"ParametricBufferGeometry",(function(){return wu})),n.d(t,"ParametricGeometry",(function(){return Eu})),n.d(t,"Particle",(function(){return xf})),n.d(t,"ParticleBasicMaterial",(function(){return jf})),n.d(t,"ParticleSystem",(function(){return Af})),n.d(t,"ParticleSystemMaterial",(function(){return Rf})),n.d(t,"Path",(function(){return Bc})),n.d(t,"PerspectiveCamera",(function(){return uo})),n.d(t,"Plane",(function(){return Fr})),n.d(t,"PlaneBufferGeometry",(function(){return wo})),n.d(t,"PlaneGeometry",(function(){return Eo})),n.d(t,"PlaneHelper",(function(){return Oh})),n.d(t,"PointCloud",(function(){return Sf})),n.d(t,"PointCloudMaterial",(function(){return Mf})),n.d(t,"PointLight",(function(){return qc})),n.d(t,"PointLightHelper",(function(){return mh})),n.d(t,"Points",(function(){return pu})),n.d(t,"PointsMaterial",(function(){return lu})),n.d(t,"PolarGridHelper",(function(){return Eh})),n.d(t,"PolyhedronBufferGeometry",(function(){return Su})),n.d(t,"PolyhedronGeometry",(function(){return Tu})),n.d(t,"PositionalAudio",(function(){return Pd})),n.d(t,"PropertyBinding",(function(){return qd})),n.d(t,"PropertyMixer",(function(){return Dd})),n.d(t,"QuadraticBezierCurve",(function(){return Oc})),n.d(t,"QuadraticBezierCurve3",(function(){return Pc})),n.d(t,"Quaternion",(function(){return An})),n.d(t,"QuaternionKeyframeTrack",(function(){return ec})),n.d(t,"QuaternionLinearInterpolant",(function(){return Ql})),n.d(t,"REVISION",(function(){return r})),n.d(t,"RGBADepthPacking",(function(){return qt})),n.d(t,"RGBAFormat",(function(){return ze})),n.d(t,"RGBAIntegerFormat",(function(){return tt})),n.d(t,"RGBA_ASTC_10x10_Format",(function(){return wt})),n.d(t,"RGBA_ASTC_10x5_Format",(function(){return _t})),n.d(t,"RGBA_ASTC_10x6_Format",(function(){return bt})),n.d(t,"RGBA_ASTC_10x8_Format",(function(){return Et})),n.d(t,"RGBA_ASTC_12x10_Format",(function(){return Tt})),n.d(t,"RGBA_ASTC_12x12_Format",(function(){return St})),n.d(t,"RGBA_ASTC_4x4_Format",(function(){return dt})),n.d(t,"RGBA_ASTC_5x4_Format",(function(){return ht})),n.d(t,"RGBA_ASTC_5x5_Format",(function(){return ft})),n.d(t,"RGBA_ASTC_6x5_Format",(function(){return pt})),n.d(t,"RGBA_ASTC_6x6_Format",(function(){return mt})),n.d(t,"RGBA_ASTC_8x5_Format",(function(){return vt})),n.d(t,"RGBA_ASTC_8x6_Format",(function(){return gt})),n.d(t,"RGBA_ASTC_8x8_Format",(function(){return yt})),n.d(t,"RGBA_PVRTC_2BPPV1_Format",(function(){return lt})),n.d(t,"RGBA_PVRTC_4BPPV1_Format",(function(){return ut})),n.d(t,"RGBA_S3TC_DXT1_Format",(function(){return rt})),n.d(t,"RGBA_S3TC_DXT3_Format",(function(){return it})),n.d(t,"RGBA_S3TC_DXT5_Format",(function(){return ot})),n.d(t,"RGBDEncoding",(function(){return zt})),n.d(t,"RGBEEncoding",(function(){return Ft})),n.d(t,"RGBEFormat",(function(){return Ke})),n.d(t,"RGBFormat",(function(){return He})),n.d(t,"RGBIntegerFormat",(function(){return et})),n.d(t,"RGBM16Encoding",(function(){return Ht})),n.d(t,"RGBM7Encoding",(function(){return Gt})),n.d(t,"RGB_ETC1_Format",(function(){return ct})),n.d(t,"RGB_PVRTC_2BPPV1_Format",(function(){return st})),n.d(t,"RGB_PVRTC_4BPPV1_Format",(function(){return at})),n.d(t,"RGB_S3TC_DXT1_Format",(function(){return nt})),n.d(t,"RGFormat",(function(){return $e})),n.d(t,"RGIntegerFormat",(function(){return Qe})),n.d(t,"RawShaderMaterial",(function(){return Pl})),n.d(t,"Ray",(function(){return Dr})),n.d(t,"Raycaster",(function(){return $d})),n.d(t,"RectAreaLight",(function(){return Zc})),n.d(t,"RedFormat",(function(){return Je})),n.d(t,"RedIntegerFormat",(function(){return Ze})),n.d(t,"ReinhardToneMapping",(function(){return oe})),n.d(t,"RepeatWrapping",(function(){return ge})),n.d(t,"ReplaceStencilOp",(function(){return Zt})),n.d(t,"ReverseSubtractEquation",(function(){return k})),n.d(t,"RingBufferGeometry",(function(){return _l})),n.d(t,"RingGeometry",(function(){return yl})),n.d(t,"Scene",(function(){return dr})),n.d(t,"SceneUtils",(function(){return Qf})),n.d(t,"ShaderChunk",(function(){return vo})),n.d(t,"ShaderLib",(function(){return yo})),n.d(t,"ShaderMaterial",(function(){return ao})),n.d(t,"ShadowMaterial",(function(){return Ol})),n.d(t,"Shape",(function(){return Uc})),n.d(t,"ShapeBufferGeometry",(function(){return Tl})),n.d(t,"ShapeGeometry",(function(){return wl})),n.d(t,"ShapePath",(function(){return cd})),n.d(t,"ShapeUtils",(function(){return sl})),n.d(t,"ShortType",(function(){return ke})),n.d(t,"Skeleton",(function(){return Ws})),n.d(t,"SkeletonHelper",(function(){return ph})),n.d(t,"SkinnedMesh",(function(){return Gs})),n.d(t,"SmoothShading",(function(){return b})),n.d(t,"Sphere",(function(){return jr})),n.d(t,"SphereBufferGeometry",(function(){return gl})),n.d(t,"SphereGeometry",(function(){return vl})),n.d(t,"Spherical",(function(){return th})),n.d(t,"SphericalHarmonics3",(function(){return vd})),n.d(t,"SphericalReflectionMapping",(function(){return pe})),n.d(t,"Spline",(function(){return Hf})),n.d(t,"SplineCurve",(function(){return Ic})),n.d(t,"SplineCurve3",(function(){return Gf})),n.d(t,"SpotLight",(function(){return zc})),n.d(t,"SpotLightHelper",(function(){return ch})),n.d(t,"SpotLightShadow",(function(){return Hc})),n.d(t,"Sprite",(function(){return Ns})),n.d(t,"SpriteMaterial",(function(){return Ss})),n.d(t,"SrcAlphaFactor",(function(){return U})),n.d(t,"SrcAlphaSaturateFactor",(function(){return W})),n.d(t,"SrcColorFactor",(function(){return N})),n.d(t,"StaticCopyUsage",(function(){return yn})),n.d(t,"StaticDrawUsage",(function(){return hn})),n.d(t,"StaticReadUsage",(function(){return mn})),n.d(t,"StereoCamera",(function(){return wd})),n.d(t,"StreamCopyUsage",(function(){return bn})),n.d(t,"StreamDrawUsage",(function(){return pn})),n.d(t,"StreamReadUsage",(function(){return gn})),n.d(t,"StringKeyframeTrack",(function(){return tc})),n.d(t,"SubtractEquation",(function(){return C})),n.d(t,"SubtractiveBlending",(function(){return M})),n.d(t,"TOUCH",(function(){return o})),n.d(t,"TangentSpaceNormalMap",(function(){return Kt})),n.d(t,"TetrahedronBufferGeometry",(function(){return Au})),n.d(t,"TetrahedronGeometry",(function(){return xu})),n.d(t,"TextBufferGeometry",(function(){return ml})),n.d(t,"TextGeometry",(function(){return pl})),n.d(t,"Texture",(function(){return In})),n.d(t,"TextureLoader",(function(){return vc})),n.d(t,"TorusBufferGeometry",(function(){return Bu})),n.d(t,"TorusGeometry",(function(){return Nu})),n.d(t,"TorusKnotBufferGeometry",(function(){return Du})),n.d(t,"TorusKnotGeometry",(function(){return Iu})),n.d(t,"Triangle",(function(){return Zr})),n.d(t,"TriangleFanDrawMode",(function(){return Dt})),n.d(t,"TriangleStripDrawMode",(function(){return It})),n.d(t,"TrianglesDrawMode",(function(){return Pt})),n.d(t,"TubeBufferGeometry",(function(){return Pu})),n.d(t,"TubeGeometry",(function(){return Ou})),n.d(t,"UVMapping",(function(){return le})),n.d(t,"Uint16Attribute",(function(){return Df})),n.d(t,"Uint16BufferAttribute",(function(){return mi})),n.d(t,"Uint32Attribute",(function(){return Bf})),n.d(t,"Uint32BufferAttribute",(function(){return gi})),n.d(t,"Uint8Attribute",(function(){return Of})),n.d(t,"Uint8BufferAttribute",(function(){return hi})),n.d(t,"Uint8ClampedAttribute",(function(){return Pf})),n.d(t,"Uint8ClampedBufferAttribute",(function(){return fi})),n.d(t,"Uncharted2ToneMapping",(function(){return ae})),n.d(t,"Uniform",(function(){return Jd})),n.d(t,"UniformsLib",(function(){return go})),n.d(t,"UniformsUtils",(function(){return oo})),n.d(t,"UnsignedByteType",(function(){return Le})),n.d(t,"UnsignedInt248Type",(function(){return Ve})),n.d(t,"UnsignedIntType",(function(){return Ie})),n.d(t,"UnsignedShort4444Type",(function(){return Be})),n.d(t,"UnsignedShort5551Type",(function(){return Ue})),n.d(t,"UnsignedShort565Type",(function(){return Fe})),n.d(t,"UnsignedShortType",(function(){return Oe})),n.d(t,"VSMShadowMap",(function(){return m})),n.d(t,"Vector2",(function(){return xn})),n.d(t,"Vector3",(function(){return Rn})),n.d(t,"Vector4",(function(){return Dn})),n.d(t,"VectorKeyframeTrack",(function(){return nc})),n.d(t,"Vertex",(function(){return Lf})),n.d(t,"VertexColors",(function(){return T})),n.d(t,"VideoTexture",(function(){return vu})),n.d(t,"WebGLMultisampleRenderTarget",(function(){return Bn})),n.d(t,"WebGLRenderTarget",(function(){return Nn})),n.d(t,"WebGLRenderTargetCube",(function(){return co})),n.d(t,"WebGLRenderer",(function(){return gs})),n.d(t,"WebGLUtils",(function(){return ds})),n.d(t,"WireframeGeometry",(function(){return bu})),n.d(t,"WireframeHelper",(function(){return Kf})),n.d(t,"WrapAroundEnding",(function(){return Ot})),n.d(t,"XHRLoader",(function(){return Yf})),n.d(t,"ZeroCurvatureEnding",(function(){return Ct})),n.d(t,"ZeroFactor",(function(){return I})),n.d(t,"ZeroSlopeEnding",(function(){return kt})),n.d(t,"ZeroStencilOp",(function(){return Xt})),n.d(t,"sRGBEncoding",(function(){return Bt})),void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),"name"in Function.prototype==!1&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t});var r="112",i={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},o={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},a=0,s=1,u=2,l=3,c=0,d=1,h=0,f=1,p=2,m=3,v=0,g=1,y=2,_=1,b=2,E=0,w=1,T=2,S=0,x=1,A=2,M=3,j=4,R=5,L=100,C=101,k=102,O=103,P=104,I=200,D=201,N=202,B=203,U=204,F=205,V=206,G=207,H=208,z=209,W=210,q=0,K=1,Y=2,X=3,J=4,Z=5,$=6,Q=7,ee=0,te=1,ne=2,re=0,ie=1,oe=2,ae=3,se=4,ue=5,le=300,ce=301,de=302,he=303,fe=304,pe=305,me=306,ve=307,ge=1e3,ye=1001,_e=1002,be=1003,Ee=1004,we=1004,Te=1005,Se=1005,xe=1006,Ae=1007,Me=1007,je=1008,Re=1008,Le=1009,Ce=1010,ke=1011,Oe=1012,Pe=1013,Ie=1014,De=1015,Ne=1016,Be=1017,Ue=1018,Fe=1019,Ve=1020,Ge=1021,He=1022,ze=1023,We=1024,qe=1025,Ke=ze,Ye=1026,Xe=1027,Je=1028,Ze=1029,$e=1030,Qe=1031,et=1032,tt=1033,nt=33776,rt=33777,it=33778,ot=33779,at=35840,st=35841,ut=35842,lt=35843,ct=36196,dt=37808,ht=37809,ft=37810,pt=37811,mt=37812,vt=37813,gt=37814,yt=37815,_t=37816,bt=37817,Et=37818,wt=37819,Tt=37820,St=37821,xt=2200,At=2201,Mt=2202,jt=2300,Rt=2301,Lt=2302,Ct=2400,kt=2401,Ot=2402,Pt=0,It=1,Dt=2,Nt=3e3,Bt=3001,Ut=3007,Ft=3002,Vt=3003,Gt=3004,Ht=3005,zt=3006,Wt=3200,qt=3201,Kt=0,Yt=1,Xt=0,Jt=7680,Zt=7681,$t=7682,Qt=7683,en=34055,tn=34056,nn=5386,rn=512,on=513,an=514,sn=515,un=516,ln=517,cn=518,dn=519,hn=35044,fn=35048,pn=35040,mn=35045,vn=35049,gn=35041,yn=35046,_n=35050,bn=35042;function En(){}Object.assign(En.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n){var r=n.indexOf(t);-1!==r&&n.splice(r,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=t.slice(0),r=0,i=n.length;r<i;r++)n[r].call(this,e)}}}});for(var wn=[],Tn=0;Tn<256;Tn++)wn[Tn]=(Tn<16?"0":"")+Tn.toString(16);var Sn={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(wn[255&e]+wn[e>>8&255]+wn[e>>16&255]+wn[e>>24&255]+"-"+wn[255&t]+wn[t>>8&255]+"-"+wn[t>>16&15|64]+wn[t>>24&255]+"-"+wn[63&n|128]+wn[n>>8&255]+"-"+wn[n>>16&255]+wn[n>>24&255]+wn[255&r]+wn[r>>8&255]+wn[r>>16&255]+wn[r>>24&255]).toUpperCase()},clamp:function(e,t,n){return Math.max(t,Math.min(n,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},lerp:function(e,t,n){return(1-n)*e+n*t},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*Sn.DEG2RAD},radToDeg:function(e){return e*Sn.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}};function xn(e,t){this.x=e||0,this.y=t||0}function An(e,t,n,r){this._x=e||0,this._y=t||0,this._z=n||0,this._w=void 0!==r?r:1}Object.defineProperties(xn.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(xn.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this},clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,o=this.y-e.y;return this.x=i*n-o*r+e.x,this.y=i*r+o*n+e.y,this}}),Object.assign(An,{slerp:function(e,t,n,r){return n.copy(e).slerp(t,r)},slerpFlat:function(e,t,n,r,i,o,a){var s=n[r+0],u=n[r+1],l=n[r+2],c=n[r+3],d=i[o+0],h=i[o+1],f=i[o+2],p=i[o+3];if(c!==p||s!==d||u!==h||l!==f){var m=1-a,v=s*d+u*h+l*f+c*p,g=v>=0?1:-1,y=1-v*v;if(y>Number.EPSILON){var _=Math.sqrt(y),b=Math.atan2(_,v*g);m=Math.sin(m*b)/_,a=Math.sin(a*b)/_}var E=a*g;if(s=s*m+d*E,u=u*m+h*E,l=l*m+f*E,c=c*m+p*E,m===1-a){var w=1/Math.sqrt(s*s+u*u+l*l+c*c);s*=w,u*=w,l*=w,c*=w}}e[t]=s,e[t+1]=u,e[t+2]=l,e[t+3]=c}}),Object.defineProperties(An.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}}}),Object.assign(An.prototype,{isQuaternion:!0,set:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=e._x,r=e._y,i=e._z,o=e.order,a=Math.cos,s=Math.sin,u=a(n/2),l=a(r/2),c=a(i/2),d=s(n/2),h=s(r/2),f=s(i/2);return"XYZ"===o?(this._x=d*l*c+u*h*f,this._y=u*h*c-d*l*f,this._z=u*l*f+d*h*c,this._w=u*l*c-d*h*f):"YXZ"===o?(this._x=d*l*c+u*h*f,this._y=u*h*c-d*l*f,this._z=u*l*f-d*h*c,this._w=u*l*c+d*h*f):"ZXY"===o?(this._x=d*l*c-u*h*f,this._y=u*h*c+d*l*f,this._z=u*l*f+d*h*c,this._w=u*l*c-d*h*f):"ZYX"===o?(this._x=d*l*c-u*h*f,this._y=u*h*c+d*l*f,this._z=u*l*f-d*h*c,this._w=u*l*c+d*h*f):"YZX"===o?(this._x=d*l*c+u*h*f,this._y=u*h*c+d*l*f,this._z=u*l*f-d*h*c,this._w=u*l*c-d*h*f):"XZY"===o&&(this._x=d*l*c-u*h*f,this._y=u*h*c-d*l*f,this._z=u*l*f+d*h*c,this._w=u*l*c+d*h*f),!1!==t&&this._onChangeCallback(),this},setFromAxisAngle:function(e,t){var n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this},setFromRotationMatrix:function(e){var t,n=e.elements,r=n[0],i=n[4],o=n[8],a=n[1],s=n[5],u=n[9],l=n[2],c=n[6],d=n[10],h=r+s+d;return h>0?(t=.5/Math.sqrt(h+1),this._w=.25/t,this._x=(c-u)*t,this._y=(o-l)*t,this._z=(a-i)*t):r>s&&r>d?(t=2*Math.sqrt(1+r-s-d),this._w=(c-u)/t,this._x=.25*t,this._y=(i+a)/t,this._z=(o+l)/t):s>d?(t=2*Math.sqrt(1+s-r-d),this._w=(o-l)/t,this._x=(i+a)/t,this._y=.25*t,this._z=(u+c)/t):(t=2*Math.sqrt(1+d-r-s),this._w=(a-i)/t,this._x=(o+l)/t,this._y=(u+c)/t,this._z=.25*t),this._onChangeCallback(),this},setFromUnitVectors:function(e,t){var n=e.dot(t)+1;return n<1e-6?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()},angleTo:function(e){return 2*Math.acos(Math.abs(Sn.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){var n=this.angleTo(e);if(0===n)return this;var r=Math.min(1,t/n);return this.slerp(e,r),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var n=e._x,r=e._y,i=e._z,o=e._w,a=t._x,s=t._y,u=t._z,l=t._w;return this._x=n*l+o*a+r*u-i*s,this._y=r*l+o*s+i*a-n*u,this._z=i*l+o*u+n*s-r*a,this._w=o*l-n*a-r*s-i*u,this._onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,r=this._y,i=this._z,o=this._w,a=o*e._w+n*e._x+r*e._y+i*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=n,this._y=r,this._z=i,this;var s=1-a*a;if(s<=Number.EPSILON){var u=1-t;return this._w=u*o+t*this._w,this._x=u*n+t*this._x,this._y=u*r+t*this._y,this._z=u*i+t*this._z,this.normalize(),this._onChangeCallback(),this}var l=Math.sqrt(s),c=Math.atan2(l,a),d=Math.sin((1-t)*c)/l,h=Math.sin(t*c)/l;return this._w=o*d+this._w*h,this._x=n*d+this._x*h,this._y=r*d+this._y*h,this._z=i*d+this._z*h,this._onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}});var Mn=new Rn,jn=new An;function Rn(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0}Object.assign(Rn.prototype,{isVector3:!0,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(jn.setFromEuler(e))},applyAxisAngle:function(e,t){return this.applyQuaternion(jn.setFromAxisAngle(e,t))},applyMatrix3:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this},applyNormalMatrix:function(e){return this.applyMatrix3(e).normalize()},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements,o=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*o,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*o,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*o,this},applyQuaternion:function(e){var t=this.x,n=this.y,r=this.z,i=e.x,o=e.y,a=e.z,s=e.w,u=s*t+o*r-a*n,l=s*n+a*t-i*r,c=s*r+i*n-o*t,d=-i*t-o*n-a*r;return this.x=u*s+d*-i+l*-a-c*-o,this.y=l*s+d*-o+c*-i-u*-a,this.z=c*s+d*-a+u*-o-l*-i,this},project:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},unproject:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)},transformDirection:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this},clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},cross:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var n=e.x,r=e.y,i=e.z,o=t.x,a=t.y,s=t.z;return this.x=r*s-i*a,this.y=i*o-n*s,this.z=n*a-r*o,this},projectOnVector:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)},projectOnPlane:function(e){return Mn.copy(this).projectOnVector(e),this.sub(Mn)},reflect:function(e){return this.sub(Mn.copy(e).multiplyScalar(2*this.dot(e)))},angleTo:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());0===t&&console.error("THREE.Vector3: angleTo() can't handle zero length vectors.");var n=this.dot(e)/t;return Math.acos(Sn.clamp(n,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},setFromSphericalCoords:function(e,t,n){var r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this},setFromCylindrical:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},setFromCylindricalCoords:function(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this},setFromMatrixPosition:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}});var Ln,Cn=new Rn;function kn(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.assign(kn.prototype,{isMatrix3:!0,set:function(e,t,n,r,i,o,a,s,u){var l=this.elements;return l[0]=e,l[1]=r,l[2]=a,l[3]=t,l[4]=i,l[5]=s,l[6]=n,l[7]=o,l[8]=u,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},applyToBufferAttribute:function(e){for(var t=0,n=e.count;t<n;t++)Cn.x=e.getX(t),Cn.y=e.getY(t),Cn.z=e.getZ(t),Cn.applyMatrix3(this),e.setXYZ(t,Cn.x,Cn.y,Cn.z);return e},multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var n=e.elements,r=t.elements,i=this.elements,o=n[0],a=n[3],s=n[6],u=n[1],l=n[4],c=n[7],d=n[2],h=n[5],f=n[8],p=r[0],m=r[3],v=r[6],g=r[1],y=r[4],_=r[7],b=r[2],E=r[5],w=r[8];return i[0]=o*p+a*g+s*b,i[3]=o*m+a*y+s*E,i[6]=o*v+a*_+s*w,i[1]=u*p+l*g+c*b,i[4]=u*m+l*y+c*E,i[7]=u*v+l*_+c*w,i[2]=d*p+h*g+f*b,i[5]=d*m+h*y+f*E,i[8]=d*v+h*_+f*w,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],a=e[5],s=e[6],u=e[7],l=e[8];return t*o*l-t*a*u-n*i*l+n*a*s+r*i*u-r*o*s},getInverse:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var n=e.elements,r=this.elements,i=n[0],o=n[1],a=n[2],s=n[3],u=n[4],l=n[5],c=n[6],d=n[7],h=n[8],f=h*u-l*d,p=l*c-h*s,m=d*s-u*c,v=i*f+o*p+a*m;if(0===v){var g="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(g);return console.warn(g),this.identity()}var y=1/v;return r[0]=f*y,r[1]=(a*d-h*o)*y,r[2]=(l*o-a*u)*y,r[3]=p*y,r[4]=(h*i-a*c)*y,r[5]=(a*s-l*i)*y,r[6]=m*y,r[7]=(o*c-d*i)*y,r[8]=(u*i-o*s)*y,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,n,r,i,o,a){var s=Math.cos(i),u=Math.sin(i);this.set(n*s,n*u,-n*(s*o+u*a)+o+e,-r*u,r*s,-r*(-u*o+s*a)+a+t,0,0,1)},scale:function(e,t){var n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this},rotate:function(e){var t=Math.cos(e),n=Math.sin(e),r=this.elements,i=r[0],o=r[3],a=r[6],s=r[1],u=r[4],l=r[7];return r[0]=t*i+n*s,r[3]=t*o+n*u,r[6]=t*a+n*l,r[1]=-n*i+t*s,r[4]=-n*o+t*u,r[7]=-n*a+t*l,this},translate:function(e,t){var n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this},equals:function(e){for(var t=this.elements,n=e.elements,r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var n=0;n<9;n++)this.elements[n]=e[n+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}});var On={getDataURL:function(e){var t;if("undefined"==typeof HTMLCanvasElement)return e.src;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Ln&&(Ln=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Ln.width=e.width,Ln.height=e.height;var n=Ln.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=Ln}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},Pn=0;function In(e,t,n,r,i,o,a,s,u,l){Object.defineProperty(this,"id",{value:Pn++}),this.uuid=Sn.generateUUID(),this.name="",this.image=void 0!==e?e:In.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:In.DEFAULT_MAPPING,this.wrapS=void 0!==n?n:ye,this.wrapT=void 0!==r?r:ye,this.magFilter=void 0!==i?i:xe,this.minFilter=void 0!==o?o:je,this.anisotropy=void 0!==u?u:1,this.format=void 0!==a?a:ze,this.internalFormat=null,this.type=void 0!==s?s:Le,this.offset=new xn(0,0),this.repeat=new xn(1,1),this.center=new xn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new kn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==l?l:Nt,this.version=0,this.onUpdate=null}function Dn(e,t,n,r){this.x=e||0,this.y=t||0,this.z=n||0,this.w=void 0!==r?r:1}function Nn(e,t,n){this.width=e,this.height=t,this.scissor=new Dn(0,0,e,t),this.scissorTest=!1,this.viewport=new Dn(0,0,e,t),n=n||{},this.texture=new In(void 0,void 0,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:xe,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0===n.stencilBuffer||n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}function Bn(e,t,n){Nn.call(this,e,t,n),this.samples=4}In.DEFAULT_IMAGE=void 0,In.DEFAULT_MAPPING=le,In.prototype=Object.assign(Object.create(En.prototype),{constructor:In,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var r=this.image;if(void 0===r.uuid&&(r.uuid=Sn.generateUUID()),!t&&void 0===e.images[r.uuid]){var i;if(Array.isArray(r)){i=[];for(var o=0,a=r.length;o<a;o++)i.push(On.getDataURL(r[o]))}else i=On.getDataURL(r);e.images[r.uuid]={uuid:r.uuid,url:i}}n.image=r.uuid}return t||(e.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping!==le)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case ge:e.x=e.x-Math.floor(e.x);break;case ye:e.x=e.x<0?0:1;break;case _e:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case ge:e.y=e.y-Math.floor(e.y);break;case ye:e.y=e.y<0?0:1;break;case _e:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(In.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.defineProperties(Dn.prototype,{width:{get:function(){return this.z},set:function(e){this.z=e}},height:{get:function(){return this.w},set:function(e){this.w=e}}}),Object.assign(Dn.prototype,{isVector4:!0,set:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z,i=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*r+o[12]*i,this.y=o[1]*t+o[5]*n+o[9]*r+o[13]*i,this.z=o[2]*t+o[6]*n+o[10]*r+o[14]*i,this.w=o[3]*t+o[7]*n+o[11]*r+o[15]*i,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,n,r,i,o=e.elements,a=o[0],s=o[4],u=o[8],l=o[1],c=o[5],d=o[9],h=o[2],f=o[6],p=o[10];if(Math.abs(s-l)<.01&&Math.abs(u-h)<.01&&Math.abs(d-f)<.01){if(Math.abs(s+l)<.1&&Math.abs(u+h)<.1&&Math.abs(d+f)<.1&&Math.abs(a+c+p-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var m=(a+1)/2,v=(c+1)/2,g=(p+1)/2,y=(s+l)/4,_=(u+h)/4,b=(d+f)/4;return m>v&&m>g?m<.01?(n=0,r=.707106781,i=.707106781):(r=y/(n=Math.sqrt(m)),i=_/n):v>g?v<.01?(n=.707106781,r=0,i=.707106781):(n=y/(r=Math.sqrt(v)),i=b/r):g<.01?(n=.707106781,r=.707106781,i=0):(n=_/(i=Math.sqrt(g)),r=b/i),this.set(n,r,i,t),this}var E=Math.sqrt((f-d)*(f-d)+(u-h)*(u-h)+(l-s)*(l-s));return Math.abs(E)<.001&&(E=1),this.x=(f-d)/E,this.y=(u-h)/E,this.z=(l-s)/E,this.w=Math.acos((a+c+p-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this},clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),Nn.prototype=Object.assign(Object.create(En.prototype),{constructor:Nn,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.texture.image.width=e,this.texture.image.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Bn.prototype=Object.assign(Object.create(Nn.prototype),{constructor:Bn,isWebGLMultisampleRenderTarget:!0,copy:function(e){return Nn.prototype.copy.call(this,e),this.samples=e.samples,this}});var Un=new Rn,Fn=new qn,Vn=new Rn(0,0,0),Gn=new Rn(1,1,1),Hn=new Rn,zn=new Rn,Wn=new Rn;function qn(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(qn.prototype,{isMatrix4:!0,set:function(e,t,n,r,i,o,a,s,u,l,c,d,h,f,p,m){var v=this.elements;return v[0]=e,v[4]=t,v[8]=n,v[12]=r,v[1]=i,v[5]=o,v[9]=a,v[13]=s,v[2]=u,v[6]=l,v[10]=c,v[14]=d,v[3]=h,v[7]=f,v[11]=p,v[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new qn).fromArray(this.elements)},copy:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this},copyPosition:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this},extractBasis:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this},extractRotation:function(e){var t=this.elements,n=e.elements,r=1/Un.setFromMatrixColumn(e,0).length(),i=1/Un.setFromMatrixColumn(e,1).length(),o=1/Un.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,n=e.x,r=e.y,i=e.z,o=Math.cos(n),a=Math.sin(n),s=Math.cos(r),u=Math.sin(r),l=Math.cos(i),c=Math.sin(i);if("XYZ"===e.order){var d=o*l,h=o*c,f=a*l,p=a*c;t[0]=s*l,t[4]=-s*c,t[8]=u,t[1]=h+f*u,t[5]=d-p*u,t[9]=-a*s,t[2]=p-d*u,t[6]=f+h*u,t[10]=o*s}else if("YXZ"===e.order){var m=s*l,v=s*c,g=u*l,y=u*c;t[0]=m+y*a,t[4]=g*a-v,t[8]=o*u,t[1]=o*c,t[5]=o*l,t[9]=-a,t[2]=v*a-g,t[6]=y+m*a,t[10]=o*s}else if("ZXY"===e.order){m=s*l,v=s*c,g=u*l,y=u*c;t[0]=m-y*a,t[4]=-o*c,t[8]=g+v*a,t[1]=v+g*a,t[5]=o*l,t[9]=y-m*a,t[2]=-o*u,t[6]=a,t[10]=o*s}else if("ZYX"===e.order){d=o*l,h=o*c,f=a*l,p=a*c;t[0]=s*l,t[4]=f*u-h,t[8]=d*u+p,t[1]=s*c,t[5]=p*u+d,t[9]=h*u-f,t[2]=-u,t[6]=a*s,t[10]=o*s}else if("YZX"===e.order){var _=o*s,b=o*u,E=a*s,w=a*u;t[0]=s*l,t[4]=w-_*c,t[8]=E*c+b,t[1]=c,t[5]=o*l,t[9]=-a*l,t[2]=-u*l,t[6]=b*c+E,t[10]=_-w*c}else if("XZY"===e.order){_=o*s,b=o*u,E=a*s,w=a*u;t[0]=s*l,t[4]=-c,t[8]=u*l,t[1]=_*c+w,t[5]=o*l,t[9]=b*c-E,t[2]=E*c-b,t[6]=a*l,t[10]=w*c+_}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(e){return this.compose(Vn,e,Gn)},lookAt:function(e,t,n){var r=this.elements;return Wn.subVectors(e,t),0===Wn.lengthSq()&&(Wn.z=1),Wn.normalize(),Hn.crossVectors(n,Wn),0===Hn.lengthSq()&&(1===Math.abs(n.z)?Wn.x+=1e-4:Wn.z+=1e-4,Wn.normalize(),Hn.crossVectors(n,Wn)),Hn.normalize(),zn.crossVectors(Wn,Hn),r[0]=Hn.x,r[4]=zn.x,r[8]=Wn.x,r[1]=Hn.y,r[5]=zn.y,r[9]=Wn.y,r[2]=Hn.z,r[6]=zn.z,r[10]=Wn.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var n=e.elements,r=t.elements,i=this.elements,o=n[0],a=n[4],s=n[8],u=n[12],l=n[1],c=n[5],d=n[9],h=n[13],f=n[2],p=n[6],m=n[10],v=n[14],g=n[3],y=n[7],_=n[11],b=n[15],E=r[0],w=r[4],T=r[8],S=r[12],x=r[1],A=r[5],M=r[9],j=r[13],R=r[2],L=r[6],C=r[10],k=r[14],O=r[3],P=r[7],I=r[11],D=r[15];return i[0]=o*E+a*x+s*R+u*O,i[4]=o*w+a*A+s*L+u*P,i[8]=o*T+a*M+s*C+u*I,i[12]=o*S+a*j+s*k+u*D,i[1]=l*E+c*x+d*R+h*O,i[5]=l*w+c*A+d*L+h*P,i[9]=l*T+c*M+d*C+h*I,i[13]=l*S+c*j+d*k+h*D,i[2]=f*E+p*x+m*R+v*O,i[6]=f*w+p*A+m*L+v*P,i[10]=f*T+p*M+m*C+v*I,i[14]=f*S+p*j+m*k+v*D,i[3]=g*E+y*x+_*R+b*O,i[7]=g*w+y*A+_*L+b*P,i[11]=g*T+y*M+_*C+b*I,i[15]=g*S+y*j+_*k+b*D,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(e){for(var t=0,n=e.count;t<n;t++)Un.x=e.getX(t),Un.y=e.getY(t),Un.z=e.getZ(t),Un.applyMatrix4(this),e.setXYZ(t,Un.x,Un.y,Un.z);return e},determinant:function(){var e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],o=e[1],a=e[5],s=e[9],u=e[13],l=e[2],c=e[6],d=e[10],h=e[14];return e[3]*(+i*s*c-r*u*c-i*a*d+n*u*d+r*a*h-n*s*h)+e[7]*(+t*s*h-t*u*d+i*o*d-r*o*h+r*u*l-i*s*l)+e[11]*(+t*u*c-t*a*h-i*o*c+n*o*h+i*a*l-n*u*l)+e[15]*(-r*a*l-t*s*c+t*a*d+r*o*c-n*o*d+n*s*l)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e,t,n){var r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this},getInverse:function(e,t){var n=this.elements,r=e.elements,i=r[0],o=r[1],a=r[2],s=r[3],u=r[4],l=r[5],c=r[6],d=r[7],h=r[8],f=r[9],p=r[10],m=r[11],v=r[12],g=r[13],y=r[14],_=r[15],b=f*y*d-g*p*d+g*c*m-l*y*m-f*c*_+l*p*_,E=v*p*d-h*y*d-v*c*m+u*y*m+h*c*_-u*p*_,w=h*g*d-v*f*d+v*l*m-u*g*m-h*l*_+u*f*_,T=v*f*c-h*g*c-v*l*p+u*g*p+h*l*y-u*f*y,S=i*b+o*E+a*w+s*T;if(0===S){var x="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(x);return console.warn(x),this.identity()}var A=1/S;return n[0]=b*A,n[1]=(g*p*s-f*y*s-g*a*m+o*y*m+f*a*_-o*p*_)*A,n[2]=(l*y*s-g*c*s+g*a*d-o*y*d-l*a*_+o*c*_)*A,n[3]=(f*c*s-l*p*s-f*a*d+o*p*d+l*a*m-o*c*m)*A,n[4]=E*A,n[5]=(h*y*s-v*p*s+v*a*m-i*y*m-h*a*_+i*p*_)*A,n[6]=(v*c*s-u*y*s-v*a*d+i*y*d+u*a*_-i*c*_)*A,n[7]=(u*p*s-h*c*s+h*a*d-i*p*d-u*a*m+i*c*m)*A,n[8]=w*A,n[9]=(v*f*s-h*g*s-v*o*m+i*g*m+h*o*_-i*f*_)*A,n[10]=(u*g*s-v*l*s+v*o*d-i*g*d-u*o*_+i*l*_)*A,n[11]=(h*l*s-u*f*s-h*o*d+i*f*d+u*o*m-i*l*m)*A,n[12]=T*A,n[13]=(h*g*a-v*f*a+v*o*p-i*g*p-h*o*y+i*f*y)*A,n[14]=(v*l*a-u*g*a-v*o*c+i*g*c+u*o*y-i*l*y)*A,n[15]=(u*f*a-h*l*a+h*o*c-i*f*c-u*o*p+i*l*p)*A,this},scale:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))},makeTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=1-n,o=e.x,a=e.y,s=e.z,u=i*o,l=i*a;return this.set(u*o+n,u*a-r*s,u*s+r*a,0,u*a+r*s,l*a+n,l*s-r*o,0,u*s-r*a,l*s+r*o,i*s*s+n,0,0,0,0,1),this},makeScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},makeShear:function(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,n){var r=this.elements,i=t._x,o=t._y,a=t._z,s=t._w,u=i+i,l=o+o,c=a+a,d=i*u,h=i*l,f=i*c,p=o*l,m=o*c,v=a*c,g=s*u,y=s*l,_=s*c,b=n.x,E=n.y,w=n.z;return r[0]=(1-(p+v))*b,r[1]=(h+_)*b,r[2]=(f-y)*b,r[3]=0,r[4]=(h-_)*E,r[5]=(1-(d+v))*E,r[6]=(m+g)*E,r[7]=0,r[8]=(f+y)*w,r[9]=(m-g)*w,r[10]=(1-(d+p))*w,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this},decompose:function(e,t,n){var r=this.elements,i=Un.set(r[0],r[1],r[2]).length(),o=Un.set(r[4],r[5],r[6]).length(),a=Un.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),e.x=r[12],e.y=r[13],e.z=r[14],Fn.copy(this);var s=1/i,u=1/o,l=1/a;return Fn.elements[0]*=s,Fn.elements[1]*=s,Fn.elements[2]*=s,Fn.elements[4]*=u,Fn.elements[5]*=u,Fn.elements[6]*=u,Fn.elements[8]*=l,Fn.elements[9]*=l,Fn.elements[10]*=l,t.setFromRotationMatrix(Fn),n.x=i,n.y=o,n.z=a,this},makePerspective:function(e,t,n,r,i,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var a=this.elements,s=2*i/(t-e),u=2*i/(n-r),l=(t+e)/(t-e),c=(n+r)/(n-r),d=-(o+i)/(o-i),h=-2*o*i/(o-i);return a[0]=s,a[4]=0,a[8]=l,a[12]=0,a[1]=0,a[5]=u,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=d,a[14]=h,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makeOrthographic:function(e,t,n,r,i,o){var a=this.elements,s=1/(t-e),u=1/(n-r),l=1/(o-i),c=(t+e)*s,d=(n+r)*u,h=(o+i)*l;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2*u,a[9]=0,a[13]=-d,a[2]=0,a[6]=0,a[10]=-2*l,a[14]=-h,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},equals:function(e){for(var t=this.elements,n=e.elements,r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var n=0;n<16;n++)this.elements[n]=e[n+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}});var Kn=new qn,Yn=new An;function Xn(e,t,n,r){this._x=e||0,this._y=t||0,this._z=n||0,this._order=r||Xn.DefaultOrder}function Jn(){this.mask=1}Xn.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Xn.DefaultOrder="XYZ",Object.defineProperties(Xn.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}}}),Object.assign(Xn.prototype,{isEuler:!0,set:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._order=r||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this},setFromRotationMatrix:function(e,t,n){var r=Sn.clamp,i=e.elements,o=i[0],a=i[4],s=i[8],u=i[1],l=i[5],c=i[9],d=i[2],h=i[6],f=i[10];return"XYZ"===(t=t||this._order)?(this._y=Math.asin(r(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,f),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(h,l),this._z=0)):"YXZ"===t?(this._x=Math.asin(-r(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(s,f),this._z=Math.atan2(u,l)):(this._y=Math.atan2(-d,o),this._z=0)):"ZXY"===t?(this._x=Math.asin(r(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-d,f),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(u,o))):"ZYX"===t?(this._y=Math.asin(-r(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(h,f),this._z=Math.atan2(u,o)):(this._x=0,this._z=Math.atan2(-a,l))):"YZX"===t?(this._z=Math.asin(r(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-d,o)):(this._x=0,this._y=Math.atan2(s,f))):"XZY"===t?(this._z=Math.asin(-r(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(s,o)):(this._x=Math.atan2(-c,f),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==n&&this._onChangeCallback(),this},setFromQuaternion:function(e,t,n){return Kn.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Kn,t,n)},setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(e){return Yn.setFromEuler(this),this.setFromQuaternion(Yn,e)},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new Rn(this._x,this._y,this._z)},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}}),Object.assign(Jn.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask|=1<<e|0},enableAll:function(){this.mask=-1},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},disableAll:function(){this.mask=0},test:function(e){return 0!=(this.mask&e.mask)}});var Zn=0,$n=new Rn,Qn=new An,er=new qn,tr=new Rn,nr=new Rn,rr=new Rn,ir=new An,or=new Rn(1,0,0),ar=new Rn(0,1,0),sr=new Rn(0,0,1),ur={type:"added"},lr={type:"removed"};function cr(){Object.defineProperty(this,"id",{value:Zn++}),this.uuid=Sn.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=cr.DefaultUp.clone();var e=new Rn,t=new Xn,n=new An,r=new Rn(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new qn},normalMatrix:{value:new kn}}),this.matrix=new qn,this.matrixWorld=new qn,this.matrixAutoUpdate=cr.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Jn,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function dr(){cr.call(this),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}cr.DefaultUp=new Rn(0,1,0),cr.DefaultMatrixAutoUpdate=!0,cr.prototype=Object.assign(Object.create(En.prototype),{constructor:cr,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(e,t){return Qn.setFromAxisAngle(e,t),this.quaternion.multiply(Qn),this},rotateOnWorldAxis:function(e,t){return Qn.setFromAxisAngle(e,t),this.quaternion.premultiply(Qn),this},rotateX:function(e){return this.rotateOnAxis(or,e)},rotateY:function(e){return this.rotateOnAxis(ar,e)},rotateZ:function(e){return this.rotateOnAxis(sr,e)},translateOnAxis:function(e,t){return $n.copy(e).applyQuaternion(this.quaternion),this.position.add($n.multiplyScalar(t)),this},translateX:function(e){return this.translateOnAxis(or,e)},translateY:function(e){return this.translateOnAxis(ar,e)},translateZ:function(e){return this.translateOnAxis(sr,e)},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4(er.getInverse(this.matrixWorld))},lookAt:function(e,t,n){e.isVector3?tr.copy(e):tr.set(e,t,n);var r=this.parent;this.updateWorldMatrix(!0,!1),nr.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?er.lookAt(nr,tr,this.up):er.lookAt(tr,nr,this.up),this.quaternion.setFromRotationMatrix(er),r&&(er.extractRotation(r.matrixWorld),Qn.setFromRotationMatrix(er),this.quaternion.premultiply(Qn.inverse()))},add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(ur)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var n=this.children.indexOf(e);return-1!==n&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(lr)),this},attach:function(e){return this.updateWorldMatrix(!0,!1),er.getInverse(this.matrixWorld),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),er.multiply(e.parent.matrixWorld)),e.applyMatrix(er),e.updateWorldMatrix(!1,!1),this.add(e),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new Rn),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new An),this.updateMatrixWorld(!0),this.matrixWorld.decompose(nr,e,rr),e},getWorldScale:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new Rn),this.updateMatrixWorld(!0),this.matrixWorld.decompose(nr,ir,e),e},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new Rn),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){var n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var r=this.children,i=0,o=r.length;i<o;i++)r[i].updateWorldMatrix(!1,!0)},toJSON:function(e){var t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var r={};function i(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){r.geometry=i(e.geometries,this.geometry);var o=this.geometry.parameters;if(void 0!==o&&void 0!==o.shapes){var a=o.shapes;if(Array.isArray(a))for(var s=0,u=a.length;s<u;s++){var l=a[s];i(e.shapes,l)}else i(e.shapes,a)}}if(void 0!==this.material)if(Array.isArray(this.material)){var c=[];for(s=0,u=this.material.length;s<u;s++)c.push(i(e.materials,this.material[s]));r.material=c}else r.material=i(e.materials,this.material);if(this.children.length>0){r.children=[];for(s=0;s<this.children.length;s++)r.children.push(this.children[s].toJSON(e).object)}if(t){var d=m(e.geometries),h=m(e.materials),f=m(e.textures),p=m(e.images);a=m(e.shapes);d.length>0&&(n.geometries=d),h.length>0&&(n.materials=h),f.length>0&&(n.textures=f),p.length>0&&(n.images=p),a.length>0&&(n.shapes=a)}return n.object=r,n;function m(e){var t=[];for(var n in e){var r=e[n];delete r.metadata,t.push(r)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var n=0;n<e.children.length;n++){var r=e.children[n];this.add(r.clone())}return this}}),dr.prototype=Object.assign(Object.create(cr.prototype),{constructor:dr,isScene:!0,copy:function(e,t){return cr.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=cr.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.environment&&(t.object.environment=this.environment.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t},dispose:function(){this.dispatchEvent({type:"dispose"})}});var hr=[new Rn,new Rn,new Rn,new Rn,new Rn,new Rn,new Rn,new Rn],fr=new Rn,pr=new xr,mr=new Rn,vr=new Rn,gr=new Rn,yr=new Rn,_r=new Rn,br=new Rn,Er=new Rn,wr=new Rn,Tr=new Rn,Sr=new Rn;function xr(e,t){this.min=void 0!==e?e:new Rn(1/0,1/0,1/0),this.max=void 0!==t?t:new Rn(-1/0,-1/0,-1/0)}function Ar(e,t,n,r,i){var o,a;for(o=0,a=e.length-3;o<=a;o+=3){Sr.fromArray(e,o);var s=i.x*Math.abs(Sr.x)+i.y*Math.abs(Sr.y)+i.z*Math.abs(Sr.z),u=t.dot(Sr),l=n.dot(Sr),c=r.dot(Sr);if(Math.max(-Math.max(u,l,c),Math.min(u,l,c))>s)return!1}return!0}Object.assign(xr.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,a=-1/0,s=0,u=e.length;s<u;s+=3){var l=e[s],c=e[s+1],d=e[s+2];l<t&&(t=l),c<n&&(n=c),d<r&&(r=d),l>i&&(i=l),c>o&&(o=c),d>a&&(a=d)}return this.min.set(t,n,r),this.max.set(i,o,a),this},setFromBufferAttribute:function(e){for(var t=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,a=-1/0,s=0,u=e.count;s<u;s++){var l=e.getX(s),c=e.getY(s),d=e.getZ(s);l<t&&(t=l),c<n&&(n=c),d<r&&(r=d),l>i&&(i=l),c>o&&(o=c),d>a&&(a=d)}return this.min.set(t,n,r),this.max.set(i,o,a),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){var n=fr.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this},setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new Rn),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new Rn),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(e){e.updateWorldMatrix(!1,!1);var t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),pr.copy(t.boundingBox),pr.applyMatrix4(e.matrixWorld),this.expandByPoint(pr.min),this.expandByPoint(pr.max));for(var n=e.children,r=0,i=n.length;r<i;r++)this.expandByObject(n[r]);return this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new Rn),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(e){return this.clampPoint(e.center,fr),fr.distanceToSquared(e.center)<=e.radius*e.radius},intersectsPlane:function(e){var t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant},intersectsTriangle:function(e){if(this.isEmpty())return!1;this.getCenter(Er),wr.subVectors(this.max,Er),mr.subVectors(e.a,Er),vr.subVectors(e.b,Er),gr.subVectors(e.c,Er),yr.subVectors(vr,mr),_r.subVectors(gr,vr),br.subVectors(mr,gr);var t=[0,-yr.z,yr.y,0,-_r.z,_r.y,0,-br.z,br.y,yr.z,0,-yr.x,_r.z,0,-_r.x,br.z,0,-br.x,-yr.y,yr.x,0,-_r.y,_r.x,0,-br.y,br.x,0];return!!Ar(t,mr,vr,gr,wr)&&(!!Ar(t=[1,0,0,0,1,0,0,0,1],mr,vr,gr,wr)&&(Tr.crossVectors(yr,_r),Ar(t=[Tr.x,Tr.y,Tr.z],mr,vr,gr,wr)))},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new Rn),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return fr.copy(e).clamp(this.min,this.max).sub(e).length()},getBoundingSphere:function(e){return void 0===e&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize(fr).length(),e},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(e){return this.isEmpty()||(hr[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),hr[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),hr[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),hr[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),hr[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),hr[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),hr[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),hr[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(hr)),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var Mr=new xr;function jr(e,t){this.center=void 0!==e?e:new Rn,this.radius=void 0!==t?t:0}Object.assign(jr.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(e,t){var n=this.center;void 0!==t?n.copy(t):Mr.setFromPoints(e).getCenter(n);for(var r=0,i=0,o=e.length;i<o;i++)r=Math.max(r,n.distanceToSquared(e[i]));return this.radius=Math.sqrt(r),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var n=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new Rn),t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new xr),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}});var Rr=new Rn,Lr=new Rn,Cr=new Rn,kr=new Rn,Or=new Rn,Pr=new Rn,Ir=new Rn;function Dr(e,t){this.origin=void 0!==e?e:new Rn,this.direction=void 0!==t?t:new Rn(0,0,-1)}Object.assign(Dr.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new Rn),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(e){return this.origin.copy(this.at(e,Rr)),this},closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new Rn),t.subVectors(e,this.origin);var n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(e){var t=Rr.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Rr.copy(this.direction).multiplyScalar(t).add(this.origin),Rr.distanceToSquared(e))},distanceSqToSegment:function(e,t,n,r){Lr.copy(e).add(t).multiplyScalar(.5),Cr.copy(t).sub(e).normalize(),kr.copy(this.origin).sub(Lr);var i,o,a,s,u=.5*e.distanceTo(t),l=-this.direction.dot(Cr),c=kr.dot(this.direction),d=-kr.dot(Cr),h=kr.lengthSq(),f=Math.abs(1-l*l);if(f>0)if(o=l*c-d,s=u*f,(i=l*d-c)>=0)if(o>=-s)if(o<=s){var p=1/f;a=(i*=p)*(i+l*(o*=p)+2*c)+o*(l*i+o+2*d)+h}else o=u,a=-(i=Math.max(0,-(l*o+c)))*i+o*(o+2*d)+h;else o=-u,a=-(i=Math.max(0,-(l*o+c)))*i+o*(o+2*d)+h;else o<=-s?a=-(i=Math.max(0,-(-l*u+c)))*i+(o=i>0?-u:Math.min(Math.max(-u,-d),u))*(o+2*d)+h:o<=s?(i=0,a=(o=Math.min(Math.max(-u,-d),u))*(o+2*d)+h):a=-(i=Math.max(0,-(l*u+c)))*i+(o=i>0?u:Math.min(Math.max(-u,-d),u))*(o+2*d)+h;else o=l>0?-u:u,a=-(i=Math.max(0,-(l*o+c)))*i+o*(o+2*d)+h;return n&&n.copy(this.direction).multiplyScalar(i).add(this.origin),r&&r.copy(Cr).multiplyScalar(o).add(Lr),a},intersectSphere:function(e,t){Rr.subVectors(e.center,this.origin);var n=Rr.dot(this.direction),r=Rr.dot(Rr)-n*n,i=e.radius*e.radius;if(r>i)return null;var o=Math.sqrt(i-r),a=n-o,s=n+o;return a<0&&s<0?null:a<0?this.at(s,t):this.at(a,t)},intersectsSphere:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null},intersectPlane:function(e,t){var n=this.distanceToPlane(e);return null===n?null:this.at(n,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0},intersectBox:function(e,t){var n,r,i,o,a,s,u=1/this.direction.x,l=1/this.direction.y,c=1/this.direction.z,d=this.origin;return u>=0?(n=(e.min.x-d.x)*u,r=(e.max.x-d.x)*u):(n=(e.max.x-d.x)*u,r=(e.min.x-d.x)*u),l>=0?(i=(e.min.y-d.y)*l,o=(e.max.y-d.y)*l):(i=(e.max.y-d.y)*l,o=(e.min.y-d.y)*l),n>o||i>r?null:((i>n||n!=n)&&(n=i),(o<r||r!=r)&&(r=o),c>=0?(a=(e.min.z-d.z)*c,s=(e.max.z-d.z)*c):(a=(e.max.z-d.z)*c,s=(e.min.z-d.z)*c),n>s||a>r?null:((a>n||n!=n)&&(n=a),(s<r||r!=r)&&(r=s),r<0?null:this.at(n>=0?n:r,t)))},intersectsBox:function(e){return null!==this.intersectBox(e,Rr)},intersectTriangle:function(e,t,n,r,i){Or.subVectors(t,e),Pr.subVectors(n,e),Ir.crossVectors(Or,Pr);var o,a=this.direction.dot(Ir);if(a>0){if(r)return null;o=1}else{if(!(a<0))return null;o=-1,a=-a}kr.subVectors(this.origin,e);var s=o*this.direction.dot(Pr.crossVectors(kr,Pr));if(s<0)return null;var u=o*this.direction.dot(Or.cross(kr));if(u<0)return null;if(s+u>a)return null;var l=-o*kr.dot(Ir);return l<0?null:this.at(l/a,i)},applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}});var Nr=new Rn,Br=new Rn,Ur=new kn;function Fr(e,t){this.normal=void 0!==e?e:new Rn(1,0,0),this.constant=void 0!==t?t:0}Object.assign(Fr.prototype,{isPlane:!0,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(e,t,n){var r=Nr.subVectors(n,t).cross(Br.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new Rn),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(e,t){void 0===t&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new Rn);var n=e.delta(Nr),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):void 0;var i=-(e.start.dot(this.normal)+this.constant)/r;return i<0||i>1?void 0:t.copy(n).multiplyScalar(i).add(e.start)},intersectsLine:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new Rn),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(e,t){var n=t||Ur.getNormalMatrix(e),r=this.coplanarPoint(Nr).applyMatrix4(e),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this},translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}});var Vr=new Rn,Gr=new Rn,Hr=new Rn,zr=new Rn,Wr=new Rn,qr=new Rn,Kr=new Rn,Yr=new Rn,Xr=new Rn,Jr=new Rn;function Zr(e,t,n){this.a=void 0!==e?e:new Rn,this.b=void 0!==t?t:new Rn,this.c=void 0!==n?n:new Rn}Object.assign(Zr,{getNormal:function(e,t,n,r){void 0===r&&(console.warn("THREE.Triangle: .getNormal() target is now required"),r=new Rn),r.subVectors(n,t),Vr.subVectors(e,t),r.cross(Vr);var i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)},getBarycoord:function(e,t,n,r,i){Vr.subVectors(r,t),Gr.subVectors(n,t),Hr.subVectors(e,t);var o=Vr.dot(Vr),a=Vr.dot(Gr),s=Vr.dot(Hr),u=Gr.dot(Gr),l=Gr.dot(Hr),c=o*u-a*a;if(void 0===i&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),i=new Rn),0===c)return i.set(-2,-1,-1);var d=1/c,h=(u*s-a*l)*d,f=(o*l-a*s)*d;return i.set(1-h-f,f,h)},containsPoint:function(e,t,n,r){return Zr.getBarycoord(e,t,n,r,zr),zr.x>=0&&zr.y>=0&&zr.x+zr.y<=1},getUV:function(e,t,n,r,i,o,a,s){return this.getBarycoord(e,t,n,r,zr),s.set(0,0),s.addScaledVector(i,zr.x),s.addScaledVector(o,zr.y),s.addScaledVector(a,zr.z),s},isFrontFacing:function(e,t,n,r){return Vr.subVectors(n,t),Gr.subVectors(e,t),Vr.cross(Gr).dot(r)<0}}),Object.assign(Zr.prototype,{set:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this},setFromPointsAndIndices:function(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){return Vr.subVectors(this.c,this.b),Gr.subVectors(this.a,this.b),.5*Vr.cross(Gr).length()},getMidpoint:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new Rn),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return Zr.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new Fr),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return Zr.getBarycoord(e,this.a,this.b,this.c,t)},getUV:function(e,t,n,r,i){return Zr.getUV(e,this.a,this.b,this.c,t,n,r,i)},containsPoint:function(e){return Zr.containsPoint(e,this.a,this.b,this.c)},isFrontFacing:function(e){return Zr.isFrontFacing(this.a,this.b,this.c,e)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new Rn);var n,r,i=this.a,o=this.b,a=this.c;Wr.subVectors(o,i),qr.subVectors(a,i),Yr.subVectors(e,i);var s=Wr.dot(Yr),u=qr.dot(Yr);if(s<=0&&u<=0)return t.copy(i);Xr.subVectors(e,o);var l=Wr.dot(Xr),c=qr.dot(Xr);if(l>=0&&c<=l)return t.copy(o);var d=s*c-l*u;if(d<=0&&s>=0&&l<=0)return n=s/(s-l),t.copy(i).addScaledVector(Wr,n);Jr.subVectors(e,a);var h=Wr.dot(Jr),f=qr.dot(Jr);if(f>=0&&h<=f)return t.copy(a);var p=h*u-s*f;if(p<=0&&u>=0&&f<=0)return r=u/(u-f),t.copy(i).addScaledVector(qr,r);var m=l*f-h*c;if(m<=0&&c-l>=0&&h-f>=0)return Kr.subVectors(a,o),r=(c-l)/(c-l+(h-f)),t.copy(o).addScaledVector(Kr,r);var v=1/(m+p+d);return n=p*v,r=d*v,t.copy(i).addScaledVector(Wr,n).addScaledVector(qr,r)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}});var $r={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Qr={h:0,s:0,l:0},ei={h:0,s:0,l:0};function ti(e,t,n){return void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}function ni(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function ri(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function ii(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}function oi(e,t,n,r,i,o){this.a=e,this.b=t,this.c=n,this.normal=r&&r.isVector3?r:new Rn,this.vertexNormals=Array.isArray(r)?r:[],this.color=i&&i.isColor?i:new ti,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=void 0!==o?o:0}Object.assign(ti.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,n){return this.r=e,this.g=t,this.b=n,this},setHSL:function(e,t,n){if(e=Sn.euclideanModulo(e,1),t=Sn.clamp(t,0,1),n=Sn.clamp(n,0,1),0===t)this.r=this.g=this.b=n;else{var r=n<=.5?n*(1+t):n+t-n*t,i=2*n-r;this.r=ni(i,r,e+1/3),this.g=ni(i,r,e),this.b=ni(i,r,e-1/3)}return this},setStyle:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var n;if(n=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var r,i=n[1],o=n[2];switch(i){case"rgb":case"rgba":if(r=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,t(r[5]),this;if(r=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,t(r[5]),this;break;case"hsl":case"hsla":if(r=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){var a=parseFloat(r[1])/360,s=parseInt(r[2],10)/100,u=parseInt(r[3],10)/100;return t(r[5]),this.setHSL(a,s,u)}}}else if(n=/^\#([A-Fa-f0-9]+)$/.exec(e)){var l=n[1],c=l.length;if(3===c)return this.r=parseInt(l.charAt(0)+l.charAt(0),16)/255,this.g=parseInt(l.charAt(1)+l.charAt(1),16)/255,this.b=parseInt(l.charAt(2)+l.charAt(2),16)/255,this;if(6===c)return this.r=parseInt(l.charAt(0)+l.charAt(1),16)/255,this.g=parseInt(l.charAt(2)+l.charAt(3),16)/255,this.b=parseInt(l.charAt(4)+l.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this},setColorName:function(e){var t=$r[e];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this},convertGammaToLinear:function(e){return this.copyGammaToLinear(this,e),this},convertLinearToGamma:function(e){return this.copyLinearToGamma(this,e),this},copySRGBToLinear:function(e){return this.r=ri(e.r),this.g=ri(e.g),this.b=ri(e.b),this},copyLinearToSRGB:function(e){return this.r=ii(e.r),this.g=ii(e.g),this.b=ii(e.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,n,r=this.r,i=this.g,o=this.b,a=Math.max(r,i,o),s=Math.min(r,i,o),u=(s+a)/2;if(s===a)t=0,n=0;else{var l=a-s;switch(n=u<=.5?l/(a+s):l/(2-a-s),a){case r:t=(i-o)/l+(i<o?6:0);break;case i:t=(o-r)/l+2;break;case o:t=(r-i)/l+4}t/=6}return e.h=t,e.s=n,e.l=u,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,n){return this.getHSL(Qr),Qr.h+=e,Qr.s+=t,Qr.l+=n,this.setHSL(Qr.h,Qr.s,Qr.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},lerpHSL:function(e,t){this.getHSL(Qr),e.getHSL(ei);var n=Sn.lerp(Qr.h,ei.h,t),r=Sn.lerp(Qr.s,ei.s,t),i=Sn.lerp(Qr.l,ei.l,t);return this.setHSL(n,r,i),this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}}),ti.NAMES=$r,Object.assign(oi.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,n=e.vertexNormals.length;t<n;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(t=0,n=e.vertexColors.length;t<n;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}});var ai=0;function si(){Object.defineProperty(this,"id",{value:ai++}),this.uuid=Sn.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=x,this.side=v,this.flatShading=!1,this.vertexTangents=!1,this.vertexColors=E,this.opacity=1,this.transparent=!1,this.blendSrc=U,this.blendDst=F,this.blendEquation=L,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=X,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=dn,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Jt,this.stencilZFail=Jt,this.stencilZPass=Jt,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function ui(e){si.call(this),this.type="MeshBasicMaterial",this.color=new ti(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ee,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}si.prototype=Object.assign(Object.create(En.prototype),{constructor:si,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var n=e[t];if(void 0!==n)if("shading"!==t){var r=this[t];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===_;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){var t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(e){var t=[];for(var n in e){var r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,n.reflectivity=this.reflectivity,n.refractionRatio=this.refractionRatio,void 0!==this.combine&&(n.combine=this.combine),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==x&&(n.blending=this.blending),!0===this.flatShading&&(n.flatShading=this.flatShading),this.side!==v&&(n.side=this.side),this.vertexColors!==E&&(n.vertexColors=this.vertexColors),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.morphNormals&&(n.morphNormals=!0),!0===this.skinning&&(n.skinning=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){var i=r(e.textures),o=r(e.images);i.length>0&&(n.textures=i),o.length>0&&(n.images=o)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexTangents=e.vertexTangents,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes,n=null;if(null!==t){var r=t.length;n=new Array(r);for(var i=0;i!==r;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(si.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),ui.prototype=Object.create(si.prototype),ui.prototype.constructor=ui,ui.prototype.isMeshBasicMaterial=!0,ui.prototype.copy=function(e){return si.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this};var li=new Rn;function ci(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.usage=hn,this.updateRange={offset:0,count:-1},this.version=0}function di(e,t,n){ci.call(this,new Int8Array(e),t,n)}function hi(e,t,n){ci.call(this,new Uint8Array(e),t,n)}function fi(e,t,n){ci.call(this,new Uint8ClampedArray(e),t,n)}function pi(e,t,n){ci.call(this,new Int16Array(e),t,n)}function mi(e,t,n){ci.call(this,new Uint16Array(e),t,n)}function vi(e,t,n){ci.call(this,new Int32Array(e),t,n)}function gi(e,t,n){ci.call(this,new Uint32Array(e),t,n)}function yi(e,t,n){ci.call(this,new Float32Array(e),t,n)}function _i(e,t,n){ci.call(this,new Float64Array(e),t,n)}function bi(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function Ei(e){if(0===e.length)return-1/0;for(var t=e[0],n=1,r=e.length;n<r;++n)e[n]>t&&(t=e[n]);return t}Object.defineProperty(ci.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(ci.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this},copyAt:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(var r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),o=new ti),t[n++]=o.r,t[n++]=o.g,t[n++]=o.b}return this},copyVector2sArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),o=new xn),t[n++]=o.x,t[n++]=o.y}return this},copyVector3sArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),o=new Rn),t[n++]=o.x,t[n++]=o.y,t[n++]=o.z}return this},copyVector4sArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),o=new Dn),t[n++]=o.x,t[n++]=o.y,t[n++]=o.z,t[n++]=o.w}return this},applyMatrix3:function(e){for(var t=0,n=this.count;t<n;t++)li.x=this.getX(t),li.y=this.getY(t),li.z=this.getZ(t),li.applyMatrix3(e),this.setXYZ(t,li.x,li.y,li.z);return this},applyMatrix4:function(e){for(var t=0,n=this.count;t<n;t++)li.x=this.getX(t),li.y=this.getY(t),li.z=this.getZ(t),li.applyMatrix4(e),this.setXYZ(t,li.x,li.y,li.z);return this},applyNormalMatrix:function(e){for(var t=0,n=this.count;t<n;t++)li.x=this.getX(t),li.y=this.getY(t),li.z=this.getZ(t),li.applyNormalMatrix(e),this.setXYZ(t,li.x,li.y,li.z);return this},transformDirection:function(e){for(var t=0,n=this.count;t<n;t++)li.x=this.getX(t),li.y=this.getY(t),li.z=this.getZ(t),li.transformDirection(e),this.setXYZ(t,li.x,li.y,li.z);return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this},setXYZ:function(e,t,n,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this},setXYZW:function(e,t,n,r,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),di.prototype=Object.create(ci.prototype),di.prototype.constructor=di,hi.prototype=Object.create(ci.prototype),hi.prototype.constructor=hi,fi.prototype=Object.create(ci.prototype),fi.prototype.constructor=fi,pi.prototype=Object.create(ci.prototype),pi.prototype.constructor=pi,mi.prototype=Object.create(ci.prototype),mi.prototype.constructor=mi,vi.prototype=Object.create(ci.prototype),vi.prototype.constructor=vi,gi.prototype=Object.create(ci.prototype),gi.prototype.constructor=gi,yi.prototype=Object.create(ci.prototype),yi.prototype.constructor=yi,_i.prototype=Object.create(ci.prototype),_i.prototype.constructor=_i,Object.assign(bi.prototype,{computeGroups:function(e){for(var t,n=[],r=void 0,i=e.faces,o=0;o<i.length;o++){var a=i[o];a.materialIndex!==r&&(r=a.materialIndex,void 0!==t&&(t.count=3*o-t.start,n.push(t)),t={start:3*o,materialIndex:r})}void 0!==t&&(t.count=3*o-t.start,n.push(t)),this.groups=n},fromGeometry:function(e){var t,n=e.faces,r=e.vertices,i=e.faceVertexUvs,o=i[0]&&i[0].length>0,a=i[1]&&i[1].length>0,s=e.morphTargets,u=s.length;if(u>0){t=[];for(var l=0;l<u;l++)t[l]={name:s[l].name,data:[]};this.morphTargets.position=t}var c,d=e.morphNormals,h=d.length;if(h>0){c=[];for(l=0;l<h;l++)c[l]={name:d[l].name,data:[]};this.morphTargets.normal=c}var f=e.skinIndices,p=e.skinWeights,m=f.length===r.length,v=p.length===r.length;r.length>0&&0===n.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(l=0;l<n.length;l++){var g=n[l];this.vertices.push(r[g.a],r[g.b],r[g.c]);var y=g.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{var _=g.normal;this.normals.push(_,_,_)}var b,E=g.vertexColors;if(3===E.length)this.colors.push(E[0],E[1],E[2]);else{var w=g.color;this.colors.push(w,w,w)}if(!0===o)void 0!==(b=i[0][l])?this.uvs.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",l),this.uvs.push(new xn,new xn,new xn));if(!0===a)void 0!==(b=i[1][l])?this.uvs2.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",l),this.uvs2.push(new xn,new xn,new xn));for(var T=0;T<u;T++){var S=s[T].vertices;t[T].data.push(S[g.a],S[g.b],S[g.c])}for(T=0;T<h;T++){var x=d[T].vertexNormals[l];c[T].data.push(x.a,x.b,x.c)}m&&this.skinIndices.push(f[g.a],f[g.b],f[g.c]),v&&this.skinWeights.push(p[g.a],p[g.b],p[g.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}});var wi=1,Ti=new qn,Si=new cr,xi=new Rn,Ai=new xr,Mi=new xr,ji=new Rn;function Ri(){Object.defineProperty(this,"id",{value:wi+=2}),this.uuid=Sn.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}Ri.prototype=Object.assign(Object.create(En.prototype),{constructor:Ri,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(Ei(e)>65535?gi:mi)(e,1):this.index=e},getAttribute:function(e){return this.attributes[e]},setAttribute:function(e,t){return this.attributes[e]=t,this},deleteAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,n){this.groups.push({start:e,count:t,materialIndex:void 0!==n?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);var n=this.attributes.normal;if(void 0!==n){var r=(new kn).getNormalMatrix(e);n.applyNormalMatrix(r),n.needsUpdate=!0}var i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(e){return Ti.makeRotationX(e),this.applyMatrix(Ti),this},rotateY:function(e){return Ti.makeRotationY(e),this.applyMatrix(Ti),this},rotateZ:function(e){return Ti.makeRotationZ(e),this.applyMatrix(Ti),this},translate:function(e,t,n){return Ti.makeTranslation(e,t,n),this.applyMatrix(Ti),this},scale:function(e,t,n){return Ti.makeScale(e,t,n),this.applyMatrix(Ti),this},lookAt:function(e){return Si.lookAt(e),Si.updateMatrix(),this.applyMatrix(Si.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(xi).negate(),this.translate(xi.x,xi.y,xi.z),this},setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){var n=new yi(3*t.vertices.length,3),r=new yi(3*t.colors.length,3);if(this.setAttribute("position",n.copyVector3sArray(t.vertices)),this.setAttribute("color",r.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var i=new yi(t.lineDistances.length,1);this.setAttribute("lineDistance",i.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new yi(t,3)),this},updateFromObject:function(e){var t,n=e.geometry;if(e.isMesh){var r=n.__directGeometry;if(!0===n.elementsNeedUpdate&&(r=void 0,n.elementsNeedUpdate=!1),void 0===r)return this.fromGeometry(n);r.verticesNeedUpdate=n.verticesNeedUpdate,r.normalsNeedUpdate=n.normalsNeedUpdate,r.colorsNeedUpdate=n.colorsNeedUpdate,r.uvsNeedUpdate=n.uvsNeedUpdate,r.groupsNeedUpdate=n.groupsNeedUpdate,n.verticesNeedUpdate=!1,n.normalsNeedUpdate=!1,n.colorsNeedUpdate=!1,n.uvsNeedUpdate=!1,n.groupsNeedUpdate=!1,n=r}return!0===n.verticesNeedUpdate&&(void 0!==(t=this.attributes.position)&&(t.copyVector3sArray(n.vertices),t.needsUpdate=!0),n.verticesNeedUpdate=!1),!0===n.normalsNeedUpdate&&(void 0!==(t=this.attributes.normal)&&(t.copyVector3sArray(n.normals),t.needsUpdate=!0),n.normalsNeedUpdate=!1),!0===n.colorsNeedUpdate&&(void 0!==(t=this.attributes.color)&&(t.copyColorsArray(n.colors),t.needsUpdate=!0),n.colorsNeedUpdate=!1),n.uvsNeedUpdate&&(void 0!==(t=this.attributes.uv)&&(t.copyVector2sArray(n.uvs),t.needsUpdate=!0),n.uvsNeedUpdate=!1),n.lineDistancesNeedUpdate&&(void 0!==(t=this.attributes.lineDistance)&&(t.copyArray(n.lineDistances),t.needsUpdate=!0),n.lineDistancesNeedUpdate=!1),n.groupsNeedUpdate&&(n.computeGroups(e.geometry),this.groups=n.groups,n.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new bi).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.setAttribute("position",new ci(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var n=new Float32Array(3*e.normals.length);this.setAttribute("normal",new ci(n,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var r=new Float32Array(3*e.colors.length);this.setAttribute("color",new ci(r,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var i=new Float32Array(2*e.uvs.length);this.setAttribute("uv",new ci(i,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var o=new Float32Array(2*e.uvs2.length);this.setAttribute("uv2",new ci(o,2).copyVector2sArray(e.uvs2))}for(var a in this.groups=e.groups,e.morphTargets){for(var s=[],u=e.morphTargets[a],l=0,c=u.length;l<c;l++){var d=u[l],h=new yi(3*d.data.length,3);h.name=d.name,s.push(h.copyVector3sArray(d.data))}this.morphAttributes[a]=s}if(e.skinIndices.length>0){var f=new yi(4*e.skinIndices.length,4);this.setAttribute("skinIndex",f.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var p=new yi(4*e.skinWeights.length,4);this.setAttribute("skinWeight",p.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new xr);var e=this.attributes.position,t=this.morphAttributes.position;if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(var n=0,r=t.length;n<r;n++){var i=t[n];Ai.setFromBufferAttribute(i),this.morphTargetsRelative?(ji.addVectors(this.boundingBox.min,Ai.min),this.boundingBox.expandByPoint(ji),ji.addVectors(this.boundingBox.max,Ai.max),this.boundingBox.expandByPoint(ji)):(this.boundingBox.expandByPoint(Ai.min),this.boundingBox.expandByPoint(Ai.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new jr);var e=this.attributes.position,t=this.morphAttributes.position;if(e){var n=this.boundingSphere.center;if(Ai.setFromBufferAttribute(e),t)for(var r=0,i=t.length;r<i;r++){var o=t[r];Mi.setFromBufferAttribute(o),this.morphTargetsRelative?(ji.addVectors(Ai.min,Mi.min),Ai.expandByPoint(ji),ji.addVectors(Ai.max,Mi.max),Ai.expandByPoint(ji)):(Ai.expandByPoint(Mi.min),Ai.expandByPoint(Mi.max))}Ai.getCenter(n);var a=0;for(r=0,i=e.count;r<i;r++)ji.fromBufferAttribute(e,r),a=Math.max(a,n.distanceToSquared(ji));if(t)for(r=0,i=t.length;r<i;r++){o=t[r];for(var s=this.morphTargetsRelative,u=0,l=o.count;u<l;u++)ji.fromBufferAttribute(o,u),s&&(xi.fromBufferAttribute(e,u),ji.add(xi)),a=Math.max(a,n.distanceToSquared(ji))}this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes;if(t.position){var n=t.position.array;if(void 0===t.normal)this.setAttribute("normal",new ci(new Float32Array(n.length),3));else for(var r=t.normal.array,i=0,o=r.length;i<o;i++)r[i]=0;var a,s,u,l=t.normal.array,c=new Rn,d=new Rn,h=new Rn,f=new Rn,p=new Rn;if(e){var m=e.array;for(i=0,o=e.count;i<o;i+=3)a=3*m[i+0],s=3*m[i+1],u=3*m[i+2],c.fromArray(n,a),d.fromArray(n,s),h.fromArray(n,u),f.subVectors(h,d),p.subVectors(c,d),f.cross(p),l[a]+=f.x,l[a+1]+=f.y,l[a+2]+=f.z,l[s]+=f.x,l[s+1]+=f.y,l[s+2]+=f.z,l[u]+=f.x,l[u+1]+=f.y,l[u+2]+=f.z}else for(i=0,o=n.length;i<o;i+=9)c.fromArray(n,i),d.fromArray(n,i+3),h.fromArray(n,i+6),f.subVectors(h,d),p.subVectors(c,d),f.cross(p),l[i]=f.x,l[i+1]=f.y,l[i+2]=f.z,l[i+3]=f.x,l[i+4]=f.y,l[i+5]=f.z,l[i+6]=f.x,l[i+7]=f.y,l[i+8]=f.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n=this.attributes;for(var r in n)if(void 0!==e.attributes[r])for(var i=n[r].array,o=e.attributes[r],a=o.array,s=o.itemSize*t,u=Math.min(a.length,i.length-s),l=0,c=s;l<u;l++,c++)i[c]=a[l];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){for(var e=this.attributes.normal,t=0,n=e.count;t<n;t++)ji.x=e.getX(t),ji.y=e.getY(t),ji.z=e.getZ(t),ji.normalize(),e.setXYZ(t,ji.x,ji.y,ji.z)},toNonIndexed:function(){function e(e,t){for(var n=e.array,r=e.itemSize,i=new n.constructor(t.length*r),o=0,a=0,s=0,u=t.length;s<u;s++){o=t[s]*r;for(var l=0;l<r;l++)i[a++]=n[o++]}return new ci(i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new Ri,n=this.index.array,r=this.attributes;for(var i in r){var o=e(r[i],n);t.setAttribute(i,o)}var a=this.morphAttributes;for(i in a){for(var s=[],u=a[i],l=0,c=u.length;l<c;l++){o=e(u[l],n);s.push(o)}t.morphAttributes[i]=s}t.morphTargetsRelative=this.morphTargetsRelative;for(var d=this.groups,h=(l=0,d.length);l<h;l++){var f=d[l];t.addGroup(f.start,f.count,f.materialIndex)}return t},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};var r=this.index;null!==r&&(e.data.index={type:r.array.constructor.name,array:Array.prototype.slice.call(r.array)});var i=this.attributes;for(var n in i){var o=(h=i[n]).toJSON();""!==h.name&&(o.name=h.name),e.data.attributes[n]=o}var a={},s=!1;for(var n in this.morphAttributes){for(var u=this.morphAttributes[n],l=[],c=0,d=u.length;c<d;c++){var h;o=(h=u[c]).toJSON();""!==h.name&&(o.name=h.name),l.push(o)}l.length>0&&(a[n]=l,s=!0)}s&&(e.data.morphAttributes=a,e.data.morphTargetsRelative=this.morphTargetsRelative);var f=this.groups;f.length>0&&(e.data.groups=JSON.parse(JSON.stringify(f)));var p=this.boundingSphere;return null!==p&&(e.data.boundingSphere={center:p.center.toArray(),radius:p.radius}),e},clone:function(){return(new Ri).copy(this)},copy:function(e){var t,n,r;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var i=e.index;null!==i&&this.setIndex(i.clone());var o=e.attributes;for(t in o){var a=o[t];this.setAttribute(t,a.clone())}var s=e.morphAttributes;for(t in s){var u=[],l=s[t];for(n=0,r=l.length;n<r;n++)u.push(l[n].clone());this.morphAttributes[t]=u}this.morphTargetsRelative=e.morphTargetsRelative;var c=e.groups;for(n=0,r=c.length;n<r;n++){var d=c[n];this.addGroup(d.start,d.count,d.materialIndex)}var h=e.boundingBox;null!==h&&(this.boundingBox=h.clone());var f=e.boundingSphere;return null!==f&&(this.boundingSphere=f.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Li=new qn,Ci=new Dr,ki=new jr,Oi=new Rn,Pi=new Rn,Ii=new Rn,Di=new Rn,Ni=new Rn,Bi=new Rn,Ui=new Rn,Fi=new Rn,Vi=new Rn,Gi=new xn,Hi=new xn,zi=new xn,Wi=new Rn,qi=new Rn;function Ki(e,t){cr.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new Ri,this.material=void 0!==t?t:new ui({color:16777215*Math.random()}),this.updateMorphTargets()}function Yi(e,t,n,r,i,o,a,s){if(null===(t.side===g?r.intersectTriangle(a,o,i,!0,s):r.intersectTriangle(i,o,a,t.side!==y,s)))return null;qi.copy(s),qi.applyMatrix4(e.matrixWorld);var u=n.ray.origin.distanceTo(qi);return u<n.near||u>n.far?null:{distance:u,point:qi.clone(),object:e}}function Xi(e,t,n,r,i,o,a,s,u,l,c,d){Oi.fromBufferAttribute(i,l),Pi.fromBufferAttribute(i,c),Ii.fromBufferAttribute(i,d);var h=e.morphTargetInfluences;if(t.morphTargets&&o&&h){Ui.set(0,0,0),Fi.set(0,0,0),Vi.set(0,0,0);for(var f=0,p=o.length;f<p;f++){var m=h[f],v=o[f];0!==m&&(Di.fromBufferAttribute(v,l),Ni.fromBufferAttribute(v,c),Bi.fromBufferAttribute(v,d),a?(Ui.addScaledVector(Di,m),Fi.addScaledVector(Ni,m),Vi.addScaledVector(Bi,m)):(Ui.addScaledVector(Di.sub(Oi),m),Fi.addScaledVector(Ni.sub(Pi),m),Vi.addScaledVector(Bi.sub(Ii),m)))}Oi.add(Ui),Pi.add(Fi),Ii.add(Vi)}var g=Yi(e,t,n,r,Oi,Pi,Ii,Wi);if(g){s&&(Gi.fromBufferAttribute(s,l),Hi.fromBufferAttribute(s,c),zi.fromBufferAttribute(s,d),g.uv=Zr.getUV(Wi,Oi,Pi,Ii,Gi,Hi,zi,new xn)),u&&(Gi.fromBufferAttribute(u,l),Hi.fromBufferAttribute(u,c),zi.fromBufferAttribute(u,d),g.uv2=Zr.getUV(Wi,Oi,Pi,Ii,Gi,Hi,zi,new xn));var y=new oi(l,c,d);Zr.getNormal(Oi,Pi,Ii,y.normal),g.face=y}return g}Ki.prototype=Object.assign(Object.create(cr.prototype),{constructor:Ki,isMesh:!0,copy:function(e){return cr.prototype.copy.call(this,e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e,t,n,r=this.geometry;if(r.isBufferGeometry){var i=r.morphAttributes,o=Object.keys(i);if(o.length>0){var a=i[o[0]];if(void 0!==a)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=a.length;e<t;e++)n=a[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}else{var s=r.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(e,t){var n,r=this.geometry,i=this.material,o=this.matrixWorld;if(void 0!==i&&(null===r.boundingSphere&&r.computeBoundingSphere(),ki.copy(r.boundingSphere),ki.applyMatrix4(o),!1!==e.ray.intersectsSphere(ki)&&(Li.getInverse(o),Ci.copy(e.ray).applyMatrix4(Li),null===r.boundingBox||!1!==Ci.intersectsBox(r.boundingBox))))if(r.isBufferGeometry){var a,s,u,l,c,d,h,f,p,m=r.index,v=r.attributes.position,g=r.morphAttributes.position,y=r.morphTargetsRelative,_=r.attributes.uv,b=r.attributes.uv2,E=r.groups,w=r.drawRange;if(null!==m)if(Array.isArray(i))for(l=0,d=E.length;l<d;l++)for(p=i[(f=E[l]).materialIndex],c=Math.max(f.start,w.start),h=Math.min(f.start+f.count,w.start+w.count);c<h;c+=3)a=m.getX(c),s=m.getX(c+1),u=m.getX(c+2),(n=Xi(this,p,e,Ci,v,g,y,_,b,a,s,u))&&(n.faceIndex=Math.floor(c/3),n.face.materialIndex=f.materialIndex,t.push(n));else for(l=Math.max(0,w.start),d=Math.min(m.count,w.start+w.count);l<d;l+=3)a=m.getX(l),s=m.getX(l+1),u=m.getX(l+2),(n=Xi(this,i,e,Ci,v,g,y,_,b,a,s,u))&&(n.faceIndex=Math.floor(l/3),t.push(n));else if(void 0!==v)if(Array.isArray(i))for(l=0,d=E.length;l<d;l++)for(p=i[(f=E[l]).materialIndex],c=Math.max(f.start,w.start),h=Math.min(f.start+f.count,w.start+w.count);c<h;c+=3)(n=Xi(this,p,e,Ci,v,g,y,_,b,a=c,s=c+1,u=c+2))&&(n.faceIndex=Math.floor(c/3),n.face.materialIndex=f.materialIndex,t.push(n));else for(l=Math.max(0,w.start),d=Math.min(v.count,w.start+w.count);l<d;l+=3)(n=Xi(this,i,e,Ci,v,g,y,_,b,a=l,s=l+1,u=l+2))&&(n.faceIndex=Math.floor(l/3),t.push(n))}else if(r.isGeometry){var T,S,x,A,M=Array.isArray(i),j=r.vertices,R=r.faces,L=r.faceVertexUvs[0];L.length>0&&(A=L);for(var C=0,k=R.length;C<k;C++){var O=R[C],P=M?i[O.materialIndex]:i;if(void 0!==P&&(T=j[O.a],S=j[O.b],x=j[O.c],n=Yi(this,P,e,Ci,T,S,x,Wi))){if(A&&A[C]){var I=A[C];Gi.copy(I[0]),Hi.copy(I[1]),zi.copy(I[2]),n.uv=Zr.getUV(Wi,T,S,x,Gi,Hi,zi,new xn)}n.face=O,n.faceIndex=C,t.push(n)}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Ji=0,Zi=new qn,$i=new cr,Qi=new Rn;function eo(){Object.defineProperty(this,"id",{value:Ji+=2}),this.uuid=Sn.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}eo.prototype=Object.assign(Object.create(En.prototype),{constructor:eo,isGeometry:!0,applyMatrix:function(e){for(var t=(new kn).getNormalMatrix(e),n=0,r=this.vertices.length;n<r;n++){this.vertices[n].applyMatrix4(e)}for(n=0,r=this.faces.length;n<r;n++){var i=this.faces[n];i.normal.applyMatrix3(t).normalize();for(var o=0,a=i.vertexNormals.length;o<a;o++)i.vertexNormals[o].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(e){return Zi.makeRotationX(e),this.applyMatrix(Zi),this},rotateY:function(e){return Zi.makeRotationY(e),this.applyMatrix(Zi),this},rotateZ:function(e){return Zi.makeRotationZ(e),this.applyMatrix(Zi),this},translate:function(e,t,n){return Zi.makeTranslation(e,t,n),this.applyMatrix(Zi),this},scale:function(e,t,n){return Zi.makeScale(e,t,n),this.applyMatrix(Zi),this},lookAt:function(e){return $i.lookAt(e),$i.updateMatrix(),this.applyMatrix($i.matrix),this},fromBufferGeometry:function(e){var t=this,n=null!==e.index?e.index.array:void 0,r=e.attributes;if(void 0===r.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;var i=r.position.array,o=void 0!==r.normal?r.normal.array:void 0,a=void 0!==r.color?r.color.array:void 0,s=void 0!==r.uv?r.uv.array:void 0,u=void 0!==r.uv2?r.uv2.array:void 0;void 0!==u&&(this.faceVertexUvs[1]=[]);for(var l=0;l<i.length;l+=3)t.vertices.push((new Rn).fromArray(i,l)),void 0!==a&&t.colors.push((new ti).fromArray(a,l));function c(e,n,r,i){var l=void 0===a?[]:[t.colors[e].clone(),t.colors[n].clone(),t.colors[r].clone()],c=new oi(e,n,r,void 0===o?[]:[(new Rn).fromArray(o,3*e),(new Rn).fromArray(o,3*n),(new Rn).fromArray(o,3*r)],l,i);t.faces.push(c),void 0!==s&&t.faceVertexUvs[0].push([(new xn).fromArray(s,2*e),(new xn).fromArray(s,2*n),(new xn).fromArray(s,2*r)]),void 0!==u&&t.faceVertexUvs[1].push([(new xn).fromArray(u,2*e),(new xn).fromArray(u,2*n),(new xn).fromArray(u,2*r)])}var d=e.groups;if(d.length>0)for(l=0;l<d.length;l++)for(var h=d[l],f=h.start,p=f,m=f+h.count;p<m;p+=3)void 0!==n?c(n[p],n[p+1],n[p+2],h.materialIndex):c(p,p+1,p+2,h.materialIndex);else if(void 0!==n)for(l=0;l<n.length;l+=3)c(n[l],n[l+1],n[l+2]);else for(l=0;l<i.length/3;l+=3)c(l,l+1,l+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Qi).negate(),this.translate(Qi.x,Qi.y,Qi.z),this},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,n=0===t?1:1/t,r=new qn;return r.set(n,0,0,-n*e.x,0,n,0,-n*e.y,0,0,n,-n*e.z,0,0,0,1),this.applyMatrix(r),this},computeFaceNormals:function(){for(var e=new Rn,t=new Rn,n=0,r=this.faces.length;n<r;n++){var i=this.faces[n],o=this.vertices[i.a],a=this.vertices[i.b],s=this.vertices[i.c];e.subVectors(s,a),t.subVectors(o,a),e.cross(t),e.normalize(),i.normal.copy(e)}},computeVertexNormals:function(e){var t,n,r,i,o,a;for(void 0===e&&(e=!0),a=new Array(this.vertices.length),t=0,n=this.vertices.length;t<n;t++)a[t]=new Rn;if(e){var s,u,l,c=new Rn,d=new Rn;for(r=0,i=this.faces.length;r<i;r++)o=this.faces[r],s=this.vertices[o.a],u=this.vertices[o.b],l=this.vertices[o.c],c.subVectors(l,u),d.subVectors(s,u),c.cross(d),a[o.a].add(c),a[o.b].add(c),a[o.c].add(c)}else for(this.computeFaceNormals(),r=0,i=this.faces.length;r<i;r++)a[(o=this.faces[r]).a].add(o.normal),a[o.b].add(o.normal),a[o.c].add(o.normal);for(t=0,n=this.vertices.length;t<n;t++)a[t].normalize();for(r=0,i=this.faces.length;r<i;r++){var h=(o=this.faces[r]).vertexNormals;3===h.length?(h[0].copy(a[o.a]),h[1].copy(a[o.b]),h[2].copy(a[o.c])):(h[0]=a[o.a].clone(),h[1]=a[o.b].clone(),h[2]=a[o.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e,t,n;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){var r=(n=this.faces[e]).vertexNormals;3===r.length?(r[0].copy(n.normal),r[1].copy(n.normal),r[2].copy(n.normal)):(r[0]=n.normal.clone(),r[1]=n.normal.clone(),r[2]=n.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,n,r,i;for(n=0,r=this.faces.length;n<r;n++)for((i=this.faces[n]).__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),e=0,t=i.vertexNormals.length;e<t;e++)i.__originalVertexNormals[e]?i.__originalVertexNormals[e].copy(i.vertexNormals[e]):i.__originalVertexNormals[e]=i.vertexNormals[e].clone();var o=new eo;for(o.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var a=this.morphNormals[e].faceNormals,s=this.morphNormals[e].vertexNormals;for(n=0,r=this.faces.length;n<r;n++)u=new Rn,l={a:new Rn,b:new Rn,c:new Rn},a.push(u),s.push(l)}var u,l,c=this.morphNormals[e];for(o.vertices=this.morphTargets[e].vertices,o.computeFaceNormals(),o.computeVertexNormals(),n=0,r=this.faces.length;n<r;n++)i=this.faces[n],u=c.faceNormals[n],l=c.vertexNormals[n],u.copy(i.normal),l.a.copy(i.vertexNormals[0]),l.b.copy(i.vertexNormals[1]),l.c.copy(i.vertexNormals[2])}for(n=0,r=this.faces.length;n<r;n++)(i=this.faces[n]).normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new xr),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new jr),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,n){if(e&&e.isGeometry){var r,i=this.vertices.length,o=this.vertices,a=e.vertices,s=this.faces,u=e.faces,l=this.colors,c=e.colors;void 0===n&&(n=0),void 0!==t&&(r=(new kn).getNormalMatrix(t));for(var d=0,h=a.length;d<h;d++){var f=a[d].clone();void 0!==t&&f.applyMatrix4(t),o.push(f)}for(d=0,h=c.length;d<h;d++)l.push(c[d].clone());for(d=0,h=u.length;d<h;d++){var p,m,v,g=u[d],y=g.vertexNormals,_=g.vertexColors;(p=new oi(g.a+i,g.b+i,g.c+i)).normal.copy(g.normal),void 0!==r&&p.normal.applyMatrix3(r).normalize();for(var b=0,E=y.length;b<E;b++)m=y[b].clone(),void 0!==r&&m.applyMatrix3(r).normalize(),p.vertexNormals.push(m);p.color.copy(g.color);for(b=0,E=_.length;b<E;b++)v=_[b],p.vertexColors.push(v.clone());p.materialIndex=g.materialIndex+n,s.push(p)}for(d=0,h=e.faceVertexUvs.length;d<h;d++){var w=e.faceVertexUvs[d];void 0===this.faceVertexUvs[d]&&(this.faceVertexUvs[d]=[]);for(b=0,E=w.length;b<E;b++){for(var T=w[b],S=[],x=0,A=T.length;x<A;x++)S.push(T[x].clone());this.faceVertexUvs[d].push(S)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var e,t,n,r,i,o,a,s,u={},l=[],c=[],d=Math.pow(10,4);for(n=0,r=this.vertices.length;n<r;n++)e=this.vertices[n],void 0===u[t=Math.round(e.x*d)+"_"+Math.round(e.y*d)+"_"+Math.round(e.z*d)]?(u[t]=n,l.push(this.vertices[n]),c[n]=l.length-1):c[n]=c[u[t]];var h=[];for(n=0,r=this.faces.length;n<r;n++){(i=this.faces[n]).a=c[i.a],i.b=c[i.b],i.c=c[i.c],o=[i.a,i.b,i.c];for(var f=0;f<3;f++)if(o[f]===o[(f+1)%3]){h.push(n);break}}for(n=h.length-1;n>=0;n--){var p=h[n];for(this.faces.splice(p,1),a=0,s=this.faceVertexUvs.length;a<s;a++)this.faceVertexUvs[a].splice(p,1)}var m=this.vertices.length-l.length;return this.vertices=l,m},setFromPoints:function(e){this.vertices=[];for(var t=0,n=e.length;t<n;t++){var r=e[t];this.vertices.push(new Rn(r.x,r.y,r.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,n=0;n<t;n++)e[n]._id=n;e.sort((function(e,t){return e.materialIndex-t.materialIndex}));var r,i,o=this.faceVertexUvs[0],a=this.faceVertexUvs[1];o&&o.length===t&&(r=[]),a&&a.length===t&&(i=[]);for(n=0;n<t;n++){var s=e[n]._id;r&&r.push(o[s]),i&&i.push(a[s])}r&&(this.faceVertexUvs[0]=r),i&&(this.faceVertexUvs[1]=i)},toJSON:function(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}for(var r=[],i=0;i<this.vertices.length;i++){var o=this.vertices[i];r.push(o.x,o.y,o.z)}var a=[],s=[],u={},l=[],c={},d=[],h={};for(i=0;i<this.faces.length;i++){var f=this.faces[i],p=void 0!==this.faceVertexUvs[0][i],m=f.normal.length()>0,v=f.vertexNormals.length>0,g=1!==f.color.r||1!==f.color.g||1!==f.color.b,y=f.vertexColors.length>0,_=0;if(_=T(_,0,0),_=T(_,1,!0),_=T(_,2,!1),_=T(_,3,p),_=T(_,4,m),_=T(_,5,v),_=T(_,6,g),_=T(_,7,y),a.push(_),a.push(f.a,f.b,f.c),a.push(f.materialIndex),p){var b=this.faceVertexUvs[0][i];a.push(A(b[0]),A(b[1]),A(b[2]))}if(m&&a.push(S(f.normal)),v){var E=f.vertexNormals;a.push(S(E[0]),S(E[1]),S(E[2]))}if(g&&a.push(x(f.color)),y){var w=f.vertexColors;a.push(x(w[0]),x(w[1]),x(w[2]))}}function T(e,t,n){return n?e|1<<t:e&~(1<<t)}function S(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==u[t]||(u[t]=s.length/3,s.push(e.x,e.y,e.z)),u[t]}function x(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==c[t]||(c[t]=l.length,l.push(e.getHex())),c[t]}function A(e){var t=e.x.toString()+e.y.toString();return void 0!==h[t]||(h[t]=d.length/2,d.push(e.x,e.y)),h[t]}return e.data={},e.data.vertices=r,e.data.normals=s,l.length>0&&(e.data.colors=l),d.length>0&&(e.data.uvs=[d]),e.data.faces=a,e},clone:function(){return(new eo).copy(this)},copy:function(e){var t,n,r,i,o,a;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var s=e.vertices;for(t=0,n=s.length;t<n;t++)this.vertices.push(s[t].clone());var u=e.colors;for(t=0,n=u.length;t<n;t++)this.colors.push(u[t].clone());var l=e.faces;for(t=0,n=l.length;t<n;t++)this.faces.push(l[t].clone());for(t=0,n=e.faceVertexUvs.length;t<n;t++){var c=e.faceVertexUvs[t];for(void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]),r=0,i=c.length;r<i;r++){var d=c[r],h=[];for(o=0,a=d.length;o<a;o++){var f=d[o];h.push(f.clone())}this.faceVertexUvs[t].push(h)}}var p=e.morphTargets;for(t=0,n=p.length;t<n;t++){var m={};if(m.name=p[t].name,void 0!==p[t].vertices)for(m.vertices=[],r=0,i=p[t].vertices.length;r<i;r++)m.vertices.push(p[t].vertices[r].clone());if(void 0!==p[t].normals)for(m.normals=[],r=0,i=p[t].normals.length;r<i;r++)m.normals.push(p[t].normals[r].clone());this.morphTargets.push(m)}var v=e.morphNormals;for(t=0,n=v.length;t<n;t++){var g={};if(void 0!==v[t].vertexNormals)for(g.vertexNormals=[],r=0,i=v[t].vertexNormals.length;r<i;r++){var y=v[t].vertexNormals[r],_={};_.a=y.a.clone(),_.b=y.b.clone(),_.c=y.c.clone(),g.vertexNormals.push(_)}if(void 0!==v[t].faceNormals)for(g.faceNormals=[],r=0,i=v[t].faceNormals.length;r<i;r++)g.faceNormals.push(v[t].faceNormals[r].clone());this.morphNormals.push(g)}var b=e.skinWeights;for(t=0,n=b.length;t<n;t++)this.skinWeights.push(b[t].clone());var E=e.skinIndices;for(t=0,n=E.length;t<n;t++)this.skinIndices.push(E[t].clone());var w=e.lineDistances;for(t=0,n=w.length;t<n;t++)this.lineDistances.push(w[t]);var T=e.boundingBox;null!==T&&(this.boundingBox=T.clone());var S=e.boundingSphere;return null!==S&&(this.boundingSphere=S.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});class to extends eo{constructor(e,t,n,r,i,o){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:o},this.fromBufferGeometry(new no(e,t,n,r,i,o)),this.mergeVertices()}}class no extends Ri{constructor(e,t,n,r,i,o){super(),this.type="BoxBufferGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:o};var a=this;e=e||1,t=t||1,n=n||1,r=Math.floor(r)||1,i=Math.floor(i)||1,o=Math.floor(o)||1;var s=[],u=[],l=[],c=[],d=0,h=0;function f(e,t,n,r,i,o,f,p,m,v,g){var y,_,b=o/m,E=f/v,w=o/2,T=f/2,S=p/2,x=m+1,A=v+1,M=0,j=0,R=new Rn;for(_=0;_<A;_++){var L=_*E-T;for(y=0;y<x;y++){var C=y*b-w;R[e]=C*r,R[t]=L*i,R[n]=S,u.push(R.x,R.y,R.z),R[e]=0,R[t]=0,R[n]=p>0?1:-1,l.push(R.x,R.y,R.z),c.push(y/m),c.push(1-_/v),M+=1}}for(_=0;_<v;_++)for(y=0;y<m;y++){var k=d+y+x*_,O=d+y+x*(_+1),P=d+(y+1)+x*(_+1),I=d+(y+1)+x*_;s.push(k,O,I),s.push(O,P,I),j+=6}a.addGroup(h,j,g),h+=j,d+=M}f("z","y","x",-1,-1,n,t,e,o,i,0),f("z","y","x",1,-1,n,t,-e,o,i,1),f("x","z","y",1,1,e,n,t,r,o,2),f("x","z","y",1,-1,e,n,-t,r,o,3),f("x","y","z",1,-1,e,t,n,r,i,4),f("x","y","z",-1,-1,e,t,-n,r,i,5),this.setIndex(s),this.setAttribute("position",new yi(u,3)),this.setAttribute("normal",new yi(l,3)),this.setAttribute("uv",new yi(c,2))}}function ro(e){var t={};for(var n in e)for(var r in t[n]={},e[n]){var i=e[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?t[n][r]=i.clone():Array.isArray(i)?t[n][r]=i.slice():t[n][r]=i}return t}function io(e){for(var t={},n=0;n<e.length;n++){var r=ro(e[n]);for(var i in r)t[i]=r[i]}return t}var oo={clone:ro,merge:io};function ao(e){si.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function so(){cr.call(this),this.type="Camera",this.matrixWorldInverse=new qn,this.projectionMatrix=new qn,this.projectionMatrixInverse=new qn}function uo(e,t,n,r){so.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==n?n:.1,this.far=void 0!==r?r:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}ao.prototype=Object.create(si.prototype),ao.prototype.constructor=ao,ao.prototype.isShaderMaterial=!0,ao.prototype.copy=function(e){return si.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=ro(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},ao.prototype.toJSON=function(e){var t=si.prototype.toJSON.call(this,e);for(var n in t.uniforms={},this.uniforms){var r=this.uniforms[n].value;r&&r.isTexture?t.uniforms[n]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[n]={type:"m4",value:r.toArray()}:t.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var i={};for(var o in this.extensions)!0===this.extensions[o]&&(i[o]=!0);return Object.keys(i).length>0&&(t.extensions=i),t},so.prototype=Object.assign(Object.create(cr.prototype),{constructor:so,isCamera:!0,copy:function(e,t){return cr.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new Rn),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){cr.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),uo.prototype=Object.assign(Object.create(so.prototype),{constructor:uo,isPerspectiveCamera:!0,copy:function(e,t){return so.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*Sn.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*Sn.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*Sn.RAD2DEG*Math.atan(Math.tan(.5*Sn.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,n,r,i,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*Sn.DEG2RAD*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r,o=this.view;if(null!==this.view&&this.view.enabled){var a=o.fullWidth,s=o.fullHeight;i+=o.offsetX*r/a,t-=o.offsetY*n/s,r*=o.width/a,n*=o.height/s}var u=this.filmOffset;0!==u&&(i+=e*u/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=cr.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}});function lo(e,t,n,r){cr.call(this),this.type="CubeCamera";var i=new uo(90,1,e,t);i.up.set(0,-1,0),i.lookAt(new Rn(1,0,0)),this.add(i);var o=new uo(90,1,e,t);o.up.set(0,-1,0),o.lookAt(new Rn(-1,0,0)),this.add(o);var a=new uo(90,1,e,t);a.up.set(0,0,1),a.lookAt(new Rn(0,1,0)),this.add(a);var s=new uo(90,1,e,t);s.up.set(0,0,-1),s.lookAt(new Rn(0,-1,0)),this.add(s);var u=new uo(90,1,e,t);u.up.set(0,-1,0),u.lookAt(new Rn(0,0,1)),this.add(u);var l=new uo(90,1,e,t);l.up.set(0,-1,0),l.lookAt(new Rn(0,0,-1)),this.add(l),r=r||{format:He,magFilter:xe,minFilter:xe},this.renderTarget=new co(n,n,r),this.renderTarget.texture.name="CubeCamera",this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var n=e.getRenderTarget(),r=this.renderTarget,c=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0),e.render(t,i),e.setRenderTarget(r,1),e.render(t,o),e.setRenderTarget(r,2),e.render(t,a),e.setRenderTarget(r,3),e.render(t,s),e.setRenderTarget(r,4),e.render(t,u),r.texture.generateMipmaps=c,e.setRenderTarget(r,5),e.render(t,l),e.setRenderTarget(n)},this.clear=function(e,t,n,r){for(var i=e.getRenderTarget(),o=this.renderTarget,a=0;a<6;a++)e.setRenderTarget(o,a),e.clear(t,n,r);e.setRenderTarget(i)}}function co(e,t,n){Nn.call(this,e,t,n)}function ho(e,t,n,r,i,o,a,s,u,l,c,d){In.call(this,null,o,a,s,u,l,r,i,c,d),this.image={data:e||null,width:t||1,height:n||1},this.magFilter=void 0!==u?u:be,this.minFilter=void 0!==l?l:be,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}lo.prototype=Object.create(cr.prototype),lo.prototype.constructor=lo,co.prototype=Object.create(Nn.prototype),co.prototype.constructor=co,co.prototype.isWebGLRenderTargetCube=!0,co.prototype.fromEquirectangularTexture=function(e,t){this.texture.type=t.type,this.texture.format=t.format,this.texture.encoding=t.encoding;var n=new dr,r={uniforms:{tEquirect:{value:null}},vertexShader:["varying vec3 vWorldDirection;","vec3 transformDirection( in vec3 dir, in mat4 matrix ) {","\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );","}","void main() {","\tvWorldDirection = transformDirection( position, modelMatrix );","\t#include <begin_vertex>","\t#include <project_vertex>","}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","varying vec3 vWorldDirection;","#define RECIPROCAL_PI 0.31830988618","#define RECIPROCAL_PI2 0.15915494","void main() {","\tvec3 direction = normalize( vWorldDirection );","\tvec2 sampleUV;","\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;","\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","\tgl_FragColor = texture2D( tEquirect, sampleUV );","}"].join("\n")},i=new ao({type:"CubemapFromEquirect",uniforms:ro(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:g,blending:S});i.uniforms.tEquirect.value=t;var o=new Ki(new no(5,5,5),i);n.add(o);var a=new lo(1,10,1);return a.renderTarget=this,a.renderTarget.texture.name="CubeCameraTexture",a.update(e,n),o.geometry.dispose(),o.material.dispose(),this},ho.prototype=Object.create(In.prototype),ho.prototype.constructor=ho,ho.prototype.isDataTexture=!0;var fo=new jr,po=new Rn;function mo(e,t,n,r,i,o){this.planes=[void 0!==e?e:new Fr,void 0!==t?t:new Fr,void 0!==n?n:new Fr,void 0!==r?r:new Fr,void 0!==i?i:new Fr,void 0!==o?o:new Fr]}Object.assign(mo.prototype,{set:function(e,t,n,r,i,o){var a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(r),a[4].copy(i),a[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,n=0;n<6;n++)t[n].copy(e.planes[n]);return this},setFromMatrix:function(e){var t=this.planes,n=e.elements,r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],u=n[5],l=n[6],c=n[7],d=n[8],h=n[9],f=n[10],p=n[11],m=n[12],v=n[13],g=n[14],y=n[15];return t[0].setComponents(a-r,c-s,p-d,y-m).normalize(),t[1].setComponents(a+r,c+s,p+d,y+m).normalize(),t[2].setComponents(a+i,c+u,p+h,y+v).normalize(),t[3].setComponents(a-i,c-u,p-h,y-v).normalize(),t[4].setComponents(a-o,c-l,p-f,y-g).normalize(),t[5].setComponents(a+o,c+l,p+f,y+g).normalize(),this},intersectsObject:function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),fo.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(fo)},intersectsSprite:function(e){return fo.center.set(0,0,0),fo.radius=.7071067811865476,fo.applyMatrix4(e.matrixWorld),this.intersectsSphere(fo)},intersectsSphere:function(e){for(var t=this.planes,n=e.center,r=-e.radius,i=0;i<6;i++){if(t[i].distanceToPoint(n)<r)return!1}return!0},intersectsBox:function(e){for(var t=this.planes,n=0;n<6;n++){var r=t[n];if(po.x=r.normal.x>0?e.max.x:e.min.x,po.y=r.normal.y>0?e.max.y:e.min.y,po.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(po)<0)return!1}return!0},containsPoint:function(e){for(var t=this.planes,n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}});var vo={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha  = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvarying vec3 vViewPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n  return m[ 2 ][ 3 ] == - 1.0;\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_maxMipLevel 8.0\n#define cubeUV_minMipLevel 4.0\n#define cubeUV_maxTileSize 256.0\n#define cubeUV_minTileSize 16.0\nfloat getFace(vec3 direction) {\n    vec3 absDirection = abs(direction);\n    float face = -1.0;\n    if (absDirection.x > absDirection.z) {\n      if (absDirection.x > absDirection.y)\n        face = direction.x > 0.0 ? 0.0 : 3.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    } else {\n      if (absDirection.z > absDirection.y)\n        face = direction.z > 0.0 ? 2.0 : 5.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    }\n    return face;\n}\nvec2 getUV(vec3 direction, float face) {\n    vec2 uv;\n    if (face == 0.0) {\n      uv = vec2(-direction.z, direction.y) / abs(direction.x);\n    } else if (face == 1.0) {\n      uv = vec2(direction.x, -direction.z) / abs(direction.y);\n    } else if (face == 2.0) {\n      uv = direction.xy / abs(direction.z);\n    } else if (face == 3.0) {\n      uv = vec2(direction.z, direction.y) / abs(direction.x);\n    } else if (face == 4.0) {\n      uv = direction.xz / abs(direction.y);\n    } else {\n      uv = vec2(-direction.x, direction.y) / abs(direction.z);\n    }\n    return 0.5 * (uv + 1.0);\n}\nvec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n  float face = getFace(direction);\n  float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n  mipInt = max(mipInt, cubeUV_minMipLevel);\n  float faceSize = exp2(mipInt);\n  float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n  vec2 uv = getUV(direction, face) * (faceSize - 1.0);\n  vec2 f = fract(uv);\n  uv += 0.5 - f;\n  if (face > 2.0) {\n    uv.y += faceSize;\n    face -= 3.0;\n  }\n  uv.x += face * faceSize;\n  if(mipInt < cubeUV_maxMipLevel){\n    uv.y += 2.0 * cubeUV_maxTileSize;\n  }\n  uv.y += filterInt * 2.0 * cubeUV_minTileSize;\n  uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n  uv *= texelSize;\n  vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x += texelSize;\n  vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.y += texelSize;\n  vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x -= texelSize;\n  vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  vec3 tm = mix(tl, tr, f.x);\n  vec3 bm = mix(bl, br, f.x);\n  return mix(tm, bm, f.y);\n}\n#define r0 1.0\n#define v0 0.339\n#define m0 -2.0\n#define r1 0.8\n#define v1 0.276\n#define m1 -1.0\n#define r4 0.4\n#define v4 0.046\n#define m4 2.0\n#define r5 0.305\n#define v5 0.016\n#define m5 3.0\n#define r6 0.21\n#define v6 0.0038\n#define m6 4.0\nfloat roughnessToMip(float roughness) {\n  float mip = 0.0;\n  if (roughness >= r1) {\n    mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n  } else if (roughness >= r4) {\n    mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n  } else if (roughness >= r5) {\n    mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n  } else if (roughness >= r6) {\n    mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n  } else {\n    mip = -2.0 * log2(1.16 * roughness);  }\n  return mip;\n}\nvec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {\n  float mip = clamp(roughnessToMip(roughness), m0, cubeUV_maxMipLevel);\n  float mipF = fract(mip);\n  float mipInt = floor(mip);\n  vec3 color0 = bilinearCubeUV(envMap, sampleDir, mipInt);\n  if (mipF == 0.0) {\n    return vec4(color0, 1.0);\n  } else {\n    vec3 color1 = bilinearCubeUV(envMap, sampleDir, mipInt + 1.0);\n    return vec4(mix(color0, color1, mipF), 1.0);\n  }\n}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\ttransformedNormal = mat3( instanceMatrix ) * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\t\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t}  else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ), 0.0 );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t  vec3 reflectVec = reflect( -viewDir, normal );\n\t\t  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryReflectVec, roughness );\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) { \n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = saturate( clearcoat );\tmaterial.clearcoatRoughness = max( clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( pointLight.shadow, directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( spotLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( directionalLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",clearcoat_normalmap_pars_fragment:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = ( floor( uv * size - 0.5 ) + 0.5 ) * texelSize;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= all( bvec2( directionalLight.shadow, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= all( bvec2( spotLight.shadow, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= all( bvec2( pointLight.shadow, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\n}",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSPARENCY\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSPARENCY\n\tuniform float transparency;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSPARENCY\n\t\tdiffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},go={common:{diffuse:{value:new ti(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new kn},uv2Transform:{value:new kn},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new xn(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ti(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new ti(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new kn}},sprite:{diffuse:{value:new ti(15658734)},opacity:{value:1},center:{value:new xn(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new kn}}},yo={basic:{uniforms:io([go.common,go.specularmap,go.envmap,go.aomap,go.lightmap,go.fog]),vertexShader:vo.meshbasic_vert,fragmentShader:vo.meshbasic_frag},lambert:{uniforms:io([go.common,go.specularmap,go.envmap,go.aomap,go.lightmap,go.emissivemap,go.fog,go.lights,{emissive:{value:new ti(0)}}]),vertexShader:vo.meshlambert_vert,fragmentShader:vo.meshlambert_frag},phong:{uniforms:io([go.common,go.specularmap,go.envmap,go.aomap,go.lightmap,go.emissivemap,go.bumpmap,go.normalmap,go.displacementmap,go.fog,go.lights,{emissive:{value:new ti(0)},specular:{value:new ti(1118481)},shininess:{value:30}}]),vertexShader:vo.meshphong_vert,fragmentShader:vo.meshphong_frag},standard:{uniforms:io([go.common,go.envmap,go.aomap,go.lightmap,go.emissivemap,go.bumpmap,go.normalmap,go.displacementmap,go.roughnessmap,go.metalnessmap,go.fog,go.lights,{emissive:{value:new ti(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:vo.meshphysical_vert,fragmentShader:vo.meshphysical_frag},toon:{uniforms:io([go.common,go.specularmap,go.aomap,go.lightmap,go.emissivemap,go.bumpmap,go.normalmap,go.displacementmap,go.gradientmap,go.fog,go.lights,{emissive:{value:new ti(0)},specular:{value:new ti(1118481)},shininess:{value:30}}]),vertexShader:vo.meshtoon_vert,fragmentShader:vo.meshtoon_frag},matcap:{uniforms:io([go.common,go.bumpmap,go.normalmap,go.displacementmap,go.fog,{matcap:{value:null}}]),vertexShader:vo.meshmatcap_vert,fragmentShader:vo.meshmatcap_frag},points:{uniforms:io([go.points,go.fog]),vertexShader:vo.points_vert,fragmentShader:vo.points_frag},dashed:{uniforms:io([go.common,go.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:vo.linedashed_vert,fragmentShader:vo.linedashed_frag},depth:{uniforms:io([go.common,go.displacementmap]),vertexShader:vo.depth_vert,fragmentShader:vo.depth_frag},normal:{uniforms:io([go.common,go.bumpmap,go.normalmap,go.displacementmap,{opacity:{value:1}}]),vertexShader:vo.normal_vert,fragmentShader:vo.normal_frag},sprite:{uniforms:io([go.sprite,go.fog]),vertexShader:vo.sprite_vert,fragmentShader:vo.sprite_frag},background:{uniforms:{uvTransform:{value:new kn},t2D:{value:null}},vertexShader:vo.background_vert,fragmentShader:vo.background_frag},cube:{uniforms:io([go.envmap,{opacity:{value:1}}]),vertexShader:vo.cube_vert,fragmentShader:vo.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:vo.equirect_vert,fragmentShader:vo.equirect_frag},distanceRGBA:{uniforms:io([go.common,go.displacementmap,{referencePosition:{value:new Rn},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:vo.distanceRGBA_vert,fragmentShader:vo.distanceRGBA_frag},shadow:{uniforms:io([go.lights,go.fog,{color:{value:new ti(0)},opacity:{value:1}}]),vertexShader:vo.shadow_vert,fragmentShader:vo.shadow_frag}};function _o(){var e=null,t=!1,n=null;function r(i,o){!1!==t&&(n(i,o),e.requestAnimationFrame(r))}return{start:function(){!0!==t&&null!==n&&(e.requestAnimationFrame(r),t=!0)},stop:function(){t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function bo(e){var t=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function(n){n.isInterleavedBufferAttribute&&(n=n.data);var r=t.get(n);r&&(e.deleteBuffer(r.buffer),t.delete(n))},update:function(n,r){n.isInterleavedBufferAttribute&&(n=n.data);var i=t.get(n);void 0===i?t.set(n,function(t,n){var r=t.array,i=t.usage,o=e.createBuffer();e.bindBuffer(n,o),e.bufferData(n,r,i),t.onUploadCallback();var a=5126;return r instanceof Float32Array?a=5126:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?a=5123:r instanceof Int16Array?a=5122:r instanceof Uint32Array?a=5125:r instanceof Int32Array?a=5124:r instanceof Int8Array?a=5120:r instanceof Uint8Array&&(a=5121),{buffer:o,type:a,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}(n,r)):i.version<n.version&&(!function(t,n,r){var i=n.array,o=n.updateRange;e.bindBuffer(r,t),-1===o.count?e.bufferSubData(r,0,i):(e.bufferSubData(r,o.offset*i.BYTES_PER_ELEMENT,i.subarray(o.offset,o.offset+o.count)),o.count=-1)}(i.buffer,n,r),i.version=n.version)}}}function Eo(e,t,n,r){eo.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r},this.fromBufferGeometry(new wo(e,t,n,r)),this.mergeVertices()}function wo(e,t,n,r){Ri.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};var i,o,a=(e=e||1)/2,s=(t=t||1)/2,u=Math.floor(n)||1,l=Math.floor(r)||1,c=u+1,d=l+1,h=e/u,f=t/l,p=[],m=[],v=[],g=[];for(o=0;o<d;o++){var y=o*f-s;for(i=0;i<c;i++){var _=i*h-a;m.push(_,-y,0),v.push(0,0,1),g.push(i/u),g.push(1-o/l)}}for(o=0;o<l;o++)for(i=0;i<u;i++){var b=i+c*o,E=i+c*(o+1),w=i+1+c*(o+1),T=i+1+c*o;p.push(b,E,T),p.push(E,w,T)}this.setIndex(p),this.setAttribute("position",new yi(m,3)),this.setAttribute("normal",new yi(v,3)),this.setAttribute("uv",new yi(g,2))}function To(e,t,n,r){var i,o,a=new ti(0),s=0,u=null,l=0;function c(e,n){t.buffers.color.setClear(e.r,e.g,e.b,n,r)}return{getClearColor:function(){return a},setClearColor:function(e,t){a.set(e),c(a,s=void 0!==t?t:1)},getClearAlpha:function(){return s},setClearAlpha:function(e){c(a,s=e)},render:function(t,r,d,h){var f=r.background,p=e.xr,m=p.getSession&&p.getSession();if(m&&"additive"===m.environmentBlendMode&&(f=null),null===f?(c(a,s),u=null,l=0):f&&f.isColor&&(c(f,1),h=!0,u=null,l=0),(e.autoClear||h)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),f&&(f.isCubeTexture||f.isWebGLRenderTargetCube||f.mapping===me)){void 0===o&&((o=new Ki(new no(1,1,1),new ao({type:"BackgroundCubeMaterial",uniforms:ro(yo.cube.uniforms),vertexShader:yo.cube.vertexShader,fragmentShader:yo.cube.fragmentShader,side:g,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),o.geometry.deleteAttribute("uv"),o.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(o.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(o));var y=f.isWebGLRenderTargetCube?f.texture:f;o.material.uniforms.envMap.value=y,o.material.uniforms.flipEnvMap.value=y.isCubeTexture?-1:1,u===f&&l===y.version||(o.material.needsUpdate=!0,u=f,l=y.version),t.unshift(o,o.geometry,o.material,0,0,null)}else f&&f.isTexture&&(void 0===i&&((i=new Ki(new wo(2,2),new ao({type:"BackgroundMaterial",uniforms:ro(yo.background.uniforms),vertexShader:yo.background.vertexShader,fragmentShader:yo.background.fragmentShader,side:v,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(i.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(i)),i.material.uniforms.t2D.value=f,!0===f.matrixAutoUpdate&&f.updateMatrix(),i.material.uniforms.uvTransform.value.copy(f.matrix),u===f&&l===f.version||(i.material.needsUpdate=!0,u=f,l=f.version),t.unshift(i,i.geometry,i.material,0,0,null))}}}function So(e,t,n,r){var i,o=r.isWebGL2;this.setMode=function(e){i=e},this.render=function(t,r){e.drawArrays(i,t,r),n.update(r,i)},this.renderInstances=function(r,a,s,u){if(0!==u){var l,c;if(o)l=e,c="drawArraysInstanced";else if(c="drawArraysInstancedANGLE",null===(l=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](i,a,s,u),n.update(s,i,u)}}}function xo(e,t,n){var r;function i(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var o="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext,a=void 0!==n.precision?n.precision:"highp",s=i(a);s!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",s,"instead."),a=s);var u=!0===n.logarithmicDepthBuffer,l=e.getParameter(34930),c=e.getParameter(35660),d=e.getParameter(3379),h=e.getParameter(34076),f=e.getParameter(34921),p=e.getParameter(36347),m=e.getParameter(36348),v=e.getParameter(36349),g=c>0,y=o||!!t.get("OES_texture_float");return{isWebGL2:o,getMaxAnisotropy:function(){if(void 0!==r)return r;var n=t.get("EXT_texture_filter_anisotropic");return r=null!==n?e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:i,precision:a,logarithmicDepthBuffer:u,maxTextures:l,maxVertexTextures:c,maxTextureSize:d,maxCubemapSize:h,maxAttributes:f,maxVertexUniforms:p,maxVaryings:m,maxFragmentUniforms:v,vertexTextures:g,floatFragmentTextures:y,floatVertexTextures:g&&y,maxSamples:o?e.getParameter(36183):0}}function Ao(){var e=this,t=null,n=0,r=!1,i=!1,o=new Fr,a=new kn,s={value:null,needsUpdate:!1};function u(){s.value!==t&&(s.value=t,s.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function l(t,n,r,i){var u=null!==t?t.length:0,l=null;if(0!==u){if(l=s.value,!0!==i||null===l){var c=r+4*u,d=n.matrixWorldInverse;a.getNormalMatrix(d),(null===l||l.length<c)&&(l=new Float32Array(c));for(var h=0,f=r;h!==u;++h,f+=4)o.copy(t[h]).applyMatrix4(d,a),o.normal.toArray(l,f),l[f+3]=o.constant}s.value=l,s.needsUpdate=!0}return e.numPlanes=u,l}this.uniform=s,this.numPlanes=0,this.numIntersection=0,this.init=function(e,i,o){var a=0!==e.length||i||0!==n||r;return r=i,t=l(e,o,0),n=e.length,a},this.beginShadows=function(){i=!0,l(null)},this.endShadows=function(){i=!1,u()},this.setState=function(e,o,a,c,d,h){if(!r||null===e||0===e.length||i&&!a)i?l(null):u();else{var f=i?0:n,p=4*f,m=d.clippingState||null;s.value=m,m=l(e,c,p,h);for(var v=0;v!==p;++v)m[v]=t[v];d.clippingState=m,this.numIntersection=o?this.numPlanes:0,this.numPlanes+=f}}}function Mo(e){var t={};return{get:function(n){if(void 0!==t[n])return t[n];var r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return null===r&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),t[n]=r,r}}}function jo(e,t,n){var r=new WeakMap,i=new WeakMap;function o(e){var a=e.target,s=r.get(a);for(var u in null!==s.index&&t.remove(s.index),s.attributes)t.remove(s.attributes[u]);a.removeEventListener("dispose",o),r.delete(a);var l=i.get(s);l&&(t.remove(l),i.delete(s)),n.memory.geometries--}function a(e){var n=[],r=e.index,o=e.attributes.position,a=0;if(null!==r){var s=r.array;a=r.version;for(var u=0,l=s.length;u<l;u+=3){var c=s[u+0],d=s[u+1],h=s[u+2];n.push(c,d,d,h,h,c)}}else{s=o.array;a=o.version;for(u=0,l=s.length/3-1;u<l;u+=3){c=u+0,d=u+1,h=u+2;n.push(c,d,d,h,h,c)}}var f=new(Ei(n)>65535?gi:mi)(n,1);f.version=a,t.update(f,34963);var p=i.get(e);p&&t.remove(p),i.set(e,f)}return{get:function(e,t){var i=r.get(t);return i||(t.addEventListener("dispose",o),t.isBufferGeometry?i=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new Ri).setFromObject(e)),i=t._bufferGeometry),r.set(t,i),n.memory.geometries++,i)},update:function(e){var n=e.index,r=e.attributes;for(var i in null!==n&&t.update(n,34963),r)t.update(r[i],34962);var o=e.morphAttributes;for(var i in o)for(var a=o[i],s=0,u=a.length;s<u;s++)t.update(a[s],34962)},getWireframeAttribute:function(e){var t=i.get(e);if(t){var n=e.index;null!==n&&t.version<n.version&&a(e)}else a(e);return i.get(e)}}}function Ro(e,t,n,r){var i,o,a,s=r.isWebGL2;this.setMode=function(e){i=e},this.setIndex=function(e){o=e.type,a=e.bytesPerElement},this.render=function(t,r){e.drawElements(i,r,o,t*a),n.update(r,i)},this.renderInstances=function(r,u,l,c){if(0!==c){var d,h;if(s)d=e,h="drawElementsInstanced";else if(h="drawElementsInstancedANGLE",null===(d=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");d[h](i,l,o,u*a,c),n.update(l,i,c)}}}function Lo(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,n,r){switch(r=r||1,t.calls++,n){case 4:t.triangles+=r*(e/3);break;case 1:t.lines+=r*(e/2);break;case 3:t.lines+=r*(e-1);break;case 2:t.lines+=r*e;break;case 0:t.points+=r*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function Co(e,t){return Math.abs(t[1])-Math.abs(e[1])}function ko(e){var t={},n=new Float32Array(8);return{update:function(r,i,o,a){var s=r.morphTargetInfluences,u=void 0===s?0:s.length,l=t[i.id];if(void 0===l){l=[];for(var c=0;c<u;c++)l[c]=[c,0];t[i.id]=l}var d=o.morphTargets&&i.morphAttributes.position,h=o.morphNormals&&i.morphAttributes.normal;for(c=0;c<u;c++){0!==(p=l[c])[1]&&(d&&i.deleteAttribute("morphTarget"+c),h&&i.deleteAttribute("morphNormal"+c))}for(c=0;c<u;c++){(p=l[c])[0]=c,p[1]=s[c]}l.sort(Co);var f=0;for(c=0;c<8;c++){var p;if(p=l[c]){var m=p[0],v=p[1];if(v){d&&i.setAttribute("morphTarget"+c,d[m]),h&&i.setAttribute("morphNormal"+c,h[m]),n[c]=v,f+=v;continue}}n[c]=0}var g=i.morphTargetsRelative?1:1-f;a.getUniforms().setValue(e,"morphTargetBaseInfluence",g),a.getUniforms().setValue(e,"morphTargetInfluences",n)}}}function Oo(e,t,n,r){var i={};return{update:function(e){var o=r.render.frame,a=e.geometry,s=t.get(e,a);return i[s.id]!==o&&(a.isGeometry&&s.updateFromObject(e),t.update(s),i[s.id]=o),e.isInstancedMesh&&n.update(e.instanceMatrix,34962),s},dispose:function(){i={}}}}function Po(e,t,n,r,i,o,a,s,u,l){e=void 0!==e?e:[],t=void 0!==t?t:ce,a=void 0!==a?a:He,In.call(this,e,t,n,r,i,o,a,s,u,l),this.flipY=!1}function Io(e,t,n,r){In.call(this,null),this.image={data:e||null,width:t||1,height:n||1,depth:r||1},this.magFilter=be,this.minFilter=be,this.wrapR=ye,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function Do(e,t,n,r){In.call(this,null),this.image={data:e||null,width:t||1,height:n||1,depth:r||1},this.magFilter=be,this.minFilter=be,this.wrapR=ye,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}yo.physical={uniforms:io([yo.standard.uniforms,{transparency:{value:0},clearcoat:{value:0},clearcoatRoughness:{value:0},sheen:{value:new ti(0)},clearcoatNormalScale:{value:new xn(1,1)},clearcoatNormalMap:{value:null}}]),vertexShader:vo.meshphysical_vert,fragmentShader:vo.meshphysical_frag},Eo.prototype=Object.create(eo.prototype),Eo.prototype.constructor=Eo,wo.prototype=Object.create(Ri.prototype),wo.prototype.constructor=wo,Po.prototype=Object.create(In.prototype),Po.prototype.constructor=Po,Po.prototype.isCubeTexture=!0,Object.defineProperty(Po.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),Io.prototype=Object.create(In.prototype),Io.prototype.constructor=Io,Io.prototype.isDataTexture2DArray=!0,Do.prototype=Object.create(In.prototype),Do.prototype.constructor=Do,Do.prototype.isDataTexture3D=!0;var No=new In,Bo=new Io,Uo=new Do,Fo=new Po,Vo=[],Go=[],Ho=new Float32Array(16),zo=new Float32Array(9),Wo=new Float32Array(4);function qo(e,t,n){var r=e[0];if(r<=0||r>0)return e;var i=t*n,o=Vo[i];if(void 0===o&&(o=new Float32Array(i),Vo[i]=o),0!==t){r.toArray(o,0);for(var a=1,s=0;a!==t;++a)s+=n,e[a].toArray(o,s)}return o}function Ko(e,t){if(e.length!==t.length)return!1;for(var n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function Yo(e,t){for(var n=0,r=t.length;n<r;n++)e[n]=t[n]}function Xo(e,t){var n=Go[t];void 0===n&&(n=new Int32Array(t),Go[t]=n);for(var r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function Jo(e,t){var n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function Zo(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Ko(n,t))return;e.uniform2fv(this.addr,t),Yo(n,t)}}function $o(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(Ko(n,t))return;e.uniform3fv(this.addr,t),Yo(n,t)}}function Qo(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Ko(n,t))return;e.uniform4fv(this.addr,t),Yo(n,t)}}function ea(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(Ko(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),Yo(n,t)}else{if(Ko(n,r))return;Wo.set(r),e.uniformMatrix2fv(this.addr,!1,Wo),Yo(n,r)}}function ta(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(Ko(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),Yo(n,t)}else{if(Ko(n,r))return;zo.set(r),e.uniformMatrix3fv(this.addr,!1,zo),Yo(n,r)}}function na(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(Ko(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),Yo(n,t)}else{if(Ko(n,r))return;Ho.set(r),e.uniformMatrix4fv(this.addr,!1,Ho),Yo(n,r)}}function ra(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.safeSetTexture2D(t||No,i)}function ia(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(t||Bo,i)}function oa(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(t||Uo,i)}function aa(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.safeSetTextureCube(t||Fo,i)}function sa(e,t){var n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function ua(e,t){var n=this.cache;Ko(n,t)||(e.uniform2iv(this.addr,t),Yo(n,t))}function la(e,t){var n=this.cache;Ko(n,t)||(e.uniform3iv(this.addr,t),Yo(n,t))}function ca(e,t){var n=this.cache;Ko(n,t)||(e.uniform4iv(this.addr,t),Yo(n,t))}function da(e,t){e.uniform1fv(this.addr,t)}function ha(e,t){e.uniform1iv(this.addr,t)}function fa(e,t){e.uniform2iv(this.addr,t)}function pa(e,t){e.uniform3iv(this.addr,t)}function ma(e,t){e.uniform4iv(this.addr,t)}function va(e,t){var n=qo(t,this.size,2);e.uniform2fv(this.addr,n)}function ga(e,t){var n=qo(t,this.size,3);e.uniform3fv(this.addr,n)}function ya(e,t){var n=qo(t,this.size,4);e.uniform4fv(this.addr,n)}function _a(e,t){var n=qo(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function ba(e,t){var n=qo(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function Ea(e,t){var n=qo(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function wa(e,t,n){var r=t.length,i=Xo(n,r);e.uniform1iv(this.addr,i);for(var o=0;o!==r;++o)n.safeSetTexture2D(t[o]||No,i[o])}function Ta(e,t,n){var r=t.length,i=Xo(n,r);e.uniform1iv(this.addr,i);for(var o=0;o!==r;++o)n.safeSetTextureCube(t[o]||Fo,i[o])}function Sa(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return Jo;case 35664:return Zo;case 35665:return $o;case 35666:return Qo;case 35674:return ea;case 35675:return ta;case 35676:return na;case 35678:case 36198:return ra;case 35679:return oa;case 35680:return aa;case 36289:return ia;case 5124:case 35670:return sa;case 35667:case 35671:return ua;case 35668:case 35672:return la;case 35669:case 35673:return ca}}(t.type)}function xa(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return da;case 35664:return va;case 35665:return ga;case 35666:return ya;case 35674:return _a;case 35675:return ba;case 35676:return Ea;case 35678:case 36198:case 36298:case 36306:return wa;case 35680:case 36300:case 36308:return Ta;case 5124:case 35670:return ha;case 35667:case 35671:return fa;case 35668:case 35672:return pa;case 35669:case 35673:return ma}}(t.type)}function Aa(e){this.id=e,this.seq=[],this.map={}}xa.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),Yo(t,e)},Aa.prototype.setValue=function(e,t,n){for(var r=this.seq,i=0,o=r.length;i!==o;++i){var a=r[i];a.setValue(e,t[a.id],n)}};var Ma=/([\w\d_]+)(\])?(\[|\.)?/g;function ja(e,t){e.seq.push(t),e.map[t.id]=t}function Ra(e,t,n){var r=e.name,i=r.length;for(Ma.lastIndex=0;;){var o=Ma.exec(r),a=Ma.lastIndex,s=o[1],u="]"===o[2],l=o[3];if(u&&(s|=0),void 0===l||"["===l&&a+2===i){ja(n,void 0===l?new Sa(s,e,t):new xa(s,e,t));break}var c=n.map[s];void 0===c&&ja(n,c=new Aa(s)),n=c}}function La(e,t){this.seq=[],this.map={};for(var n=e.getProgramParameter(t,35718),r=0;r<n;++r){var i=e.getActiveUniform(t,r);Ra(i,e.getUniformLocation(t,i.name),this)}}function Ca(e,t,n){var r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}La.prototype.setValue=function(e,t,n,r){var i=this.map[t];void 0!==i&&i.setValue(e,n,r)},La.prototype.setOptional=function(e,t,n){var r=t[n];void 0!==r&&this.setValue(e,n,r)},La.upload=function(e,t,n,r){for(var i=0,o=t.length;i!==o;++i){var a=t[i],s=n[a.id];!1!==s.needsUpdate&&a.setValue(e,s.value,r)}},La.seqWithValue=function(e,t){for(var n=[],r=0,i=e.length;r!==i;++r){var o=e[r];o.id in t&&n.push(o)}return n};var ka=0;function Oa(e){switch(e){case Nt:return["Linear","( value )"];case Bt:return["sRGB","( value )"];case Ft:return["RGBE","( value )"];case Gt:return["RGBM","( value, 7.0 )"];case Ht:return["RGBM","( value, 16.0 )"];case zt:return["RGBD","( value, 256.0 )"];case Ut:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case Vt:return["LogLuv","( value )"];default:throw new Error("unsupported encoding: "+e)}}function Pa(e,t,n){var r=e.getShaderParameter(t,35713),i=e.getShaderInfoLog(t).trim();return r&&""===i?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+i+function(e){for(var t=e.split("\n"),n=0;n<t.length;n++)t[n]=n+1+": "+t[n];return t.join("\n")}(e.getShaderSource(t))}function Ia(e,t){var n=Oa(t);return"vec4 "+e+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function Da(e,t){var n;switch(t){case ie:n="Linear";break;case oe:n="Reinhard";break;case ae:n="Uncharted2";break;case se:n="OptimizedCineon";break;case ue:n="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function Na(e){return""!==e}function Ba(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Ua(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var Fa=/^[ \t]*#include +<([\w\d./]+)>/gm;function Va(e){return e.replace(Fa,Ga)}function Ga(e,t){var n=vo[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return Va(n)}var Ha=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;function za(e){return e.replace(Ha,Wa)}function Wa(e,t,n,r){for(var i="",o=parseInt(t);o<parseInt(n);o++)i+=r.replace(/\[ i \]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return i}function qa(e){var t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function Ka(e,t,n,r,i,o){var a,s,u,l,c,d=e.getContext(),h=r.defines,v=i.vertexShader,g=i.fragmentShader,y=function(e){var t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===f?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===p?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===m&&(t="SHADOWMAP_TYPE_VSM"),t}(o),_=function(e){var t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case ce:case de:t="ENVMAP_TYPE_CUBE";break;case me:case ve:t="ENVMAP_TYPE_CUBE_UV";break;case he:case fe:t="ENVMAP_TYPE_EQUIREC";break;case pe:t="ENVMAP_TYPE_SPHERE"}return t}(o),b=function(e){var t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case de:case fe:t="ENVMAP_MODE_REFRACTION"}return t}(o),E=function(e){var t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case ee:t="ENVMAP_BLENDING_MULTIPLY";break;case te:t="ENVMAP_BLENDING_MIX";break;case ne:t="ENVMAP_BLENDING_ADD"}return t}(o),w=e.gammaFactor>0?e.gammaFactor:1,T=o.isWebGL2?"":function(e,t,n){return[(e=e||{}).derivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.fragDepth||t.logarithmicDepthBuffer)&&n.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",e.drawBuffers&&n.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(e.shaderTextureLOD||t.envMap)&&n.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Na).join("\n")}(r.extensions,o,t),S=function(e){var t=[];for(var n in e){var r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}(h),x=d.createProgram(),A=o.numMultiviewViews;if(r.isRawShaderMaterial?((a=[S].filter(Na).join("\n")).length>0&&(a+="\n"),(s=[T,S].filter(Na).join("\n")).length>0&&(s+="\n")):(a=[qa(o),"#define SHADER_NAME "+i.name,S,o.instancing?"#define USE_INSTANCING":"",o.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+w,"#define MAX_BONES "+o.maxBones,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp2?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+b:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.normalMap&&o.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",o.normalMap&&o.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",o.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",o.displacementMap&&o.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.vertexTangents?"#define USE_TANGENT":"",o.vertexColors?"#define USE_COLOR":"",o.vertexUvs?"#define USE_UV":"",o.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",o.flatShading?"#define FLAT_SHADED":"",o.skinning?"#define USE_SKINNING":"",o.useVertexTexture?"#define BONE_TEXTURE":"",o.morphTargets?"#define USE_MORPHTARGETS":"",o.morphNormals&&!1===o.flatShading?"#define USE_MORPHNORMALS":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+y:"",o.sizeAttenuation?"#define USE_SIZEATTENUATION":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&(o.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Na).join("\n"),s=[T,qa(o),"#define SHADER_NAME "+i.name,S,o.alphaTest?"#define ALPHATEST "+o.alphaTest+(o.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+w,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp2?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.matcap?"#define USE_MATCAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+_:"",o.envMap?"#define "+b:"",o.envMap?"#define "+E:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.normalMap&&o.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",o.normalMap&&o.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",o.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.sheen?"#define USE_SHEEN":"",o.vertexTangents?"#define USE_TANGENT":"",o.vertexColors?"#define USE_COLOR":"",o.vertexUvs?"#define USE_UV":"",o.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",o.gradientMap?"#define USE_GRADIENTMAP":"",o.flatShading?"#define FLAT_SHADED":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+y:"",o.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",o.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&(o.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"",(r.extensions&&r.extensions.shaderTextureLOD||o.envMap)&&(o.isWebGL2||t.get("EXT_shader_texture_lod"))?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",o.toneMapping!==re?"#define TONE_MAPPING":"",o.toneMapping!==re?vo.tonemapping_pars_fragment:"",o.toneMapping!==re?Da("toneMapping",o.toneMapping):"",o.dithering?"#define DITHERING":"",o.outputEncoding||o.mapEncoding||o.matcapEncoding||o.envMapEncoding||o.emissiveMapEncoding||o.lightMapEncoding?vo.encodings_pars_fragment:"",o.mapEncoding?Ia("mapTexelToLinear",o.mapEncoding):"",o.matcapEncoding?Ia("matcapTexelToLinear",o.matcapEncoding):"",o.envMapEncoding?Ia("envMapTexelToLinear",o.envMapEncoding):"",o.emissiveMapEncoding?Ia("emissiveMapTexelToLinear",o.emissiveMapEncoding):"",o.lightMapEncoding?Ia("lightMapTexelToLinear",o.lightMapEncoding):"",o.outputEncoding?(u="linearToOutputTexel",l=o.outputEncoding,c=Oa(l),"vec4 "+u+"( vec4 value ) { return LinearTo"+c[0]+c[1]+"; }"):"",o.depthPacking?"#define DEPTH_PACKING "+r.depthPacking:"","\n"].filter(Na).join("\n")),v=Ua(v=Ba(v=Va(v),o),o),g=Ua(g=Ba(g=Va(g),o),o),v=za(v),g=za(g),o.isWebGL2&&!r.isRawShaderMaterial){var M=!1,j=/^\s*#version\s+300\s+es\s*\n/;r.isShaderMaterial&&null!==v.match(j)&&null!==g.match(j)&&(M=!0,v=v.replace(j,""),g=g.replace(j,"")),a=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+a,s=["#version 300 es\n","#define varying in",M?"":"out highp vec4 pc_fragColor;",M?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+s,A>0&&(a=(a=a.replace("#version 300 es\n",["#version 300 es\n","#extension GL_OVR_multiview2 : require","layout(num_views = "+A+") in;","#define VIEW_ID gl_ViewID_OVR"].join("\n"))).replace(["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;"].join("\n"),["uniform mat4 modelViewMatrices["+A+"];","uniform mat4 projectionMatrices["+A+"];","uniform mat4 viewMatrices["+A+"];","uniform mat3 normalMatrices["+A+"];","#define modelViewMatrix modelViewMatrices[VIEW_ID]","#define projectionMatrix projectionMatrices[VIEW_ID]","#define viewMatrix viewMatrices[VIEW_ID]","#define normalMatrix normalMatrices[VIEW_ID]"].join("\n")),s=(s=s.replace("#version 300 es\n",["#version 300 es\n","#extension GL_OVR_multiview2 : require","#define VIEW_ID gl_ViewID_OVR"].join("\n"))).replace("uniform mat4 viewMatrix;",["uniform mat4 viewMatrices["+A+"];","#define viewMatrix viewMatrices[VIEW_ID]"].join("\n")))}var R,L,C=s+g,k=Ca(d,35633,a+v),O=Ca(d,35632,C);if(d.attachShader(x,k),d.attachShader(x,O),void 0!==r.index0AttributeName?d.bindAttribLocation(x,0,r.index0AttributeName):!0===o.morphTargets&&d.bindAttribLocation(x,0,"position"),d.linkProgram(x),e.debug.checkShaderErrors){var P=d.getProgramInfoLog(x).trim(),I=d.getShaderInfoLog(k).trim(),D=d.getShaderInfoLog(O).trim(),N=!0,B=!0;if(!1===d.getProgramParameter(x,35714)){N=!1;var U=Pa(d,k,"vertex"),F=Pa(d,O,"fragment");console.error("THREE.WebGLProgram: shader error: ",d.getError(),"35715",d.getProgramParameter(x,35715),"gl.getProgramInfoLog",P,U,F)}else""!==P?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",P):""!==I&&""!==D||(B=!1);B&&(this.diagnostics={runnable:N,material:r,programLog:P,vertexShader:{log:I,prefix:a},fragmentShader:{log:D,prefix:s}})}return d.deleteShader(k),d.deleteShader(O),this.getUniforms=function(){return void 0===R&&(R=new La(d,x)),R},this.getAttributes=function(){return void 0===L&&(L=function(e,t){for(var n={},r=e.getProgramParameter(t,35721),i=0;i<r;i++){var o=e.getActiveAttrib(t,i).name;n[o]=e.getAttribLocation(t,o)}return n}(d,x)),L},this.destroy=function(){d.deleteProgram(x),this.program=void 0},this.name=i.name,this.id=ka++,this.cacheKey=n,this.usedTimes=1,this.program=x,this.vertexShader=k,this.fragmentShader=O,this.numMultiviewViews=A,this}function Ya(e,t,n){var r=[],i=n.isWebGL2,o=n.logarithmicDepthBuffer,a=n.floatVertexTextures,s=n.precision,u=n.maxVertexUniforms,l=n.vertexTextures,c={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},d=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","numMultiviewViews","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen"];function h(e){var t;return e?e.isTexture?t=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=e.texture.encoding):t=Nt,t}this.getParameters=function(t,r,d,f,p,m,v){var _=f.fog,b=t.isMeshStandardMaterial?f.environment:null,E=t.envMap||b,w=c[t.type],T=v.isSkinnedMesh?function(e){var t=e.skeleton.bones;if(a)return 1024;var n=u,r=Math.floor((n-20)/4),i=Math.min(r,t.length);return i<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+i+"."),0):i}(v):0;null!==t.precision&&(s=n.getMaxPrecision(t.precision))!==t.precision&&console.warn("THREE.WebGLProgram.getParameters:",t.precision,"not supported, using",s,"instead.");var S=e.getRenderTarget(),x=S&&S.isWebGLMultiviewRenderTarget?S.numViews:0;return{isWebGL2:i,shaderID:w,precision:s,instancing:!0===v.isInstancedMesh,supportsVertexTextures:l,numMultiviewViews:x,outputEncoding:null!==S?h(S.texture):e.outputEncoding,map:!!t.map,mapEncoding:h(t.map),matcap:!!t.matcap,matcapEncoding:h(t.matcap),envMap:!!E,envMapMode:E&&E.mapping,envMapEncoding:h(E),envMapCubeUV:!!E&&(E.mapping===me||E.mapping===ve),lightMap:!!t.lightMap,lightMapEncoding:h(t.lightMap),aoMap:!!t.aoMap,emissiveMap:!!t.emissiveMap,emissiveMapEncoding:h(t.emissiveMap),bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,objectSpaceNormalMap:t.normalMapType===Yt,tangentSpaceNormalMap:t.normalMapType===Kt,clearcoatNormalMap:!!t.clearcoatNormalMap,displacementMap:!!t.displacementMap,roughnessMap:!!t.roughnessMap,metalnessMap:!!t.metalnessMap,specularMap:!!t.specularMap,alphaMap:!!t.alphaMap,gradientMap:!!t.gradientMap,sheen:!!t.sheen,combine:t.combine,vertexTangents:t.normalMap&&t.vertexTangents,vertexColors:t.vertexColors,vertexUvs:!!(t.map||t.bumpMap||t.normalMap||t.specularMap||t.alphaMap||t.emissiveMap||t.roughnessMap||t.metalnessMap||t.clearcoatNormalMap||t.displacementMap),uvsVertexOnly:!(t.map||t.bumpMap||t.normalMap||t.specularMap||t.alphaMap||t.emissiveMap||t.roughnessMap||t.metalnessMap||t.clearcoatNormalMap||!t.displacementMap),fog:!!_,useFog:t.fog,fogExp2:_&&_.isFogExp2,flatShading:t.flatShading,sizeAttenuation:t.sizeAttenuation,logarithmicDepthBuffer:o,skinning:t.skinning&&T>0,maxBones:T,useVertexTexture:a,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:r.directional.length,numPointLights:r.point.length,numSpotLights:r.spot.length,numRectAreaLights:r.rectArea.length,numHemiLights:r.hemi.length,numDirLightShadows:r.directionalShadowMap.length,numPointLightShadows:r.pointShadowMap.length,numSpotLightShadows:r.spotShadowMap.length,numClippingPlanes:p,numClipIntersection:m,dithering:t.dithering,shadowMapEnabled:e.shadowMap.enabled&&d.length>0,shadowMapType:e.shadowMap.type,toneMapping:t.toneMapped?e.toneMapping:re,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:t.premultipliedAlpha,alphaTest:t.alphaTest,doubleSided:t.side===y,flipSided:t.side===g,depthPacking:void 0!==t.depthPacking&&t.depthPacking}},this.getProgramCacheKey=function(t,n){var r=[];if(n.shaderID?r.push(n.shaderID):(r.push(t.fragmentShader),r.push(t.vertexShader)),void 0!==t.defines)for(var i in t.defines)r.push(i),r.push(t.defines[i]);if(void 0===t.isRawShaderMaterial){for(var o=0;o<d.length;o++)r.push(n[d[o]]);r.push(e.outputEncoding),r.push(e.gammaFactor)}return r.push(t.onBeforeCompile.toString()),r.join()},this.acquireProgram=function(n,i,o,a){for(var s,u=0,l=r.length;u<l;u++){var c=r[u];if(c.cacheKey===a){++(s=c).usedTimes;break}}return void 0===s&&(s=new Ka(e,t,a,n,i,o),r.push(s)),s},this.releaseProgram=function(e){if(0==--e.usedTimes){var t=r.indexOf(e);r[t]=r[r.length-1],r.pop(),e.destroy()}},this.programs=r}function Xa(){var e=new WeakMap;return{get:function(t){var n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,r){e.get(t)[n]=r},dispose:function(){e=new WeakMap}}}function Ja(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Za(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function $a(){var e=[],t=0,n=[],r=[],i={id:-1};function o(n,r,o,a,s,u){var l=e[t];return void 0===l?(l={id:n.id,object:n,geometry:r,material:o,program:o.program||i,groupOrder:a,renderOrder:n.renderOrder,z:s,group:u},e[t]=l):(l.id=n.id,l.object=n,l.geometry=r,l.material=o,l.program=o.program||i,l.groupOrder=a,l.renderOrder=n.renderOrder,l.z=s,l.group=u),t++,l}return{opaque:n,transparent:r,init:function(){t=0,n.length=0,r.length=0},push:function(e,t,i,a,s,u){var l=o(e,t,i,a,s,u);(!0===i.transparent?r:n).push(l)},unshift:function(e,t,i,a,s,u){var l=o(e,t,i,a,s,u);(!0===i.transparent?r:n).unshift(l)},sort:function(e,t){n.length>1&&n.sort(e||Ja),r.length>1&&r.sort(t||Za)}}}function Qa(){var e=new WeakMap;function t(n){var r=n.target;r.removeEventListener("dispose",t),e.delete(r)}return{get:function(n,r){var i,o=e.get(n);return void 0===o?(i=new $a,e.set(n,new WeakMap),e.get(n).set(r,i),n.addEventListener("dispose",t)):void 0===(i=o.get(r))&&(i=new $a,o.set(r,i)),i},dispose:function(){e=new WeakMap}}}function es(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":n={direction:new Rn,color:new ti,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new xn};break;case"SpotLight":n={position:new Rn,direction:new Rn,color:new ti,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new xn};break;case"PointLight":n={position:new Rn,color:new ti,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new xn,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":n={direction:new Rn,skyColor:new ti,groundColor:new ti};break;case"RectAreaLight":n={color:new ti,position:new Rn,halfWidth:new Rn,halfHeight:new Rn}}return e[t.id]=n,n}}}var ts=0;function ns(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function rs(){for(var e=new es,t={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},n=0;n<9;n++)t.probe.push(new Rn);var r=new Rn,i=new qn,o=new qn;return{setup:function(n,a,s){for(var u=0,l=0,c=0,d=0;d<9;d++)t.probe[d].set(0,0,0);var h=0,f=0,p=0,m=0,v=0,g=0,y=0,_=0,b=s.matrixWorldInverse;n.sort(ns),d=0;for(var E=n.length;d<E;d++){var w=n[d],T=w.color,S=w.intensity,x=w.distance,A=w.shadow&&w.shadow.map?w.shadow.map.texture:null;if(w.isAmbientLight)u+=T.r*S,l+=T.g*S,c+=T.b*S;else if(w.isLightProbe)for(var M=0;M<9;M++)t.probe[M].addScaledVector(w.sh.coefficients[M],S);else if(w.isDirectionalLight){if((R=e.get(w)).color.copy(w.color).multiplyScalar(w.intensity),R.direction.setFromMatrixPosition(w.matrixWorld),r.setFromMatrixPosition(w.target.matrixWorld),R.direction.sub(r),R.direction.transformDirection(b),R.shadow=w.castShadow,w.castShadow){var j=w.shadow;R.shadowBias=j.bias,R.shadowRadius=j.radius,R.shadowMapSize=j.mapSize,t.directionalShadowMap[h]=A,t.directionalShadowMatrix[h]=w.shadow.matrix,g++}t.directional[h]=R,h++}else if(w.isSpotLight){if((R=e.get(w)).position.setFromMatrixPosition(w.matrixWorld),R.position.applyMatrix4(b),R.color.copy(T).multiplyScalar(S),R.distance=x,R.direction.setFromMatrixPosition(w.matrixWorld),r.setFromMatrixPosition(w.target.matrixWorld),R.direction.sub(r),R.direction.transformDirection(b),R.coneCos=Math.cos(w.angle),R.penumbraCos=Math.cos(w.angle*(1-w.penumbra)),R.decay=w.decay,R.shadow=w.castShadow,w.castShadow){j=w.shadow;R.shadowBias=j.bias,R.shadowRadius=j.radius,R.shadowMapSize=j.mapSize,t.spotShadowMap[p]=A,t.spotShadowMatrix[p]=w.shadow.matrix,_++}t.spot[p]=R,p++}else if(w.isRectAreaLight){(R=e.get(w)).color.copy(T).multiplyScalar(S),R.position.setFromMatrixPosition(w.matrixWorld),R.position.applyMatrix4(b),o.identity(),i.copy(w.matrixWorld),i.premultiply(b),o.extractRotation(i),R.halfWidth.set(.5*w.width,0,0),R.halfHeight.set(0,.5*w.height,0),R.halfWidth.applyMatrix4(o),R.halfHeight.applyMatrix4(o),t.rectArea[m]=R,m++}else if(w.isPointLight){if((R=e.get(w)).position.setFromMatrixPosition(w.matrixWorld),R.position.applyMatrix4(b),R.color.copy(w.color).multiplyScalar(w.intensity),R.distance=w.distance,R.decay=w.decay,R.shadow=w.castShadow,w.castShadow){j=w.shadow;R.shadowBias=j.bias,R.shadowRadius=j.radius,R.shadowMapSize=j.mapSize,R.shadowCameraNear=j.camera.near,R.shadowCameraFar=j.camera.far,t.pointShadowMap[f]=A,t.pointShadowMatrix[f]=w.shadow.matrix,y++}t.point[f]=R,f++}else if(w.isHemisphereLight){var R;(R=e.get(w)).direction.setFromMatrixPosition(w.matrixWorld),R.direction.transformDirection(b),R.direction.normalize(),R.skyColor.copy(w.color).multiplyScalar(S),R.groundColor.copy(w.groundColor).multiplyScalar(S),t.hemi[v]=R,v++}}t.ambient[0]=u,t.ambient[1]=l,t.ambient[2]=c;var L=t.hash;L.directionalLength===h&&L.pointLength===f&&L.spotLength===p&&L.rectAreaLength===m&&L.hemiLength===v&&L.numDirectionalShadows===g&&L.numPointShadows===y&&L.numSpotShadows===_||(t.directional.length=h,t.spot.length=p,t.rectArea.length=m,t.point.length=f,t.hemi.length=v,t.directionalShadowMap.length=g,t.pointShadowMap.length=y,t.spotShadowMap.length=_,t.directionalShadowMatrix.length=g,t.pointShadowMatrix.length=y,t.spotShadowMatrix.length=_,L.directionalLength=h,L.pointLength=f,L.spotLength=p,L.rectAreaLength=m,L.hemiLength=v,L.numDirectionalShadows=g,L.numPointShadows=y,L.numSpotShadows=_,t.version=ts++)},state:t}}function is(){var e=new rs,t=[],n=[];return{init:function(){t.length=0,n.length=0},state:{lightsArray:t,shadowsArray:n,lights:e},setupLights:function(r){e.setup(t,n,r)},pushLight:function(e){t.push(e)},pushShadow:function(e){n.push(e)}}}function os(){var e=new WeakMap;function t(n){var r=n.target;r.removeEventListener("dispose",t),e.delete(r)}return{get:function(n,r){var i;return!1===e.has(n)?(i=new is,e.set(n,new WeakMap),e.get(n).set(r,i),n.addEventListener("dispose",t)):!1===e.get(n).has(r)?(i=new is,e.get(n).set(r,i)):i=e.get(n).get(r),i},dispose:function(){e=new WeakMap}}}function as(e){si.call(this),this.type="MeshDepthMaterial",this.depthPacking=Wt,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}function ss(e){si.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Rn,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}as.prototype=Object.create(si.prototype),as.prototype.constructor=as,as.prototype.isMeshDepthMaterial=!0,as.prototype.copy=function(e){return si.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},ss.prototype=Object.create(si.prototype),ss.prototype.constructor=ss,ss.prototype.isMeshDistanceMaterial=!0,ss.prototype.copy=function(e){return si.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this};function us(e,t,n){var r=new mo,i=new xn,o=new xn,a=new Dn,s=[],u=[],l={},c={0:g,1:v,2:y},d=new ao({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new xn},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n  float mean = 0.0;\n  float squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );\n  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n    #ifdef HORIZONAL_PASS\n      vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n      mean += distribution.x;\n      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n    #else\n      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );\n      mean += depth;\n      squared_mean += depth * depth;\n    #endif\n  }\n  mean = mean * HALF_SAMPLE_RATE;\n  squared_mean = squared_mean * HALF_SAMPLE_RATE;\n  float std_dev = sqrt( squared_mean - mean * mean );\n  gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),h=d.clone();h.defines.HORIZONAL_PASS=1;var p=new Ri;p.setAttribute("position",new ci(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var _=new Ki(p,d),b=this;function E(n,r){var i=t.update(_);d.uniforms.shadow_pass.value=n.map.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,i,d,_,null),h.uniforms.shadow_pass.value=n.mapPass.texture,h.uniforms.resolution.value=n.mapSize,h.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,i,h,_,null)}function w(e,t,n){var r=e<<0|t<<1|n<<2,i=s[r];return void 0===i&&(i=new as({depthPacking:qt,morphTargets:e,skinning:t}),s[r]=i),i}function T(e,t,n){var r=e<<0|t<<1|n<<2,i=u[r];return void 0===i&&(i=new ss({morphTargets:e,skinning:t}),u[r]=i),i}function x(t,n,r,i,o,a){var s=t.geometry,u=null,d=w,h=t.customDepthMaterial;if(!0===r.isPointLight&&(d=T,h=t.customDistanceMaterial),void 0===h){var f=!1;!0===n.morphTargets&&(!0===s.isBufferGeometry?f=s.morphAttributes&&s.morphAttributes.position&&s.morphAttributes.position.length>0:!0===s.isGeometry&&(f=s.morphTargets&&s.morphTargets.length>0));var p=!1;!0===t.isSkinnedMesh&&(!0===n.skinning?p=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t)),u=d(f,p,!0===t.isInstancedMesh)}else u=h;if(e.localClippingEnabled&&!0===n.clipShadows&&0!==n.clippingPlanes.length){var v=u.uuid,g=n.uuid,y=l[v];void 0===y&&(y={},l[v]=y);var _=y[g];void 0===_&&(_=u.clone(),y[g]=_),u=_}return u.visible=n.visible,u.wireframe=n.wireframe,u.side=a===m?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:c[n.side],u.clipShadows=n.clipShadows,u.clippingPlanes=n.clippingPlanes,u.clipIntersection=n.clipIntersection,u.wireframeLinewidth=n.wireframeLinewidth,u.linewidth=n.linewidth,!0===r.isPointLight&&!0===u.isMeshDistanceMaterial&&(u.referencePosition.setFromMatrixPosition(r.matrixWorld),u.nearDistance=i,u.farDistance=o),u}function A(n,i,o,a,s){if(!1!==n.visible){if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&s===m)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,n.matrixWorld);var u=t.update(n),l=n.material;if(Array.isArray(l))for(var c=u.groups,d=0,h=c.length;d<h;d++){var f=c[d],p=l[f.materialIndex];if(p&&p.visible){var v=x(n,p,a,o.near,o.far,s);e.renderBufferDirect(o,null,u,v,n,f)}}else if(l.visible){v=x(n,l,a,o.near,o.far,s);e.renderBufferDirect(o,null,u,v,n,null)}}for(var g=n.children,y=0,_=g.length;y<_;y++)A(g[y],i,o,a,s)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=f,this.render=function(t,s,u){if(!1!==b.enabled&&(!1!==b.autoUpdate||!1!==b.needsUpdate)&&0!==t.length){var l=e.getRenderTarget(),c=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),h=e.state;h.setBlending(S),h.buffers.color.setClear(1,1,1,1),h.buffers.depth.setTest(!0),h.setScissorTest(!1);for(var f=0,p=t.length;f<p;f++){var v=t[f],g=v.shadow;if(void 0!==g){i.copy(g.mapSize);var y=g.getFrameExtents();if(i.multiply(y),o.copy(g.mapSize),(i.x>n||i.y>n)&&(console.warn("THREE.WebGLShadowMap:",v,"has shadow exceeding max texture size, reducing"),i.x>n&&(o.x=Math.floor(n/y.x),i.x=o.x*y.x,g.mapSize.x=o.x),i.y>n&&(o.y=Math.floor(n/y.y),i.y=o.y*y.y,g.mapSize.y=o.y)),null===g.map&&!g.isPointLightShadow&&this.type===m){var _={minFilter:xe,magFilter:xe,format:ze};g.map=new Nn(i.x,i.y,_),g.map.texture.name=v.name+".shadowMap",g.mapPass=new Nn(i.x,i.y,_),g.camera.updateProjectionMatrix()}if(null===g.map){_={minFilter:be,magFilter:be,format:ze};g.map=new Nn(i.x,i.y,_),g.map.texture.name=v.name+".shadowMap",g.camera.updateProjectionMatrix()}e.setRenderTarget(g.map),e.clear();for(var w=g.getViewportCount(),T=0;T<w;T++){var x=g.getViewport(T);a.set(o.x*x.x,o.y*x.y,o.x*x.z,o.y*x.w),h.viewport(a),g.updateMatrices(v,T),r=g.getFrustum(),A(s,u,g.camera,v,this.type)}g.isPointLightShadow||this.type!==m||E(g,u)}else console.warn("THREE.WebGLShadowMap:",v,"has no shadow.")}b.needsUpdate=!1,e.setRenderTarget(l,c,d)}}}function ls(e,t,n){var r=n.isWebGL2;var i=new function(){var t=!1,n=new Dn,r=null,i=new Dn(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,o,a,s){!0===s&&(t*=a,r*=a,o*=a),n.set(t,r,o,a),!1===i.equals(n)&&(e.clearColor(t,r,o,a),i.copy(n))},reset:function(){t=!1,r=null,i.set(-1,0,0,0)}}},o=new function(){var t=!1,n=null,r=null,i=null;return{setTest:function(e){e?_e(2929):be(2929)},setMask:function(r){n===r||t||(e.depthMask(r),n=r)},setFunc:function(t){if(r!==t){if(t)switch(t){case q:e.depthFunc(512);break;case K:e.depthFunc(519);break;case Y:e.depthFunc(513);break;case X:e.depthFunc(515);break;case J:e.depthFunc(514);break;case Z:e.depthFunc(518);break;case $:e.depthFunc(516);break;case Q:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);r=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,n=null,r=null,i=null}}},l=new function(){var t=!1,n=null,r=null,i=null,o=null,a=null,s=null,u=null,l=null;return{setTest:function(e){t||(e?_e(2960):be(2960))},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,a){r===t&&i===n&&o===a||(e.stencilFunc(t,n,a),r=t,i=n,o=a)},setOp:function(t,n,r){a===t&&s===n&&u===r||(e.stencilOp(t,n,r),a=t,s=n,u=r)},setLocked:function(e){t=e},setClear:function(t){l!==t&&(e.clearStencil(t),l=t)},reset:function(){t=!1,n=null,r=null,i=null,o=null,a=null,s=null,u=null,l=null}}},c=e.getParameter(34921),d=new Uint8Array(c),h=new Uint8Array(c),f=new Uint8Array(c),p={},m=null,v=null,_=null,b=null,E=null,w=null,T=null,ee=null,te=null,ne=!1,re=null,ie=null,oe=null,ae=null,se=null,ue=e.getParameter(35661),le=!1,ce=0,de=e.getParameter(7938);-1!==de.indexOf("WebGL")?(ce=parseFloat(/^WebGL\ ([0-9])/.exec(de)[1]),le=ce>=1):-1!==de.indexOf("OpenGL ES")&&(ce=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(de)[1]),le=ce>=2);var he=null,fe={},pe=new Dn,me=new Dn;function ve(t,n,r){var i=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(var a=0;a<r;a++)e.texImage2D(n+a,0,6408,1,1,0,6408,5121,i);return o}var ge={};function ye(n,i){(d[n]=1,0===h[n]&&(e.enableVertexAttribArray(n),h[n]=1),f[n]!==i)&&((r?e:t.get("ANGLE_instanced_arrays"))[r?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,i),f[n]=i)}function _e(t){!0!==p[t]&&(e.enable(t),p[t]=!0)}function be(t){!1!==p[t]&&(e.disable(t),p[t]=!1)}ge[3553]=ve(3553,3553,1),ge[34067]=ve(34067,34069,6),i.setClear(0,0,0,1),o.setClear(1),l.setClear(0),_e(2929),o.setFunc(X),xe(!1),Ae(s),_e(2884),Se(S);var Ee={[L]:32774,[C]:32778,[k]:32779};if(r)Ee[O]=32775,Ee[P]=32776;else{var we=t.get("EXT_blend_minmax");null!==we&&(Ee[O]=we.MIN_EXT,Ee[P]=we.MAX_EXT)}var Te={[I]:0,[D]:1,[N]:768,[U]:770,[W]:776,[H]:774,[V]:772,[B]:769,[F]:771,[z]:775,[G]:773};function Se(t,n,r,i,o,a,s,u){if(t!==S){if(v||(_e(3042),v=!0),t===R)o=o||n,a=a||r,s=s||i,n===b&&o===T||(e.blendEquationSeparate(Ee[n],Ee[o]),b=n,T=o),r===E&&i===w&&a===ee&&s===te||(e.blendFuncSeparate(Te[r],Te[i],Te[a],Te[s]),E=r,w=i,ee=a,te=s),_=t,ne=null;else if(t!==_||u!==ne){if(b===L&&T===L||(e.blendEquation(32774),b=L,T=L),u)switch(t){case x:e.blendFuncSeparate(1,771,1,771);break;case A:e.blendFunc(1,1);break;case M:e.blendFuncSeparate(0,0,769,771);break;case j:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case x:e.blendFuncSeparate(770,771,1,771);break;case A:e.blendFunc(770,1);break;case M:e.blendFunc(0,769);break;case j:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}E=null,w=null,ee=null,te=null,_=t,ne=u}}else v&&(be(3042),v=!1)}function xe(t){re!==t&&(t?e.frontFace(2304):e.frontFace(2305),re=t)}function Ae(t){t!==a?(_e(2884),t!==ie&&(t===s?e.cullFace(1029):t===u?e.cullFace(1028):e.cullFace(1032))):be(2884),ie=t}function Me(t,n,r){t?(_e(32823),ae===n&&se===r||(e.polygonOffset(n,r),ae=n,se=r)):be(32823)}function je(t){void 0===t&&(t=33984+ue-1),he!==t&&(e.activeTexture(t),he=t)}return{buffers:{color:i,depth:o,stencil:l},initAttributes:function(){for(var e=0,t=d.length;e<t;e++)d[e]=0},enableAttribute:function(e){ye(e,0)},enableAttributeAndDivisor:ye,disableUnusedAttributes:function(){for(var t=0,n=h.length;t!==n;++t)h[t]!==d[t]&&(e.disableVertexAttribArray(t),h[t]=0)},enable:_e,disable:be,useProgram:function(t){return m!==t&&(e.useProgram(t),m=t,!0)},setBlending:Se,setMaterial:function(e,t){e.side===y?be(2884):_e(2884);var n=e.side===g;t&&(n=!n),xe(n),e.blending===x&&!1===e.transparent?Se(S):Se(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),o.setFunc(e.depthFunc),o.setTest(e.depthTest),o.setMask(e.depthWrite),i.setMask(e.colorWrite);var r=e.stencilWrite;l.setTest(r),r&&(l.setMask(e.stencilWriteMask),l.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),l.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),Me(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:xe,setCullFace:Ae,setLineWidth:function(t){t!==oe&&(le&&e.lineWidth(t),oe=t)},setPolygonOffset:Me,setScissorTest:function(e){e?_e(3089):be(3089)},activeTexture:je,bindTexture:function(t,n){null===he&&je();var r=fe[he];void 0===r&&(r={type:void 0,texture:void 0},fe[he]=r),r.type===t&&r.texture===n||(e.bindTexture(t,n||ge[t]),r.type=t,r.texture=n)},unbindTexture:function(){var t=fe[he];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===pe.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),pe.copy(t))},viewport:function(t){!1===me.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),me.copy(t))},reset:function(){for(var t=0;t<h.length;t++)1===h[t]&&(e.disableVertexAttribArray(t),h[t]=0);p={},he=null,fe={},m=null,_=null,re=null,ie=null,i.reset(),o.reset(),l.reset()}}}function cs(e,t,n,r,i,o,a){var s,u=i.isWebGL2,l=i.maxTextures,c=i.maxCubemapSize,d=i.maxTextureSize,h=i.maxSamples,f=new WeakMap,p=!1;try{p="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function m(e,t){return p?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function v(e,t,n,r){var i=1;if((e.width>r||e.height>r)&&(i=r/Math.max(e.width,e.height)),i<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){var o=t?Sn.floorPowerOfTwo:Math.floor,a=o(i*e.width),u=o(i*e.height);void 0===s&&(s=m(a,u));var l=n?m(a,u):s;return l.width=a,l.height=u,l.getContext("2d").drawImage(e,0,0,a,u),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+a+"x"+u+")."),l}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function g(e){return Sn.isPowerOfTwo(e.width)&&Sn.isPowerOfTwo(e.height)}function y(e,t){return e.generateMipmaps&&t&&e.minFilter!==be&&e.minFilter!==xe}function _(t,n,i,o){e.generateMipmap(t),r.get(n).__maxMipLevel=Math.log(Math.max(i,o))*Math.LOG2E}function b(n,r,i){if(!1===u)return r;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}var o=r;return 6403===r&&(5126===i&&(o=33326),5131===i&&(o=33325),5121===i&&(o=33321)),6407===r&&(5126===i&&(o=34837),5131===i&&(o=34843),5121===i&&(o=32849)),6408===r&&(5126===i&&(o=34836),5131===i&&(o=34842),5121===i&&(o=32856)),33325===o||33326===o||34842===o||34836===o?t.get("EXT_color_buffer_float"):34843!==o&&34837!==o||console.warn("THREE.WebGLRenderer: Floating point textures with RGB format not supported. Please use RGBA instead."),o}function E(e){return e===be||e===Ee||e===Te?9728:9729}function w(t){var n=t.target;n.removeEventListener("dispose",w),function(t){var n=r.get(t);if(void 0===n.__webglInit)return;e.deleteTexture(n.__webglTexture),r.remove(t)}(n),n.isVideoTexture&&f.delete(n),a.memory.textures--}function T(t){var n=t.target;n.removeEventListener("dispose",T),function(t){var n=r.get(t),i=r.get(t.texture);if(!t)return;void 0!==i.__webglTexture&&e.deleteTexture(i.__webglTexture);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLRenderTargetCube)for(var o=0;o<6;o++)e.deleteFramebuffer(n.__webglFramebuffer[o]),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[o]);else e.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer);if(t.isWebGLMultiviewRenderTarget){e.deleteTexture(n.__webglColorTexture),e.deleteTexture(n.__webglDepthStencilTexture),a.memory.textures-=2;o=0;for(var s=n.__webglViewFramebuffers.length;o<s;o++)e.deleteFramebuffer(n.__webglViewFramebuffers[o])}r.remove(t.texture),r.remove(t)}(n),a.memory.textures--}var S=0;function x(e,t){var i=r.get(e);if(e.isVideoTexture&&function(e){var t=a.render.frame;f.get(e)!==t&&(f.set(e,t),e.update())}(e),e.version>0&&i.__version!==e.version){var o=e.image;if(void 0===o)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==o.complete)return void k(i,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+t),n.bindTexture(3553,i.__webglTexture)}function A(t,i){if(6===t.image.length){var a=r.get(t);if(t.version>0&&a.__version!==t.version){C(a,t),n.activeTexture(33984+i),n.bindTexture(34067,a.__webglTexture),e.pixelStorei(37440,t.flipY);for(var s=t&&t.isCompressedTexture,l=t.image[0]&&t.image[0].isDataTexture,d=[],h=0;h<6;h++)d[h]=s||l?l?t.image[h].image:t.image[h]:v(t.image[h],!1,!0,c);var f,p=d[0],m=g(p)||u,E=o.convert(t.format),w=o.convert(t.type),T=b(t.internalFormat,E,w);if(L(34067,t,m),s){for(h=0;h<6;h++){f=d[h].mipmaps;for(var S=0;S<f.length;S++){var x=f[S];t.format!==ze&&t.format!==He?null!==E?n.compressedTexImage2D(34069+h,S,T,x.width,x.height,0,x.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+h,S,T,x.width,x.height,0,E,w,x.data)}}a.__maxMipLevel=f.length-1}else{f=t.mipmaps;for(h=0;h<6;h++)if(l){n.texImage2D(34069+h,0,T,d[h].width,d[h].height,0,E,w,d[h].data);for(S=0;S<f.length;S++){var A=(x=f[S]).image[h].image;n.texImage2D(34069+h,S+1,T,A.width,A.height,0,E,w,A.data)}}else{n.texImage2D(34069+h,0,T,E,w,d[h]);for(S=0;S<f.length;S++){x=f[S];n.texImage2D(34069+h,S+1,T,E,w,x.image[h])}}a.__maxMipLevel=f.length}y(t,m)&&_(34067,t,p.width,p.height),a.__version=t.version,t.onUpdate&&t.onUpdate(t)}else n.activeTexture(33984+i),n.bindTexture(34067,a.__webglTexture)}}function M(e,t){n.activeTexture(33984+t),n.bindTexture(34067,r.get(e).__webglTexture)}var j={[ge]:10497,[ye]:33071,[_e]:33648},R={[be]:9728,[Ee]:9984,[Te]:9986,[xe]:9729,[Ae]:9985,[je]:9987};function L(n,o,a){a?(e.texParameteri(n,10242,j[o.wrapS]),e.texParameteri(n,10243,j[o.wrapT]),32879!==n&&35866!==n||e.texParameteri(n,32882,j[o.wrapR]),e.texParameteri(n,10240,R[o.magFilter]),e.texParameteri(n,10241,R[o.minFilter])):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),32879!==n&&35866!==n||e.texParameteri(n,32882,33071),o.wrapS===ye&&o.wrapT===ye||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,10240,E(o.magFilter)),e.texParameteri(n,10241,E(o.minFilter)),o.minFilter!==be&&o.minFilter!==xe&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));var s=t.get("EXT_texture_filter_anisotropic");if(s){if(o.type===De&&null===t.get("OES_texture_float_linear"))return;if(o.type===Ne&&null===(u||t.get("OES_texture_half_float_linear")))return;(o.anisotropy>1||r.get(o).__currentAnisotropy)&&(e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,i.getMaxAnisotropy())),r.get(o).__currentAnisotropy=o.anisotropy)}}function C(t,n){void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",w),t.__webglTexture=e.createTexture(),a.memory.textures++)}function k(t,r,i){var a=3553;r.isDataTexture2DArray&&(a=35866),r.isDataTexture3D&&(a=32879),C(t,r),n.activeTexture(33984+i),n.bindTexture(a,t.__webglTexture),e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment);var s=function(e){return!u&&(e.wrapS!==ye||e.wrapT!==ye||e.minFilter!==be&&e.minFilter!==xe)}(r)&&!1===g(r.image),l=v(r.image,s,!1,d),c=g(l)||u,h=o.convert(r.format),f=o.convert(r.type),p=b(r.internalFormat,h,f);L(a,r,c);var m,E=r.mipmaps;if(r.isDepthTexture){if(p=6402,r.type===De){if(!1===u)throw new Error("Float Depth Texture only supported in WebGL2.0");p=36012}else u&&(p=33189);r.format===Ye&&6402===p&&r.type!==Oe&&r.type!==Ie&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=Oe,f=o.convert(r.type)),r.format===Xe&&(p=34041,r.type!==Ve&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=Ve,f=o.convert(r.type))),n.texImage2D(3553,0,p,l.width,l.height,0,h,f,null)}else if(r.isDataTexture)if(E.length>0&&c){for(var w=0,T=E.length;w<T;w++)m=E[w],n.texImage2D(3553,w,p,m.width,m.height,0,h,f,m.data);r.generateMipmaps=!1,t.__maxMipLevel=E.length-1}else n.texImage2D(3553,0,p,l.width,l.height,0,h,f,l.data),t.__maxMipLevel=0;else if(r.isCompressedTexture){for(w=0,T=E.length;w<T;w++)m=E[w],r.format!==ze&&r.format!==He?null!==h?n.compressedTexImage2D(3553,w,p,m.width,m.height,0,m.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,w,p,m.width,m.height,0,h,f,m.data);t.__maxMipLevel=E.length-1}else if(r.isDataTexture2DArray)n.texImage3D(35866,0,p,l.width,l.height,l.depth,0,h,f,l.data),t.__maxMipLevel=0;else if(r.isDataTexture3D)n.texImage3D(32879,0,p,l.width,l.height,l.depth,0,h,f,l.data),t.__maxMipLevel=0;else if(E.length>0&&c){for(w=0,T=E.length;w<T;w++)m=E[w],n.texImage2D(3553,w,p,h,f,m);r.generateMipmaps=!1,t.__maxMipLevel=E.length-1}else n.texImage2D(3553,0,p,h,f,l),t.__maxMipLevel=0;y(r,c)&&_(a,r,l.width,l.height),t.__version=r.version,r.onUpdate&&r.onUpdate(r)}function O(t,i,a,s){var u=o.convert(i.texture.format),l=o.convert(i.texture.type),c=b(i.texture.internalFormat,u,l);n.texImage2D(s,0,c,i.width,i.height,0,u,l,null),e.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,a,s,r.get(i.texture).__webglTexture,0),e.bindFramebuffer(36160,null)}function P(t,n,r){if(e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){if(r){var i=D(n);e.renderbufferStorageMultisample(36161,i,33189,n.width,n.height)}else e.renderbufferStorage(36161,33189,n.width,n.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(n.depthBuffer&&n.stencilBuffer){if(r){i=D(n);e.renderbufferStorageMultisample(36161,i,35056,n.width,n.height)}else e.renderbufferStorage(36161,34041,n.width,n.height);e.framebufferRenderbuffer(36160,33306,36161,t)}else{var a=o.convert(n.texture.format),s=o.convert(n.texture.type),u=b(n.texture.internalFormat,a,s);if(r){i=D(n);e.renderbufferStorageMultisample(36161,i,u,n.width,n.height)}else e.renderbufferStorage(36161,u,n.width,n.height)}e.bindRenderbuffer(36161,null)}function I(t){var n=r.get(t),i=!0===t.isWebGLRenderTargetCube;if(t.depthTexture){if(i)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,n){if(n&&n.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,t),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),x(n.depthTexture,0);var i=r.get(n.depthTexture).__webglTexture;if(n.depthTexture.format===Ye)e.framebufferTexture2D(36160,36096,3553,i,0);else{if(n.depthTexture.format!==Xe)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,i,0)}}(n.__webglFramebuffer,t)}else if(i){n.__webglDepthbuffer=[];for(var o=0;o<6;o++)e.bindFramebuffer(36160,n.__webglFramebuffer[o]),n.__webglDepthbuffer[o]=e.createRenderbuffer(),P(n.__webglDepthbuffer[o],t)}else e.bindFramebuffer(36160,n.__webglFramebuffer),n.__webglDepthbuffer=e.createRenderbuffer(),P(n.__webglDepthbuffer,t);e.bindFramebuffer(36160,null)}function D(e){return u&&e.isWebGLMultisampleRenderTarget?Math.min(h,e.samples):0}var N=!1,B=!1;this.allocateTextureUnit=function(){var e=S;return e>=l&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+l),S+=1,e},this.resetTextureUnits=function(){S=0},this.setTexture2D=x,this.setTexture2DArray=function(e,t){var i=r.get(e);e.version>0&&i.__version!==e.version?k(i,e,t):(n.activeTexture(33984+t),n.bindTexture(35866,i.__webglTexture))},this.setTexture3D=function(e,t){var i=r.get(e);e.version>0&&i.__version!==e.version?k(i,e,t):(n.activeTexture(33984+t),n.bindTexture(32879,i.__webglTexture))},this.setTextureCube=A,this.setTextureCubeDynamic=M,this.setupRenderTarget=function(i){var s=r.get(i),l=r.get(i.texture);i.addEventListener("dispose",T),l.__webglTexture=e.createTexture(),a.memory.textures++;var c=!0===i.isWebGLRenderTargetCube,d=!0===i.isWebGLMultisampleRenderTarget,h=!0===i.isWebGLMultiviewRenderTarget,f=g(i)||u;if(c){s.__webglFramebuffer=[];for(var p=0;p<6;p++)s.__webglFramebuffer[p]=e.createFramebuffer()}else if(s.__webglFramebuffer=e.createFramebuffer(),d)if(u){s.__webglMultisampledFramebuffer=e.createFramebuffer(),s.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,s.__webglColorRenderbuffer);var m=o.convert(i.texture.format),v=o.convert(i.texture.type),E=b(i.texture.internalFormat,m,v),w=D(i);e.renderbufferStorageMultisample(36161,w,E,i.width,i.height),e.bindFramebuffer(36160,s.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,s.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),i.depthBuffer&&(s.__webglDepthRenderbuffer=e.createRenderbuffer(),P(s.__webglDepthRenderbuffer,i,!0)),e.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");else if(h){var S=i.width,x=i.height,A=i.numViews;e.bindFramebuffer(36160,s.__webglFramebuffer);var M=t.get("OVR_multiview2");a.memory.textures+=2;var j=e.createTexture();e.bindTexture(35866,j),e.texParameteri(35866,10240,9728),e.texParameteri(35866,10241,9728),e.texImage3D(35866,0,32856,S,x,A,0,6408,5121,null),M.framebufferTextureMultiviewOVR(36160,36064,j,0,0,A);var R=e.createTexture();e.bindTexture(35866,R),e.texParameteri(35866,10240,9728),e.texParameteri(35866,10241,9728),e.texImage3D(35866,0,35056,S,x,A,0,34041,34042,null),M.framebufferTextureMultiviewOVR(36160,33306,R,0,0,A);var C=new Array(A);for(p=0;p<A;++p)C[p]=e.createFramebuffer(),e.bindFramebuffer(36160,C[p]),e.framebufferTextureLayer(36160,36064,j,0,p);s.__webglColorTexture=j,s.__webglDepthStencilTexture=R,s.__webglViewFramebuffers=C,e.bindFramebuffer(36160,null),e.bindTexture(35866,null)}if(c){n.bindTexture(34067,l.__webglTexture),L(34067,i.texture,f);for(p=0;p<6;p++)O(s.__webglFramebuffer[p],i,36064,34069+p);y(i.texture,f)&&_(34067,i.texture,i.width,i.height),n.bindTexture(34067,null)}else h||(n.bindTexture(3553,l.__webglTexture),L(3553,i.texture,f),O(s.__webglFramebuffer,i,36064,3553),y(i.texture,f)&&_(3553,i.texture,i.width,i.height),n.bindTexture(3553,null));i.depthBuffer&&I(i)},this.updateRenderTargetMipmap=function(e){var t=e.texture;if(y(t,g(e)||u)){var i=e.isWebGLRenderTargetCube?34067:3553,o=r.get(t).__webglTexture;n.bindTexture(i,o),_(i,t,e.width,e.height),n.bindTexture(i,null)}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(u){var n=r.get(t);e.bindFramebuffer(36008,n.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,n.__webglFramebuffer);var i=t.width,o=t.height,a=16384;t.depthBuffer&&(a|=256),t.stencilBuffer&&(a|=1024),e.blitFramebuffer(0,0,i,o,0,0,i,o,a,9728)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===N&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),N=!0),e=e.texture),x(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLRenderTargetCube&&(!1===B&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),B=!0),e=e.texture),e&&e.isCubeTexture||Array.isArray(e.image)&&6===e.image.length?A(e,t):M(e,t)}}function ds(e,t,n){var r=n.isWebGL2;return{convert:function(e){var n;if(e===Le)return 5121;if(e===Be)return 32819;if(e===Ue)return 32820;if(e===Fe)return 33635;if(e===Ce)return 5120;if(e===ke)return 5122;if(e===Oe)return 5123;if(e===Pe)return 5124;if(e===Ie)return 5125;if(e===De)return 5126;if(e===Ne)return r?5131:null!==(n=t.get("OES_texture_half_float"))?n.HALF_FLOAT_OES:null;if(e===Ge)return 6406;if(e===He)return 6407;if(e===ze)return 6408;if(e===We)return 6409;if(e===qe)return 6410;if(e===Ye)return 6402;if(e===Xe)return 34041;if(e===Je)return 6403;if(e===Ze)return 36244;if(e===$e)return 33319;if(e===Qe)return 33320;if(e===et)return 36248;if(e===tt)return 36249;if(e===nt||e===rt||e===it||e===ot){if(null===(n=t.get("WEBGL_compressed_texture_s3tc")))return null;if(e===nt)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===rt)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===it)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===ot)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===at||e===st||e===ut||e===lt){if(null===(n=t.get("WEBGL_compressed_texture_pvrtc")))return null;if(e===at)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===st)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===ut)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===lt)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}return e===ct?null!==(n=t.get("WEBGL_compressed_texture_etc1"))?n.COMPRESSED_RGB_ETC1_WEBGL:null:e===dt||e===ht||e===ft||e===pt||e===mt||e===vt||e===gt||e===yt||e===_t||e===bt||e===Et||e===wt||e===Tt||e===St?null!==(n=t.get("WEBGL_compressed_texture_astc"))?e:null:e===Ve?r?34042:null!==(n=t.get("WEBGL_depth_texture"))?n.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}function hs(e,t,n,r){Nn.call(this,e,t,r),this.depthBuffer=!1,this.stencilBuffer=!1,this.numViews=n}function fs(e,t){var n,r,i,o,a,s,u,l=e.extensions,c=e.properties,d=0;function h(e){return e.isArrayCamera?e.cameras:(a[0]=e,a)}this.isAvailable=function(){if(void 0===u){var e=l.get("OVR_multiview2");if(u=null!==e&&!1===t.getContextAttributes().antialias){d=t.getParameter(e.MAX_VIEWS_OVR),n=new hs(0,0,2),s=new xn,o=[],i=[],a=[];for(var r=0;r<d;r++)o[r]=new qn,i[r]=new kn}}return u},this.attachCamera=function(t){!1!==function(e){if(void 0===e.isArrayCamera)return!0;var t=e.cameras;if(t.length>d)return!1;for(var n=1,r=t.length;n<r;n++)if(t[0].viewport.z!==t[n].viewport.z||t[0].viewport.w!==t[n].viewport.w)return!1;return!0}(t)&&(r=e.getRenderTarget(),function(t){if(r?s.set(r.width,r.height):e.getDrawingBufferSize(s),t.isArrayCamera){var i=t.cameras[0].viewport;n.setSize(i.z,i.w),n.setNumViews(t.cameras.length)}else n.setSize(s.x,s.y),n.setNumViews(2)}(t),e.setRenderTarget(n))},this.detachCamera=function(i){n===e.getRenderTarget()&&(e.setRenderTarget(r),function(e){var r=n,i=r.numViews,o=c.get(r).__webglViewFramebuffers,a=r.width,u=r.height;if(e.isArrayCamera)for(var l=0;l<i;l++){var d=e.cameras[l].viewport,h=d.x,f=d.y,p=h+d.z,m=f+d.w;t.bindFramebuffer(36008,o[l]),t.blitFramebuffer(0,0,a,u,h,f,p,m,16384,9728)}else t.bindFramebuffer(36008,o[0]),t.blitFramebuffer(0,0,a,u,0,0,s.x,s.y,16384,9728)}(i))},this.updateCameraProjectionMatricesUniform=function(e,n){for(var r=h(e),i=0;i<r.length;i++)o[i].copy(r[i].projectionMatrix);n.setValue(t,"projectionMatrices",o)},this.updateCameraViewMatricesUniform=function(e,n){for(var r=h(e),i=0;i<r.length;i++)o[i].copy(r[i].matrixWorldInverse);n.setValue(t,"viewMatrices",o)},this.updateObjectMatricesUniforms=function(e,n,r){for(var a=h(n),s=0;s<a.length;s++)o[s].multiplyMatrices(a[s].matrixWorldInverse,e.matrixWorld),i[s].getNormalMatrix(o[s]);r.setValue(t,"modelViewMatrices",o),r.setValue(t,"normalMatrices",i)}}function ps(e){uo.call(this),this.cameras=e||[]}function ms(){cr.call(this),this.type="Group"}function vs(e,t){var n=this,r=null,i=null,o="local-floor",a=null,s=[],u=new Map,l=new uo;l.layers.enable(1),l.viewport=new Dn;var c=new uo;c.layers.enable(2),c.viewport=new Dn;var d=new ps([l,c]);function h(e){var t=u.get(e.inputSource);t&&t.dispatchEvent({type:e.type})}function f(){u.forEach((function(e,t){e.dispatchEvent({type:"disconnected",data:t}),e.visible=!1})),u.clear(),e.setFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),b.stop(),n.dispatchEvent({type:"sessionend"}),n.isPresenting=!1}function p(e){i=e,b.setContext(r),b.start(),n.dispatchEvent({type:"sessionstart"}),n.isPresenting=!0}function m(e){for(var t=r.inputSources,n=0;n<s.length;n++)u.set(t[n],s[n]);for(n=0;n<e.removed.length;n++){var i=e.removed[n];(o=u.get(i))&&(o.dispatchEvent({type:"disconnected",data:i}),u.delete(i))}for(n=0;n<e.added.length;n++){var o;i=e.added[n];(o=u.get(i))&&o.dispatchEvent({type:"connected",data:i})}}d.layers.enable(1),d.layers.enable(2),this.enabled=!1,this.isPresenting=!1,this.getController=function(e){var t=s[e];return void 0===t&&((t=new ms).matrixAutoUpdate=!1,t.visible=!1,s[e]=t),t},this.setFramebufferScaleFactor=function(){},this.setReferenceSpaceType=function(e){o=e},this.getReferenceSpace=function(){return i},this.getSession=function(){return r},this.setSession=function(e){if(null!==(r=e)){r.addEventListener("select",h),r.addEventListener("selectstart",h),r.addEventListener("selectend",h),r.addEventListener("squeeze",h),r.addEventListener("squeezestart",h),r.addEventListener("squeezeend",h),r.addEventListener("end",f);var n=t.getContextAttributes(),i={antialias:n.antialias,alpha:n.alpha,depth:n.depth,stencil:n.stencil},a=new XRWebGLLayer(r,t,i);r.updateRenderState({baseLayer:a}),r.requestReferenceSpace(o).then(p),r.addEventListener("inputsourceschange",m)}};var v=new Rn,g=new Rn;function y(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.getInverse(e.matrixWorld)}this.getCamera=function(e){var t=e.parent,n=d.cameras;y(d,t);for(var r=0;r<n.length;r++)y(n[r],t);e.matrixWorld.copy(d.matrixWorld);for(var i=e.children,o=(r=0,i.length);r<o;r++)i[r].updateMatrixWorld(!0);return function(e,t,n){v.setFromMatrixPosition(t.matrixWorld),g.setFromMatrixPosition(n.matrixWorld);var r=v.distanceTo(g),i=t.projectionMatrix.elements,o=n.projectionMatrix.elements,a=i[14]/(i[10]-1),s=i[14]/(i[10]+1),u=(i[9]+1)/i[5],l=(i[9]-1)/i[5],c=(i[8]-1)/i[0],d=(o[8]+1)/o[0],h=a*c,f=a*d,p=r/(-c+d),m=p*-c;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.getInverse(e.matrixWorld);var y=a+p,_=s+p,b=h-m,E=f+(r-m),w=u*s/_*y,T=l*s/_*y;e.projectionMatrix.makePerspective(b,E,w,T,y,_)}(d,l,c),d};var _=null;var b=new _o;b.setAnimationLoop((function(t,n){if(null!==(a=n.getViewerPose(i))){var o=a.views,u=r.renderState.baseLayer;e.setFramebuffer(u.framebuffer);for(var l=0;l<o.length;l++){var c=o[l],h=u.getViewport(c),f=c.transform.inverse.matrix,p=d.cameras[l];p.matrix.fromArray(f).getInverse(p.matrix),p.projectionMatrix.fromArray(c.projectionMatrix),p.viewport.set(h.x,h.y,h.width,h.height),0===l&&d.matrix.copy(p.matrix)}}var m=r.inputSources;for(l=0;l<s.length;l++){var v=s[l],g=m[l];if(g){var y=n.getPose(g.targetRaySpace,i);if(null!==y){v.matrix.fromArray(y.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale),v.visible=!0;continue}}v.visible=!1}_&&_(t,n)})),this.setAnimationLoop=function(e){_=e},this.dispose=function(){}}function gs(e){var t=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),n=void 0!==e.context?e.context:null,r=void 0!==e.alpha&&e.alpha,i=void 0===e.depth||e.depth,o=void 0===e.stencil||e.stencil,a=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,u=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,l=void 0!==e.powerPreference?e.powerPreference:"default",c=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat,d=null,h=null;this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Nt,this.physicallyCorrectLights=!1,this.toneMapping=ie,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var f,p,m,v,y,_,b,E,w,T,S,x,A,M,j,R,L,C,k=this,O=!1,P=null,I=0,D=0,N=null,B=null,U=-1,F={geometry:null,program:null,wireframe:!1},V=null,G=null,H=new Dn,z=new Dn,W=null,q=t.width,K=t.height,Y=1,X=null,J=null,Z=new Dn(0,0,q,K),$=new Dn(0,0,q,K),Q=!1,ee=new mo,te=new Ao,ne=!1,re=!1,oe=new qn,ae=new Rn;function se(){return null===N?Y:1}try{var ue={alpha:r,depth:i,stencil:o,antialias:a,premultipliedAlpha:s,preserveDrawingBuffer:u,powerPreference:l,failIfMajorPerformanceCaveat:c,xrCompatible:!0};if(t.addEventListener("webglcontextlost",fe,!1),t.addEventListener("webglcontextrestored",pe,!1),null===(f=n||t.getContext("webgl",ue)||t.getContext("experimental-webgl",ue)))throw null!==t.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===f.getShaderPrecisionFormat&&(f.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function le(){p=new Mo(f),!1===(m=new xo(f,p,e)).isWebGL2&&(p.get("WEBGL_depth_texture"),p.get("OES_texture_float"),p.get("OES_texture_half_float"),p.get("OES_texture_half_float_linear"),p.get("OES_standard_derivatives"),p.get("OES_element_index_uint"),p.get("ANGLE_instanced_arrays")),p.get("OES_texture_float_linear"),C=new ds(f,p,m),(v=new ls(f,p,m)).scissor(z.copy($).multiplyScalar(Y).floor()),v.viewport(H.copy(Z).multiplyScalar(Y).floor()),y=new Lo(f),_=new Xa,b=new cs(f,p,v,_,m,C,y),E=new bo(f),w=new jo(f,E,y),T=new Oo(f,w,E,y),j=new ko(f),S=new Ya(k,p,m),x=new Qa,A=new os,M=new To(k,v,T,s),R=new So(f,p,y,m),L=new Ro(f,p,y,m),y.programs=S.programs,k.capabilities=m,k.extensions=p,k.properties=_,k.renderLists=x,k.state=v,k.info=y}le();var ce=new vs(k,f);this.xr=ce;var de=new fs(k,f),he=new us(k,T,m.maxTextureSize);function fe(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),O=!0}function pe(){console.log("THREE.WebGLRenderer: Context Restored."),O=!1,le()}function me(e){var t=e.target;t.removeEventListener("dispose",me),function(e){ve(e),_.remove(e)}(t)}function ve(e){var t=_.get(e).program;e.program=void 0,void 0!==t&&S.releaseProgram(t)}this.shadowMap=he,this.getContext=function(){return f},this.getContextAttributes=function(){return f.getContextAttributes()},this.forceContextLoss=function(){var e=p.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=p.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return Y},this.setPixelRatio=function(e){void 0!==e&&(Y=e,this.setSize(q,K,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new xn),e.set(q,K)},this.setSize=function(e,n,r){ce.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(q=e,K=n,t.width=Math.floor(e*Y),t.height=Math.floor(n*Y),!1!==r&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new xn),e.set(q*Y,K*Y).floor()},this.setDrawingBufferSize=function(e,n,r){q=e,K=n,Y=r,t.width=Math.floor(e*r),t.height=Math.floor(n*r),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new Dn),e.copy(H)},this.getViewport=function(e){return e.copy(Z)},this.setViewport=function(e,t,n,r){e.isVector4?Z.set(e.x,e.y,e.z,e.w):Z.set(e,t,n,r),v.viewport(H.copy(Z).multiplyScalar(Y).floor())},this.getScissor=function(e){return e.copy($)},this.setScissor=function(e,t,n,r){e.isVector4?$.set(e.x,e.y,e.z,e.w):$.set(e,t,n,r),v.scissor(z.copy($).multiplyScalar(Y).floor())},this.getScissorTest=function(){return Q},this.setScissorTest=function(e){v.setScissorTest(Q=e)},this.setOpaqueSort=function(e){X=e},this.setTransparentSort=function(e){J=e},this.getClearColor=function(){return M.getClearColor()},this.setClearColor=function(){M.setClearColor.apply(M,arguments)},this.getClearAlpha=function(){return M.getClearAlpha()},this.setClearAlpha=function(){M.setClearAlpha.apply(M,arguments)},this.clear=function(e,t,n){var r=0;(void 0===e||e)&&(r|=16384),(void 0===t||t)&&(r|=256),(void 0===n||n)&&(r|=1024),f.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",fe,!1),t.removeEventListener("webglcontextrestored",pe,!1),x.dispose(),A.dispose(),_.dispose(),T.dispose(),ce.dispose(),_e.stop()},this.renderBufferImmediate=function(e,t){v.initAttributes();var n=_.get(e);e.hasPositions&&!n.position&&(n.position=f.createBuffer()),e.hasNormals&&!n.normal&&(n.normal=f.createBuffer()),e.hasUvs&&!n.uv&&(n.uv=f.createBuffer()),e.hasColors&&!n.color&&(n.color=f.createBuffer());var r=t.getAttributes();e.hasPositions&&(f.bindBuffer(34962,n.position),f.bufferData(34962,e.positionArray,35048),v.enableAttribute(r.position),f.vertexAttribPointer(r.position,3,5126,!1,0,0)),e.hasNormals&&(f.bindBuffer(34962,n.normal),f.bufferData(34962,e.normalArray,35048),v.enableAttribute(r.normal),f.vertexAttribPointer(r.normal,3,5126,!1,0,0)),e.hasUvs&&(f.bindBuffer(34962,n.uv),f.bufferData(34962,e.uvArray,35048),v.enableAttribute(r.uv),f.vertexAttribPointer(r.uv,2,5126,!1,0,0)),e.hasColors&&(f.bindBuffer(34962,n.color),f.bufferData(34962,e.colorArray,35048),v.enableAttribute(r.color),f.vertexAttribPointer(r.color,3,5126,!1,0,0)),v.disableUnusedAttributes(),f.drawArrays(4,0,e.count),e.count=0};var ge=new dr;this.renderBufferDirect=function(e,t,n,r,i,o){null===t&&(t=ge);var a=i.isMesh&&i.matrixWorld.determinant()<0,s=Se(e,t,r,i);v.setMaterial(r,a);var u=!1;F.geometry===n.id&&F.program===s.id&&F.wireframe===(!0===r.wireframe)||(F.geometry=n.id,F.program=s.id,F.wireframe=!0===r.wireframe,u=!0),(r.morphTargets||r.morphNormals)&&(j.update(i,n,r,s),u=!0);var l=n.index,c=n.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;var d,h=1;!0===r.wireframe&&(l=w.getWireframeAttribute(n),h=2);var g=R;null!==l&&(d=E.get(l),(g=L).setIndex(d)),u&&(!function(e,t,n,r){if(!1===m.isWebGL2&&(e.isInstancedMesh||t.isInstancedBufferGeometry)&&null===p.get("ANGLE_instanced_arrays"))return;v.initAttributes();var i=t.attributes,o=r.getAttributes(),a=n.defaultAttributeValues;for(var s in o){var u=o[s];if(u>=0){var l=i[s];if(void 0!==l){var c=l.normalized,d=l.itemSize;if(void 0===(T=E.get(l)))continue;var h=T.buffer,g=T.type,y=T.bytesPerElement;if(l.isInterleavedBufferAttribute){var _=l.data,b=_.stride,w=l.offset;_&&_.isInstancedInterleavedBuffer?(v.enableAttributeAndDivisor(u,_.meshPerAttribute),void 0===t.maxInstancedCount&&(t.maxInstancedCount=_.meshPerAttribute*_.count)):v.enableAttribute(u),f.bindBuffer(34962,h),f.vertexAttribPointer(u,d,g,c,b*y,w*y)}else l.isInstancedBufferAttribute?(v.enableAttributeAndDivisor(u,l.meshPerAttribute),void 0===t.maxInstancedCount&&(t.maxInstancedCount=l.meshPerAttribute*l.count)):v.enableAttribute(u),f.bindBuffer(34962,h),f.vertexAttribPointer(u,d,g,c,0,0)}else if("instanceMatrix"===s){var T;if(void 0===(T=E.get(e.instanceMatrix)))continue;h=T.buffer,g=T.type;v.enableAttributeAndDivisor(u+0,1),v.enableAttributeAndDivisor(u+1,1),v.enableAttributeAndDivisor(u+2,1),v.enableAttributeAndDivisor(u+3,1),f.bindBuffer(34962,h),f.vertexAttribPointer(u+0,4,g,!1,64,0),f.vertexAttribPointer(u+1,4,g,!1,64,16),f.vertexAttribPointer(u+2,4,g,!1,64,32),f.vertexAttribPointer(u+3,4,g,!1,64,48)}else if(void 0!==a){var S=a[s];if(void 0!==S)switch(S.length){case 2:f.vertexAttrib2fv(u,S);break;case 3:f.vertexAttrib3fv(u,S);break;case 4:f.vertexAttrib4fv(u,S);break;default:f.vertexAttrib1fv(u,S)}}}}v.disableUnusedAttributes()}(i,n,r,s),null!==l&&f.bindBuffer(34963,d.buffer));var y=null!==l?l.count:c.count,_=n.drawRange.start*h,b=n.drawRange.count*h,T=null!==o?o.start*h:0,S=null!==o?o.count*h:1/0,x=Math.max(_,T),A=Math.min(y,_+b,T+S)-1,M=Math.max(0,A-x+1);if(0!==M){if(i.isMesh)!0===r.wireframe?(v.setLineWidth(r.wireframeLinewidth*se()),g.setMode(1)):g.setMode(4);else if(i.isLine){var C=r.linewidth;void 0===C&&(C=1),v.setLineWidth(C*se()),i.isLineSegments?g.setMode(1):i.isLineLoop?g.setMode(2):g.setMode(3)}else i.isPoints?g.setMode(0):i.isSprite&&g.setMode(4);i.isInstancedMesh?g.renderInstances(n,x,M,i.count):n.isInstancedBufferGeometry?g.renderInstances(n,x,M,n.maxInstancedCount):g.render(x,M)}},this.compile=function(e,t){(h=A.get(e,t)).init(),e.traverse((function(e){e.isLight&&(h.pushLight(e),e.castShadow&&h.pushShadow(e))})),h.setupLights(t),e.traverse((function(t){if(t.material)if(Array.isArray(t.material))for(var n=0;n<t.material.length;n++)Te(t.material[n],e,t);else Te(t.material,e,t)}))};var ye=null;var _e=new _o;function be(e,t,n,r){if(!1!==e.visible){if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)h.pushLight(e),e.castShadow&&h.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||ee.intersectsSprite(e)){r&&ae.setFromMatrixPosition(e.matrixWorld).applyMatrix4(oe);var i=T.update(e);(o=e.material).visible&&d.push(e,i,o,n,ae.z,null)}}else if(e.isImmediateRenderObject)r&&ae.setFromMatrixPosition(e.matrixWorld).applyMatrix4(oe),d.push(e,null,e.material,n,ae.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==y.render.frame&&(e.skeleton.update(),e.skeleton.frame=y.render.frame),!e.frustumCulled||ee.intersectsObject(e))){r&&ae.setFromMatrixPosition(e.matrixWorld).applyMatrix4(oe);i=T.update(e);var o=e.material;if(Array.isArray(o))for(var a=i.groups,s=0,u=a.length;s<u;s++){var l=a[s],c=o[l.materialIndex];c&&c.visible&&d.push(e,i,c,n,ae.z,l)}else o.visible&&d.push(e,i,o,n,ae.z,null)}var f=e.children;for(s=0,u=f.length;s<u;s++)be(f[s],t,n,r)}}function Ee(e,t,n,r){for(var i=0,o=e.length;i<o;i++){var a=e[i],s=a.object,u=a.geometry,l=void 0===r?a.material:r,c=a.group;if(n.isArrayCamera)if(G=n,ce.enabled&&de.isAvailable())we(s,t,n,u,l,c);else for(var d=n.cameras,f=0,p=d.length;f<p;f++){var m=d[f];s.layers.test(m.layers)&&(v.viewport(H.copy(m.viewport)),h.setupLights(m),we(s,t,m,u,l,c))}else G=null,we(s,t,n,u,l,c)}}function we(e,t,n,r,i,o){if(e.onBeforeRender(k,t,n,r,i,o),h=A.get(t,G||n),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){var a=Se(n,t,i,e);v.setMaterial(i),F.geometry=null,F.program=null,F.wireframe=!1,function(e,t){e.render((function(e){k.renderBufferImmediate(e,t)}))}(e,a)}else k.renderBufferDirect(n,t,r,i,e,o);e.onAfterRender(k,t,n,r,i,o),h=A.get(t,G||n)}function Te(e,t,n){var r=_.get(e),i=h.state.lights,o=h.state.shadowsArray,a=i.state.version,s=S.getParameters(e,i.state,o,t,te.numPlanes,te.numIntersection,n),u=S.getProgramCacheKey(e,s),l=r.program,c=!0;if(void 0===l)e.addEventListener("dispose",me);else if(l.cacheKey!==u)ve(e);else if(r.lightsStateVersion!==a)r.lightsStateVersion=a,c=!1;else{if(void 0!==s.shaderID)return;c=!1}if(c){if(s.shaderID){var d=yo[s.shaderID];r.shader={name:e.type,uniforms:ro(d.uniforms),vertexShader:d.vertexShader,fragmentShader:d.fragmentShader}}else r.shader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};e.onBeforeCompile(r.shader,k),u=S.getProgramCacheKey(e,s),l=S.acquireProgram(e,r.shader,s,u),r.program=l,r.environment=e.isMeshStandardMaterial?t.environment:null,r.outputEncoding=k.outputEncoding,e.program=l}var f=l.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var p=0;p<k.maxMorphTargets;p++)f["morphTarget"+p]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;for(p=0;p<k.maxMorphNormals;p++)f["morphNormal"+p]>=0&&e.numSupportedMorphNormals++}var m=r.shader.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(r.numClippingPlanes=te.numPlanes,r.numIntersection=te.numIntersection,m.clippingPlanes=te.uniform),r.fog=t.fog,r.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),r.lightsStateVersion=a,r.needsLights&&(m.ambientLightColor.value=i.state.ambient,m.lightProbe.value=i.state.probe,m.directionalLights.value=i.state.directional,m.spotLights.value=i.state.spot,m.rectAreaLights.value=i.state.rectArea,m.pointLights.value=i.state.point,m.hemisphereLights.value=i.state.hemi,m.directionalShadowMap.value=i.state.directionalShadowMap,m.directionalShadowMatrix.value=i.state.directionalShadowMatrix,m.spotShadowMap.value=i.state.spotShadowMap,m.spotShadowMatrix.value=i.state.spotShadowMatrix,m.pointShadowMap.value=i.state.pointShadowMap,m.pointShadowMatrix.value=i.state.pointShadowMatrix);var v=r.program.getUniforms(),g=La.seqWithValue(v.seq,m);r.uniformsList=g}function Se(e,t,n,r){b.resetTextureUnits();var i=t.fog,o=n.isMeshStandardMaterial?t.environment:null,a=_.get(n),s=h.state.lights;if(ne&&(re||e!==V)){var u=e===V&&n.id===U;te.setState(n.clippingPlanes,n.clipIntersection,n.clipShadows,e,a,u)}n.version===a.__version&&(void 0===a.program||n.fog&&a.fog!==i||a.environment!==o||a.needsLights&&a.lightsStateVersion!==s.state.version?n.needsUpdate=!0:void 0===a.numClippingPlanes||a.numClippingPlanes===te.numPlanes&&a.numIntersection===te.numIntersection?a.outputEncoding!==k.outputEncoding&&(n.needsUpdate=!0):n.needsUpdate=!0),n.version!==a.__version&&(Te(n,t,r),a.__version=n.version);var l,c,d=!1,p=!1,y=!1,E=a.program,w=E.getUniforms(),T=a.shader.uniforms;if(v.useProgram(E.program)&&(d=!0,p=!0,y=!0),n.id!==U&&(U=n.id,p=!0),d||V!==e){if(E.numMultiviewViews>0?de.updateCameraProjectionMatricesUniform(e,w):w.setValue(f,"projectionMatrix",e.projectionMatrix),m.logarithmicDepthBuffer&&w.setValue(f,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),V!==e&&(V=e,p=!0,y=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){var S=w.map.cameraPosition;void 0!==S&&S.setValue(f,ae.setFromMatrixPosition(e.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&w.setValue(f,"isOrthographic",!0===e.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.skinning)&&(E.numMultiviewViews>0?de.updateCameraViewMatricesUniform(e,w):w.setValue(f,"viewMatrix",e.matrixWorldInverse))}if(n.skinning){w.setOptional(f,r,"bindMatrix"),w.setOptional(f,r,"bindMatrixInverse");var x=r.skeleton;if(x){var A=x.bones;if(m.floatVertexTextures){if(void 0===x.boneTexture){var M=Math.sqrt(4*A.length);M=Sn.ceilPowerOfTwo(M),M=Math.max(M,4);var j=new Float32Array(M*M*4);j.set(x.boneMatrices);var R=new ho(j,M,M,ze,De);x.boneMatrices=j,x.boneTexture=R,x.boneTextureSize=M}w.setValue(f,"boneTexture",x.boneTexture,b),w.setValue(f,"boneTextureSize",x.boneTextureSize)}else w.setOptional(f,x,"boneMatrices")}}return(p||a.receiveShadow!==r.receiveShadow)&&(a.receiveShadow=r.receiveShadow,w.setValue(f,"receiveShadow",r.receiveShadow)),p&&(w.setValue(f,"toneMappingExposure",k.toneMappingExposure),w.setValue(f,"toneMappingWhitePoint",k.toneMappingWhitePoint),a.needsLights&&(c=y,(l=T).ambientLightColor.needsUpdate=c,l.lightProbe.needsUpdate=c,l.directionalLights.needsUpdate=c,l.pointLights.needsUpdate=c,l.spotLights.needsUpdate=c,l.rectAreaLights.needsUpdate=c,l.hemisphereLights.needsUpdate=c),i&&n.fog&&function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)}(T,i),n.isMeshBasicMaterial?xe(T,n):n.isMeshLambertMaterial?(xe(T,n),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(T,n)):n.isMeshToonMaterial?(xe(T,n),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.gradientMap&&(e.gradientMap.value=t.gradientMap);t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===g&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===g&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(T,n)):n.isMeshPhongMaterial?(xe(T,n),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===g&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===g&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(T,n)):n.isMeshStandardMaterial?(xe(T,n,o),n.isMeshPhysicalMaterial?function(e,t,n){Ae(e,t,n),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen);t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===g&&e.clearcoatNormalScale.value.negate());e.transparency.value=t.transparency}(T,n,o):Ae(T,n,o)):n.isMeshMatcapMaterial?(xe(T,n),function(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===g&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===g&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(T,n)):n.isMeshDepthMaterial?(xe(T,n),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(T,n)):n.isMeshDistanceMaterial?(xe(T,n),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(T,n)):n.isMeshNormalMaterial?(xe(T,n),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===g&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===g&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(T,n)):n.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(T,n),n.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(T,n)):n.isPointsMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*Y,e.scale.value=.5*K,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);var n;t.map?n=t.map:t.alphaMap&&(n=t.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(T,n):n.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);var n;t.map?n=t.map:t.alphaMap&&(n=t.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(T,n):n.isShadowMaterial&&(T.color.value.copy(n.color),T.opacity.value=n.opacity),void 0!==T.ltc_1&&(T.ltc_1.value=go.LTC_1),void 0!==T.ltc_2&&(T.ltc_2.value=go.LTC_2),La.upload(f,a.uniformsList,T,b),n.isShaderMaterial&&(n.uniformsNeedUpdate=!1)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(La.upload(f,a.uniformsList,T,b),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&w.setValue(f,"center",r.center),E.numMultiviewViews>0?de.updateObjectMatricesUniforms(r,e,w):(w.setValue(f,"modelViewMatrix",r.modelViewMatrix),w.setValue(f,"normalMatrix",r.normalMatrix)),w.setValue(f,"modelMatrix",r.matrixWorld),E}function xe(e,t,n){e.opacity.value=t.opacity,t.color&&e.diffuse.value.copy(t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap);var r,i,o=t.envMap||n;o&&(e.envMap.value=o,e.flipEnvMap.value=o.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.maxMipLevel.value=_.get(o).__maxMipLevel),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity),t.map?r=t.map:t.specularMap?r=t.specularMap:t.displacementMap?r=t.displacementMap:t.normalMap?r=t.normalMap:t.bumpMap?r=t.bumpMap:t.roughnessMap?r=t.roughnessMap:t.metalnessMap?r=t.metalnessMap:t.alphaMap?r=t.alphaMap:t.emissiveMap&&(r=t.emissiveMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix)),t.aoMap?i=t.aoMap:t.lightMap&&(i=t.lightMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uv2Transform.value.copy(i.matrix))}function Ae(e,t,n){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===g&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===g&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),(t.envMap||n)&&(e.envMapIntensity.value=t.envMapIntensity)}_e.setAnimationLoop((function(e){ce.isPresenting||ye&&ye(e)})),"undefined"!=typeof window&&_e.setContext(window),this.setAnimationLoop=function(e){ye=e,ce.setAnimationLoop(e),_e.start()},this.render=function(e,t){var n,r;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),n=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),r=arguments[3]),t&&t.isCamera){if(!O){F.geometry=null,F.program=null,F.wireframe=!1,U=-1,V=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),ce.enabled&&ce.isPresenting&&(t=ce.getCamera(t)),(h=A.get(e,t)).init(),e.onBeforeRender(k,e,t,n||N),oe.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),ee.setFromMatrix(oe),re=this.localClippingEnabled,ne=te.init(this.clippingPlanes,re,t),(d=x.get(e,t)).init(),be(e,t,0,k.sortObjects),!0===k.sortObjects&&d.sort(X,J),ne&&te.beginShadows();var i=h.state.shadowsArray;he.render(i,e,t),h.setupLights(t),ne&&te.endShadows(),this.info.autoReset&&this.info.reset(),void 0!==n&&this.setRenderTarget(n),ce.enabled&&de.isAvailable()&&de.attachCamera(t),M.render(d,e,t,r);var o=d.opaque,a=d.transparent;if(e.overrideMaterial){var s=e.overrideMaterial;o.length&&Ee(o,e,t,s),a.length&&Ee(a,e,t,s)}else o.length&&Ee(o,e,t),a.length&&Ee(a,e,t);e.onAfterRender(k,e,t),null!==N&&(b.updateRenderTargetMipmap(N),b.updateMultisampleRenderTarget(N)),v.buffers.depth.setTest(!0),v.buffers.depth.setMask(!0),v.buffers.color.setMask(!0),v.setPolygonOffset(!1),ce.enabled&&de.isAvailable()&&de.detachCamera(t),d=null,h=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFramebuffer=function(e){P!==e&&null===N&&f.bindFramebuffer(36160,e),P=e},this.getActiveCubeFace=function(){return I},this.getActiveMipmapLevel=function(){return D},this.getRenderTarget=function(){return N},this.setRenderTarget=function(e,t,n){N=e,I=t,D=n,e&&void 0===_.get(e).__webglFramebuffer&&b.setupRenderTarget(e);var r=P,i=!1;if(e){var o=_.get(e).__webglFramebuffer;e.isWebGLRenderTargetCube?(r=o[t||0],i=!0):r=e.isWebGLMultisampleRenderTarget?_.get(e).__webglMultisampledFramebuffer:o,H.copy(e.viewport),z.copy(e.scissor),W=e.scissorTest}else H.copy(Z).multiplyScalar(Y).floor(),z.copy($).multiplyScalar(Y).floor(),W=Q;if(B!==r&&(f.bindFramebuffer(36160,r),B=r),v.viewport(H),v.scissor(z),v.setScissorTest(W),i){var a=_.get(e.texture);f.framebufferTexture2D(36160,36064,34069+(t||0),a.__webglTexture,n||0)}},this.readRenderTargetPixels=function(e,t,n,r,i,o,a){if(e&&e.isWebGLRenderTarget){var s=_.get(e).__webglFramebuffer;if(e.isWebGLRenderTargetCube&&void 0!==a&&(s=s[a]),s){var u=!1;s!==B&&(f.bindFramebuffer(36160,s),u=!0);try{var l=e.texture,c=l.format,d=l.type;if(c!==ze&&C.convert(c)!==f.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(d===Le||C.convert(d)===f.getParameter(35738)||d===De&&(m.isWebGL2||p.get("OES_texture_float")||p.get("WEBGL_color_buffer_float"))||d===Ne&&(m.isWebGL2?p.get("EXT_color_buffer_float"):p.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===f.checkFramebufferStatus(36160)?t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i&&f.readPixels(t,n,r,i,C.convert(c),C.convert(d),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{u&&f.bindFramebuffer(36160,B)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,n){void 0===n&&(n=0);var r=Math.pow(2,-n),i=Math.floor(t.image.width*r),o=Math.floor(t.image.height*r),a=C.convert(t.format);b.setTexture2D(t,0),f.copyTexImage2D(3553,n,a,e.x,e.y,i,o,0),v.unbindTexture()},this.copyTextureToTexture=function(e,t,n,r){var i=t.image.width,o=t.image.height,a=C.convert(n.format),s=C.convert(n.type);b.setTexture2D(n,0),t.isDataTexture?f.texSubImage2D(3553,r||0,e.x,e.y,i,o,a,s,t.image.data):f.texSubImage2D(3553,r||0,e.x,e.y,a,s,t.image),v.unbindTexture()},this.initTexture=function(e){b.setTexture2D(e,0),v.unbindTexture()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function ys(e,t){this.name="",this.color=new ti(e),this.density=void 0!==t?t:25e-5}function _s(e,t,n){this.name="",this.color=new ti(e),this.near=void 0!==t?t:1,this.far=void 0!==n?n:1e3}function bs(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=hn,this.updateRange={offset:0,count:-1},this.version=0}hs.prototype=Object.assign(Object.create(Nn.prototype),{constructor:hs,isWebGLMultiviewRenderTarget:!0,copy:function(e){return Nn.prototype.copy.call(this,e),this.numViews=e.numViews,this},setNumViews:function(e){return this.numViews!==e&&(this.numViews=e,this.dispose()),this}}),ps.prototype=Object.assign(Object.create(uo.prototype),{constructor:ps,isArrayCamera:!0}),ms.prototype=Object.assign(Object.create(cr.prototype),{constructor:ms,isGroup:!0}),Object.assign(vs.prototype,En.prototype),Object.assign(ys.prototype,{isFogExp2:!0,clone:function(){return new ys(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}),Object.assign(_s.prototype,{isFog:!0,clone:function(){return new _s(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),Object.defineProperty(bs.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(bs.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this},copyAt:function(e,t,n){e*=this.stride,n*=t.stride;for(var r=0,i=this.stride;r<i;r++)this.array[e+r]=t.array[n+r];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}});var Es,ws=new Rn;function Ts(e,t,n,r){this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===r}function Ss(e){si.call(this),this.type="SpriteMaterial",this.color=new ti(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}Object.defineProperties(Ts.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(Ts.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(e){for(var t=0,n=this.data.count;t<n;t++)ws.x=this.getX(t),ws.y=this.getY(t),ws.z=this.getZ(t),ws.applyMatrix4(e),this.setXYZ(t,ws.x,ws.y,ws.z);return this},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this},setXYZ:function(e,t,n,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this},setXYZW:function(e,t,n,r,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=i,this}}),Ss.prototype=Object.create(si.prototype),Ss.prototype.constructor=Ss,Ss.prototype.isSpriteMaterial=!0,Ss.prototype.copy=function(e){return si.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this};var xs=new Rn,As=new Rn,Ms=new Rn,js=new xn,Rs=new xn,Ls=new qn,Cs=new Rn,ks=new Rn,Os=new Rn,Ps=new xn,Is=new xn,Ds=new xn;function Ns(e){if(cr.call(this),this.type="Sprite",void 0===Es){Es=new Ri;var t=new bs(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);Es.setIndex([0,1,2,0,2,3]),Es.setAttribute("position",new Ts(t,3,0,!1)),Es.setAttribute("uv",new Ts(t,2,3,!1))}this.geometry=Es,this.material=void 0!==e?e:new Ss,this.center=new xn(.5,.5)}function Bs(e,t,n,r,i,o){js.subVectors(e,n).addScalar(.5).multiply(r),void 0!==i?(Rs.x=o*js.x-i*js.y,Rs.y=i*js.x+o*js.y):Rs.copy(js),e.copy(t),e.x+=Rs.x,e.y+=Rs.y,e.applyMatrix4(Ls)}Ns.prototype=Object.assign(Object.create(cr.prototype),{constructor:Ns,isSprite:!0,raycast:function(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),As.setFromMatrixScale(this.matrixWorld),Ls.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Ms.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&As.multiplyScalar(-Ms.z);var n,r,i=this.material.rotation;0!==i&&(r=Math.cos(i),n=Math.sin(i));var o=this.center;Bs(Cs.set(-.5,-.5,0),Ms,o,As,n,r),Bs(ks.set(.5,-.5,0),Ms,o,As,n,r),Bs(Os.set(.5,.5,0),Ms,o,As,n,r),Ps.set(0,0),Is.set(1,0),Ds.set(1,1);var a=e.ray.intersectTriangle(Cs,ks,Os,!1,xs);if(null!==a||(Bs(ks.set(-.5,.5,0),Ms,o,As,n,r),Is.set(0,1),null!==(a=e.ray.intersectTriangle(Cs,Os,ks,!1,xs)))){var s=e.ray.origin.distanceTo(xs);s<e.near||s>e.far||t.push({distance:s,point:xs.clone(),uv:Zr.getUV(xs,Cs,ks,Os,Ps,Is,Ds,new xn),face:null,object:this})}},clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){return cr.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this}});var Us=new Rn,Fs=new Rn;function Vs(){cr.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function Gs(e,t){e&&e.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),Ki.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new qn,this.bindMatrixInverse=new qn}Vs.prototype=Object.assign(Object.create(cr.prototype),{constructor:Vs,isLOD:!0,copy:function(e){cr.prototype.copy.call(this,e,!1);for(var t=e.levels,n=0,r=t.length;n<r;n++){var i=t[n];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=e.autoUpdate,this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var n=this.levels,r=0;r<n.length&&!(t<n[r].distance);r++);return n.splice(r,0,{distance:t,object:e}),this.add(e),this},getObjectForDistance:function(e){var t=this.levels;if(t.length>0){for(var n=1,r=t.length;n<r&&!(e<t[n].distance);n++);return t[n-1].object}return null},raycast:function(e,t){if(this.levels.length>0){Us.setFromMatrixPosition(this.matrixWorld);var n=e.ray.origin.distanceTo(Us);this.getObjectForDistance(n).raycast(e,t)}},update:function(e){var t=this.levels;if(t.length>1){Us.setFromMatrixPosition(e.matrixWorld),Fs.setFromMatrixPosition(this.matrixWorld);var n=Us.distanceTo(Fs);t[0].object.visible=!0;for(var r=1,i=t.length;r<i&&n>=t[r].distance;r++)t[r-1].object.visible=!1,t[r].object.visible=!0;for(;r<i;r++)t[r].object.visible=!1}},toJSON:function(e){var t=cr.prototype.toJSON.call(this,e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];for(var n=this.levels,r=0,i=n.length;r<i;r++){var o=n[r];t.object.levels.push({object:o.object.uuid,distance:o.distance})}return t}}),Gs.prototype=Object.assign(Object.create(Ki.prototype),{constructor:Gs,isSkinnedMesh:!0,bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var e=new Dn,t=this.geometry.attributes.skinWeight,n=0,r=t.count;n<r;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);var i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){Ki.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Hs=new qn,zs=new qn;function Ws(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var n=0,r=this.bones.length;n<r;n++)this.boneInverses.push(new qn)}}function qs(){cr.call(this),this.type="Bone"}Object.assign(Ws.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var n=new qn;this.bones[e]&&n.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(n)}},pose:function(){var e,t,n;for(t=0,n=this.bones.length;t<n;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,n=this.bones.length;t<n;t++)(e=this.bones[t])&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:function(){for(var e=this.bones,t=this.boneInverses,n=this.boneMatrices,r=this.boneTexture,i=0,o=e.length;i<o;i++){var a=e[i]?e[i].matrixWorld:zs;Hs.multiplyMatrices(a,t[i]),Hs.toArray(n,16*i)}void 0!==r&&(r.needsUpdate=!0)},clone:function(){return new Ws(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,n=this.bones.length;t<n;t++){var r=this.bones[t];if(r.name===e)return r}}}),qs.prototype=Object.assign(Object.create(cr.prototype),{constructor:qs,isBone:!0});var Ks=new qn,Ys=new qn,Xs=[],Js=new Ki;function Zs(e,t,n){Ki.call(this,e,t),this.instanceMatrix=new ci(new Float32Array(16*n),16),this.count=n}function $s(e){si.call(this),this.type="LineBasicMaterial",this.color=new ti(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}Zs.prototype=Object.assign(Object.create(Ki.prototype),{constructor:Zs,isInstancedMesh:!0,getMatrixAt:function(e,t){t.fromArray(this.instanceMatrix.array,16*e)},raycast:function(e,t){var n=this.matrixWorld,r=this.count;if(Js.geometry=this.geometry,Js.material=this.material,void 0!==Js.material)for(var i=0;i<r;i++)this.getMatrixAt(i,Ks),Ys.multiplyMatrices(n,Ks),Js.matrixWorld=Ys,Js.raycast(e,Xs),Xs.length>0&&(Xs[0].instanceId=i,Xs[0].object=this,t.push(Xs[0]),Xs.length=0)},setMatrixAt:function(e,t){t.toArray(this.instanceMatrix.array,16*e)},updateMorphTargets:function(){}}),$s.prototype=Object.create(si.prototype),$s.prototype.constructor=$s,$s.prototype.isLineBasicMaterial=!0,$s.prototype.copy=function(e){return si.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this};var Qs=new Rn,eu=new Rn,tu=new qn,nu=new Dr,ru=new jr;function iu(e,t,n){1===n&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),cr.call(this),this.type="Line",this.geometry=void 0!==e?e:new Ri,this.material=void 0!==t?t:new $s({color:16777215*Math.random()})}iu.prototype=Object.assign(Object.create(cr.prototype),{constructor:iu,isLine:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,n=[0],r=1,i=t.count;r<i;r++)Qs.fromBufferAttribute(t,r-1),eu.fromBufferAttribute(t,r),n[r]=n[r-1],n[r]+=Qs.distanceTo(eu);e.setAttribute("lineDistance",new yi(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var o=e.vertices;(n=e.lineDistances)[0]=0;for(r=1,i=o.length;r<i;r++)n[r]=n[r-1],n[r]+=o[r-1].distanceTo(o[r])}return this},raycast:function(e,t){var n=e.linePrecision,r=this.geometry,i=this.matrixWorld;if(null===r.boundingSphere&&r.computeBoundingSphere(),ru.copy(r.boundingSphere),ru.applyMatrix4(i),ru.radius+=n,!1!==e.ray.intersectsSphere(ru)){tu.getInverse(i),nu.copy(e.ray).applyMatrix4(tu);var o=n/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,s=new Rn,u=new Rn,l=new Rn,c=new Rn,d=this&&this.isLineSegments?2:1;if(r.isBufferGeometry){var h=r.index,f=r.attributes.position.array;if(null!==h)for(var p=h.array,m=0,v=p.length-1;m<v;m+=d){var g=p[m],y=p[m+1];if(s.fromArray(f,3*g),u.fromArray(f,3*y),!(nu.distanceSqToSegment(s,u,c,l)>a))c.applyMatrix4(this.matrixWorld),(E=e.ray.origin.distanceTo(c))<e.near||E>e.far||t.push({distance:E,point:l.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}else for(m=0,v=f.length/3-1;m<v;m+=d){if(s.fromArray(f,3*m),u.fromArray(f,3*m+3),!(nu.distanceSqToSegment(s,u,c,l)>a))c.applyMatrix4(this.matrixWorld),(E=e.ray.origin.distanceTo(c))<e.near||E>e.far||t.push({distance:E,point:l.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}}else if(r.isGeometry){var _=r.vertices,b=_.length;for(m=0;m<b-1;m+=d){var E;if(!(nu.distanceSqToSegment(_[m],_[m+1],c,l)>a))c.applyMatrix4(this.matrixWorld),(E=e.ray.origin.distanceTo(c))<e.near||E>e.far||t.push({distance:E,point:l.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var ou=new Rn,au=new Rn;function su(e,t){iu.call(this,e,t),this.type="LineSegments"}function uu(e,t){iu.call(this,e,t),this.type="LineLoop"}function lu(e){si.call(this),this.type="PointsMaterial",this.color=new ti(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}su.prototype=Object.assign(Object.create(iu.prototype),{constructor:su,isLineSegments:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,n=[],r=0,i=t.count;r<i;r+=2)ou.fromBufferAttribute(t,r),au.fromBufferAttribute(t,r+1),n[r]=0===r?0:n[r-1],n[r+1]=n[r]+ou.distanceTo(au);e.setAttribute("lineDistance",new yi(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var o=e.vertices;for(n=e.lineDistances,r=0,i=o.length;r<i;r+=2)ou.copy(o[r]),au.copy(o[r+1]),n[r]=0===r?0:n[r-1],n[r+1]=n[r]+ou.distanceTo(au)}return this}}),uu.prototype=Object.assign(Object.create(iu.prototype),{constructor:uu,isLineLoop:!0}),lu.prototype=Object.create(si.prototype),lu.prototype.constructor=lu,lu.prototype.isPointsMaterial=!0,lu.prototype.copy=function(e){return si.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this};var cu=new qn,du=new Dr,hu=new jr,fu=new Rn;function pu(e,t){cr.call(this),this.type="Points",this.geometry=void 0!==e?e:new Ri,this.material=void 0!==t?t:new lu({color:16777215*Math.random()}),this.updateMorphTargets()}function mu(e,t,n,r,i,o,a){var s=du.distanceSqToPoint(e);if(s<n){var u=new Rn;du.closestPointToPoint(e,u),u.applyMatrix4(r);var l=i.ray.origin.distanceTo(u);if(l<i.near||l>i.far)return;o.push({distance:l,distanceToRay:Math.sqrt(s),point:u,index:t,face:null,object:a})}}function vu(e,t,n,r,i,o,a,s,u){In.call(this,e,t,n,r,i,o,a,s,u),this.format=void 0!==a?a:He,this.minFilter=void 0!==o?o:xe,this.magFilter=void 0!==i?i:xe,this.generateMipmaps=!1}function gu(e,t,n,r,i,o,a,s,u,l,c,d){In.call(this,null,o,a,s,u,l,r,i,c,d),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function yu(e,t,n,r,i,o,a,s,u){In.call(this,e,t,n,r,i,o,a,s,u),this.needsUpdate=!0}function _u(e,t,n,r,i,o,a,s,u,l){if((l=void 0!==l?l:Ye)!==Ye&&l!==Xe)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&l===Ye&&(n=Oe),void 0===n&&l===Xe&&(n=Ve),In.call(this,null,r,i,o,a,s,l,n,u),this.image={width:e,height:t},this.magFilter=void 0!==a?a:be,this.minFilter=void 0!==s?s:be,this.flipY=!1,this.generateMipmaps=!1}function bu(e){Ri.call(this),this.type="WireframeGeometry";var t,n,r,i,o,a,s,u,l,c,d=[],h=[0,0],f={},p=["a","b","c"];if(e&&e.isGeometry){var m=e.faces;for(t=0,r=m.length;t<r;t++){var v=m[t];for(n=0;n<3;n++)s=v[p[n]],u=v[p[(n+1)%3]],h[0]=Math.min(s,u),h[1]=Math.max(s,u),void 0===f[l=h[0]+","+h[1]]&&(f[l]={index1:h[0],index2:h[1]})}for(l in f)a=f[l],c=e.vertices[a.index1],d.push(c.x,c.y,c.z),c=e.vertices[a.index2],d.push(c.x,c.y,c.z)}else if(e&&e.isBufferGeometry){var g,y,_,b,E,w,T;if(c=new Rn,null!==e.index){for(g=e.attributes.position,y=e.index,0===(_=e.groups).length&&(_=[{start:0,count:y.count,materialIndex:0}]),i=0,o=_.length;i<o;++i)for(t=E=(b=_[i]).start,r=E+b.count;t<r;t+=3)for(n=0;n<3;n++)s=y.getX(t+n),u=y.getX(t+(n+1)%3),h[0]=Math.min(s,u),h[1]=Math.max(s,u),void 0===f[l=h[0]+","+h[1]]&&(f[l]={index1:h[0],index2:h[1]});for(l in f)a=f[l],c.fromBufferAttribute(g,a.index1),d.push(c.x,c.y,c.z),c.fromBufferAttribute(g,a.index2),d.push(c.x,c.y,c.z)}else for(t=0,r=(g=e.attributes.position).count/3;t<r;t++)for(n=0;n<3;n++)w=3*t+n,c.fromBufferAttribute(g,w),d.push(c.x,c.y,c.z),T=3*t+(n+1)%3,c.fromBufferAttribute(g,T),d.push(c.x,c.y,c.z)}this.setAttribute("position",new yi(d,3))}function Eu(e,t,n){eo.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:n},this.fromBufferGeometry(new wu(e,t,n)),this.mergeVertices()}function wu(e,t,n){Ri.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:n};var r,i,o=[],a=[],s=[],u=[],l=1e-5,c=new Rn,d=new Rn,h=new Rn,f=new Rn,p=new Rn;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var m=t+1;for(r=0;r<=n;r++){var v=r/n;for(i=0;i<=t;i++){var g=i/t;e(g,v,d),a.push(d.x,d.y,d.z),g-l>=0?(e(g-l,v,h),f.subVectors(d,h)):(e(g+l,v,h),f.subVectors(h,d)),v-l>=0?(e(g,v-l,h),p.subVectors(d,h)):(e(g,v+l,h),p.subVectors(h,d)),c.crossVectors(f,p).normalize(),s.push(c.x,c.y,c.z),u.push(g,v)}}for(r=0;r<n;r++)for(i=0;i<t;i++){var y=r*m+i,_=r*m+i+1,b=(r+1)*m+i+1,E=(r+1)*m+i;o.push(y,_,E),o.push(_,b,E)}this.setIndex(o),this.setAttribute("position",new yi(a,3)),this.setAttribute("normal",new yi(s,3)),this.setAttribute("uv",new yi(u,2))}function Tu(e,t,n,r){eo.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r},this.fromBufferGeometry(new Su(e,t,n,r)),this.mergeVertices()}function Su(e,t,n,r){Ri.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r},n=n||1;var i=[],o=[];function a(e,t,n,r){var i,o,a=Math.pow(2,r),u=[];for(i=0;i<=a;i++){u[i]=[];var l=e.clone().lerp(n,i/a),c=t.clone().lerp(n,i/a),d=a-i;for(o=0;o<=d;o++)u[i][o]=0===o&&i===a?l:l.clone().lerp(c,o/d)}for(i=0;i<a;i++)for(o=0;o<2*(a-i)-1;o++){var h=Math.floor(o/2);o%2==0?(s(u[i][h+1]),s(u[i+1][h]),s(u[i][h])):(s(u[i][h+1]),s(u[i+1][h+1]),s(u[i+1][h]))}}function s(e){i.push(e.x,e.y,e.z)}function u(t,n){var r=3*t;n.x=e[r+0],n.y=e[r+1],n.z=e[r+2]}function l(e,t,n,r){r<0&&1===e.x&&(o[t]=e.x-1),0===n.x&&0===n.z&&(o[t]=r/2/Math.PI+.5)}function c(e){return Math.atan2(e.z,-e.x)}!function(e){for(var n=new Rn,r=new Rn,i=new Rn,o=0;o<t.length;o+=3)u(t[o+0],n),u(t[o+1],r),u(t[o+2],i),a(n,r,i,e)}(r=r||0),function(e){for(var t=new Rn,n=0;n<i.length;n+=3)t.x=i[n+0],t.y=i[n+1],t.z=i[n+2],t.normalize().multiplyScalar(e),i[n+0]=t.x,i[n+1]=t.y,i[n+2]=t.z}(n),function(){for(var e=new Rn,t=0;t<i.length;t+=3){e.x=i[t+0],e.y=i[t+1],e.z=i[t+2];var n=c(e)/2/Math.PI+.5,r=(a=e,Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))/Math.PI+.5);o.push(n,1-r)}var a;(function(){for(var e=new Rn,t=new Rn,n=new Rn,r=new Rn,a=new xn,s=new xn,u=new xn,d=0,h=0;d<i.length;d+=9,h+=6){e.set(i[d+0],i[d+1],i[d+2]),t.set(i[d+3],i[d+4],i[d+5]),n.set(i[d+6],i[d+7],i[d+8]),a.set(o[h+0],o[h+1]),s.set(o[h+2],o[h+3]),u.set(o[h+4],o[h+5]),r.copy(e).add(t).add(n).divideScalar(3);var f=c(r);l(a,h+0,e,f),l(s,h+2,t,f),l(u,h+4,n,f)}})(),function(){for(var e=0;e<o.length;e+=6){var t=o[e+0],n=o[e+2],r=o[e+4],i=Math.max(t,n,r),a=Math.min(t,n,r);i>.9&&a<.1&&(t<.2&&(o[e+0]+=1),n<.2&&(o[e+2]+=1),r<.2&&(o[e+4]+=1))}}()}(),this.setAttribute("position",new yi(i,3)),this.setAttribute("normal",new yi(i.slice(),3)),this.setAttribute("uv",new yi(o,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}function xu(e,t){eo.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Au(e,t)),this.mergeVertices()}function Au(e,t){Su.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Mu(e,t){eo.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new ju(e,t)),this.mergeVertices()}function ju(e,t){Su.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Ru(e,t){eo.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Lu(e,t)),this.mergeVertices()}function Lu(e,t){var n=(1+Math.sqrt(5))/2,r=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1];Su.call(this,r,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Cu(e,t){eo.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new ku(e,t)),this.mergeVertices()}function ku(e,t){var n=(1+Math.sqrt(5))/2,r=1/n,i=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r];Su.call(this,i,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Ou(e,t,n,r,i,o){eo.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:i},void 0!==o&&console.warn("THREE.TubeGeometry: taper has been removed.");var a=new Pu(e,t,n,r,i);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals,this.fromBufferGeometry(a),this.mergeVertices()}function Pu(e,t,n,r,i){Ri.call(this),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:i},t=t||64,n=n||1,r=r||8,i=i||!1;var o=e.computeFrenetFrames(t,i);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;var a,s,u=new Rn,l=new Rn,c=new xn,d=new Rn,h=[],f=[],p=[],m=[];function v(i){d=e.getPointAt(i/t,d);var a=o.normals[i],c=o.binormals[i];for(s=0;s<=r;s++){var p=s/r*Math.PI*2,m=Math.sin(p),v=-Math.cos(p);l.x=v*a.x+m*c.x,l.y=v*a.y+m*c.y,l.z=v*a.z+m*c.z,l.normalize(),f.push(l.x,l.y,l.z),u.x=d.x+n*l.x,u.y=d.y+n*l.y,u.z=d.z+n*l.z,h.push(u.x,u.y,u.z)}}!function(){for(a=0;a<t;a++)v(a);v(!1===i?t:0),function(){for(a=0;a<=t;a++)for(s=0;s<=r;s++)c.x=a/t,c.y=s/r,p.push(c.x,c.y)}(),function(){for(s=1;s<=t;s++)for(a=1;a<=r;a++){var e=(r+1)*(s-1)+(a-1),n=(r+1)*s+(a-1),i=(r+1)*s+a,o=(r+1)*(s-1)+a;m.push(e,n,o),m.push(n,i,o)}}()}(),this.setIndex(m),this.setAttribute("position",new yi(h,3)),this.setAttribute("normal",new yi(f,3)),this.setAttribute("uv",new yi(p,2))}function Iu(e,t,n,r,i,o,a){eo.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:r,p:i,q:o},void 0!==a&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new Du(e,t,n,r,i,o)),this.mergeVertices()}function Du(e,t,n,r,i,o){Ri.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:r,p:i,q:o},e=e||1,t=t||.4,n=Math.floor(n)||64,r=Math.floor(r)||8,i=i||2,o=o||3;var a,s,u=[],l=[],c=[],d=[],h=new Rn,f=new Rn,p=new Rn,m=new Rn,v=new Rn,g=new Rn,y=new Rn;for(a=0;a<=n;++a){var _=a/n*i*Math.PI*2;for(M(_,i,o,e,p),M(_+.01,i,o,e,m),g.subVectors(m,p),y.addVectors(m,p),v.crossVectors(g,y),y.crossVectors(v,g),v.normalize(),y.normalize(),s=0;s<=r;++s){var b=s/r*Math.PI*2,E=-t*Math.cos(b),w=t*Math.sin(b);h.x=p.x+(E*y.x+w*v.x),h.y=p.y+(E*y.y+w*v.y),h.z=p.z+(E*y.z+w*v.z),l.push(h.x,h.y,h.z),f.subVectors(h,p).normalize(),c.push(f.x,f.y,f.z),d.push(a/n),d.push(s/r)}}for(s=1;s<=n;s++)for(a=1;a<=r;a++){var T=(r+1)*(s-1)+(a-1),S=(r+1)*s+(a-1),x=(r+1)*s+a,A=(r+1)*(s-1)+a;u.push(T,S,A),u.push(S,x,A)}function M(e,t,n,r,i){var o=Math.cos(e),a=Math.sin(e),s=n/t*e,u=Math.cos(s);i.x=r*(2+u)*.5*o,i.y=r*(2+u)*a*.5,i.z=r*Math.sin(s)*.5}this.setIndex(u),this.setAttribute("position",new yi(l,3)),this.setAttribute("normal",new yi(c,3)),this.setAttribute("uv",new yi(d,2))}function Nu(e,t,n,r,i){eo.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:i},this.fromBufferGeometry(new Bu(e,t,n,r,i)),this.mergeVertices()}function Bu(e,t,n,r,i){Ri.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:i},e=e||1,t=t||.4,n=Math.floor(n)||8,r=Math.floor(r)||6,i=i||2*Math.PI;var o,a,s=[],u=[],l=[],c=[],d=new Rn,h=new Rn,f=new Rn;for(o=0;o<=n;o++)for(a=0;a<=r;a++){var p=a/r*i,m=o/n*Math.PI*2;h.x=(e+t*Math.cos(m))*Math.cos(p),h.y=(e+t*Math.cos(m))*Math.sin(p),h.z=t*Math.sin(m),u.push(h.x,h.y,h.z),d.x=e*Math.cos(p),d.y=e*Math.sin(p),f.subVectors(h,d).normalize(),l.push(f.x,f.y,f.z),c.push(a/r),c.push(o/n)}for(o=1;o<=n;o++)for(a=1;a<=r;a++){var v=(r+1)*o+a-1,g=(r+1)*(o-1)+a-1,y=(r+1)*(o-1)+a,_=(r+1)*o+a;s.push(v,g,_),s.push(g,y,_)}this.setIndex(s),this.setAttribute("position",new yi(u,3)),this.setAttribute("normal",new yi(l,3)),this.setAttribute("uv",new yi(c,2))}pu.prototype=Object.assign(Object.create(cr.prototype),{constructor:pu,isPoints:!0,raycast:function(e,t){var n=this.geometry,r=this.matrixWorld,i=e.params.Points.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),hu.copy(n.boundingSphere),hu.applyMatrix4(r),hu.radius+=i,!1!==e.ray.intersectsSphere(hu)){cu.getInverse(r),du.copy(e.ray).applyMatrix4(cu);var o=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o;if(n.isBufferGeometry){var s=n.index,u=n.attributes.position.array;if(null!==s)for(var l=s.array,c=0,d=l.length;c<d;c++){var h=l[c];fu.fromArray(u,3*h),mu(fu,h,a,r,e,t,this)}else{c=0;for(var f=u.length/3;c<f;c++)fu.fromArray(u,3*c),mu(fu,c,a,r,e,t,this)}}else{var p=n.vertices;for(c=0,f=p.length;c<f;c++)mu(p[c],c,a,r,e,t,this)}}},updateMorphTargets:function(){var e,t,n,r=this.geometry;if(r.isBufferGeometry){var i=r.morphAttributes,o=Object.keys(i);if(o.length>0){var a=i[o[0]];if(void 0!==a)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=a.length;e<t;e++)n=a[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}else{var s=r.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),vu.prototype=Object.assign(Object.create(In.prototype),{constructor:vu,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),gu.prototype=Object.create(In.prototype),gu.prototype.constructor=gu,gu.prototype.isCompressedTexture=!0,yu.prototype=Object.create(In.prototype),yu.prototype.constructor=yu,yu.prototype.isCanvasTexture=!0,_u.prototype=Object.create(In.prototype),_u.prototype.constructor=_u,_u.prototype.isDepthTexture=!0,bu.prototype=Object.create(Ri.prototype),bu.prototype.constructor=bu,Eu.prototype=Object.create(eo.prototype),Eu.prototype.constructor=Eu,wu.prototype=Object.create(Ri.prototype),wu.prototype.constructor=wu,Tu.prototype=Object.create(eo.prototype),Tu.prototype.constructor=Tu,Su.prototype=Object.create(Ri.prototype),Su.prototype.constructor=Su,xu.prototype=Object.create(eo.prototype),xu.prototype.constructor=xu,Au.prototype=Object.create(Su.prototype),Au.prototype.constructor=Au,Mu.prototype=Object.create(eo.prototype),Mu.prototype.constructor=Mu,ju.prototype=Object.create(Su.prototype),ju.prototype.constructor=ju,Ru.prototype=Object.create(eo.prototype),Ru.prototype.constructor=Ru,Lu.prototype=Object.create(Su.prototype),Lu.prototype.constructor=Lu,Cu.prototype=Object.create(eo.prototype),Cu.prototype.constructor=Cu,ku.prototype=Object.create(Su.prototype),ku.prototype.constructor=ku,Ou.prototype=Object.create(eo.prototype),Ou.prototype.constructor=Ou,Pu.prototype=Object.create(Ri.prototype),Pu.prototype.constructor=Pu,Pu.prototype.toJSON=function(){var e=Ri.prototype.toJSON.call(this);return e.path=this.parameters.path.toJSON(),e},Iu.prototype=Object.create(eo.prototype),Iu.prototype.constructor=Iu,Du.prototype=Object.create(Ri.prototype),Du.prototype.constructor=Du,Nu.prototype=Object.create(eo.prototype),Nu.prototype.constructor=Nu,Bu.prototype=Object.create(Ri.prototype),Bu.prototype.constructor=Bu;var Uu=function(e,t,n){n=n||2;var r,i,o,a,s,u,l,c=t&&t.length,d=c?t[0]*n:e.length,h=Fu(e,0,d,n,!0),f=[];if(!h||h.next===h.prev)return f;if(c&&(h=function(e,t,n,r){var i,o,a,s,u,l=[];for(i=0,o=t.length;i<o;i++)a=t[i]*r,s=i<o-1?t[i+1]*r:e.length,(u=Fu(e,a,s,r,!1))===u.next&&(u.steiner=!0),l.push(Ju(u));for(l.sort(Ku),i=0;i<l.length;i++)Yu(l[i],n),n=Vu(n,n.next);return n}(e,t,h,n)),e.length>80*n){r=o=e[0],i=a=e[1];for(var p=n;p<d;p+=n)(s=e[p])<r&&(r=s),(u=e[p+1])<i&&(i=u),s>o&&(o=s),u>a&&(a=u);l=0!==(l=Math.max(o-r,a-i))?1/l:0}return Gu(h,f,n,r,i,l),f};function Fu(e,t,n,r,i){var o,a;if(i===function(e,t,n,r){for(var i=0,o=t,a=n-r;o<n;o+=r)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}(e,t,n,r)>0)for(o=t;o<n;o+=r)a=il(o,e[o],e[o+1],a);else for(o=n-r;o>=t;o-=r)a=il(o,e[o],e[o+1],a);return a&&el(a,a.next)&&(ol(a),a=a.next),a}function Vu(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!el(r,r.next)&&0!==Qu(r.prev,r,r.next))r=r.next;else{if(ol(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function Gu(e,t,n,r,i,o,a){if(e){!a&&o&&function(e,t,n,r){var i=e;do{null===i.z&&(i.z=Xu(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,o,a,s,u,l=1;do{for(n=e,e=null,o=null,a=0;n;){for(a++,r=n,s=0,t=0;t<l&&(s++,r=r.nextZ);t++);for(u=l;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,l*=2}while(a>1)}(i)}(e,r,i,o);for(var s,u,l=e;e.prev!==e.next;)if(s=e.prev,u=e.next,o?zu(e,r,i,o):Hu(e))t.push(s.i/n),t.push(e.i/n),t.push(u.i/n),ol(e),e=u.next,l=u.next;else if((e=u)===l){a?1===a?Gu(e=Wu(e,t,n),t,n,r,i,o,2):2===a&&qu(e,t,n,r,i,o):Gu(Vu(e),t,n,r,i,o,1);break}}}function Hu(e){var t=e.prev,n=e,r=e.next;if(Qu(t,n,r)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(Zu(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&Qu(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function zu(e,t,n,r){var i=e.prev,o=e,a=e.next;if(Qu(i,o,a)>=0)return!1;for(var s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,u=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,l=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,c=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,d=Xu(s,u,t,n,r),h=Xu(l,c,t,n,r),f=e.prevZ,p=e.nextZ;f&&f.z>=d&&p&&p.z<=h;){if(f!==e.prev&&f!==e.next&&Zu(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&Qu(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,p!==e.prev&&p!==e.next&&Zu(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&Qu(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;f&&f.z>=d;){if(f!==e.prev&&f!==e.next&&Zu(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&Qu(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=h;){if(p!==e.prev&&p!==e.next&&Zu(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&Qu(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function Wu(e,t,n){var r=e;do{var i=r.prev,o=r.next.next;!el(i,o)&&tl(i,r,r.next,o)&&nl(i,o)&&nl(o,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(o.i/n),ol(r),ol(r.next),r=e=o),r=r.next}while(r!==e);return r}function qu(e,t,n,r,i,o){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&$u(a,s)){var u=rl(a,s);return a=Vu(a,a.next),u=Vu(u,u.next),Gu(a,t,n,r,i,o),void Gu(u,t,n,r,i,o)}s=s.next}a=a.next}while(a!==e)}function Ku(e,t){return e.x-t.x}function Yu(e,t){if(t=function(e,t){var n,r=t,i=e.x,o=e.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a){if(a=s,s===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(i===a)return n.prev;var u,l=n,c=n.x,d=n.y,h=1/0;r=n.next;for(;r!==l;)i>=r.x&&r.x>=c&&i!==r.x&&Zu(o<d?i:a,o,c,d,o<d?a:i,o,r.x,r.y)&&((u=Math.abs(o-r.y)/(i-r.x))<h||u===h&&r.x>n.x)&&nl(r,e)&&(n=r,h=u),r=r.next;return n}(e,t)){var n=rl(t,e);Vu(n,n.next)}}function Xu(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Ju(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Zu(e,t,n,r,i,o,a,s){return(i-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(r-s)-(n-a)*(t-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function $u(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&tl(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&nl(e,t)&&nl(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)}function Qu(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function el(e,t){return e.x===t.x&&e.y===t.y}function tl(e,t,n,r){return!!(el(e,n)&&el(t,r)||el(e,r)&&el(n,t))||Qu(e,t,n)>0!=Qu(e,t,r)>0&&Qu(n,r,e)>0!=Qu(n,r,t)>0}function nl(e,t){return Qu(e.prev,e,e.next)<0?Qu(e,t,e.next)>=0&&Qu(e,e.prev,t)>=0:Qu(e,t,e.prev)<0||Qu(e,e.next,t)<0}function rl(e,t){var n=new al(e.i,e.x,e.y),r=new al(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function il(e,t,n,r){var i=new al(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function ol(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function al(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var sl={area:function(e){for(var t=e.length,n=0,r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return.5*n},isClockWise:function(e){return sl.area(e)<0},triangulateShape:function(e,t){var n=[],r=[],i=[];ul(e),ll(n,e);var o=e.length;t.forEach(ul);for(var a=0;a<t.length;a++)r.push(o),o+=t[a].length,ll(n,t[a]);var s=Uu(n,r);for(a=0;a<s.length;a+=3)i.push(s.slice(a,a+3));return i}};function ul(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function ll(e,t){for(var n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}function cl(e,t){eo.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new dl(e,t)),this.mergeVertices()}function dl(e,t){Ri.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];for(var n=this,r=[],i=[],o=0,a=e.length;o<a;o++){s(e[o])}function s(e){var o=[],a=void 0!==t.curveSegments?t.curveSegments:12,s=void 0!==t.steps?t.steps:1,u=void 0!==t.depth?t.depth:100,l=void 0===t.bevelEnabled||t.bevelEnabled,c=void 0!==t.bevelThickness?t.bevelThickness:6,d=void 0!==t.bevelSize?t.bevelSize:c-2,h=void 0!==t.bevelOffset?t.bevelOffset:0,f=void 0!==t.bevelSegments?t.bevelSegments:3,p=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:hl;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),u=t.amount);var v,g,y,_,b,E,w,T,S=!1;p&&(v=p.getSpacedPoints(s),S=!0,l=!1,g=p.computeFrenetFrames(s,!1),y=new Rn,_=new Rn,b=new Rn),l||(f=0,c=0,d=0,h=0);var x=e.extractPoints(a),A=x.shape,M=x.holes;if(!sl.isClockWise(A))for(A=A.reverse(),w=0,T=M.length;w<T;w++)E=M[w],sl.isClockWise(E)&&(M[w]=E.reverse());var j=sl.triangulateShape(A,M),R=A;for(w=0,T=M.length;w<T;w++)E=M[w],A=A.concat(E);function L(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}var C,k,O,P,I,D,N=A.length,B=j.length;function U(e,t,n){var r,i,o,a=e.x-t.x,s=e.y-t.y,u=n.x-e.x,l=n.y-e.y,c=a*a+s*s,d=a*l-s*u;if(Math.abs(d)>Number.EPSILON){var h=Math.sqrt(c),f=Math.sqrt(u*u+l*l),p=t.x-s/h,m=t.y+a/h,v=((n.x-l/f-p)*l-(n.y+u/f-m)*u)/(a*l-s*u),g=(r=p+a*v-e.x)*r+(i=m+s*v-e.y)*i;if(g<=2)return new xn(r,i);o=Math.sqrt(g/2)}else{var y=!1;a>Number.EPSILON?u>Number.EPSILON&&(y=!0):a<-Number.EPSILON?u<-Number.EPSILON&&(y=!0):Math.sign(s)===Math.sign(l)&&(y=!0),y?(r=-s,i=a,o=Math.sqrt(c)):(r=a,i=s,o=Math.sqrt(c/2))}return new xn(r/o,i/o)}for(var F=[],V=0,G=R.length,H=G-1,z=V+1;V<G;V++,H++,z++)H===G&&(H=0),z===G&&(z=0),F[V]=U(R[V],R[H],R[z]);var W,q,K=[],Y=F.concat();for(w=0,T=M.length;w<T;w++){for(E=M[w],W=[],V=0,H=(G=E.length)-1,z=V+1;V<G;V++,H++,z++)H===G&&(H=0),z===G&&(z=0),W[V]=U(E[V],E[H],E[z]);K.push(W),Y=Y.concat(W)}for(C=0;C<f;C++){for(O=C/f,P=c*Math.cos(O*Math.PI/2),k=d*Math.sin(O*Math.PI/2)+h,V=0,G=R.length;V<G;V++)J((I=L(R[V],F[V],k)).x,I.y,-P);for(w=0,T=M.length;w<T;w++)for(E=M[w],W=K[w],V=0,G=E.length;V<G;V++)J((I=L(E[V],W[V],k)).x,I.y,-P)}for(k=d+h,V=0;V<N;V++)I=l?L(A[V],Y[V],k):A[V],S?(_.copy(g.normals[0]).multiplyScalar(I.x),y.copy(g.binormals[0]).multiplyScalar(I.y),b.copy(v[0]).add(_).add(y),J(b.x,b.y,b.z)):J(I.x,I.y,0);for(q=1;q<=s;q++)for(V=0;V<N;V++)I=l?L(A[V],Y[V],k):A[V],S?(_.copy(g.normals[q]).multiplyScalar(I.x),y.copy(g.binormals[q]).multiplyScalar(I.y),b.copy(v[q]).add(_).add(y),J(b.x,b.y,b.z)):J(I.x,I.y,u/s*q);for(C=f-1;C>=0;C--){for(O=C/f,P=c*Math.cos(O*Math.PI/2),k=d*Math.sin(O*Math.PI/2)+h,V=0,G=R.length;V<G;V++)J((I=L(R[V],F[V],k)).x,I.y,u+P);for(w=0,T=M.length;w<T;w++)for(E=M[w],W=K[w],V=0,G=E.length;V<G;V++)I=L(E[V],W[V],k),S?J(I.x,I.y+v[s-1].y,v[s-1].x+P):J(I.x,I.y,u+P)}function X(e,t){var n,r;for(V=e.length;--V>=0;){n=V,(r=V-1)<0&&(r=e.length-1);var i=0,o=s+2*f;for(i=0;i<o;i++){var a=N*i,u=N*(i+1);$(t+n+a,t+r+a,t+r+u,t+n+u)}}}function J(e,t,n){o.push(e),o.push(t),o.push(n)}function Z(e,t,i){Q(e),Q(t),Q(i);var o=r.length/3,a=m.generateTopUV(n,r,o-3,o-2,o-1);ee(a[0]),ee(a[1]),ee(a[2])}function $(e,t,i,o){Q(e),Q(t),Q(o),Q(t),Q(i),Q(o);var a=r.length/3,s=m.generateSideWallUV(n,r,a-6,a-3,a-2,a-1);ee(s[0]),ee(s[1]),ee(s[3]),ee(s[1]),ee(s[2]),ee(s[3])}function Q(e){r.push(o[3*e+0]),r.push(o[3*e+1]),r.push(o[3*e+2])}function ee(e){i.push(e.x),i.push(e.y)}!function(){var e=r.length/3;if(l){var t=0,i=N*t;for(V=0;V<B;V++)Z((D=j[V])[2]+i,D[1]+i,D[0]+i);for(i=N*(t=s+2*f),V=0;V<B;V++)Z((D=j[V])[0]+i,D[1]+i,D[2]+i)}else{for(V=0;V<B;V++)Z((D=j[V])[2],D[1],D[0]);for(V=0;V<B;V++)Z((D=j[V])[0]+N*s,D[1]+N*s,D[2]+N*s)}n.addGroup(e,r.length/3-e,0)}(),function(){var e=r.length/3,t=0;for(X(R,t),t+=R.length,w=0,T=M.length;w<T;w++)X(E=M[w],t),t+=E.length;n.addGroup(e,r.length/3-e,1)}()}this.setAttribute("position",new yi(r,3)),this.setAttribute("uv",new yi(i,2)),this.computeVertexNormals()}cl.prototype=Object.create(eo.prototype),cl.prototype.constructor=cl,cl.prototype.toJSON=function(){var e=eo.prototype.toJSON.call(this);return fl(this.parameters.shapes,this.parameters.options,e)},dl.prototype=Object.create(Ri.prototype),dl.prototype.constructor=dl,dl.prototype.toJSON=function(){var e=Ri.prototype.toJSON.call(this);return fl(this.parameters.shapes,this.parameters.options,e)};var hl={generateTopUV:function(e,t,n,r,i){var o=t[3*n],a=t[3*n+1],s=t[3*r],u=t[3*r+1],l=t[3*i],c=t[3*i+1];return[new xn(o,a),new xn(s,u),new xn(l,c)]},generateSideWallUV:function(e,t,n,r,i,o){var a=t[3*n],s=t[3*n+1],u=t[3*n+2],l=t[3*r],c=t[3*r+1],d=t[3*r+2],h=t[3*i],f=t[3*i+1],p=t[3*i+2],m=t[3*o],v=t[3*o+1],g=t[3*o+2];return Math.abs(s-c)<.01?[new xn(a,1-u),new xn(l,1-d),new xn(h,1-p),new xn(m,1-g)]:[new xn(s,1-u),new xn(c,1-d),new xn(f,1-p),new xn(v,1-g)]}};function fl(e,t,n){if(n.shapes=[],Array.isArray(e))for(var r=0,i=e.length;r<i;r++){var o=e[r];n.shapes.push(o.uuid)}else n.shapes.push(e.uuid);return void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON()),n}function pl(e,t){eo.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new ml(e,t)),this.mergeVertices()}function ml(e,t){var n=(t=t||{}).font;if(!n||!n.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new eo;var r=n.generateShapes(e,t.size);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),dl.call(this,r,t),this.type="TextBufferGeometry"}function vl(e,t,n,r,i,o,a){eo.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:o,thetaLength:a},this.fromBufferGeometry(new gl(e,t,n,r,i,o,a)),this.mergeVertices()}function gl(e,t,n,r,i,o,a){Ri.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:o,thetaLength:a},e=e||1,t=Math.max(3,Math.floor(t)||8),n=Math.max(2,Math.floor(n)||6),r=void 0!==r?r:0,i=void 0!==i?i:2*Math.PI,o=void 0!==o?o:0,a=void 0!==a?a:Math.PI;var s,u,l=Math.min(o+a,Math.PI),c=0,d=[],h=new Rn,f=new Rn,p=[],m=[],v=[],g=[];for(u=0;u<=n;u++){var y=[],_=u/n,b=0;for(0==u&&0==o?b=.5/t:u==n&&l==Math.PI&&(b=-.5/t),s=0;s<=t;s++){var E=s/t;h.x=-e*Math.cos(r+E*i)*Math.sin(o+_*a),h.y=e*Math.cos(o+_*a),h.z=e*Math.sin(r+E*i)*Math.sin(o+_*a),m.push(h.x,h.y,h.z),f.copy(h).normalize(),v.push(f.x,f.y,f.z),g.push(E+b,1-_),y.push(c++)}d.push(y)}for(u=0;u<n;u++)for(s=0;s<t;s++){var w=d[u][s+1],T=d[u][s],S=d[u+1][s],x=d[u+1][s+1];(0!==u||o>0)&&p.push(w,T,x),(u!==n-1||l<Math.PI)&&p.push(T,S,x)}this.setIndex(p),this.setAttribute("position",new yi(m,3)),this.setAttribute("normal",new yi(v,3)),this.setAttribute("uv",new yi(g,2))}function yl(e,t,n,r,i,o){eo.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:o},this.fromBufferGeometry(new _l(e,t,n,r,i,o)),this.mergeVertices()}function _l(e,t,n,r,i,o){Ri.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:o},e=e||.5,t=t||1,i=void 0!==i?i:0,o=void 0!==o?o:2*Math.PI,n=void 0!==n?Math.max(3,n):8;var a,s,u,l=[],c=[],d=[],h=[],f=e,p=(t-e)/(r=void 0!==r?Math.max(1,r):1),m=new Rn,v=new xn;for(s=0;s<=r;s++){for(u=0;u<=n;u++)a=i+u/n*o,m.x=f*Math.cos(a),m.y=f*Math.sin(a),c.push(m.x,m.y,m.z),d.push(0,0,1),v.x=(m.x/t+1)/2,v.y=(m.y/t+1)/2,h.push(v.x,v.y);f+=p}for(s=0;s<r;s++){var g=s*(n+1);for(u=0;u<n;u++){var y=a=u+g,_=a+n+1,b=a+n+2,E=a+1;l.push(y,_,E),l.push(_,b,E)}}this.setIndex(l),this.setAttribute("position",new yi(c,3)),this.setAttribute("normal",new yi(d,3)),this.setAttribute("uv",new yi(h,2))}function bl(e,t,n,r){eo.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},this.fromBufferGeometry(new El(e,t,n,r)),this.mergeVertices()}function El(e,t,n,r){Ri.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},t=Math.floor(t)||12,n=n||0,r=r||2*Math.PI,r=Sn.clamp(r,0,2*Math.PI);var i,o,a,s=[],u=[],l=[],c=1/t,d=new Rn,h=new xn;for(o=0;o<=t;o++){var f=n+o*c*r,p=Math.sin(f),m=Math.cos(f);for(a=0;a<=e.length-1;a++)d.x=e[a].x*p,d.y=e[a].y,d.z=e[a].x*m,u.push(d.x,d.y,d.z),h.x=o/t,h.y=a/(e.length-1),l.push(h.x,h.y)}for(o=0;o<t;o++)for(a=0;a<e.length-1;a++){var v=i=a+o*e.length,g=i+e.length,y=i+e.length+1,_=i+1;s.push(v,g,_),s.push(g,y,_)}if(this.setIndex(s),this.setAttribute("position",new yi(u,3)),this.setAttribute("uv",new yi(l,2)),this.computeVertexNormals(),r===2*Math.PI){var b=this.attributes.normal.array,E=new Rn,w=new Rn,T=new Rn;for(i=t*e.length*3,o=0,a=0;o<e.length;o++,a+=3)E.x=b[a+0],E.y=b[a+1],E.z=b[a+2],w.x=b[i+a+0],w.y=b[i+a+1],w.z=b[i+a+2],T.addVectors(E,w).normalize(),b[a+0]=b[i+a+0]=T.x,b[a+1]=b[i+a+1]=T.y,b[a+2]=b[i+a+2]=T.z}}function wl(e,t){eo.call(this),this.type="ShapeGeometry","object"==typeof t&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new Tl(e,t)),this.mergeVertices()}function Tl(e,t){Ri.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;var n=[],r=[],i=[],o=[],a=0,s=0;if(!1===Array.isArray(e))l(e);else for(var u=0;u<e.length;u++)l(e[u]),this.addGroup(a,s,u),a+=s,s=0;function l(e){var a,u,l,c=r.length/3,d=e.extractPoints(t),h=d.shape,f=d.holes;for(!1===sl.isClockWise(h)&&(h=h.reverse()),a=0,u=f.length;a<u;a++)l=f[a],!0===sl.isClockWise(l)&&(f[a]=l.reverse());var p=sl.triangulateShape(h,f);for(a=0,u=f.length;a<u;a++)l=f[a],h=h.concat(l);for(a=0,u=h.length;a<u;a++){var m=h[a];r.push(m.x,m.y,0),i.push(0,0,1),o.push(m.x,m.y)}for(a=0,u=p.length;a<u;a++){var v=p[a],g=v[0]+c,y=v[1]+c,_=v[2]+c;n.push(g,y,_),s+=3}}this.setIndex(n),this.setAttribute("position",new yi(r,3)),this.setAttribute("normal",new yi(i,3)),this.setAttribute("uv",new yi(o,2))}function Sl(e,t){if(t.shapes=[],Array.isArray(e))for(var n=0,r=e.length;n<r;n++){var i=e[n];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}function xl(e,t){Ri.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1;var n,r,i,o,a=[],s=Math.cos(Sn.DEG2RAD*t),u=[0,0],l={},c=["a","b","c"];e.isBufferGeometry?(o=new eo).fromBufferGeometry(e):o=e.clone(),o.mergeVertices(),o.computeFaceNormals();for(var d=o.vertices,h=o.faces,f=0,p=h.length;f<p;f++)for(var m=h[f],v=0;v<3;v++)n=m[c[v]],r=m[c[(v+1)%3]],u[0]=Math.min(n,r),u[1]=Math.max(n,r),void 0===l[i=u[0]+","+u[1]]?l[i]={index1:u[0],index2:u[1],face1:f,face2:void 0}:l[i].face2=f;for(i in l){var g=l[i];if(void 0===g.face2||h[g.face1].normal.dot(h[g.face2].normal)<=s){var y=d[g.index1];a.push(y.x,y.y,y.z),y=d[g.index2],a.push(y.x,y.y,y.z)}}this.setAttribute("position",new yi(a,3))}function Al(e,t,n,r,i,o,a,s){eo.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:i,openEnded:o,thetaStart:a,thetaLength:s},this.fromBufferGeometry(new Ml(e,t,n,r,i,o,a,s)),this.mergeVertices()}function Ml(e,t,n,r,i,o,a,s){Ri.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:i,openEnded:o,thetaStart:a,thetaLength:s};var u=this;e=void 0!==e?e:1,t=void 0!==t?t:1,n=n||1,r=Math.floor(r)||8,i=Math.floor(i)||1,o=void 0!==o&&o,a=void 0!==a?a:0,s=void 0!==s?s:2*Math.PI;var l=[],c=[],d=[],h=[],f=0,p=[],m=n/2,v=0;function g(n){var i,o,p,g=new xn,y=new Rn,_=0,b=!0===n?e:t,E=!0===n?1:-1;for(o=f,i=1;i<=r;i++)c.push(0,m*E,0),d.push(0,E,0),h.push(.5,.5),f++;for(p=f,i=0;i<=r;i++){var w=i/r*s+a,T=Math.cos(w),S=Math.sin(w);y.x=b*S,y.y=m*E,y.z=b*T,c.push(y.x,y.y,y.z),d.push(0,E,0),g.x=.5*T+.5,g.y=.5*S*E+.5,h.push(g.x,g.y),f++}for(i=0;i<r;i++){var x=o+i,A=p+i;!0===n?l.push(A,A+1,x):l.push(A+1,A,x),_+=3}u.addGroup(v,_,!0===n?1:2),v+=_}!function(){var o,g,y=new Rn,_=new Rn,b=0,E=(t-e)/n;for(g=0;g<=i;g++){var w=[],T=g/i,S=T*(t-e)+e;for(o=0;o<=r;o++){var x=o/r,A=x*s+a,M=Math.sin(A),j=Math.cos(A);_.x=S*M,_.y=-T*n+m,_.z=S*j,c.push(_.x,_.y,_.z),y.set(M,E,j).normalize(),d.push(y.x,y.y,y.z),h.push(x,1-T),w.push(f++)}p.push(w)}for(o=0;o<r;o++)for(g=0;g<i;g++){var R=p[g][o],L=p[g+1][o],C=p[g+1][o+1],k=p[g][o+1];l.push(R,L,k),l.push(L,C,k),b+=6}u.addGroup(v,b,0),v+=b}(),!1===o&&(e>0&&g(!0),t>0&&g(!1)),this.setIndex(l),this.setAttribute("position",new yi(c,3)),this.setAttribute("normal",new yi(d,3)),this.setAttribute("uv",new yi(h,2))}function jl(e,t,n,r,i,o,a){Al.call(this,0,e,t,n,r,i,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:o,thetaLength:a}}function Rl(e,t,n,r,i,o,a){Ml.call(this,0,e,t,n,r,i,o,a),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:o,thetaLength:a}}function Ll(e,t,n,r){eo.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},this.fromBufferGeometry(new Cl(e,t,n,r)),this.mergeVertices()}function Cl(e,t,n,r){Ri.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},e=e||1,t=void 0!==t?Math.max(3,t):8,n=void 0!==n?n:0,r=void 0!==r?r:2*Math.PI;var i,o,a=[],s=[],u=[],l=[],c=new Rn,d=new xn;for(s.push(0,0,0),u.push(0,0,1),l.push(.5,.5),o=0,i=3;o<=t;o++,i+=3){var h=n+o/t*r;c.x=e*Math.cos(h),c.y=e*Math.sin(h),s.push(c.x,c.y,c.z),u.push(0,0,1),d.x=(s[i]/e+1)/2,d.y=(s[i+1]/e+1)/2,l.push(d.x,d.y)}for(i=1;i<=t;i++)a.push(i,i+1,0);this.setIndex(a),this.setAttribute("position",new yi(s,3)),this.setAttribute("normal",new yi(u,3)),this.setAttribute("uv",new yi(l,2))}pl.prototype=Object.create(eo.prototype),pl.prototype.constructor=pl,ml.prototype=Object.create(dl.prototype),ml.prototype.constructor=ml,vl.prototype=Object.create(eo.prototype),vl.prototype.constructor=vl,gl.prototype=Object.create(Ri.prototype),gl.prototype.constructor=gl,yl.prototype=Object.create(eo.prototype),yl.prototype.constructor=yl,_l.prototype=Object.create(Ri.prototype),_l.prototype.constructor=_l,bl.prototype=Object.create(eo.prototype),bl.prototype.constructor=bl,El.prototype=Object.create(Ri.prototype),El.prototype.constructor=El,wl.prototype=Object.create(eo.prototype),wl.prototype.constructor=wl,wl.prototype.toJSON=function(){var e=eo.prototype.toJSON.call(this);return Sl(this.parameters.shapes,e)},Tl.prototype=Object.create(Ri.prototype),Tl.prototype.constructor=Tl,Tl.prototype.toJSON=function(){var e=Ri.prototype.toJSON.call(this);return Sl(this.parameters.shapes,e)},xl.prototype=Object.create(Ri.prototype),xl.prototype.constructor=xl,Al.prototype=Object.create(eo.prototype),Al.prototype.constructor=Al,Ml.prototype=Object.create(Ri.prototype),Ml.prototype.constructor=Ml,jl.prototype=Object.create(Al.prototype),jl.prototype.constructor=jl,Rl.prototype=Object.create(Ml.prototype),Rl.prototype.constructor=Rl,Ll.prototype=Object.create(eo.prototype),Ll.prototype.constructor=Ll,Cl.prototype=Object.create(Ri.prototype),Cl.prototype.constructor=Cl;var kl=Object.freeze({__proto__:null,WireframeGeometry:bu,ParametricGeometry:Eu,ParametricBufferGeometry:wu,TetrahedronGeometry:xu,TetrahedronBufferGeometry:Au,OctahedronGeometry:Mu,OctahedronBufferGeometry:ju,IcosahedronGeometry:Ru,IcosahedronBufferGeometry:Lu,DodecahedronGeometry:Cu,DodecahedronBufferGeometry:ku,PolyhedronGeometry:Tu,PolyhedronBufferGeometry:Su,TubeGeometry:Ou,TubeBufferGeometry:Pu,TorusKnotGeometry:Iu,TorusKnotBufferGeometry:Du,TorusGeometry:Nu,TorusBufferGeometry:Bu,TextGeometry:pl,TextBufferGeometry:ml,SphereGeometry:vl,SphereBufferGeometry:gl,RingGeometry:yl,RingBufferGeometry:_l,PlaneGeometry:Eo,PlaneBufferGeometry:wo,LatheGeometry:bl,LatheBufferGeometry:El,ShapeGeometry:wl,ShapeBufferGeometry:Tl,ExtrudeGeometry:cl,ExtrudeBufferGeometry:dl,EdgesGeometry:xl,ConeGeometry:jl,ConeBufferGeometry:Rl,CylinderGeometry:Al,CylinderBufferGeometry:Ml,CircleGeometry:Ll,CircleBufferGeometry:Cl,BoxGeometry:to,BoxBufferGeometry:no});function Ol(e){si.call(this),this.type="ShadowMaterial",this.color=new ti(0),this.transparent=!0,this.setValues(e)}function Pl(e){ao.call(this,e),this.type="RawShaderMaterial"}function Il(e){si.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ti(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ti(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Kt,this.normalScale=new xn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Dl(e){Il.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearcoat=0,this.clearcoatRoughness=0,this.sheen=null,this.clearcoatNormalScale=new xn(1,1),this.clearcoatNormalMap=null,this.transparency=0,this.setValues(e)}function Nl(e){si.call(this),this.type="MeshPhongMaterial",this.color=new ti(16777215),this.specular=new ti(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ti(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Kt,this.normalScale=new xn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ee,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Bl(e){si.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ti(16777215),this.specular=new ti(1118481),this.shininess=30,this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ti(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Kt,this.normalScale=new xn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Ul(e){si.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Kt,this.normalScale=new xn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Fl(e){si.call(this),this.type="MeshLambertMaterial",this.color=new ti(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ti(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ee,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Vl(e){si.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ti(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Kt,this.normalScale=new xn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Gl(e){$s.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}Ol.prototype=Object.create(si.prototype),Ol.prototype.constructor=Ol,Ol.prototype.isShadowMaterial=!0,Ol.prototype.copy=function(e){return si.prototype.copy.call(this,e),this.color.copy(e.color),this},Pl.prototype=Object.create(ao.prototype),Pl.prototype.constructor=Pl,Pl.prototype.isRawShaderMaterial=!0,Il.prototype=Object.create(si.prototype),Il.prototype.constructor=Il,Il.prototype.isMeshStandardMaterial=!0,Il.prototype.copy=function(e){return si.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Dl.prototype=Object.create(Il.prototype),Dl.prototype.constructor=Dl,Dl.prototype.isMeshPhysicalMaterial=!0,Dl.prototype.copy=function(e){return Il.prototype.copy.call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearcoat=e.clearcoat,this.clearcoatRoughness=e.clearcoatRoughness,e.sheen?this.sheen=(this.sheen||new ti).copy(e.sheen):this.sheen=null,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.transparency=e.transparency,this},Nl.prototype=Object.create(si.prototype),Nl.prototype.constructor=Nl,Nl.prototype.isMeshPhongMaterial=!0,Nl.prototype.copy=function(e){return si.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Bl.prototype=Object.create(si.prototype),Bl.prototype.constructor=Bl,Bl.prototype.isMeshToonMaterial=!0,Bl.prototype.copy=function(e){return si.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Ul.prototype=Object.create(si.prototype),Ul.prototype.constructor=Ul,Ul.prototype.isMeshNormalMaterial=!0,Ul.prototype.copy=function(e){return si.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Fl.prototype=Object.create(si.prototype),Fl.prototype.constructor=Fl,Fl.prototype.isMeshLambertMaterial=!0,Fl.prototype.copy=function(e){return si.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Vl.prototype=Object.create(si.prototype),Vl.prototype.constructor=Vl,Vl.prototype.isMeshMatcapMaterial=!0,Vl.prototype.copy=function(e){return si.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Gl.prototype=Object.create($s.prototype),Gl.prototype.constructor=Gl,Gl.prototype.isLineDashedMaterial=!0,Gl.prototype.copy=function(e){return $s.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var Hl=Object.freeze({__proto__:null,ShadowMaterial:Ol,SpriteMaterial:Ss,RawShaderMaterial:Pl,ShaderMaterial:ao,PointsMaterial:lu,MeshPhysicalMaterial:Dl,MeshStandardMaterial:Il,MeshPhongMaterial:Nl,MeshToonMaterial:Bl,MeshNormalMaterial:Ul,MeshLambertMaterial:Fl,MeshDepthMaterial:as,MeshDistanceMaterial:ss,MeshBasicMaterial:ui,MeshMatcapMaterial:Vl,LineDashedMaterial:Gl,LineBasicMaterial:$s,Material:si}),zl={arraySlice:function(e,t,n){return zl.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,n=new Array(t),r=0;r!==t;++r)n[r]=r;return n.sort((function(t,n){return e[t]-e[n]})),n},sortedArray:function(e,t,n){for(var r=e.length,i=new e.constructor(r),o=0,a=0;a!==r;++o)for(var s=n[o]*t,u=0;u!==t;++u)i[a++]=e[s+u];return i},flattenJSON:function(e,t,n,r){for(var i=1,o=e[0];void 0!==o&&void 0===o[r];)o=e[i++];if(void 0!==o){var a=o[r];if(void 0!==a)if(Array.isArray(a))do{void 0!==(a=o[r])&&(t.push(o.time),n.push.apply(n,a)),o=e[i++]}while(void 0!==o);else if(void 0!==a.toArray)do{void 0!==(a=o[r])&&(t.push(o.time),a.toArray(n,n.length)),o=e[i++]}while(void 0!==o);else do{void 0!==(a=o[r])&&(t.push(o.time),n.push(a)),o=e[i++]}while(void 0!==o)}},subclip:function(e,t,n,r,i){i=i||30;var o=e.clone();o.name=t;for(var a=[],s=0;s<o.tracks.length;++s){for(var u=o.tracks[s],l=u.getValueSize(),c=[],d=[],h=0;h<u.times.length;++h){var f=u.times[h]*i;if(!(f<n||f>=r)){c.push(u.times[h]);for(var p=0;p<l;++p)d.push(u.values[h*l+p])}}0!==c.length&&(u.times=zl.convertArray(c,u.times.constructor),u.values=zl.convertArray(d,u.values.constructor),a.push(u))}o.tracks=a;var m=1/0;for(s=0;s<o.tracks.length;++s)m>o.tracks[s].times[0]&&(m=o.tracks[s].times[0]);for(s=0;s<o.tracks.length;++s)o.tracks[s].shift(-1*m);return o.resetDuration(),o}};function Wl(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n}function ql(e,t,n,r){Wl.call(this,e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function Kl(e,t,n,r){Wl.call(this,e,t,n,r)}function Yl(e,t,n,r){Wl.call(this,e,t,n,r)}function Xl(e,t,n,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=zl.convertArray(t,this.TimeBufferType),this.values=zl.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}function Jl(e,t,n){Xl.call(this,e,t,n)}function Zl(e,t,n,r){Xl.call(this,e,t,n,r)}function $l(e,t,n,r){Xl.call(this,e,t,n,r)}function Ql(e,t,n,r){Wl.call(this,e,t,n,r)}function ec(e,t,n,r){Xl.call(this,e,t,n,r)}function tc(e,t,n,r){Xl.call(this,e,t,n,r)}function nc(e,t,n,r){Xl.call(this,e,t,n,r)}function rc(e,t,n){this.name=e,this.tracks=n,this.duration=void 0!==t?t:-1,this.uuid=Sn.generateUUID(),this.duration<0&&this.resetDuration()}function ic(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return $l;case"vector":case"vector2":case"vector3":case"vector4":return nc;case"color":return Zl;case"quaternion":return ec;case"bool":case"boolean":return Jl;case"string":return tc}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){var n=[],r=[];zl.flattenJSON(e.keys,n,r,"value"),e.times=n,e.values=r}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}Object.assign(Wl.prototype,{evaluate:function(e){var t=this.parameterPositions,n=this._cachedIndex,r=t[n],i=t[n-1];e:{t:{var o;n:{r:if(!(e<r)){for(var a=n+2;;){if(void 0===r){if(e<i)break r;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,i)}if(n===a)break;if(i=r,e<(r=t[++n]))break t}o=t.length;break n}if(e>=i)break e;var s=t[1];e<s&&(n=2,i=s);for(a=n-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(n===a)break;if(r=i,e>=(i=t[--n-1]))break t}o=n,n=0}for(;n<o;){var u=n+o>>>1;e<t[u]?o=u:n=u+1}if(r=t[n],void 0===(i=t[n-1]))return this._cachedIndex=0,this.beforeStart_(0,e,r);if(void 0===r)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,i,e)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,e,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r,o=0;o!==r;++o)t[o]=n[i+o];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(Wl.prototype,{beforeStart_:Wl.prototype.copySampleValue_,afterEnd_:Wl.prototype.copySampleValue_}),ql.prototype=Object.assign(Object.create(Wl.prototype),{constructor:ql,DefaultSettings_:{endingStart:Ct,endingEnd:Ct},intervalChanged_:function(e,t,n){var r=this.parameterPositions,i=e-2,o=e+1,a=r[i],s=r[o];if(void 0===a)switch(this.getSettings_().endingStart){case kt:i=e,a=2*t-n;break;case Ot:a=t+r[i=r.length-2]-r[i+1];break;default:i=e,a=n}if(void 0===s)switch(this.getSettings_().endingEnd){case kt:o=e,s=2*n-t;break;case Ot:o=1,s=n+r[1]-r[0];break;default:o=e-1,s=t}var u=.5*(n-t),l=this.valueSize;this._weightPrev=u/(t-a),this._weightNext=u/(s-n),this._offsetPrev=i*l,this._offsetNext=o*l},interpolate_:function(e,t,n,r){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,u=s-a,l=this._offsetPrev,c=this._offsetNext,d=this._weightPrev,h=this._weightNext,f=(n-t)/(r-t),p=f*f,m=p*f,v=-d*m+2*d*p-d*f,g=(1+d)*m+(-1.5-2*d)*p+(-.5+d)*f+1,y=(-1-h)*m+(1.5+h)*p+.5*f,_=h*m-h*p,b=0;b!==a;++b)i[b]=v*o[l+b]+g*o[u+b]+y*o[s+b]+_*o[c+b];return i}}),Kl.prototype=Object.assign(Object.create(Wl.prototype),{constructor:Kl,interpolate_:function(e,t,n,r){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,u=s-a,l=(n-t)/(r-t),c=1-l,d=0;d!==a;++d)i[d]=o[u+d]*c+o[s+d]*l;return i}}),Yl.prototype=Object.assign(Object.create(Wl.prototype),{constructor:Yl,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(Xl,{toJSON:function(e){var t,n=e.constructor;if(void 0!==n.toJSON)t=n.toJSON(e);else{t={name:e.name,times:zl.convertArray(e.times,Array),values:zl.convertArray(e.values,Array)};var r=e.getInterpolation();r!==e.DefaultInterpolation&&(t.interpolation=r)}return t.type=e.ValueTypeName,t}}),Object.assign(Xl.prototype,{constructor:Xl,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:Rt,InterpolantFactoryMethodDiscrete:function(e){return new Yl(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new Kl(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new ql(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case jt:t=this.InterpolantFactoryMethodDiscrete;break;case Rt:t=this.InterpolantFactoryMethodLinear;break;case Lt:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return jt;case this.InterpolantFactoryMethodLinear:return Rt;case this.InterpolantFactoryMethodSmooth:return Lt}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,n=0,r=t.length;n!==r;++n)t[n]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,n=0,r=t.length;n!==r;++n)t[n]*=e;return this},trim:function(e,t){for(var n=this.times,r=n.length,i=0,o=r-1;i!==r&&n[i]<e;)++i;for(;-1!==o&&n[o]>t;)--o;if(++o,0!==i||o!==r){i>=o&&(i=(o=Math.max(o,1))-1);var a=this.getValueSize();this.times=zl.arraySlice(n,i,o),this.values=zl.arraySlice(this.values,i*a,o*a)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var o=null,a=0;a!==i;a++){var s=n[a];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,s),e=!1;break}if(null!==o&&o>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,s,o),e=!1;break}o=s}if(void 0!==r&&zl.isTypedArray(r)){a=0;for(var u=r.length;a!==u;++a){var l=r[a];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,l),e=!1;break}}}return e},optimize:function(){for(var e=this.times,t=this.values,n=this.getValueSize(),r=this.getInterpolation()===Lt,i=1,o=e.length-1,a=1;a<o;++a){var s=!1,u=e[a];if(u!==e[a+1]&&(1!==a||u!==u[0]))if(r)s=!0;else for(var l=a*n,c=l-n,d=l+n,h=0;h!==n;++h){var f=t[l+h];if(f!==t[c+h]||f!==t[d+h]){s=!0;break}}if(s){if(a!==i){e[i]=e[a];var p=a*n,m=i*n;for(h=0;h!==n;++h)t[m+h]=t[p+h]}++i}}if(o>0){e[i]=e[o];for(p=o*n,m=i*n,h=0;h!==n;++h)t[m+h]=t[p+h];++i}return i!==e.length&&(this.times=zl.arraySlice(e,0,i),this.values=zl.arraySlice(t,0,i*n)),this},clone:function(){var e=zl.arraySlice(this.times,0),t=zl.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}),Jl.prototype=Object.assign(Object.create(Xl.prototype),{constructor:Jl,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:jt,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Zl.prototype=Object.assign(Object.create(Xl.prototype),{constructor:Zl,ValueTypeName:"color"}),$l.prototype=Object.assign(Object.create(Xl.prototype),{constructor:$l,ValueTypeName:"number"}),Ql.prototype=Object.assign(Object.create(Wl.prototype),{constructor:Ql,interpolate_:function(e,t,n,r){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,u=(n-t)/(r-t),l=s+a;s!==l;s+=4)An.slerpFlat(i,0,o,s-a,o,s,u);return i}}),ec.prototype=Object.assign(Object.create(Xl.prototype),{constructor:ec,ValueTypeName:"quaternion",DefaultInterpolation:Rt,InterpolantFactoryMethodLinear:function(e){return new Ql(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),tc.prototype=Object.assign(Object.create(Xl.prototype),{constructor:tc,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:jt,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),nc.prototype=Object.assign(Object.create(Xl.prototype),{constructor:nc,ValueTypeName:"vector"}),Object.assign(rc,{parse:function(e){for(var t=[],n=e.tracks,r=1/(e.fps||1),i=0,o=n.length;i!==o;++i)t.push(ic(n[i]).scale(r));return new rc(e.name,e.duration,t)},toJSON:function(e){for(var t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid},i=0,o=n.length;i!==o;++i)t.push(Xl.toJSON(n[i]));return r},CreateFromMorphTargetSequence:function(e,t,n,r){for(var i=t.length,o=[],a=0;a<i;a++){var s=[],u=[];s.push((a+i-1)%i,a,(a+1)%i),u.push(0,1,0);var l=zl.getKeyframeOrder(s);s=zl.sortedArray(s,1,l),u=zl.sortedArray(u,1,l),r||0!==s[0]||(s.push(i),u.push(u[0])),o.push(new $l(".morphTargetInfluences["+t[a].name+"]",s,u).scale(1/n))}return new rc(e,-1,o)},findByName:function(e,t){var n=e;if(!Array.isArray(e)){var r=e;n=r.geometry&&r.geometry.animations||r.animations}for(var i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null},CreateClipsFromMorphTargetSequences:function(e,t,n){for(var r={},i=/^([\w-]*?)([\d]+)$/,o=0,a=e.length;o<a;o++){var s=e[o],u=s.name.match(i);if(u&&u.length>1){var l=r[d=u[1]];l||(r[d]=l=[]),l.push(s)}}var c=[];for(var d in r)c.push(rc.CreateFromMorphTargetSequence(d,r[d],t,n));return c},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var n=function(e,t,n,r,i){if(0!==n.length){var o=[],a=[];zl.flattenJSON(n,o,a,r),0!==o.length&&i.push(new e(t,o,a))}},r=[],i=e.name||"default",o=e.length||-1,a=e.fps||30,s=e.hierarchy||[],u=0;u<s.length;u++){var l=s[u].keys;if(l&&0!==l.length)if(l[0].morphTargets){for(var c={},d=0;d<l.length;d++)if(l[d].morphTargets)for(var h=0;h<l[d].morphTargets.length;h++)c[l[d].morphTargets[h]]=-1;for(var f in c){var p=[],m=[];for(h=0;h!==l[d].morphTargets.length;++h){var v=l[d];p.push(v.time),m.push(v.morphTarget===f?1:0)}r.push(new $l(".morphTargetInfluence["+f+"]",p,m))}o=c.length*(a||1)}else{var g=".bones["+t[u].name+"]";n(nc,g+".position",l,"pos",r),n(ec,g+".quaternion",l,"rot",r),n(nc,g+".scale",l,"scl",r)}}return 0===r.length?null:new rc(i,o,r)}}),Object.assign(rc.prototype,{resetDuration:function(){for(var e=0,t=0,n=this.tracks.length;t!==n;++t){var r=this.tracks[t];e=Math.max(e,r.times[r.times.length-1])}return this.duration=e,this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new rc(this.name,this.duration,e)}});var oc={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function ac(e,t,n){var r=this,i=!1,o=0,a=0,s=void 0,u=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){a++,!1===i&&void 0!==r.onStart&&r.onStart(e,o,a),i=!0},this.itemEnd=function(e){o++,void 0!==r.onProgress&&r.onProgress(e,o,a),o===a&&(i=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this},this.addHandler=function(e,t){return u.push(e,t),this},this.removeHandler=function(e){var t=u.indexOf(e);return-1!==t&&u.splice(t,2),this},this.getHandler=function(e){for(var t=0,n=u.length;t<n;t+=2){var r=u[t],i=u[t+1];if(r.global&&(r.lastIndex=0),r.test(e))return i}return null}}var sc=new ac;function uc(e){this.manager=void 0!==e?e:sc,this.crossOrigin="anonymous",this.path="",this.resourcePath=""}Object.assign(uc.prototype,{load:function(){},parse:function(){},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this}});var lc={};function cc(e){uc.call(this,e)}function dc(e){uc.call(this,e)}function hc(e){uc.call(this,e)}function fc(e){uc.call(this,e)}function pc(e){uc.call(this,e)}function mc(e){uc.call(this,e)}function vc(e){uc.call(this,e)}function gc(){this.type="Curve",this.arcLengthDivisions=200}function yc(e,t,n,r,i,o,a,s){gc.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=n||1,this.yRadius=r||1,this.aStartAngle=i||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=a||!1,this.aRotation=s||0}function _c(e,t,n,r,i,o){yc.call(this,e,t,n,n,r,i,o),this.type="ArcCurve"}function bc(){var e=0,t=0,n=0,r=0;function i(i,o,a,s){e=i,t=a,n=-3*i+3*o-2*a-s,r=2*i-2*o+a+s}return{initCatmullRom:function(e,t,n,r,o){i(t,n,o*(n-e),o*(r-t))},initNonuniformCatmullRom:function(e,t,n,r,o,a,s){var u=(t-e)/o-(n-e)/(o+a)+(n-t)/a,l=(n-t)/a-(r-t)/(a+s)+(r-n)/s;i(t,n,u*=a,l*=a)},calc:function(i){var o=i*i;return e+t*i+n*o+r*(o*i)}}}cc.prototype=Object.assign(Object.create(uc.prototype),{constructor:cc,load:function(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,o=oc.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout((function(){t&&t(o),i.manager.itemEnd(e)}),0),o;if(void 0===lc[e]){var a=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(a){var s=a[1],u=!!a[2],l=a[3];l=decodeURIComponent(l),u&&(l=atob(l));try{var c,d=(this.responseType||"").toLowerCase();switch(d){case"arraybuffer":case"blob":for(var h=new Uint8Array(l.length),f=0;f<l.length;f++)h[f]=l.charCodeAt(f);c="blob"===d?new Blob([h.buffer],{type:s}):h.buffer;break;case"document":var p=new DOMParser;c=p.parseFromString(l,s);break;case"json":c=JSON.parse(l);break;default:c=l}setTimeout((function(){t&&t(c),i.manager.itemEnd(e)}),0)}catch(t){setTimeout((function(){r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}),0)}}else{lc[e]=[],lc[e].push({onLoad:t,onProgress:n,onError:r});var m=new XMLHttpRequest;for(var v in m.open("GET",e,!0),m.addEventListener("load",(function(t){var n=this.response,r=lc[e];if(delete lc[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),oc.add(e,n);for(var o=0,a=r.length;o<a;o++){(s=r[o]).onLoad&&s.onLoad(n)}i.manager.itemEnd(e)}else{for(o=0,a=r.length;o<a;o++){var s;(s=r[o]).onError&&s.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}}),!1),m.addEventListener("progress",(function(t){for(var n=lc[e],r=0,i=n.length;r<i;r++){var o=n[r];o.onProgress&&o.onProgress(t)}}),!1),m.addEventListener("error",(function(t){var n=lc[e];delete lc[e];for(var r=0,o=n.length;r<o;r++){var a=n[r];a.onError&&a.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}),!1),m.addEventListener("abort",(function(t){var n=lc[e];delete lc[e];for(var r=0,o=n.length;r<o;r++){var a=n[r];a.onError&&a.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}),!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)m.setRequestHeader(v,this.requestHeader[v]);m.send(null)}return i.manager.itemStart(e),m}lc[e].push({onLoad:t,onProgress:n,onError:r})},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),dc.prototype=Object.assign(Object.create(uc.prototype),{constructor:dc,load:function(e,t,n,r){var i=this,o=new cc(i.manager);o.setPath(i.path),o.load(e,(function(e){t(i.parse(JSON.parse(e)))}),n,r)},parse:function(e){for(var t=[],n=0;n<e.length;n++){var r=rc.parse(e[n]);t.push(r)}return t}}),hc.prototype=Object.assign(Object.create(uc.prototype),{constructor:hc,load:function(e,t,n,r){var i=this,o=[],a=new gu;a.image=o;var s=new cc(this.manager);function u(u){s.load(e[u],(function(e){var n=i.parse(e,!0);o[u]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},6===(l+=1)&&(1===n.mipmapCount&&(a.minFilter=xe),a.format=n.format,a.needsUpdate=!0,t&&t(a))}),n,r)}if(s.setPath(this.path),s.setResponseType("arraybuffer"),Array.isArray(e))for(var l=0,c=0,d=e.length;c<d;++c)u(c);else s.load(e,(function(e){var n=i.parse(e,!0);if(n.isCubemap)for(var r=n.mipmaps.length/n.mipmapCount,s=0;s<r;s++){o[s]={mipmaps:[]};for(var u=0;u<n.mipmapCount;u++)o[s].mipmaps.push(n.mipmaps[s*n.mipmapCount+u]),o[s].format=n.format,o[s].width=n.width,o[s].height=n.height}else a.image.width=n.width,a.image.height=n.height,a.mipmaps=n.mipmaps;1===n.mipmapCount&&(a.minFilter=xe),a.format=n.format,a.needsUpdate=!0,t&&t(a)}),n,r);return a}}),fc.prototype=Object.assign(Object.create(uc.prototype),{constructor:fc,load:function(e,t,n,r){var i=this,o=new ho,a=new cc(this.manager);return a.setResponseType("arraybuffer"),a.setPath(this.path),a.load(e,(function(e){var n=i.parse(e);n&&(void 0!==n.image?o.image=n.image:void 0!==n.data&&(o.image.width=n.width,o.image.height=n.height,o.image.data=n.data),o.wrapS=void 0!==n.wrapS?n.wrapS:ye,o.wrapT=void 0!==n.wrapT?n.wrapT:ye,o.magFilter=void 0!==n.magFilter?n.magFilter:xe,o.minFilter=void 0!==n.minFilter?n.minFilter:xe,o.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.format&&(o.format=n.format),void 0!==n.type&&(o.type=n.type),void 0!==n.mipmaps&&(o.mipmaps=n.mipmaps,o.minFilter=je),1===n.mipmapCount&&(o.minFilter=xe),o.needsUpdate=!0,t&&t(o,n))}),n,r),o}}),pc.prototype=Object.assign(Object.create(uc.prototype),{constructor:pc,load:function(e,t,n,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,o=oc.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout((function(){t&&t(o),i.manager.itemEnd(e)}),0),o;var a=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){a.removeEventListener("load",s,!1),a.removeEventListener("error",u,!1),oc.add(e,this),t&&t(this),i.manager.itemEnd(e)}function u(t){a.removeEventListener("load",s,!1),a.removeEventListener("error",u,!1),r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}return a.addEventListener("load",s,!1),a.addEventListener("error",u,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),i.manager.itemStart(e),a.src=e,a}}),mc.prototype=Object.assign(Object.create(uc.prototype),{constructor:mc,load:function(e,t,n,r){var i=new Po,o=new pc(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);var a=0;function s(n){o.load(e[n],(function(e){i.images[n]=e,6===++a&&(i.needsUpdate=!0,t&&t(i))}),void 0,r)}for(var u=0;u<e.length;++u)s(u);return i}}),vc.prototype=Object.assign(Object.create(uc.prototype),{constructor:vc,load:function(e,t,n,r){var i=new In,o=new pc(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,(function(n){i.image=n;var r=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);i.format=r?He:ze,i.needsUpdate=!0,void 0!==t&&t(i)}),n,r),i}}),Object.assign(gc.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){var n=this.getUtoTmapping(e);return this.getPoint(n,t)},getPoints:function(e){void 0===e&&(e=5);for(var t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,n,r=[],i=this.getPoint(0),o=0;for(r.push(0),n=1;n<=e;n++)o+=(t=this.getPoint(n/e)).distanceTo(i),r.push(o),i=t;return this.cacheArcLengths=r,r},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var n,r=this.getLengths(),i=0,o=r.length;n=t||e*r[o-1];for(var a,s=0,u=o-1;s<=u;)if((a=r[i=Math.floor(s+(u-s)/2)]-n)<0)s=i+1;else{if(!(a>0)){u=i;break}u=i-1}if(r[i=u]===n)return i/(o-1);var l=r[i];return(i+(n-l)/(r[i+1]-l))/(o-1)},getTangent:function(e){var t=e-1e-4,n=e+1e-4;t<0&&(t=0),n>1&&(n=1);var r=this.getPoint(t);return this.getPoint(n).clone().sub(r).normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},computeFrenetFrames:function(e,t){var n,r,i,o=new Rn,a=[],s=[],u=[],l=new Rn,c=new qn;for(n=0;n<=e;n++)r=n/e,a[n]=this.getTangentAt(r),a[n].normalize();s[0]=new Rn,u[0]=new Rn;var d=Number.MAX_VALUE,h=Math.abs(a[0].x),f=Math.abs(a[0].y),p=Math.abs(a[0].z);for(h<=d&&(d=h,o.set(1,0,0)),f<=d&&(d=f,o.set(0,1,0)),p<=d&&o.set(0,0,1),l.crossVectors(a[0],o).normalize(),s[0].crossVectors(a[0],l),u[0].crossVectors(a[0],s[0]),n=1;n<=e;n++)s[n]=s[n-1].clone(),u[n]=u[n-1].clone(),l.crossVectors(a[n-1],a[n]),l.length()>Number.EPSILON&&(l.normalize(),i=Math.acos(Sn.clamp(a[n-1].dot(a[n]),-1,1)),s[n].applyMatrix4(c.makeRotationAxis(l,i))),u[n].crossVectors(a[n],s[n]);if(!0===t)for(i=Math.acos(Sn.clamp(s[0].dot(s[e]),-1,1)),i/=e,a[0].dot(l.crossVectors(s[0],s[e]))>0&&(i=-i),n=1;n<=e;n++)s[n].applyMatrix4(c.makeRotationAxis(a[n],i*n)),u[n].crossVectors(a[n],s[n]);return{tangents:a,normals:s,binormals:u}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),yc.prototype=Object.create(gc.prototype),yc.prototype.constructor=yc,yc.prototype.isEllipseCurve=!0,yc.prototype.getPoint=function(e,t){for(var n=t||new xn,r=2*Math.PI,i=this.aEndAngle-this.aStartAngle,o=Math.abs(i)<Number.EPSILON;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=o?0:r),!0!==this.aClockwise||o||(i===r?i=-r:i-=r);var a=this.aStartAngle+e*i,s=this.aX+this.xRadius*Math.cos(a),u=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){var l=Math.cos(this.aRotation),c=Math.sin(this.aRotation),d=s-this.aX,h=u-this.aY;s=d*l-h*c+this.aX,u=d*c+h*l+this.aY}return n.set(s,u)},yc.prototype.copy=function(e){return gc.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},yc.prototype.toJSON=function(){var e=gc.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},yc.prototype.fromJSON=function(e){return gc.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},_c.prototype=Object.create(yc.prototype),_c.prototype.constructor=_c,_c.prototype.isArcCurve=!0;var Ec=new Rn,wc=new bc,Tc=new bc,Sc=new bc;function xc(e,t,n,r){gc.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=n||"centripetal",this.tension=r||.5}function Ac(e,t,n,r,i){var o=.5*(r-t),a=.5*(i-n),s=e*e;return(2*n-2*r+o+a)*(e*s)+(-3*n+3*r-2*o-a)*s+o*e+n}function Mc(e,t,n,r){return function(e,t){var n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,r)}function jc(e,t,n,r,i){return function(e,t){var n=1-e;return n*n*n*t}(e,t)+function(e,t){var n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,r)+function(e,t){return e*e*e*t}(e,i)}function Rc(e,t,n,r){gc.call(this),this.type="CubicBezierCurve",this.v0=e||new xn,this.v1=t||new xn,this.v2=n||new xn,this.v3=r||new xn}function Lc(e,t,n,r){gc.call(this),this.type="CubicBezierCurve3",this.v0=e||new Rn,this.v1=t||new Rn,this.v2=n||new Rn,this.v3=r||new Rn}function Cc(e,t){gc.call(this),this.type="LineCurve",this.v1=e||new xn,this.v2=t||new xn}function kc(e,t){gc.call(this),this.type="LineCurve3",this.v1=e||new Rn,this.v2=t||new Rn}function Oc(e,t,n){gc.call(this),this.type="QuadraticBezierCurve",this.v0=e||new xn,this.v1=t||new xn,this.v2=n||new xn}function Pc(e,t,n){gc.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new Rn,this.v1=t||new Rn,this.v2=n||new Rn}function Ic(e){gc.call(this),this.type="SplineCurve",this.points=e||[]}xc.prototype=Object.create(gc.prototype),xc.prototype.constructor=xc,xc.prototype.isCatmullRomCurve3=!0,xc.prototype.getPoint=function(e,t){var n,r,i,o,a=t||new Rn,s=this.points,u=s.length,l=(u-(this.closed?0:1))*e,c=Math.floor(l),d=l-c;if(this.closed?c+=c>0?0:(Math.floor(Math.abs(c)/u)+1)*u:0===d&&c===u-1&&(c=u-2,d=1),this.closed||c>0?n=s[(c-1)%u]:(Ec.subVectors(s[0],s[1]).add(s[0]),n=Ec),r=s[c%u],i=s[(c+1)%u],this.closed||c+2<u?o=s[(c+2)%u]:(Ec.subVectors(s[u-1],s[u-2]).add(s[u-1]),o=Ec),"centripetal"===this.curveType||"chordal"===this.curveType){var h="chordal"===this.curveType?.5:.25,f=Math.pow(n.distanceToSquared(r),h),p=Math.pow(r.distanceToSquared(i),h),m=Math.pow(i.distanceToSquared(o),h);p<1e-4&&(p=1),f<1e-4&&(f=p),m<1e-4&&(m=p),wc.initNonuniformCatmullRom(n.x,r.x,i.x,o.x,f,p,m),Tc.initNonuniformCatmullRom(n.y,r.y,i.y,o.y,f,p,m),Sc.initNonuniformCatmullRom(n.z,r.z,i.z,o.z,f,p,m)}else"catmullrom"===this.curveType&&(wc.initCatmullRom(n.x,r.x,i.x,o.x,this.tension),Tc.initCatmullRom(n.y,r.y,i.y,o.y,this.tension),Sc.initCatmullRom(n.z,r.z,i.z,o.z,this.tension));return a.set(wc.calc(d),Tc.calc(d),Sc.calc(d)),a},xc.prototype.copy=function(e){gc.prototype.copy.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},xc.prototype.toJSON=function(){var e=gc.prototype.toJSON.call(this);e.points=[];for(var t=0,n=this.points.length;t<n;t++){var r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},xc.prototype.fromJSON=function(e){gc.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push((new Rn).fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Rc.prototype=Object.create(gc.prototype),Rc.prototype.constructor=Rc,Rc.prototype.isCubicBezierCurve=!0,Rc.prototype.getPoint=function(e,t){var n=t||new xn,r=this.v0,i=this.v1,o=this.v2,a=this.v3;return n.set(jc(e,r.x,i.x,o.x,a.x),jc(e,r.y,i.y,o.y,a.y)),n},Rc.prototype.copy=function(e){return gc.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Rc.prototype.toJSON=function(){var e=gc.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Rc.prototype.fromJSON=function(e){return gc.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Lc.prototype=Object.create(gc.prototype),Lc.prototype.constructor=Lc,Lc.prototype.isCubicBezierCurve3=!0,Lc.prototype.getPoint=function(e,t){var n=t||new Rn,r=this.v0,i=this.v1,o=this.v2,a=this.v3;return n.set(jc(e,r.x,i.x,o.x,a.x),jc(e,r.y,i.y,o.y,a.y),jc(e,r.z,i.z,o.z,a.z)),n},Lc.prototype.copy=function(e){return gc.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Lc.prototype.toJSON=function(){var e=gc.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Lc.prototype.fromJSON=function(e){return gc.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Cc.prototype=Object.create(gc.prototype),Cc.prototype.constructor=Cc,Cc.prototype.isLineCurve=!0,Cc.prototype.getPoint=function(e,t){var n=t||new xn;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n},Cc.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Cc.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},Cc.prototype.copy=function(e){return gc.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Cc.prototype.toJSON=function(){var e=gc.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Cc.prototype.fromJSON=function(e){return gc.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},kc.prototype=Object.create(gc.prototype),kc.prototype.constructor=kc,kc.prototype.isLineCurve3=!0,kc.prototype.getPoint=function(e,t){var n=t||new Rn;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n},kc.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},kc.prototype.copy=function(e){return gc.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},kc.prototype.toJSON=function(){var e=gc.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},kc.prototype.fromJSON=function(e){return gc.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Oc.prototype=Object.create(gc.prototype),Oc.prototype.constructor=Oc,Oc.prototype.isQuadraticBezierCurve=!0,Oc.prototype.getPoint=function(e,t){var n=t||new xn,r=this.v0,i=this.v1,o=this.v2;return n.set(Mc(e,r.x,i.x,o.x),Mc(e,r.y,i.y,o.y)),n},Oc.prototype.copy=function(e){return gc.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Oc.prototype.toJSON=function(){var e=gc.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Oc.prototype.fromJSON=function(e){return gc.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Pc.prototype=Object.create(gc.prototype),Pc.prototype.constructor=Pc,Pc.prototype.isQuadraticBezierCurve3=!0,Pc.prototype.getPoint=function(e,t){var n=t||new Rn,r=this.v0,i=this.v1,o=this.v2;return n.set(Mc(e,r.x,i.x,o.x),Mc(e,r.y,i.y,o.y),Mc(e,r.z,i.z,o.z)),n},Pc.prototype.copy=function(e){return gc.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Pc.prototype.toJSON=function(){var e=gc.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Pc.prototype.fromJSON=function(e){return gc.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Ic.prototype=Object.create(gc.prototype),Ic.prototype.constructor=Ic,Ic.prototype.isSplineCurve=!0,Ic.prototype.getPoint=function(e,t){var n=t||new xn,r=this.points,i=(r.length-1)*e,o=Math.floor(i),a=i-o,s=r[0===o?o:o-1],u=r[o],l=r[o>r.length-2?r.length-1:o+1],c=r[o>r.length-3?r.length-1:o+2];return n.set(Ac(a,s.x,u.x,l.x,c.x),Ac(a,s.y,u.y,l.y,c.y)),n},Ic.prototype.copy=function(e){gc.prototype.copy.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push(r.clone())}return this},Ic.prototype.toJSON=function(){var e=gc.prototype.toJSON.call(this);e.points=[];for(var t=0,n=this.points.length;t<n;t++){var r=this.points[t];e.points.push(r.toArray())}return e},Ic.prototype.fromJSON=function(e){gc.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push((new xn).fromArray(r))}return this};var Dc=Object.freeze({__proto__:null,ArcCurve:_c,CatmullRomCurve3:xc,CubicBezierCurve:Rc,CubicBezierCurve3:Lc,EllipseCurve:yc,LineCurve:Cc,LineCurve3:kc,QuadraticBezierCurve:Oc,QuadraticBezierCurve3:Pc,SplineCurve:Ic});function Nc(){gc.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function Bc(e){Nc.call(this),this.type="Path",this.currentPoint=new xn,e&&this.setFromPoints(e)}function Uc(e){Bc.call(this,e),this.uuid=Sn.generateUUID(),this.type="Shape",this.holes=[]}function Fc(e,t){cr.call(this),this.type="Light",this.color=new ti(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}function Vc(e,t,n){Fc.call(this,e,n),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(cr.DefaultUp),this.updateMatrix(),this.groundColor=new ti(t)}function Gc(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new xn(512,512),this.map=null,this.mapPass=null,this.matrix=new qn,this._frustum=new mo,this._frameExtents=new xn(1,1),this._viewportCount=1,this._viewports=[new Dn(0,0,1,1)]}function Hc(){Gc.call(this,new uo(50,1,.5,500))}function zc(e,t,n,r,i,o){Fc.call(this,e,t),this.type="SpotLight",this.position.copy(cr.DefaultUp),this.updateMatrix(),this.target=new cr,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==n?n:0,this.angle=void 0!==r?r:Math.PI/3,this.penumbra=void 0!==i?i:0,this.decay=void 0!==o?o:1,this.shadow=new Hc}function Wc(){Gc.call(this,new uo(90,1,.5,500)),this._frameExtents=new xn(4,2),this._viewportCount=6,this._viewports=[new Dn(2,1,1,1),new Dn(0,1,1,1),new Dn(3,1,1,1),new Dn(1,1,1,1),new Dn(3,0,1,1),new Dn(1,0,1,1)],this._cubeDirections=[new Rn(1,0,0),new Rn(-1,0,0),new Rn(0,0,1),new Rn(0,0,-1),new Rn(0,1,0),new Rn(0,-1,0)],this._cubeUps=[new Rn(0,1,0),new Rn(0,1,0),new Rn(0,1,0),new Rn(0,1,0),new Rn(0,0,1),new Rn(0,0,-1)]}function qc(e,t,n,r){Fc.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==n?n:0,this.decay=void 0!==r?r:1,this.shadow=new Wc}function Kc(e,t,n,r,i,o){so.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==e?e:-1,this.right=void 0!==t?t:1,this.top=void 0!==n?n:1,this.bottom=void 0!==r?r:-1,this.near=void 0!==i?i:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}function Yc(){Gc.call(this,new Kc(-5,5,5,-5,.5,500))}function Xc(e,t){Fc.call(this,e,t),this.type="DirectionalLight",this.position.copy(cr.DefaultUp),this.updateMatrix(),this.target=new cr,this.shadow=new Yc}function Jc(e,t){Fc.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function Zc(e,t,n,r){Fc.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==n?n:10,this.height=void 0!==r?r:10}function $c(e){uc.call(this,e),this.textures={}}Nc.prototype=Object.assign(Object.create(gc.prototype),{constructor:Nc,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Cc(t,e))},getPoint:function(e){for(var t=e*this.getLength(),n=this.getCurveLengths(),r=0;r<n.length;){if(n[r]>=t){var i=n[r]-t,o=this.curves[r],a=o.getLength(),s=0===a?0:1-i/a;return o.getPointAt(s)}r++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,n=[],r=0,i=this.curves;r<i.length;r++)for(var o=i[r],a=o&&o.isEllipseCurve?2*e:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?e*o.points.length:e,s=o.getPoints(a),u=0;u<s.length;u++){var l=s[u];t&&t.equals(l)||(n.push(l),t=l)}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n},copy:function(e){gc.prototype.copy.call(this,e),this.curves=[];for(var t=0,n=e.curves.length;t<n;t++){var r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){var e=gc.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,n=this.curves.length;t<n;t++){var r=this.curves[t];e.curves.push(r.toJSON())}return e},fromJSON:function(e){gc.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,n=e.curves.length;t<n;t++){var r=e.curves[t];this.curves.push((new Dc[r.type]).fromJSON(r))}return this}}),Bc.prototype=Object.assign(Object.create(Nc.prototype),{constructor:Bc,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this},moveTo:function(e,t){return this.currentPoint.set(e,t),this},lineTo:function(e,t){var n=new Cc(this.currentPoint.clone(),new xn(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this},quadraticCurveTo:function(e,t,n,r){var i=new Oc(this.currentPoint.clone(),new xn(e,t),new xn(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this},bezierCurveTo:function(e,t,n,r,i,o){var a=new Rc(this.currentPoint.clone(),new xn(e,t),new xn(n,r),new xn(i,o));return this.curves.push(a),this.currentPoint.set(i,o),this},splineThru:function(e){var t=new Ic([this.currentPoint.clone()].concat(e));return this.curves.push(t),this.currentPoint.copy(e[e.length-1]),this},arc:function(e,t,n,r,i,o){var a=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+a,t+s,n,r,i,o),this},absarc:function(e,t,n,r,i,o){return this.absellipse(e,t,n,n,r,i,o),this},ellipse:function(e,t,n,r,i,o,a,s){var u=this.currentPoint.x,l=this.currentPoint.y;return this.absellipse(e+u,t+l,n,r,i,o,a,s),this},absellipse:function(e,t,n,r,i,o,a,s){var u=new yc(e,t,n,r,i,o,a,s);if(this.curves.length>0){var l=u.getPoint(0);l.equals(this.currentPoint)||this.lineTo(l.x,l.y)}this.curves.push(u);var c=u.getPoint(1);return this.currentPoint.copy(c),this},copy:function(e){return Nc.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=Nc.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return Nc.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),Uc.prototype=Object.assign(Object.create(Bc.prototype),{constructor:Uc,getPointsHoles:function(e){for(var t=[],n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){Bc.prototype.copy.call(this,e),this.holes=[];for(var t=0,n=e.holes.length;t<n;t++){var r=e.holes[t];this.holes.push(r.clone())}return this},toJSON:function(){var e=Bc.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,n=this.holes.length;t<n;t++){var r=this.holes[t];e.holes.push(r.toJSON())}return e},fromJSON:function(e){Bc.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,n=e.holes.length;t<n;t++){var r=e.holes[t];this.holes.push((new Bc).fromJSON(r))}return this}}),Fc.prototype=Object.assign(Object.create(cr.prototype),{constructor:Fc,isLight:!0,copy:function(e){return cr.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=cr.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),Vc.prototype=Object.assign(Object.create(Fc.prototype),{constructor:Vc,isHemisphereLight:!0,copy:function(e){return Fc.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(Gc.prototype,{_projScreenMatrix:new qn,_lightPositionWorld:new Rn,_lookTarget:new Rn,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(e){var t=this.camera,n=this.matrix,r=this._projScreenMatrix,i=this._lookTarget,o=this._lightPositionWorld;o.setFromMatrixPosition(e.matrixWorld),t.position.copy(o),i.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(i),t.updateMatrixWorld(),r.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromMatrix(r),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)},getViewport:function(e){return this._viewports[e]},getFrameExtents:function(){return this._frameExtents},copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),Hc.prototype=Object.assign(Object.create(Gc.prototype),{constructor:Hc,isSpotLightShadow:!0,updateMatrices:function(e){var t=this.camera,n=2*Sn.RAD2DEG*e.angle,r=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;n===t.fov&&r===t.aspect&&i===t.far||(t.fov=n,t.aspect=r,t.far=i,t.updateProjectionMatrix()),Gc.prototype.updateMatrices.call(this,e)}}),zc.prototype=Object.assign(Object.create(Fc.prototype),{constructor:zc,isSpotLight:!0,copy:function(e){return Fc.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),Wc.prototype=Object.assign(Object.create(Gc.prototype),{constructor:Wc,isPointLightShadow:!0,updateMatrices:function(e,t){void 0===t&&(t=0);var n=this.camera,r=this.matrix,i=this._lightPositionWorld,o=this._lookTarget,a=this._projScreenMatrix;i.setFromMatrixPosition(e.matrixWorld),n.position.copy(i),o.copy(n.position),o.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(o),n.updateMatrixWorld(),r.makeTranslation(-i.x,-i.y,-i.z),a.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromMatrix(a)}}),qc.prototype=Object.assign(Object.create(Fc.prototype),{constructor:qc,isPointLight:!0,copy:function(e){return Fc.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),Kc.prototype=Object.assign(Object.create(so.prototype),{constructor:Kc,isOrthographicCamera:!0,copy:function(e,t){return so.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,n,r,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2,i=n-e,o=n+e,a=r+t,s=r-t;if(null!==this.view&&this.view.enabled){var u=this.zoom/(this.view.width/this.view.fullWidth),l=this.zoom/(this.view.height/this.view.fullHeight),c=(this.right-this.left)/this.view.width,d=(this.top-this.bottom)/this.view.height;o=(i+=c*(this.view.offsetX/u))+c*(this.view.width/u),s=(a-=d*(this.view.offsetY/l))-d*(this.view.height/l)}this.projectionMatrix.makeOrthographic(i,o,a,s,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=cr.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),Yc.prototype=Object.assign(Object.create(Gc.prototype),{constructor:Yc,isDirectionalLightShadow:!0,updateMatrices:function(e){Gc.prototype.updateMatrices.call(this,e)}}),Xc.prototype=Object.assign(Object.create(Fc.prototype),{constructor:Xc,isDirectionalLight:!0,copy:function(e){return Fc.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),Jc.prototype=Object.assign(Object.create(Fc.prototype),{constructor:Jc,isAmbientLight:!0}),Zc.prototype=Object.assign(Object.create(Fc.prototype),{constructor:Zc,isRectAreaLight:!0,copy:function(e){return Fc.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){var t=Fc.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}}),$c.prototype=Object.assign(Object.create(uc.prototype),{constructor:$c,load:function(e,t,n,r){var i=this,o=new cc(i.manager);o.setPath(i.path),o.load(e,(function(e){t(i.parse(JSON.parse(e)))}),n,r)},parse:function(e){var t=this.textures;function n(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}var r=new Hl[e.type];if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.sheen&&(r.sheen=(new ti).setHex(e.sheen)),void 0!==e.emissive&&r.emissive.setHex(e.emissive),void 0!==e.specular&&r.specular.setHex(e.specular),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearcoat&&(r.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(r.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.vertexColors&&(r.vertexColors=e.vertexColors),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.combine&&(r.combine=e.combine),void 0!==e.side&&(r.side=e.side),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(r.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(r.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(r.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(r.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(r.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(r.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(r.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(r.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),1!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.polygonOffset&&(r.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(r.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(r.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(r.skinning=e.skinning),void 0!==e.morphTargets&&(r.morphTargets=e.morphTargets),void 0!==e.morphNormals&&(r.morphNormals=e.morphNormals),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.toneMapped&&(r.toneMapped=e.toneMapped),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.uniforms)for(var i in e.uniforms){var o=e.uniforms[i];switch(r.uniforms[i]={},o.type){case"t":r.uniforms[i].value=n(o.value);break;case"c":r.uniforms[i].value=(new ti).setHex(o.value);break;case"v2":r.uniforms[i].value=(new xn).fromArray(o.value);break;case"v3":r.uniforms[i].value=(new Rn).fromArray(o.value);break;case"v4":r.uniforms[i].value=(new Dn).fromArray(o.value);break;case"m3":r.uniforms[i].value=(new kn).fromArray(o.value);case"m4":r.uniforms[i].value=(new qn).fromArray(o.value);break;default:r.uniforms[i].value=o.value}}if(void 0!==e.defines&&(r.defines=e.defines),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(var a in e.extensions)r.extensions[a]=e.extensions[a];if(void 0!==e.shading&&(r.flatShading=1===e.shading),void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(r.map=n(e.map)),void 0!==e.matcap&&(r.matcap=n(e.matcap)),void 0!==e.alphaMap&&(r.alphaMap=n(e.alphaMap),r.transparent=!0),void 0!==e.bumpMap&&(r.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(r.normalMapType=e.normalMapType),void 0!==e.normalScale){var s=e.normalScale;!1===Array.isArray(s)&&(s=[s,s]),r.normalScale=(new xn).fromArray(s)}return void 0!==e.displacementMap&&(r.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=n(e.specularMap)),void 0!==e.envMap&&(r.envMap=n(e.envMap)),void 0!==e.envMapIntensity&&(r.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(r.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(r.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatNormalMap&&(r.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(r.clearcoatNormalScale=(new xn).fromArray(e.clearcoatNormalScale)),r},setTextures:function(e){return this.textures=e,this}});var Qc={decodeText:function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}},extractUrlBase:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}};function ed(){Ri.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function td(e,t,n,r){"number"==typeof n&&(r=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),ci.call(this,e,t,n),this.meshPerAttribute=r||1}function nd(e){uc.call(this,e)}ed.prototype=Object.assign(Object.create(Ri.prototype),{constructor:ed,isInstancedBufferGeometry:!0,copy:function(e){return Ri.prototype.copy.call(this,e),this.maxInstancedCount=e.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e=Ri.prototype.toJSON.call(this);return e.maxInstancedCount=this.maxInstancedCount,e.isInstancedBufferGeometry=!0,e}}),td.prototype=Object.assign(Object.create(ci.prototype),{constructor:td,isInstancedBufferAttribute:!0,copy:function(e){return ci.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:function(){var e=ci.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}),nd.prototype=Object.assign(Object.create(uc.prototype),{constructor:nd,load:function(e,t,n,r){var i=this,o=new cc(i.manager);o.setPath(i.path),o.load(e,(function(e){t(i.parse(JSON.parse(e)))}),n,r)},parse:function(e){var t=e.isInstancedBufferGeometry?new ed:new Ri,n=e.data.index;if(void 0!==n){var r=new rd[n.type](n.array);t.setIndex(new ci(r,1))}var i=e.data.attributes;for(var o in i){var a=i[o],s=(r=new rd[a.type](a.array),new(a.isInstancedBufferAttribute?td:ci)(r,a.itemSize,a.normalized));void 0!==a.name&&(s.name=a.name),t.setAttribute(o,s)}var u=e.data.morphAttributes;if(u)for(var o in u){for(var l=u[o],c=[],d=0,h=l.length;d<h;d++){a=l[d],s=new ci(r=new rd[a.type](a.array),a.itemSize,a.normalized);void 0!==a.name&&(s.name=a.name),c.push(s)}t.morphAttributes[o]=c}e.data.morphTargetsRelative&&(t.morphTargetsRelative=!0);var f=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==f){d=0;for(var p=f.length;d!==p;++d){var m=f[d];t.addGroup(m.start,m.count,m.materialIndex)}}var v=e.data.boundingSphere;if(void 0!==v){var g=new Rn;void 0!==v.center&&g.fromArray(v.center),t.boundingSphere=new jr(g,v.radius)}return e.name&&(t.name=e.name),e.userData&&(t.userData=e.userData),t}});var rd={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function id(e){uc.call(this,e)}id.prototype=Object.assign(Object.create(uc.prototype),{constructor:id,load:function(e,t,n,r){var i=this,o=""===this.path?Qc.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;var a=new cc(i.manager);a.setPath(this.path),a.load(e,(function(n){var o=null;try{o=JSON.parse(n)}catch(t){return void 0!==r&&r(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}var a=o.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()?i.parse(o,t):console.error("THREE.ObjectLoader: Can't load "+e)}),n,r)},parse:function(e,t){var n=this.parseShape(e.shapes),r=this.parseGeometries(e.geometries,n),i=this.parseImages(e.images,(function(){void 0!==t&&t(s)})),o=this.parseTextures(e.textures,i),a=this.parseMaterials(e.materials,o),s=this.parseObject(e.object,r,a);return e.animations&&(s.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0!==t&&t(s),s},parseShape:function(e){var t={};if(void 0!==e)for(var n=0,r=e.length;n<r;n++){var i=(new Uc).fromJSON(e[n]);t[i.uuid]=i}return t},parseGeometries:function(e,t){var n={};if(void 0!==e)for(var r=new nd,i=0,o=e.length;i<o;i++){var a,s=e[i];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":a=new kl[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":a=new kl[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":a=new kl[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":a=new kl[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":a=new kl[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":a=new kl[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":a=new kl[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":a=new kl[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":a=new kl[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":a=new kl[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"TubeGeometry":case"TubeBufferGeometry":a=new kl[s.type]((new Dc[s.path.type]).fromJSON(s.path),s.tubularSegments,s.radius,s.radialSegments,s.closed);break;case"LatheGeometry":case"LatheBufferGeometry":a=new kl[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":a=new kl[s.type](s.vertices,s.indices,s.radius,s.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var u=[],l=0,c=s.shapes.length;l<c;l++){var d=t[s.shapes[l]];u.push(d)}a=new kl[s.type](u,s.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(u=[],l=0,c=s.shapes.length;l<c;l++){d=t[s.shapes[l]];u.push(d)}var h=s.options.extrudePath;void 0!==h&&(s.options.extrudePath=(new Dc[h.type]).fromJSON(h)),a=new kl[s.type](u,s.options);break;case"BufferGeometry":case"InstancedBufferGeometry":a=r.parse(s);break;case"Geometry":if("THREE"in window&&"LegacyJSONLoader"in THREE)a=(new THREE.LegacyJSONLoader).parse(s,this.resourcePath).geometry;else console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),!0===a.isBufferGeometry&&void 0!==s.userData&&(a.userData=s.userData),n[s.uuid]=a}return n},parseMaterials:function(e,t){var n={},r={};if(void 0!==e){var i=new $c;i.setTextures(t);for(var o=0,a=e.length;o<a;o++){var s=e[o];if("MultiMaterial"===s.type){for(var u=[],l=0;l<s.materials.length;l++){var c=s.materials[l];void 0===n[c.uuid]&&(n[c.uuid]=i.parse(c)),u.push(n[c.uuid])}r[s.uuid]=u}else void 0===n[s.uuid]&&(n[s.uuid]=i.parse(s)),r[s.uuid]=n[s.uuid]}}return r},parseAnimations:function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n],i=rc.parse(r);void 0!==r.uuid&&(i.uuid=r.uuid),t.push(i)}return t},parseImages:function(e,t){var n=this,r={};function i(e){return n.manager.itemStart(e),o.load(e,(function(){n.manager.itemEnd(e)}),void 0,(function(){n.manager.itemError(e),n.manager.itemEnd(e)}))}if(void 0!==e&&e.length>0){var o=new pc(new ac(t));o.setCrossOrigin(this.crossOrigin);for(var a=0,s=e.length;a<s;a++){var u=e[a],l=u.url;if(Array.isArray(l)){r[u.uuid]=[];for(var c=0,d=l.length;c<d;c++){var h=l[c],f=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(h)?h:n.resourcePath+h;r[u.uuid].push(i(f))}}else{f=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(u.url)?u.url:n.resourcePath+u.url;r[u.uuid]=i(f)}}}return r},parseTextures:function(e,t){function n(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var r={};if(void 0!==e)for(var i=0,o=e.length;i<o;i++){var a,s=e[i];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===t[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image),(a=Array.isArray(t[s.image])?new Po(t[s.image]):new In(t[s.image])).needsUpdate=!0,a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),void 0!==s.mapping&&(a.mapping=n(s.mapping,ad)),void 0!==s.offset&&a.offset.fromArray(s.offset),void 0!==s.repeat&&a.repeat.fromArray(s.repeat),void 0!==s.center&&a.center.fromArray(s.center),void 0!==s.rotation&&(a.rotation=s.rotation),void 0!==s.wrap&&(a.wrapS=n(s.wrap[0],sd),a.wrapT=n(s.wrap[1],sd)),void 0!==s.format&&(a.format=s.format),void 0!==s.type&&(a.type=s.type),void 0!==s.encoding&&(a.encoding=s.encoding),void 0!==s.minFilter&&(a.minFilter=n(s.minFilter,ud)),void 0!==s.magFilter&&(a.magFilter=n(s.magFilter,ud)),void 0!==s.anisotropy&&(a.anisotropy=s.anisotropy),void 0!==s.flipY&&(a.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(a.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(a.unpackAlignment=s.unpackAlignment),r[s.uuid]=a}return r},parseObject:function(e,t,n){var r;function i(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function o(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],r=0,i=e.length;r<i;r++){var o=e[r];void 0===n[o]&&console.warn("THREE.ObjectLoader: Undefined material",o),t.push(n[o])}return t}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}switch(e.type){case"Scene":r=new dr,void 0!==e.background&&Number.isInteger(e.background)&&(r.background=new ti(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?r.fog=new _s(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(r.fog=new ys(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":r=new uo(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(r.focus=e.focus),void 0!==e.zoom&&(r.zoom=e.zoom),void 0!==e.filmGauge&&(r.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(r.filmOffset=e.filmOffset),void 0!==e.view&&(r.view=Object.assign({},e.view));break;case"OrthographicCamera":r=new Kc(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(r.zoom=e.zoom),void 0!==e.view&&(r.view=Object.assign({},e.view));break;case"AmbientLight":r=new Jc(e.color,e.intensity);break;case"DirectionalLight":r=new Xc(e.color,e.intensity);break;case"PointLight":r=new qc(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":r=new Zc(e.color,e.intensity,e.width,e.height);break;case"SpotLight":r=new zc(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":r=new Vc(e.color,e.groundColor,e.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var a=i(e.geometry),s=o(e.material);r=a.bones&&a.bones.length>0?new Gs(a,s):new Ki(a,s);break;case"InstancedMesh":a=i(e.geometry),s=o(e.material);var u=e.count,l=e.instanceMatrix;(r=new Zs(a,s,u)).instanceMatrix=new ci(new Float32Array(l.array),16);break;case"LOD":r=new Vs;break;case"Line":r=new iu(i(e.geometry),o(e.material),e.mode);break;case"LineLoop":r=new uu(i(e.geometry),o(e.material));break;case"LineSegments":r=new su(i(e.geometry),o(e.material));break;case"PointCloud":case"Points":r=new pu(i(e.geometry),o(e.material));break;case"Sprite":r=new Ns(o(e.material));break;case"Group":r=new ms;break;default:r=new cr}if(r.uuid=e.uuid,void 0!==e.name&&(r.name=e.name),void 0!==e.matrix?(r.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(r.matrixAutoUpdate=e.matrixAutoUpdate),r.matrixAutoUpdate&&r.matrix.decompose(r.position,r.quaternion,r.scale)):(void 0!==e.position&&r.position.fromArray(e.position),void 0!==e.rotation&&r.rotation.fromArray(e.rotation),void 0!==e.quaternion&&r.quaternion.fromArray(e.quaternion),void 0!==e.scale&&r.scale.fromArray(e.scale)),void 0!==e.castShadow&&(r.castShadow=e.castShadow),void 0!==e.receiveShadow&&(r.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(r.shadow.bias=e.shadow.bias),void 0!==e.shadow.radius&&(r.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&r.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(r.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.frustumCulled&&(r.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(r.renderOrder=e.renderOrder),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.layers&&(r.layers.mask=e.layers),void 0!==e.children)for(var c=e.children,d=0;d<c.length;d++)r.add(this.parseObject(c[d],t,n));if("LOD"===e.type){void 0!==e.autoUpdate&&(r.autoUpdate=e.autoUpdate);for(var h=e.levels,f=0;f<h.length;f++){var p=h[f],m=r.getObjectByProperty("uuid",p.object);void 0!==m&&r.addLevel(m,p.distance)}}return r}});var od,ad={UVMapping:le,CubeReflectionMapping:ce,CubeRefractionMapping:de,EquirectangularReflectionMapping:he,EquirectangularRefractionMapping:fe,SphericalReflectionMapping:pe,CubeUVReflectionMapping:me,CubeUVRefractionMapping:ve},sd={RepeatWrapping:ge,ClampToEdgeWrapping:ye,MirroredRepeatWrapping:_e},ud={NearestFilter:be,NearestMipmapNearestFilter:Ee,NearestMipmapLinearFilter:Te,LinearFilter:xe,LinearMipmapNearestFilter:Ae,LinearMipmapLinearFilter:je};function ld(e){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),uc.call(this,e),this.options=void 0}function cd(){this.type="ShapePath",this.color=new ti,this.subPaths=[],this.currentPath=null}function dd(e){this.type="Font",this.data=e}function hd(e,t,n,r,i){var o=i.glyphs[e]||i.glyphs["?"];if(o){var a,s,u,l,c,d,h,f,p=new cd;if(o.o)for(var m=o._cachedOutline||(o._cachedOutline=o.o.split(" ")),v=0,g=m.length;v<g;){switch(m[v++]){case"m":a=m[v++]*t+n,s=m[v++]*t+r,p.moveTo(a,s);break;case"l":a=m[v++]*t+n,s=m[v++]*t+r,p.lineTo(a,s);break;case"q":u=m[v++]*t+n,l=m[v++]*t+r,c=m[v++]*t+n,d=m[v++]*t+r,p.quadraticCurveTo(c,d,u,l);break;case"b":u=m[v++]*t+n,l=m[v++]*t+r,c=m[v++]*t+n,d=m[v++]*t+r,h=m[v++]*t+n,f=m[v++]*t+r,p.bezierCurveTo(c,d,h,f,u,l)}}return{offsetX:o.ha*t,path:p}}console.error('THREE.Font: character "'+e+'" does not exists in font family '+i.familyName+".")}function fd(e){uc.call(this,e)}ld.prototype=Object.assign(Object.create(uc.prototype),{constructor:ld,setOptions:function(e){return this.options=e,this},load:function(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,o=oc.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout((function(){t&&t(o),i.manager.itemEnd(e)}),0),o;fetch(e).then((function(e){return e.blob()})).then((function(e){return void 0===i.options?createImageBitmap(e):createImageBitmap(e,i.options)})).then((function(n){oc.add(e,n),t&&t(n),i.manager.itemEnd(e)})).catch((function(t){r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)})),i.manager.itemStart(e)}}),Object.assign(cd.prototype,{moveTo:function(e,t){return this.currentPath=new Bc,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this},lineTo:function(e,t){return this.currentPath.lineTo(e,t),this},quadraticCurveTo:function(e,t,n,r){return this.currentPath.quadraticCurveTo(e,t,n,r),this},bezierCurveTo:function(e,t,n,r,i,o){return this.currentPath.bezierCurveTo(e,t,n,r,i,o),this},splineThru:function(e){return this.currentPath.splineThru(e),this},toShapes:function(e,t){function n(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n],o=new Uc;o.curves=i.curves,t.push(o)}return t}function r(e,t){for(var n=t.length,r=!1,i=n-1,o=0;o<n;i=o++){var a=t[i],s=t[o],u=s.x-a.x,l=s.y-a.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(a=t[o],u=-u,s=t[i],l=-l),e.y<a.y||e.y>s.y)continue;if(e.y===a.y){if(e.x===a.x)return!0}else{var c=l*(e.x-a.x)-u*(e.y-a.y);if(0===c)return!0;if(c<0)continue;r=!r}}else{if(e.y!==a.y)continue;if(s.x<=e.x&&e.x<=a.x||a.x<=e.x&&e.x<=s.x)return!0}}return r}var i=sl.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===t)return n(o);var a,s,u,l=[];if(1===o.length)return s=o[0],(u=new Uc).curves=s.curves,l.push(u),l;var c=!i(o[0].getPoints());c=e?!c:c;var d,h,f=[],p=[],m=[],v=0;p[v]=void 0,m[v]=[];for(var g=0,y=o.length;g<y;g++)a=i(d=(s=o[g]).getPoints()),(a=e?!a:a)?(!c&&p[v]&&v++,p[v]={s:new Uc,p:d},p[v].s.curves=s.curves,c&&v++,m[v]=[]):m[v].push({h:s,p:d[0]});if(!p[0])return n(o);if(p.length>1){for(var _=!1,b=[],E=0,w=p.length;E<w;E++)f[E]=[];for(E=0,w=p.length;E<w;E++)for(var T=m[E],S=0;S<T.length;S++){for(var x=T[S],A=!0,M=0;M<p.length;M++)r(x.p,p[M].p)&&(E!==M&&b.push({froms:E,tos:M,hole:S}),A?(A=!1,f[M].push(x)):_=!0);A&&f[E].push(x)}b.length>0&&(_||(m=f))}g=0;for(var j=p.length;g<j;g++){u=p[g].s,l.push(u);for(var R=0,L=(h=m[g]).length;R<L;R++)u.holes.push(h[R].h)}return l}}),Object.assign(dd.prototype,{isFont:!0,generateShapes:function(e,t){void 0===t&&(t=100);for(var n=[],r=function(e,t,n){for(var r=Array.from?Array.from(e):String(e).split(""),i=t/n.resolution,o=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*i,a=[],s=0,u=0,l=0;l<r.length;l++){var c=r[l];if("\n"===c)s=0,u-=o;else{var d=hd(c,i,s,u,n);s+=d.offsetX,a.push(d.path)}}return a}(e,t,this.data),i=0,o=r.length;i<o;i++)Array.prototype.push.apply(n,r[i].toShapes());return n}}),fd.prototype=Object.assign(Object.create(uc.prototype),{constructor:fd,load:function(e,t,n,r){var i=this,o=new cc(this.manager);o.setPath(this.path),o.load(e,(function(e){var n;try{n=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(e.substring(65,e.length-2))}var r=i.parse(n);t&&t(r)}),n,r)},parse:function(e){return new dd(e)}});var pd={getContext:function(){return void 0===od&&(od=new(window.AudioContext||window.webkitAudioContext)),od},setContext:function(e){od=e}};function md(e){uc.call(this,e)}function vd(){this.coefficients=[];for(var e=0;e<9;e++)this.coefficients.push(new Rn)}function gd(e,t){Fc.call(this,void 0,t),this.sh=void 0!==e?e:new vd}function yd(e,t,n){gd.call(this,void 0,n);var r=(new ti).set(e),i=(new ti).set(t),o=new Rn(r.r,r.g,r.b),a=new Rn(i.r,i.g,i.b),s=Math.sqrt(Math.PI),u=s*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(a).multiplyScalar(s),this.sh.coefficients[1].copy(o).sub(a).multiplyScalar(u)}function _d(e,t){gd.call(this,void 0,t);var n=(new ti).set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}md.prototype=Object.assign(Object.create(uc.prototype),{constructor:md,load:function(e,t,n,r){var i=new cc(this.manager);i.setResponseType("arraybuffer"),i.setPath(this.path),i.load(e,(function(e){var n=e.slice(0);pd.getContext().decodeAudioData(n,(function(e){t(e)}))}),n,r)}}),Object.assign(vd.prototype,{isSphericalHarmonics3:!0,set:function(e){for(var t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this},zero:function(){for(var e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this},getAt:function(e,t){var n=e.x,r=e.y,i=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScale(o[1],.488603*r),t.addScale(o[2],.488603*i),t.addScale(o[3],.488603*n),t.addScale(o[4],n*r*1.092548),t.addScale(o[5],r*i*1.092548),t.addScale(o[6],.315392*(3*i*i-1)),t.addScale(o[7],n*i*1.092548),t.addScale(o[8],.546274*(n*n-r*r)),t},getIrradianceAt:function(e,t){var n=e.x,r=e.y,i=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScale(o[1],1.023328*r),t.addScale(o[2],1.023328*i),t.addScale(o[3],1.023328*n),t.addScale(o[4],.858086*n*r),t.addScale(o[5],.858086*r*i),t.addScale(o[6],.743125*i*i-.247708),t.addScale(o[7],.858086*n*i),t.addScale(o[8],.429043*(n*n-r*r)),t},add:function(e){for(var t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this},scale:function(e){for(var t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this},lerp:function(e,t){for(var n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this},equals:function(e){for(var t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0},copy:function(e){return this.set(e.coefficients)},clone:function(){return(new this.constructor).copy(this)},fromArray:function(e,t){void 0===t&&(t=0);for(var n=this.coefficients,r=0;r<9;r++)n[r].fromArray(e,t+3*r);return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);for(var n=this.coefficients,r=0;r<9;r++)n[r].toArray(e,t+3*r);return e}}),Object.assign(vd,{getBasisAt:function(e,t){var n=e.x,r=e.y,i=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*i,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*i,t[6]=.315392*(3*i*i-1),t[7]=1.092548*n*i,t[8]=.546274*(n*n-r*r)}}),gd.prototype=Object.assign(Object.create(Fc.prototype),{constructor:gd,isLightProbe:!0,copy:function(e){return Fc.prototype.copy.call(this,e),this.sh.copy(e.sh),this.intensity=e.intensity,this},toJSON:function(e){return Fc.prototype.toJSON.call(this,e)}}),yd.prototype=Object.assign(Object.create(gd.prototype),{constructor:yd,isHemisphereLightProbe:!0,copy:function(e){return gd.prototype.copy.call(this,e),this},toJSON:function(e){return gd.prototype.toJSON.call(this,e)}}),_d.prototype=Object.assign(Object.create(gd.prototype),{constructor:_d,isAmbientLightProbe:!0,copy:function(e){return gd.prototype.copy.call(this,e),this},toJSON:function(e){return gd.prototype.toJSON.call(this,e)}});var bd=new qn,Ed=new qn;function wd(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new uo,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new uo,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}function Td(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}Object.assign(wd.prototype,{update:function(e){var t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;var n,r,i=e.projectionMatrix.clone(),o=t.eyeSep/2,a=o*t.near/t.focus,s=t.near*Math.tan(Sn.DEG2RAD*t.fov*.5)/t.zoom;Ed.elements[12]=-o,bd.elements[12]=o,n=-s*t.aspect+a,r=s*t.aspect+a,i.elements[0]=2*t.near/(r-n),i.elements[8]=(r+n)/(r-n),this.cameraL.projectionMatrix.copy(i),n=-s*t.aspect-a,r=s*t.aspect-a,i.elements[0]=2*t.near/(r-n),i.elements[8]=(r+n)/(r-n),this.cameraR.projectionMatrix.copy(i)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Ed),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(bd)}}),Object.assign(Td.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}});var Sd=new Rn,xd=new An,Ad=new Rn,Md=new Rn;function jd(){cr.call(this),this.type="AudioListener",this.context=pd.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Td}function Rd(e){cr.call(this),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this._startedAt=0,this._pausedAt=0,this.filters=[]}jd.prototype=Object.assign(Object.create(cr.prototype),{constructor:jd,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},updateMatrixWorld:function(e){cr.prototype.updateMatrixWorld.call(this,e);var t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Sd,xd,Ad),Md.set(0,0,-1).applyQuaternion(xd),t.positionX){var r=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Sd.x,r),t.positionY.linearRampToValueAtTime(Sd.y,r),t.positionZ.linearRampToValueAtTime(Sd.z,r),t.forwardX.linearRampToValueAtTime(Md.x,r),t.forwardY.linearRampToValueAtTime(Md.y,r),t.forwardZ.linearRampToValueAtTime(Md.z,r),t.upX.linearRampToValueAtTime(n.x,r),t.upY.linearRampToValueAtTime(n.y,r),t.upZ.linearRampToValueAtTime(n.z,r)}else t.setPosition(Sd.x,Sd.y,Sd.z),t.setOrientation(Md.x,Md.y,Md.z,n.x,n.y,n.z)}}),Rd.prototype=Object.assign(Object.create(cr.prototype),{constructor:Rd,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setMediaElementSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},setMediaStreamSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(e){if(void 0===e&&(e=0),!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+e;var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._pausedAt+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._pausedAt=(this.context.currentTime-this._startedAt)*this.playbackRate,this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this._pausedAt=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},setDetune:function(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},setLoopStart:function(e){return this.loopStart=e,this},setLoopEnd:function(e){return this.loopEnd=e,this},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}});var Ld=new Rn,Cd=new An,kd=new Rn,Od=new Rn;function Pd(e){Rd.call(this,e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}function Id(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}function Dd(e,t,n){this.binding=e,this.valueSize=n;var r,i=Float64Array;switch(t){case"quaternion":r=this._slerp;break;case"string":case"bool":i=Array,r=this._select;break;default:r=this._lerp}this.buffer=new i(4*n),this._mixBufferRegion=r,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}Pd.prototype=Object.assign(Object.create(Rd.prototype),{constructor:Pd,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){return this.panner.refDistance=e,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){return this.panner.rolloffFactor=e,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){return this.panner.distanceModel=e,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){return this.panner.maxDistance=e,this},setDirectionalCone:function(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this},updateMatrixWorld:function(e){if(cr.prototype.updateMatrixWorld.call(this,e),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(Ld,Cd,kd),Od.set(0,0,1).applyQuaternion(Cd);var t=this.panner;if(t.positionX){var n=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Ld.x,n),t.positionY.linearRampToValueAtTime(Ld.y,n),t.positionZ.linearRampToValueAtTime(Ld.z,n),t.orientationX.linearRampToValueAtTime(Od.x,n),t.orientationY.linearRampToValueAtTime(Od.y,n),t.orientationZ.linearRampToValueAtTime(Od.z,n)}else t.setPosition(Ld.x,Ld.y,Ld.z),t.setOrientation(Od.x,Od.y,Od.z)}}}),Object.assign(Id.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),n=0;n<t.length;n++)e+=t[n];return e/t.length}}),Object.assign(Dd.prototype,{accumulate:function(e,t){var n=this.buffer,r=this.valueSize,i=e*r+r,o=this.cumulativeWeight;if(0===o){for(var a=0;a!==r;++a)n[i+a]=n[a];o=t}else{var s=t/(o+=t);this._mixBufferRegion(n,i,0,s,r)}this.cumulativeWeight=o},apply:function(e){var t=this.valueSize,n=this.buffer,r=e*t+t,i=this.cumulativeWeight,o=this.binding;if(this.cumulativeWeight=0,i<1){var a=3*t;this._mixBufferRegion(n,r,a,1-i,t)}for(var s=t,u=t+t;s!==u;++s)if(n[s]!==n[s+t]){o.setValue(n,r);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,n=this.valueSize,r=3*n;e.getValue(t,r);for(var i=n,o=r;i!==o;++i)t[i]=t[r+i%n];this.cumulativeWeight=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_select:function(e,t,n,r,i){if(r>=.5)for(var o=0;o!==i;++o)e[t+o]=e[n+o]},_slerp:function(e,t,n,r){An.slerpFlat(e,t,e,t,e,n,r)},_lerp:function(e,t,n,r,i){for(var o=1-r,a=0;a!==i;++a){var s=t+a;e[s]=e[s]*o+e[n+a]*r}}});var Nd=new RegExp("[\\[\\]\\.:\\/]","g"),Bd="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",Ud=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),Fd=/(WCOD+)?/.source.replace("WCOD",Bd),Vd=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),Gd=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),Hd=new RegExp("^"+Ud+Fd+Vd+Gd+"$"),zd=["material","materials","bones"];function Wd(e,t,n){var r=n||qd.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}function qd(e,t,n){this.path=t,this.parsedPath=n||qd.parseTrackName(t),this.node=qd.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function Kd(){this.uuid=Sn.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,n=arguments.length;t!==n;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}}function Yd(e,t,n){this._mixer=e,this._clip=t,this._localRoot=n||null;for(var r=t.tracks,i=r.length,o=new Array(i),a={endingStart:Ct,endingEnd:Ct},s=0;s!==i;++s){var u=r[s].createInterpolant(null);o[s]=u,u.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(i),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=At,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function Xd(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function Jd(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}function Zd(e,t,n){bs.call(this,e,t),this.meshPerAttribute=n||1}function $d(e,t,n,r){this.ray=new Dr(e,t),this.near=n||0,this.far=r||1/0,this.camera=null,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function Qd(e,t){return e.distance-t.distance}function eh(e,t,n,r){if(!1!==e.visible&&(e.raycast(t,n),!0===r))for(var i=e.children,o=0,a=i.length;o<a;o++)eh(i[o],t,n,!0)}function th(e,t,n){return this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==n?n:0,this}function nh(e,t,n){return this.radius=void 0!==e?e:1,this.theta=void 0!==t?t:0,this.y=void 0!==n?n:0,this}Object.assign(Wd.prototype,{getValue:function(e,t){this.bind();var n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)},setValue:function(e,t){for(var n=this._bindings,r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}),Object.assign(qd,{Composite:Wd,create:function(e,t,n){return e&&e.isAnimationObjectGroup?new qd.Composite(e,t,n):new qd(e,t,n)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(Nd,"")},parseTrackName:function(e){var t=Hd.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){var i=n.nodeName.substring(r+1);-1!==zd.indexOf(i)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=i)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n},findNode:function(e,t){if(!t||""===t||"root"===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){var r=function(e){for(var n=0;n<e.length;n++){var i=e[n];if(i.name===t||i.uuid===t)return i;var o=r(i.children);if(o)return o}return null},i=r(e.children);if(i)return i}return null}}),Object.assign(qd.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)e[t++]=n[r]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++]},function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,n=t.objectName,r=t.propertyName,i=t.propertyIndex;if(e||(e=qd.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(n){var o=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(var a=0;a<e.length;a++)if(e[a].name===o){o=a;break}break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==o){if(void 0===e[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[o]}}var s=e[r];if(void 0!==s){var u=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?u=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(u=this.Versioning.MatrixWorldNeedsUpdate);var l=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(a=0;a<this.node.geometry.morphAttributes.position.length;a++)if(e.geometry.morphAttributes.position[a].name===i){i=a;break}}else{if(!e.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(a=0;a<this.node.geometry.morphTargets.length;a++)if(e.geometry.morphTargets[a].name===i){i=a;break}}}l=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else void 0!==s.fromArray&&void 0!==s.toArray?(l=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(l=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][u]}else{var c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+r+" but it wasn't found.",e)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(qd.prototype,{_getValue_unbound:qd.prototype.getValue,_setValue_unbound:qd.prototype.setValue}),Object.assign(Kd.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=e.length,n=this.nCachedObjects_,r=this._indicesByUUID,i=this._paths,o=this._parsedPaths,a=this._bindings,s=a.length,u=void 0,l=0,c=arguments.length;l!==c;++l){var d=arguments[l],h=d.uuid,f=r[h];if(void 0===f){f=t++,r[h]=f,e.push(d);for(var p=0,m=s;p!==m;++p)a[p].push(new qd(d,i[p],o[p]))}else if(f<n){u=e[f];var v=--n,g=e[v];r[g.uuid]=f,e[f]=g,r[h]=v,e[v]=d;for(p=0,m=s;p!==m;++p){var y=a[p],_=y[v],b=y[f];y[f]=_,void 0===b&&(b=new qd(d,i[p],o[p])),y[v]=b}}else e[f]!==u&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=n},remove:function(){for(var e=this._objects,t=this.nCachedObjects_,n=this._indicesByUUID,r=this._bindings,i=r.length,o=0,a=arguments.length;o!==a;++o){var s=arguments[o],u=s.uuid,l=n[u];if(void 0!==l&&l>=t){var c=t++,d=e[c];n[d.uuid]=l,e[l]=d,n[u]=c,e[c]=s;for(var h=0,f=i;h!==f;++h){var p=r[h],m=p[c],v=p[l];p[l]=m,p[c]=v}}}this.nCachedObjects_=t},uncache:function(){for(var e=this._objects,t=e.length,n=this.nCachedObjects_,r=this._indicesByUUID,i=this._bindings,o=i.length,a=0,s=arguments.length;a!==s;++a){var u=arguments[a],l=u.uuid,c=r[l];if(void 0!==c)if(delete r[l],c<n){var d=--n,h=e[d],f=e[y=--t];r[h.uuid]=c,e[c]=h,r[f.uuid]=d,e[d]=f,e.pop();for(var p=0,m=o;p!==m;++p){var v=(_=i[p])[d],g=_[y];_[c]=v,_[d]=g,_.pop()}}else{var y;r[(f=e[y=--t]).uuid]=c,e[c]=f,e.pop();for(p=0,m=o;p!==m;++p){var _;(_=i[p])[c]=_[y],_.pop()}}}this.nCachedObjects_=n},subscribe_:function(e,t){var n=this._bindingsIndicesByPath,r=n[e],i=this._bindings;if(void 0!==r)return i[r];var o=this._paths,a=this._parsedPaths,s=this._objects,u=s.length,l=this.nCachedObjects_,c=new Array(u);r=i.length,n[e]=r,o.push(e),a.push(t),i.push(c);for(var d=l,h=s.length;d!==h;++d){var f=s[d];c[d]=new qd(f,e,t)}return c},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){var r=this._paths,i=this._parsedPaths,o=this._bindings,a=o.length-1,s=o[a];t[e[a]]=n,o[n]=s,o.pop(),i[n]=i[a],i.pop(),r[n]=r[a],r.pop()}}}),Object.assign(Yd.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){var r=this._clip.duration,i=e._clip.duration,o=i/r,a=r/i;e.warp(1,o,t),this.warp(a,1,t)}return this},crossFadeTo:function(e,t,n){return e.crossFadeFrom(this,t,n)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,n){var r=this._mixer,i=r.time,o=this._timeScaleInterpolant,a=this.timeScale;null===o&&(o=r._lendControlInterpolant(),this._timeScaleInterpolant=o);var s=o.parameterPositions,u=o.sampleValues;return s[0]=i,s[1]=i+n,u[0]=e/a,u[1]=t/a,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,n,r){if(this.enabled){var i=this._startTime;if(null!==i){var o=(e-i)*n;if(o<0||0===n)return;this._startTime=null,t=n*o}t*=this._updateTimeScale(e);var a=this._updateTime(t),s=this._updateWeight(e);if(s>0)for(var u=this._interpolants,l=this._propertyBindings,c=0,d=u.length;c!==d;++c)u[c].evaluate(a),l[c].accumulate(r,s)}else this._updateWeight(e)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var n=this._weightInterpolant;if(null!==n){var r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var n=this._timeScaleInterpolant;if(null!==n)t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}return this._effectiveTimeScale=t,t},_updateTime:function(e){var t=this.time+e,n=this._clip.duration,r=this.loop,i=this._loopCount,o=r===Mt;if(0===e)return-1===i?t:o&&1==(1&i)?n-t:t;if(r===xt){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(t>=n)t=n;else{if(!(t<0)){this.time=t;break e}t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===i&&(e>=0?(i=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),t>=n||t<0){var a=Math.floor(t/n);t-=n*a,i+=Math.abs(a);var s=this.repetitions-i;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=e>0?n:0,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){var u=e<0;this._setEndings(u,!u,o)}else this._setEndings(!1,!1,o);this._loopCount=i,this.time=t,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=t;if(o&&1==(1&i))return n-t}return t},_setEndings:function(e,t,n){var r=this._interpolantSettings;n?(r.endingStart=kt,r.endingEnd=kt):(r.endingStart=e?this.zeroSlopeAtStart?kt:Ct:Ot,r.endingEnd=t?this.zeroSlopeAtEnd?kt:Ct:Ot)},_scheduleFading:function(e,t,n){var r=this._mixer,i=r.time,o=this._weightInterpolant;null===o&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);var a=o.parameterPositions,s=o.sampleValues;return a[0]=i,s[0]=t,a[1]=i+e,s[1]=n,this}}),Xd.prototype=Object.assign(Object.create(En.prototype),{constructor:Xd,_bindAction:function(e,t){var n=e._localRoot||this._root,r=e._clip.tracks,i=r.length,o=e._propertyBindings,a=e._interpolants,s=n.uuid,u=this._bindingsByRootAndName,l=u[s];void 0===l&&(l={},u[s]=l);for(var c=0;c!==i;++c){var d=r[c],h=d.name,f=l[h];if(void 0!==f)o[c]=f;else{if(void 0!==(f=o[c])){null===f._cacheIndex&&(++f.referenceCount,this._addInactiveBinding(f,s,h));continue}var p=t&&t._propertyBindings[c].binding.parsedPath;++(f=new Dd(qd.create(n,h,p),d.ValueTypeName,d.getValueSize())).referenceCount,this._addInactiveBinding(f,s,h),o[c]=f}a[c].resultBuffer=f.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,n=e._clip.uuid,r=this._actionsByClip[n];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,n,t)}for(var i=e._propertyBindings,o=0,a=i.length;o!==a;++o){var s=i[o];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,n=0,r=t.length;n!==r;++n){var i=t[n];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,n){var r=this._actions,i=this._actionsByClip,o=i[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=o;else{var a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=r.length,r.push(e),o.actionByRoot[n]=e},_removeInactiveAction:function(e){var t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null;var i=e._clip.uuid,o=this._actionsByClip,a=o[i],s=a.knownActions,u=s[s.length-1],l=e._byClipCacheIndex;u._byClipCacheIndex=l,s[l]=u,s.pop(),e._byClipCacheIndex=null,delete a.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete o[i],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,n=0,r=t.length;n!==r;++n){var i=t[n];0==--i.referenceCount&&this._removeInactiveBinding(i)}},_lendAction:function(e){var t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_takeBackAction:function(e){var t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_addInactiveBinding:function(e,t,n){var r=this._bindingsByRootAndName,i=r[t],o=this._bindings;void 0===i&&(i={},r[t]=i),i[n]=e,e._cacheIndex=o.length,o.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,n=e.binding,r=n.rootNode.uuid,i=n.path,o=this._bindingsByRootAndName,a=o[r],s=t[t.length-1],u=e._cacheIndex;s._cacheIndex=u,t[u]=s,t.pop(),delete a[i],0===Object.keys(a).length&&delete o[r]},_lendBinding:function(e){var t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_takeBackBinding:function(e){var t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,n=e[t];return void 0===n&&((n=new Kl(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=n),n},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,i=t[r];e.__cacheIndex=r,t[r]=e,i.__cacheIndex=n,t[n]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t){var n=t||this._root,r=n.uuid,i="string"==typeof e?rc.findByName(n,e):e,o=null!==i?i.uuid:e,a=this._actionsByClip[o],s=null;if(void 0!==a){var u=a.actionByRoot[r];if(void 0!==u)return u;s=a.knownActions[0],null===i&&(i=s._clip)}if(null===i)return null;var l=new Yd(this,i,t);return this._bindAction(l,s),this._addInactiveAction(l,o,r),l},existingAction:function(e,t){var n=t||this._root,r=n.uuid,i="string"==typeof e?rc.findByName(n,e):e,o=i?i.uuid:e,a=this._actionsByClip[o];return void 0!==a&&a.actionByRoot[r]||null},stopAllAction:function(){var e=this._actions,t=this._nActiveActions,n=this._bindings,r=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var i=0;i!==t;++i)e[i].reset();for(i=0;i!==r;++i)n[i].useCount=0;return this},update:function(e){e*=this.timeScale;for(var t=this._actions,n=this._nActiveActions,r=this.time+=e,i=Math.sign(e),o=this._accuIndex^=1,a=0;a!==n;++a){t[a]._update(r,e,i,o)}var s=this._bindings,u=this._nActiveBindings;for(a=0;a!==u;++a)s[a].apply(o);return this},setTime:function(e){this.time=0;for(var t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,n=e.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){for(var o=i.knownActions,a=0,s=o.length;a!==s;++a){var u=o[a];this._deactivateAction(u);var l=u._cacheIndex,c=t[t.length-1];u._cacheIndex=null,u._byClipCacheIndex=null,c._cacheIndex=l,t[l]=c,t.pop(),this._removeInactiveBindingsForAction(u)}delete r[n]}},uncacheRoot:function(e){var t=e.uuid,n=this._actionsByClip;for(var r in n){var i=n[r].actionByRoot[t];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}var o=this._bindingsByRootAndName[t];if(void 0!==o)for(var a in o){var s=o[a];s.restoreOriginalState(),this._removeInactiveBinding(s)}},uncacheAction:function(e,t){var n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}),Jd.prototype.clone=function(){return new Jd(void 0===this.value.clone?this.value:this.value.clone())},Zd.prototype=Object.assign(Object.create(bs.prototype),{constructor:Zd,isInstancedInterleavedBuffer:!0,copy:function(e){return bs.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign($d.prototype,{linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t,n){var r=n||[];return eh(e,this,r,t),r.sort(Qd),r},intersectObjects:function(e,t,n){var r=n||[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),r;for(var i=0,o=e.length;i<o;i++)eh(e[i],this,r,t);return r.sort(Qd),r}}),Object.assign(th.prototype,{set:function(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Sn.clamp(t/this.radius,-1,1))),this}}),Object.assign(nh.prototype,{set:function(e,t,n){return this.radius=e,this.theta=t,this.y=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}});var rh=new xn;function ih(e,t){this.min=void 0!==e?e:new xn(1/0,1/0),this.max=void 0!==t?t:new xn(-1/0,-1/0)}Object.assign(ih.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){var n=rh.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new xn),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new xn),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new xn),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new xn),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return rh.copy(e).clamp(this.min,this.max).sub(e).length()},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var oh=new Rn,ah=new Rn;function sh(e,t){this.start=void 0!==e?e:new Rn,this.end=void 0!==t?t:new Rn}function uh(e){cr.call(this),this.material=e,this.render=function(){}}Object.assign(sh.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new Rn),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new Rn),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new Rn),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(e,t){oh.subVectors(e,this.start),ah.subVectors(this.end,this.start);var n=ah.dot(ah),r=ah.dot(oh)/n;return t&&(r=Sn.clamp(r,0,1)),r},closestPointToPoint:function(e,t,n){var r=this.closestPointToPointParameter(e,t);return void 0===n&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new Rn),this.delta(n).multiplyScalar(r).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),uh.prototype=Object.create(cr.prototype),uh.prototype.constructor=uh,uh.prototype.isImmediateRenderObject=!0;var lh=new Rn;function ch(e,t){cr.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;for(var n=new Ri,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],i=0,o=1;i<32;i++,o++){var a=i/32*Math.PI*2,s=o/32*Math.PI*2;r.push(Math.cos(a),Math.sin(a),1,Math.cos(s),Math.sin(s),1)}n.setAttribute("position",new yi(r,3));var u=new $s({fog:!1});this.cone=new su(n,u),this.add(this.cone),this.update()}ch.prototype=Object.create(cr.prototype),ch.prototype.constructor=ch,ch.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},ch.prototype.update=function(){this.light.updateMatrixWorld();var e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),lh.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(lh),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)};var dh=new Rn,hh=new qn,fh=new qn;function ph(e){for(var t=function e(t){var n=[];t&&t.isBone&&n.push(t);for(var r=0;r<t.children.length;r++)n.push.apply(n,e(t.children[r]));return n}(e),n=new Ri,r=[],i=[],o=new ti(0,0,1),a=new ti(0,1,0),s=0;s<t.length;s++){var u=t[s];u.parent&&u.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(o.r,o.g,o.b),i.push(a.r,a.g,a.b))}n.setAttribute("position",new yi(r,3)),n.setAttribute("color",new yi(i,3));var l=new $s({vertexColors:T,depthTest:!1,depthWrite:!1,transparent:!0});su.call(this,n,l),this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}function mh(e,t,n){this.light=e,this.light.updateMatrixWorld(),this.color=n;var r=new gl(t,4,2),i=new ui({wireframe:!0,fog:!1});Ki.call(this,r,i),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}ph.prototype=Object.create(su.prototype),ph.prototype.constructor=ph,ph.prototype.updateMatrixWorld=function(e){var t=this.bones,n=this.geometry,r=n.getAttribute("position");fh.getInverse(this.root.matrixWorld);for(var i=0,o=0;i<t.length;i++){var a=t[i];a.parent&&a.parent.isBone&&(hh.multiplyMatrices(fh,a.matrixWorld),dh.setFromMatrixPosition(hh),r.setXYZ(o,dh.x,dh.y,dh.z),hh.multiplyMatrices(fh,a.parent.matrixWorld),dh.setFromMatrixPosition(hh),r.setXYZ(o+1,dh.x,dh.y,dh.z),o+=2)}n.getAttribute("position").needsUpdate=!0,cr.prototype.updateMatrixWorld.call(this,e)},mh.prototype=Object.create(Ki.prototype),mh.prototype.constructor=mh,mh.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},mh.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)};var vh=new Rn,gh=new ti,yh=new ti;function _h(e,t,n){cr.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;var r=new ju(t);r.rotateY(.5*Math.PI),this.material=new ui({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=T);var i=r.getAttribute("position"),o=new Float32Array(3*i.count);r.setAttribute("color",new ci(o,3)),this.add(new Ki(r,this.material)),this.update()}function bh(e,t,n,r){e=e||10,t=t||10,n=new ti(void 0!==n?n:4473924),r=new ti(void 0!==r?r:8947848);for(var i=t/2,o=e/t,a=e/2,s=[],u=[],l=0,c=0,d=-a;l<=t;l++,d+=o){s.push(-a,0,d,a,0,d),s.push(d,0,-a,d,0,a);var h=l===i?n:r;h.toArray(u,c),c+=3,h.toArray(u,c),c+=3,h.toArray(u,c),c+=3,h.toArray(u,c),c+=3}var f=new Ri;f.setAttribute("position",new yi(s,3)),f.setAttribute("color",new yi(u,3));var p=new $s({vertexColors:T});su.call(this,f,p)}function Eh(e,t,n,r,i,o){e=e||10,t=t||16,n=n||8,r=r||64,i=new ti(void 0!==i?i:4473924),o=new ti(void 0!==o?o:8947848);var a,s,u,l,c,d,h,f=[],p=[];for(l=0;l<=t;l++)u=l/t*(2*Math.PI),a=Math.sin(u)*e,s=Math.cos(u)*e,f.push(0,0,0),f.push(a,0,s),h=1&l?i:o,p.push(h.r,h.g,h.b),p.push(h.r,h.g,h.b);for(l=0;l<=n;l++)for(h=1&l?i:o,d=e-e/n*l,c=0;c<r;c++)u=c/r*(2*Math.PI),a=Math.sin(u)*d,s=Math.cos(u)*d,f.push(a,0,s),p.push(h.r,h.g,h.b),u=(c+1)/r*(2*Math.PI),a=Math.sin(u)*d,s=Math.cos(u)*d,f.push(a,0,s),p.push(h.r,h.g,h.b);var m=new Ri;m.setAttribute("position",new yi(f,3)),m.setAttribute("color",new yi(p,3));var v=new $s({vertexColors:T});su.call(this,m,v)}_h.prototype=Object.create(cr.prototype),_h.prototype.constructor=_h,_h.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},_h.prototype.update=function(){var e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var t=e.geometry.getAttribute("color");gh.copy(this.light.color),yh.copy(this.light.groundColor);for(var n=0,r=t.count;n<r;n++){var i=n<r/2?gh:yh;t.setXYZ(n,i.r,i.g,i.b)}t.needsUpdate=!0}e.lookAt(vh.setFromMatrixPosition(this.light.matrixWorld).negate())},bh.prototype=Object.assign(Object.create(su.prototype),{constructor:bh,copy:function(e){return su.prototype.copy.call(this,e),this.geometry.copy(e.geometry),this.material.copy(e.material),this},clone:function(){return(new this.constructor).copy(this)}}),Eh.prototype=Object.create(su.prototype),Eh.prototype.constructor=Eh;var wh=new Rn,Th=new Rn,Sh=new Rn;function xh(e,t,n){cr.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===t&&(t=1);var r=new Ri;r.setAttribute("position",new yi([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var i=new $s({fog:!1});this.lightPlane=new iu(r,i),this.add(this.lightPlane),(r=new Ri).setAttribute("position",new yi([0,0,0,0,0,1],3)),this.targetLine=new iu(r,i),this.add(this.targetLine),this.update()}xh.prototype=Object.create(cr.prototype),xh.prototype.constructor=xh,xh.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},xh.prototype.update=function(){wh.setFromMatrixPosition(this.light.matrixWorld),Th.setFromMatrixPosition(this.light.target.matrixWorld),Sh.subVectors(Th,wh),this.lightPlane.lookAt(Th),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Th),this.targetLine.scale.z=Sh.length()};var Ah=new Rn,Mh=new so;function jh(e){var t=new Ri,n=new $s({color:16777215,vertexColors:w}),r=[],i=[],o={},a=new ti(16755200),s=new ti(16711680),u=new ti(43775),l=new ti(16777215),c=new ti(3355443);function d(e,t,n){h(e,n),h(t,n)}function h(e,t){r.push(0,0,0),i.push(t.r,t.g,t.b),void 0===o[e]&&(o[e]=[]),o[e].push(r.length/3-1)}d("n1","n2",a),d("n2","n4",a),d("n4","n3",a),d("n3","n1",a),d("f1","f2",a),d("f2","f4",a),d("f4","f3",a),d("f3","f1",a),d("n1","f1",a),d("n2","f2",a),d("n3","f3",a),d("n4","f4",a),d("p","n1",s),d("p","n2",s),d("p","n3",s),d("p","n4",s),d("u1","u2",u),d("u2","u3",u),d("u3","u1",u),d("c","t",l),d("p","c",c),d("cn1","cn2",c),d("cn3","cn4",c),d("cf1","cf2",c),d("cf3","cf4",c),t.setAttribute("position",new yi(r,3)),t.setAttribute("color",new yi(i,3)),su.call(this,t,n),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}function Rh(e,t,n,r,i,o,a){Ah.set(i,o,a).unproject(r);var s=t[e];if(void 0!==s)for(var u=n.getAttribute("position"),l=0,c=s.length;l<c;l++)u.setXYZ(s[l],Ah.x,Ah.y,Ah.z)}jh.prototype=Object.create(su.prototype),jh.prototype.constructor=jh,jh.prototype.update=function(){var e=this.geometry,t=this.pointMap;Mh.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Rh("c",t,e,Mh,0,0,-1),Rh("t",t,e,Mh,0,0,1),Rh("n1",t,e,Mh,-1,-1,-1),Rh("n2",t,e,Mh,1,-1,-1),Rh("n3",t,e,Mh,-1,1,-1),Rh("n4",t,e,Mh,1,1,-1),Rh("f1",t,e,Mh,-1,-1,1),Rh("f2",t,e,Mh,1,-1,1),Rh("f3",t,e,Mh,-1,1,1),Rh("f4",t,e,Mh,1,1,1),Rh("u1",t,e,Mh,.7,1.1,-1),Rh("u2",t,e,Mh,-.7,1.1,-1),Rh("u3",t,e,Mh,0,2,-1),Rh("cf1",t,e,Mh,-1,0,1),Rh("cf2",t,e,Mh,1,0,1),Rh("cf3",t,e,Mh,0,-1,1),Rh("cf4",t,e,Mh,0,1,1),Rh("cn1",t,e,Mh,-1,0,-1),Rh("cn2",t,e,Mh,1,0,-1),Rh("cn3",t,e,Mh,0,-1,-1),Rh("cn4",t,e,Mh,0,1,-1),e.getAttribute("position").needsUpdate=!0};var Lh=new xr;function Ch(e,t){this.object=e,void 0===t&&(t=16776960);var n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),i=new Ri;i.setIndex(new ci(n,1)),i.setAttribute("position",new ci(r,3)),su.call(this,i,new $s({color:t})),this.matrixAutoUpdate=!1,this.update()}function kh(e,t){this.type="Box3Helper",this.box=e,t=t||16776960;var n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Ri;r.setIndex(new ci(n,1)),r.setAttribute("position",new yi([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),su.call(this,r,new $s({color:t})),this.geometry.computeBoundingSphere()}function Oh(e,t,n){this.type="PlaneHelper",this.plane=e,this.size=void 0===t?1:t;var r=void 0!==n?n:16776960,i=new Ri;i.setAttribute("position",new yi([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),i.computeBoundingSphere(),iu.call(this,i,new $s({color:r}));var o=new Ri;o.setAttribute("position",new yi([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),o.computeBoundingSphere(),this.add(new Ki(o,new ui({color:r,opacity:.2,transparent:!0,depthWrite:!1})))}Ch.prototype=Object.create(su.prototype),Ch.prototype.constructor=Ch,Ch.prototype.update=function(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Lh.setFromObject(this.object),!Lh.isEmpty()){var t=Lh.min,n=Lh.max,r=this.geometry.attributes.position,i=r.array;i[0]=n.x,i[1]=n.y,i[2]=n.z,i[3]=t.x,i[4]=n.y,i[5]=n.z,i[6]=t.x,i[7]=t.y,i[8]=n.z,i[9]=n.x,i[10]=t.y,i[11]=n.z,i[12]=n.x,i[13]=n.y,i[14]=t.z,i[15]=t.x,i[16]=n.y,i[17]=t.z,i[18]=t.x,i[19]=t.y,i[20]=t.z,i[21]=n.x,i[22]=t.y,i[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}},Ch.prototype.setFromObject=function(e){return this.object=e,this.update(),this},Ch.prototype.copy=function(e){return su.prototype.copy.call(this,e),this.object=e.object,this},Ch.prototype.clone=function(){return(new this.constructor).copy(this)},kh.prototype=Object.create(su.prototype),kh.prototype.constructor=kh,kh.prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),cr.prototype.updateMatrixWorld.call(this,e))},Oh.prototype=Object.create(iu.prototype),Oh.prototype.constructor=Oh,Oh.prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?g:v,this.lookAt(this.plane.normal),cr.prototype.updateMatrixWorld.call(this,e)};var Ph,Ih,Dh=new Rn;function Nh(e,t,n,r,i,o){cr.call(this),void 0===e&&(e=new Rn(0,0,1)),void 0===t&&(t=new Rn(0,0,0)),void 0===n&&(n=1),void 0===r&&(r=16776960),void 0===i&&(i=.2*n),void 0===o&&(o=.2*i),void 0===Ph&&((Ph=new Ri).setAttribute("position",new yi([0,0,0,0,1,0],3)),(Ih=new Ml(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new iu(Ph,new $s({color:r})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Ki(Ih,new ui({color:r})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,i,o)}function Bh(e){var t=[0,0,0,e=e||1,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new Ri;n.setAttribute("position",new yi(t,3)),n.setAttribute("color",new yi([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var r=new $s({vertexColors:T});su.call(this,n,r)}Nh.prototype=Object.create(cr.prototype),Nh.prototype.constructor=Nh,Nh.prototype.setDirection=function(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Dh.set(e.z,0,-e.x).normalize();var t=Math.acos(e.y);this.quaternion.setFromAxisAngle(Dh,t)}},Nh.prototype.setLength=function(e,t,n){void 0===t&&(t=.2*e),void 0===n&&(n=.2*t),this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()},Nh.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},Nh.prototype.copy=function(e){return cr.prototype.copy.call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this},Nh.prototype.clone=function(){return(new this.constructor).copy(this)},Bh.prototype=Object.create(su.prototype),Bh.prototype.constructor=Bh;var Uh,Fh,Vh,Gh,Hh=Math.pow(2,8),zh=[.125,.215,.35,.446,.526,.582],Wh=5+zh.length,qh={[Nt]:0,[Bt]:1,[Ft]:2,[Gt]:3,[Ht]:4,[zt]:5,[Ut]:6},Kh=new Kc,Yh=(Uh=20,Fh=new Float32Array(Uh),Vh=new Rn(0,1,0),(Gh=new Pl({defines:{n:Uh},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:Fh},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:Vh},inputEncoding:{value:qh[Nt]},outputEncoding:{value:qh[Nt]}},vertexShader:gf(),fragmentShader:`\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform sampler2D envMap;\nuniform int samples;\nuniform float weights[n];\nuniform bool latitudinal;\nuniform float dTheta;\nuniform float mipInt;\nuniform vec3 poleAxis;\n\n${yf()}\n\n#define ENVMAP_TYPE_CUBE_UV\n#include <cube_uv_reflection_fragment>\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tfor (int i = 0; i < n; i++) {\n\t\tif (i >= samples)\n\t\t\tbreak;\n\t\tfor (int dir = -1; dir < 2; dir += 2) {\n\t\t\tif (i == 0 && dir == 1)\n\t\t\t\tcontinue;\n\t\t\tvec3 axis = latitudinal ? poleAxis : cross(poleAxis, vOutputDirection);\n\t\t\tif (all(equal(axis, vec3(0.0))))\n\t\t\t\taxis = cross(vec3(0.0, 1.0, 0.0), vOutputDirection);\n\t\t\taxis = normalize(axis);\n\t\t\tfloat theta = dTheta * float(dir * i);\n\t\t\tfloat cosTheta = cos(theta);\n\t\t\t// Rodrigues' axis-angle rotation\n\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross(axis, vOutputDirection) * sin(theta)\n\t\t\t\t\t+ axis * dot(axis, vOutputDirection) * (1.0 - cosTheta);\n\t\t\tgl_FragColor.rgb +=\n\t\t\t\t\tweights[i] * bilinearCubeUV(envMap, sampleDirection, mipInt);\n\t\t}\n\t}\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t`,blending:S,depthTest:!1,depthWrite:!1})).type="SphericalGaussianBlur",Gh),Xh=null,Jh=null,{_lodPlanes:Zh,_sizeLods:$h,_sigmas:Qh}=function(){for(var e=[],t=[],n=[],r=8,i=0;i<Wh;i++){var o=Math.pow(2,r);t.push(o);var a=1/o;i>4?a=zh[i-8+4-1]:0==i&&(a=0),n.push(a);for(var s=1/(o-1),u=-s/2,l=1+s/2,c=[u,u,l,u,l,l,u,u,l,l,u,l],d=new Float32Array(108),h=new Float32Array(72),f=new Float32Array(36),p=0;p<6;p++){var m=p%3*2/3-1,v=p>2?0:-1,g=[m,v,0,m+2/3,v,0,m+2/3,v+1,0,m,v,0,m+2/3,v+1,0,m,v+1,0];d.set(g,18*p),h.set(c,12*p);var y=[p,p,p,p,p,p];f.set(y,6*p)}var _=new Ri;_.setAttribute("position",new ci(d,3)),_.setAttribute("uv",new ci(h,2)),_.setAttribute("faceIndex",new ci(f,1)),e.push(_),r>4&&r--}return{_lodPlanes:e,_sizeLods:t,_sigmas:n}}(),ef=null,tf=null,nf=(1+Math.sqrt(5))/2,rf=1/nf,of=[new Rn(1,1,1),new Rn(-1,1,1),new Rn(1,1,-1),new Rn(-1,1,-1),new Rn(0,nf,rf),new Rn(0,nf,-rf),new Rn(rf,0,nf),new Rn(-rf,0,nf),new Rn(nf,rf,0),new Rn(-nf,rf,0)];function af(e){tf=e,lf(Yh)}function sf(e){var t={magFilter:be,minFilter:be,generateMipmaps:!1,type:e?e.type:Le,format:e?e.format:Ke,encoding:e?e.encoding:Ft,depthBuffer:!1,stencilBuffer:!1},n=cf(t);return n.depthBuffer=!e,ef=cf(t),n}function uf(){ef.dispose(),tf.setRenderTarget(null);var e=tf.getSize(new xn);tf.setViewport(0,0,e.x,e.y)}function lf(e){var t=new dr;t.add(new Ki(Zh[0],e)),tf.compile(t,Kh)}function cf(e){var t=new Nn(3*Hh,3*Hh,e);return t.texture.mapping=me,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function df(e,t,n,r){var i=1/tf.getPixelRatio();e*=i,t*=i,n*=i,r*=i,tf.setViewport(e,t,n,r),tf.setScissor(e,t,n,r)}function hf(e){var t=tf.autoClear;tf.autoClear=!1;for(var n=1;n<Wh;n++){ff(e,n-1,n,Math.sqrt(Qh[n]*Qh[n]-Qh[n-1]*Qh[n-1]),of[(n-1)%of.length])}tf.autoClear=t}function ff(e,t,n,r,i){pf(e,ef,t,n,r,"latitudinal",i),pf(ef,e,n,n,r,"longitudinal",i)}function pf(e,t,n,r,i,o,a){"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");var s=new dr;s.add(new Ki(Zh[r],Yh));var u=Yh.uniforms,l=$h[n]-1,c=isFinite(i)?Math.PI/(2*l):2*Math.PI/39,d=i/c,h=isFinite(i)?1+Math.floor(3*d):20;h>20&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${h} samples when the maximum is set to 20`);for(var f=[],p=0,m=0;m<20;++m){var v=m/d,g=Math.exp(-v*v/2);f.push(g),0==m?p+=g:m<h&&(p+=2*g)}for(m=0;m<f.length;m++)f[m]=f[m]/p;u.envMap.value=e.texture,u.samples.value=h,u.weights.value=f,u.latitudinal.value="latitudinal"===o,a&&(u.poleAxis.value=a),u.dTheta.value=c,u.mipInt.value=8-n,u.inputEncoding.value=qh[e.texture.encoding],u.outputEncoding.value=qh[e.texture.encoding];var y=$h[r],_=(v=3*Math.max(0,Hh-2*y),(0===r?0:2*Hh)+2*y*(r>4?r-8+4:0));tf.setRenderTarget(t),df(v,_,3*y,2*y),tf.render(s,Kh)}function mf(){var e=new Pl({uniforms:{envMap:{value:null},texelSize:{value:new xn(1,1)},inputEncoding:{value:qh[Nt]},outputEncoding:{value:qh[Nt]}},vertexShader:gf(),fragmentShader:`\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform sampler2D envMap;\nuniform vec2 texelSize;\n\n${yf()}\n\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tvec3 outputDirection = normalize(vOutputDirection);\n\tvec2 uv;\n\tuv.y = asin(clamp(outputDirection.y, -1.0, 1.0)) * RECIPROCAL_PI + 0.5;\n\tuv.x = atan(outputDirection.z, outputDirection.x) * RECIPROCAL_PI2 + 0.5;\n\tvec2 f = fract(uv / texelSize - 0.5);\n\tuv -= f * texelSize;\n\tvec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.x += texelSize.x;\n\tvec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.y += texelSize.y;\n\tvec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.x -= texelSize.x;\n\tvec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tvec3 tm = mix(tl, tr, f.x);\n\tvec3 bm = mix(bl, br, f.x);\n\tgl_FragColor.rgb = mix(tm, bm, f.y);\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t`,blending:S,depthTest:!1,depthWrite:!1});return e.type="EquirectangularToCubeUV",e}function vf(){var e=new Pl({uniforms:{envMap:{value:null},inputEncoding:{value:qh[Nt]},outputEncoding:{value:qh[Nt]}},vertexShader:gf(),fragmentShader:`\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform samplerCube envMap;\n\n${yf()}\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tgl_FragColor.rgb = envMapTexelToLinear(textureCube(envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ))).rgb;\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t`,blending:S,depthTest:!1,depthWrite:!1});return e.type="CubemapToCubeUV",e}function gf(){return"\nprecision mediump float;\nprecision mediump int;\nattribute vec3 position;\nattribute vec2 uv;\nattribute float faceIndex;\nvarying vec3 vOutputDirection;\nvec3 getDirection(vec2 uv, float face) {\n\tuv = 2.0 * uv - 1.0;\n\tvec3 direction = vec3(uv, 1.0);\n\tif (face == 0.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.z *= -1.0;\n\t} else if (face == 1.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.z *= -1.0;\n\t} else if (face == 3.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.x *= -1.0;\n\t} else if (face == 4.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.y *= -1.0;\n\t} else if (face == 5.0) {\n\t\tdirection.xz *= -1.0;\n\t}\n\treturn direction;\n}\nvoid main() {\n\tvOutputDirection = getDirection(uv, faceIndex);\n\tgl_Position = vec4( position, 1.0 );\n}\n\t"}function yf(){return"\nuniform int inputEncoding;\nuniform int outputEncoding;\n\n#include <encodings_pars_fragment>\n\nvec4 inputTexelToLinear(vec4 value){\n\tif(inputEncoding == 0){\n\t\treturn value;\n\t}else if(inputEncoding == 1){\n\t\treturn sRGBToLinear(value);\n\t}else if(inputEncoding == 2){\n\t\treturn RGBEToLinear(value);\n\t}else if(inputEncoding == 3){\n\t\treturn RGBMToLinear(value, 7.0);\n\t}else if(inputEncoding == 4){\n\t\treturn RGBMToLinear(value, 16.0);\n\t}else if(inputEncoding == 5){\n\t\treturn RGBDToLinear(value, 256.0);\n\t}else{\n\t\treturn GammaToLinear(value, 2.2);\n\t}\n}\n\nvec4 linearToOutputTexel(vec4 value){\n\tif(outputEncoding == 0){\n\t\treturn value;\n\t}else if(outputEncoding == 1){\n\t\treturn LinearTosRGB(value);\n\t}else if(outputEncoding == 2){\n\t\treturn LinearToRGBE(value);\n\t}else if(outputEncoding == 3){\n\t\treturn LinearToRGBM(value, 7.0);\n\t}else if(outputEncoding == 4){\n\t\treturn LinearToRGBM(value, 16.0);\n\t}else if(outputEncoding == 5){\n\t\treturn LinearToRGBD(value, 256.0);\n\t}else{\n\t\treturn LinearToGamma(value, 2.2);\n\t}\n}\n\nvec4 envMapTexelToLinear(vec4 color) {\n\treturn inputTexelToLinear(color);\n}\n\t"}function _f(e,t,n,r,i,o,a){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new oi(e,t,n,i,o,a)}af.prototype={constructor:af,fromScene:function(e,t=0,n=.1,r=100){var i=sf();return function(e,t,n,r){var i=new uo(90,1,t,n),o=[1,1,1,1,-1,1],a=[1,1,-1,-1,-1,1],s=tf.outputEncoding,u=tf.toneMapping,l=tf.toneMappingExposure,c=tf.getClearColor(),d=tf.getClearAlpha();tf.toneMapping=ie,tf.toneMappingExposure=1,tf.outputEncoding=Nt,e.scale.z*=-1;var h=e.background;if(h&&h.isColor){h.convertSRGBToLinear();var f=Math.max(h.r,h.g,h.b),p=Math.min(Math.max(Math.ceil(Math.log2(f)),-128),127);h=h.multiplyScalar(Math.pow(2,-p));var m=(p+128)/255;tf.setClearColor(h,m),e.background=null}tf.setRenderTarget(r);for(var v=0;v<6;v++){var g=v%3;0==g?(i.up.set(0,o[v],0),i.lookAt(a[v],0,0)):1==g?(i.up.set(0,0,o[v]),i.lookAt(0,a[v],0)):(i.up.set(0,o[v],0),i.lookAt(0,0,a[v])),df(g*Hh,v>2?Hh:0,Hh,Hh),tf.render(e,i)}tf.toneMapping=u,tf.toneMappingExposure=l,tf.outputEncoding=s,tf.setClearColor(c,d),e.scale.z*=-1}(e,n,r,i),t>0&&ff(i,0,0,t),hf(i),uf(),i.scissorTest=!1,i},fromEquirectangular:function(e){return e.magFilter=be,e.minFilter=be,e.generateMipmaps=!1,this.fromCubemap(e)},fromCubemap:function(e){var t=sf(e);return function(e,t){var n=new dr;e.isCubeTexture?null==Jh&&(Jh=vf()):null==Xh&&(Xh=mf());var r=e.isCubeTexture?Jh:Xh;n.add(new Ki(Zh[0],r));var i=r.uniforms;i.envMap.value=e,e.isCubeTexture||i.texelSize.value.set(1/e.image.width,1/e.image.height);i.inputEncoding.value=qh[e.encoding],i.outputEncoding.value=qh[e.encoding],tf.setRenderTarget(t),df(0,0,3*Hh,2*Hh),tf.render(n,Kh)}(e,t),hf(t),uf(),t.scissorTest=!1,t},compileCubemapShader:function(){null==Jh&&lf(Jh=vf())},compileEquirectangularShader:function(){null==Xh&&lf(Xh=mf())},dispose:function(){Yh.dispose(),null!=Jh&&Jh.dispose(),null!=Xh&&Xh.dispose();for(var e=0;e<Zh.length;e++)Zh[e].dispose()}};var bf=0,Ef=1;function wf(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e}function Tf(e){return void 0===e&&(e=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e}function Sf(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new pu(e,t)}function xf(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Ns(e)}function Af(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new pu(e,t)}function Mf(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new lu(e)}function jf(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new lu(e)}function Rf(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new lu(e)}function Lf(e,t,n){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Rn(e,t,n)}function Cf(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new ci(e,t).setDynamic(!0)}function kf(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new di(e,t)}function Of(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new hi(e,t)}function Pf(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new fi(e,t)}function If(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new pi(e,t)}function Df(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new mi(e,t)}function Nf(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new vi(e,t)}function Bf(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new gi(e,t)}function Uf(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new yi(e,t)}function Ff(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new _i(e,t)}function Vf(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),xc.call(this,e),this.type="catmullrom",this.closed=!0}function Gf(e){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),xc.call(this,e),this.type="catmullrom"}function Hf(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),xc.call(this,e),this.type="catmullrom"}function zf(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Bh(e)}function Wf(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Ch(e,t)}function qf(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new su(new xl(e.geometry),new $s({color:void 0!==t?t:16777215}))}function Kf(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new su(new bu(e.geometry),new $s({color:void 0!==t?t:16777215}))}function Yf(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new cc(e)}function Xf(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new fc(e)}gc.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(gc.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign(Nc.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var t=new eo,n=0,r=e.length;n<r;n++){var i=e[n];t.vertices.push(new Rn(i.x,i.y,i.z||0))}return t}}),Object.assign(Bc.prototype,{fromPoints:function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),Vf.prototype=Object.create(xc.prototype),Gf.prototype=Object.create(xc.prototype),Hf.prototype=Object.create(xc.prototype),Object.assign(Hf.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),bh.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},ph.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(uc.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Qc.extractUrlBase(e)}}),uc.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(id.prototype,{setTexturePath:function(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}),Object.assign(ih.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(xr.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),sh.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(Sn,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Sn.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Sn.ceilPowerOfTwo(e)}}),Object.assign(kn.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(qn.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Rn).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,n,r,i,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,r,n,i,o)}}),Fr.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},An.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(Dr.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(Zr.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(Zr,{barycoordFromPoint:function(e,t,n,r,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Zr.getBarycoord(e,t,n,r,i)},normal:function(e,t,n,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Zr.getNormal(e,t,n,r)}}),Object.assign(Uc.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new cl(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new wl(this,e)}}),Object.assign(xn.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Rn.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Dn.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(eo.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}}),Object.assign(cr.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")}}),Object.defineProperties(cr.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(Ki.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(Ki.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),Pt},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(Vs.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(Ws.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),Gs.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(gc.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),uo.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(Fc.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(ci.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===fn},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(fn)}}}),Object.assign(ci.prototype,{setDynamic:function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?fn:hn),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(Ri.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addAttribute:function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new ci(arguments[1],arguments[2])))},addDrawCall:function(e,t,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)}}),Object.defineProperties(Ri.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(bs.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===fn},set:function(e){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(e)}}}),Object.assign(bs.prototype,{setDynamic:function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?fn:hn),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(dl.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(Jd.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(si.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new ti}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=e===_}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}}}),Object.defineProperties(Nl.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(ao.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(gs.prototype,{clearTarget:function(e,t,n,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,n,r)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(gs.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?Bt:Nt}}}),Object.defineProperties(us.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(co.prototype,{activeCubeFace:{set:function(){console.warn("THREE.WebGLRenderTargetCube: .activeCubeFace has been removed. It is now the second parameter of WebGLRenderer.setRenderTarget().")}},activeMipMapLevel:{set:function(){console.warn("THREE.WebGLRenderTargetCube: .activeMipMapLevel has been removed. It is now the third parameter of WebGLRenderer.setRenderTarget().")}}}),Object.defineProperties(Nn.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties(Rd.prototype,{load:{value:function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return(new md).load(e,(function(e){t.setBuffer(e)})),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),Id.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},lo.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)};var Jf={merge:function(e,t,n){var r;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t.isMesh&&(t.matrixAutoUpdate&&t.updateMatrix(),r=t.matrix,t=t.geometry),e.merge(t,r,n)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}};function Zf(){console.error("THREE.CanvasRenderer has been removed")}function $f(){console.error("THREE.JSONLoader has been removed.")}On.crossOrigin=void 0,On.loadTexture=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var i=new vc;i.setCrossOrigin(this.crossOrigin);var o=i.load(e,n,void 0,r);return t&&(o.mapping=t),o},On.loadTextureCube=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var i=new mc;i.setCrossOrigin(this.crossOrigin);var o=i.load(e,n,void 0,r);return t&&(o.mapping=t),o},On.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},On.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};var Qf={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")}};function ep(){console.error("THREE.LensFlare has been moved to /examples/js/objects/Lensflare.js")}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:r}}))},"./node_modules/uuid/lib/bytesToUuid.js":function(e,t){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);e.exports=function(e,t){var r=t||0,i=n;return[i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]]].join("")}},"./node_modules/uuid/lib/rng-browser.js":function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);e.exports=function(){return n(r),r}}else{var i=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}},"./node_modules/uuid/v4.js":function(e,t,n){var r=n("./node_modules/uuid/lib/rng-browser.js"),i=n("./node_modules/uuid/lib/bytesToUuid.js");e.exports=function(e,t,n){var o=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||r)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var s=0;s<16;++s)t[o+s]=a[s];return t||i(a)}},"./node_modules/webpack/buildin/global.js":function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},"./node_modules/webpack/buildin/module.js":function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},"./package.json":function(e){e.exports=JSON.parse('{"name":"@bbc/storyplayer","version":"0.12.7","description":"Object Based Media player","main":"dist/romper.js","scripts":{"prepublish":"npm run build","build":"webpack","build:electron":"webpack --env.platform=electron","test":"concurrently --names \\"eslint,jest,sass-lint\\" -c \\"blue.bgWhite,magenta.bgWhite,black.bgWhite\\" --prefix \\"[{name}]\\" \\"yarn test:eslint\\" \\"yarn test:jest\\" \\"yarn test:sass-lint\\"","test-noinstall":"concurrently --names \\"eslint,jest,sass-lint\\" -c \\"blue.bgWhite,magenta.bgWhite,black.bgWhite\\" --prefix \\"[{name}]\\" \\"yarn test:eslint\\" \\"yarn test:jest\\" \\"yarn test:sass-lint\\"","test-watch":"nodemon -L --watch src --exec yarn test-noinstall","test:eslint":"eslint src/ spec/","test:jest":"jest","test:sass-lint":"sass-lint -v","demo":"yarn build && rm -f ./tmp/*.json && node demos.js","watch":"concurrently \\"webpack --watch --watch-poll 500 --progress --profile --bail\\" \\"jest --watch\\" \\"nodemon --watch src --watch spec --exec node_modules/.bin/eslint src/ spec/\\" \\"nodemon --watch src --watch spec --exec \'node_modules/.bin/flow check --all || exit 1\'\\"","dev":"webpack --watch --watch-poll 500 --progress --profile --bail"},"repository":{"type":"git","url":"git+https://github.com/bbc/rd-ux-storyplayer.git"},"author":"BBC R&D","license":"UNLICENSED","bugs":{"url":"https://github.com/bbc/rd-ux-storyplayer/issues"},"homepage":"https://github.com/bbc/rd-ux-storyplayer#readme","devDependencies":{"@babel/cli":"^7.7.7","@babel/core":"^7.7.7","@babel/node":"^7.7.7","@babel/plugin-proposal-object-rest-spread":"^7.7.7","@babel/plugin-transform-flow-strip-types":"^7.7.4","@babel/plugin-transform-modules-commonjs":"^7.7.5","@babel/plugin-transform-runtime":"^7.7.6","@babel/preset-env":"^7.7.7","@babel/runtime":"^7.7.7","babel-eslint":"^10.0.3","babel-jest":"^24.9.0","babel-loader":"^8.0.6","body-parser":"^1.19.0","chai":"^4.2.0","concurrently":"^5.0.2","core-js":"^3.6.1","css-loader":"^3.4.0","eslint":"^6.8.0","eslint-config-airbnb-base":"^14.0.0","eslint-config-prettier":"^6.9.0","eslint-plugin-babel":"^5.3.0","eslint-plugin-flowtype":"^4.5.3","eslint-plugin-import":"^2.19.1","file-loader":"4","flow-bin":"^0.114.0","flow-typed":"^2.6.2","jest-cli":"^24.9.0","jest-junit-reporter":"^1.1.0","jsoneditor":"^8.1.1","mini-css-extract-plugin":"^0.9.0","node-sass":"^4.13.0","nodemon":"2.0.2","regenerator-runtime":"^0.13.3","sass-lint":"^1.13.1","sass-loader":"^8.0.0","sinon":"^8.0.2","sinon-chai":"^3.4.0","style-loader":"^1.1.2","terser-webpack-plugin":"^3.0.1","webpack":"^4.41.5","webpack-cli":"^3.3.10"},"dependencies":{"browser-bunyan":"^1.5.3","browserify-css":"^0.15.0","dashjs":"^3.0.1","express":"^4.17.1","hls.js":"^0.13.0","json-logic-js":"^1.0.11","shaka-player":"^2.5.7","three":"^0.112.1","uuid":"^3.3.3"}}')},"./src/AnalyticEvents.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.array.for-each.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={names:{},types:{}};["STORY_NAVIGATION","RENDERER_ACTION","USER_ACTION","SEGMENT_COMPLETION"].forEach((function(e){r.types[e]=e})),["NARRATIVE_ELEMENT_CHANGE","ENTER_SUB_STORY","STORY_END","SWITCHABLE_REPRESENTATION_SWITCH","START_BEHAVIOUR_PHASE_STARTED","START_BEHAVIOUR_PHASE_ENDED","COMPLETE_BEHAVIOUR_PHASE_STARTED","DURING_BEHAVIOUR_STARTED","VIDEO_PAUSE","VIDEO_UNPAUSE","PLAY_PAUSE_BUTTON_CLICKED","SEEK_FORWARD_BUTTON_CLICKED","SEEK_BACKWARD_BUTTON_CLICKED","BACK_BUTTON_CLICKED","NEXT_BUTTON_CLICKED","START_BUTTON_CLICKED","SUBTITLES_BUTTON_CLICKED","FULLSCREEN_BUTTON_CLICKED","VOLUME_CHANGED","VOLUME_MUTE_TOGGLED","VIDEO_SCRUBBED","OVERLAY_BUTTON_CLICKED","OVERLAY_DEACTIVATED","BUTTONS_ACTIVATED","BUTTONS_DEACTIVATED","CHANGE_CHAPTER_BUTTON_CLICKED","SWITCH_VIEW_BUTTON_CLICKED","LINK_CHOICE_CLICKED","BEHAVIOUR_CONTINUE_BUTTON_CLICKED","BEHAVIOUR_CANCEL_BUTTON_CLICKED","VR_ORIENTATION_CHANGED","BROWSER_VISIBILITY_CHANGE","WINDOW_ORIENTATION_CHANGE","USER_SET_VARIABLE","VARIABLE_PANEL_NEXT_CLICKED","VARIABLE_PANEL_BACK_CLICKED","SOCIAL_SHARE_CLICKED","OUTWARD_LINK_CLICKED"].forEach((function(e){r.names[e]=e}));var i=r;t.default=i},"./src/AnalyticsHandler.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.symbol.js"),n("./node_modules/core-js/modules/es.array.filter.js"),n("./node_modules/core-js/modules/es.array.for-each.js"),n("./node_modules/core-js/modules/es.date.to-string.js"),n("./node_modules/core-js/modules/es.function.name.js"),n("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),n("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),n("./node_modules/core-js/modules/es.object.keys.js"),n("./node_modules/core-js/modules/web.dom-collections.for-each.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,i=(r=n("./src/AnalyticEvents.js"))&&r.__esModule?r:{default:r};function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._analytics=t,this._controller=n,this._segmentSummaryData={},this._lastpausedTime=Date.now(),this._lastHideTime=Date.now(),this._paused=!1}var t,n,r;return t=e,(n=[{key:"handleAnalyticsEvent",value:function(e){var t=this._enhanceAnalytics(e);this._handleSegmentSummaries(t),this._analytics(t)}},{key:"_enhanceAnalytics",value:function(e){var t=e.current_representation,n=this._controller.getCurrentRenderer();void 0===t&&n&&n.getRepresentation()&&(t=n.getRepresentation().id);var r=e.current_narrative_element;return void 0===r&&(r=this._controller.getCurrentNarrativeElement()?this._controller.getCurrentNarrativeElement().id:"null"),function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{current_narrative_element:r,current_representation:t})}},{key:"_sumpausedTime",value:function(){var e=Date.now()-this._lastpausedTime,t=this._segmentSummaryData.pausedTime+e;this._segmentSummaryData.pausedTime=t}},{key:"_sumHiddenTime",value:function(){var e=Date.now()-this._lastHideTime,t=this._segmentSummaryData.hiddenTime+e;this._segmentSummaryData.hiddenTime=t}},{key:"_handleSegmentSummaries",value:function(e){e.type===i.default.types.USER_ACTION&&(this._segmentSummaryData.hasOwnProperty(e.name)?this._segmentSummaryData[e.name]+=1:this._segmentSummaryData[e.name]=1),e.name===i.default.names.VIDEO_PAUSE&&(this._lastpausedTime=Date.now(),this._paused=!0),e.name===i.default.names.VIDEO_UNPAUSE&&(this._paused=!1,this._sumpausedTime()),e.name===i.default.names.BROWSER_VISIBILITY_CHANGE&&"hidden"===e.to?(this._lastHideTime=Date.now(),this._paused&&this._sumpausedTime()):e.name===i.default.names.BROWSER_VISIBILITY_CHANGE&&(this._paused&&(this._lastpausedTime=Date.now()),this._sumHiddenTime()),e.name===i.default.names.START_BUTTON_CLICKED&&this._resetSegmentData(),e.name!==i.default.names.NARRATIVE_ELEMENT_CHANGE&&e.name!==i.default.names.STORY_END||this._saveSummaryData(e)}},{key:"_resetSegmentData",value:function(){this._segmentSummaryData={startTime:Date.now(),pausedTime:0,hiddenTime:0},this._lastpausedTime=Date.now(),this._lastHideTime=Date.now(),this._paused=!1}},{key:"_saveSummaryData",value:function(e){var t=this._segmentSummaryData,n=t.startTime,r=t.pausedTime,o=t.hiddenTime,a=Date.now()-n;this._segmentSummaryData.duration=a,this._segmentSummaryData.playingTime=a-r-o,this._segmentSummaryData.visibleTime=a-o,this._segmentSummaryData.chapter||(this._segmentSummaryData.chapter=e.from);var s={type:i.default.types.SEGMENT_COMPLETION,name:e.name,from:e.from,to:e.to,data:this._segmentSummaryData,current_narrative_element:e.current_narrative_element,current_representation:e.current_representation};s.current_representation&&this._analytics(s),this._resetSegmentData(),this._segmentSummaryData.chapter=e.to}}])&&s(t.prototype,n),r&&s(t,r),e}();t.default=u},"./src/Controller.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.symbol.js"),n("./node_modules/core-js/modules/es.symbol.description.js"),n("./node_modules/core-js/modules/es.symbol.iterator.js"),n("./node_modules/core-js/modules/es.array.concat.js"),n("./node_modules/core-js/modules/es.array.filter.js"),n("./node_modules/core-js/modules/es.array.for-each.js"),n("./node_modules/core-js/modules/es.array.from.js"),n("./node_modules/core-js/modules/es.array.includes.js"),n("./node_modules/core-js/modules/es.array.index-of.js"),n("./node_modules/core-js/modules/es.array.iterator.js"),n("./node_modules/core-js/modules/es.array.map.js"),n("./node_modules/core-js/modules/es.array.reduce.js"),n("./node_modules/core-js/modules/es.array.some.js"),n("./node_modules/core-js/modules/es.date.to-string.js"),n("./node_modules/core-js/modules/es.function.name.js"),n("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),n("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),n("./node_modules/core-js/modules/es.object.get-prototype-of.js"),n("./node_modules/core-js/modules/es.object.keys.js"),n("./node_modules/core-js/modules/es.object.set-prototype-of.js"),n("./node_modules/core-js/modules/es.object.to-string.js"),n("./node_modules/core-js/modules/es.promise.js"),n("./node_modules/core-js/modules/es.regexp.to-string.js"),n("./node_modules/core-js/modules/es.string.includes.js"),n("./node_modules/core-js/modules/es.string.iterator.js"),n("./node_modules/core-js/modules/web.dom-collections.for-each.js"),n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.PLACEHOLDER_REPRESENTATION=void 0;var r=g(n("./node_modules/events/events.js")),i=g(n("./node_modules/json-logic-js/logic.js")),o=(g(n("./src/StoryReasoner.js")),g(n("./src/StoryPathWalker.js"))),a=g(n("./src/RenderManager.js")),s=g(n("./src/renderers/RendererEvents.js")),u=g(n("./src/AnalyticEvents.js")),l=n("./src/browserCapabilities.js"),c=g(n("./src/logger.js")),d=(g(n("./src/renderers/BaseRenderer.js")),n("./src/InternalVariables.js")),h=n("./src/Events.js"),f=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==y(e)&&"function"!=typeof e)return{default:e};var t=v();if(t&&t.has(e))return t.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=r?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(n,i,o):n[i]=e[i]}n.default=e,t&&t.set(e,n);return n}(n("./src/SessionManager.js")),p=n("./src/utils.js"),m=g(n("./src/AnalyticsHandler.js"));function v(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return v=function(){return e},e}function g(e){return e&&e.__esModule?e:{default:e}}function y(e){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach((function(t){E(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function w(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function T(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e))&&"[object Arguments]"!==Object.prototype.toString.call(e))return;var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function x(e){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function A(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function M(e,t){return(M=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var j={object_class:"REPRESENTATION",version:"0:0",tags:{},name:"Blank representation",representation_type:"urn:x-object-based-media:representation-types:placeholder/v1.0",asset_collections:{}};t.PLACEHOLDER_REPRESENTATION=j;var R=function(e){function t(e,n,r,i,o,a,s,u,l){var c;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(c=function(e,t){return!t||"object"!==y(t)&&"function"!=typeof t?A(e):t}(this,x(t).call(this)))._storyId=null,c._reasoner=null,c._saveSession=u,c._sessionManager=null,c._target=e,c._storyReasonerFactory=n,c._representationReasoner=r,c._fetchers=i,c._handleVariableChanged=c._handleVariableChanged.bind(A(c)),c._handleRendererCompletedEvent=c._handleRendererCompletedEvent.bind(A(c)),c._handleRendererNextButtonEvent=c._handleRendererNextButtonEvent.bind(A(c)),c._handleRendererPreviousButtonEvent=c._handleRendererPreviousButtonEvent.bind(A(c)),c._startStoryEventListener=c._startStoryEventListener.bind(A(c)),c._handleStoryEnd=c._handleStoryEnd.bind(A(c)),c._analyticsHandler=new m.default(o,A(c)),c._handleAnalytics=c._handleAnalytics.bind(A(c)),c._assetUrls=a,c._privacyNotice=s,c.handleKeys=l,c._linearStoryPath=[],c._createRenderManager(),c._storyIconRendererCreated=!1,c}var n,r,v;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&M(e,t)}(t,e),n=t,(r=[{key:"_handleAnalytics",value:function(e){this._analyticsHandler.handleAnalyticsEvent(e)}},{key:"restart",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._reasoner=null,this._prepareRenderManagerForRestart(),this._sessionManager?0===Object.keys(n).length&&this._sessionManager.fetchExistingSessionState().then((function(n){t.start(e,n)})):this.start(e,n)}},{key:"_prepareRenderManagerForRestart",value:function(){this._removeListenersFromRenderManager(),this._renderManager.prepareForRestart()}},{key:"resetStory",value:function(e){this._prepareRenderManagerForRestart(),this.start(e)}},{key:"start",value:function(e,t){if(this._storyId=e,this._saveSession)switch(this._sessionManager||this._createSessionManager(e),this._sessionManager.sessionState){case f.SESSION_STATE.RESUME:case f.SESSION_STATE.EXISTING:this.resumeStoryFromState(e,t);break;case f.SESSION_STATE.RESTART:case f.SESSION_STATE.NEW:default:this.startFromDefaultState(e,t)}else this.deleteExistingSession(),this.startFromDefaultState(e,t)}},{key:"resumeStoryFromState",value:function(e,t){var n=this;t&&Object.keys(t).length>0?this.startStory(e,t):this._sessionManager?this._sessionManager.fetchExistingSessionState().then((function(t){n.startStory(e,t)})):this.startStory(e,t)}},{key:"startFromDefaultState",value:function(e,t){var n=this;t&&Object.keys(t).length>0?this.startStory(e,t):this.getDefaultInitialState().then((function(r){n.setDefaultState(r),Object.keys(r).length>0?n.startStory(e,r):n.startStory(e,t)}))}},{key:"startStory",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._getAllNarrativeElements().then((function(e){t._allNarrativeElements=e})),window._sessionManager=this._sessionManager,this._testForLinearityAndBuildStoryRenderer(e).then((function(){return t._storyReasonerFactory(e,t._analytics)})).then((function(r){t._storyId===e&&-1!==t._checkStoryPlayable(r.getRequirements())&&(t._handleNarrativeElementChanged=function(e){t._handleNEChange(r,e).then((function(){t._linearStoryPath&&!t._storyIconRendererCreated&&(t._renderManager._createStoryIconRenderer(t._linearStoryPath),t._storyIconRendererCreated=!0)}))},r.on(h.REASONER_EVENTS.STORY_END,t._handleStoryEnd),r.on(h.REASONER_EVENTS.NARRATIVE_ELEMENT_CHANGED,t._handleNarrativeElementChanged),r.on(h.VARIABLE_EVENTS.VARIABLE_CHANGED,t._handleVariableChanged),r.on(h.ERROR_EVENTS,t._handleError),t._reasoner=r,t._reasoner.start(n),t._chooseBeginningElement(),t._addListenersToRenderManager(),t._renderManager.handleStoryStart(e))})).catch((function(e){c.default.warn("Error starting story",e)}))}},{key:"_chooseResumeElement",value:function(){var e=this;this._sessionManager.fetchPathHistory().then((function(t){if(t){var n=t[t.length-1];n&&n in e._reasoner._narrativeElements?e._jumpToNarrativeElement(n):e.walkPathHistory(e._storyId,n,t)}else e._reasoner.chooseBeginning()}))}},{key:"_chooseBeginningElement",value:function(){if(this._sessionManager)switch(this._sessionManager.sessionState){case f.SESSION_STATE.RESUME:this._chooseResumeElement();break;case f.SESSION_STATE.EXISTING:break;case f.SESSION_STATE.RESTART:case f.SESSION_STATE.NEW:default:this._reasoner.chooseBeginning()}else this._reasoner.chooseBeginning()}},{key:"getStatus",value:function(){var e=this._renderManager.getCurrentNarrativeElement(),t=null;return this.getValidNextSteps().then((function(e){return e.length>=1&&(t=e[0].ne),Promise.resolve(t)})).then((function(t){return{currentNarrativeElement:e,nextNarrativeElement:t}}))}},{key:"_checkStoryPlayable",value:function(e){var t=this,n={supports:{hls:l.BrowserCapabilities.hlsSupport(),dash:l.BrowserCapabilities.dashSupport()},browser:{ie:l.BrowserUserAgent.ie(),edge:l.BrowserUserAgent.edge(),iOS:l.BrowserUserAgent.iOS(),safari:l.BrowserUserAgent.safari()}};return(0,p.checkDebugPlayout)()&&c.default.info("playing capabilities",n),e.some((function(e){if(!1===i.default.apply(e.logic,n)){t._target.innerHTML="";var r=document.createElement("div");r.classList.add("romper-warning");var o=document.createElement("div");return o.classList.add("romper-warning-div"),o.innerHTML=e.errorMsg,r.appendChild(o),t._target.appendChild(r),c.default.warn("Using Data: ".concat(JSON.stringify(n))),c.default.warn("Requirement Failed: ".concat(JSON.stringify(e.logic))),!0}return!1}))?-1:(c.default.info("All requirements satisfied: ".concat(JSON.stringify(e))),0)}},{key:"_createRenderManager",value:function(){this._renderManager=new a.default(this,this._target,this._representationReasoner,this._fetchers,this._handleAnalytics,this._assetUrls,this._privacyNotice)}},{key:"_createSessionManager",value:function(e){this._sessionManager=new f.default(e)}},{key:"getCurrentRenderer",value:function(){return this._renderManager.getCurrentRenderer()}},{key:"getCurrentNarrativeElement",value:function(){return this._currentNarrativeElement}},{key:"_handleRendererCompletedEvent",value:function(){this._reasoner&&this._reasoner.next()}},{key:"_handleRendererNextButtonEvent",value:function(){this._reasoner&&this._reasoner.next()}},{key:"_handleRendererPreviousButtonEvent",value:function(){this._goBackOneStepInStory()}},{key:"_addListenersToRenderManager",value:function(){this._renderManager.on(h.REASONER_EVENTS.ROMPER_STORY_STARTED,this._startStoryEventListener),this._renderManager.on(s.default.COMPLETED,this._handleRendererCompletedEvent),this._renderManager.on(s.default.NEXT_BUTTON_CLICKED,this._handleRendererNextButtonEvent),this._renderManager.on(s.default.PREVIOUS_BUTTON_CLICKED,this._handleRendererPreviousButtonEvent)}},{key:"_removeListenersFromRenderManager",value:function(){this._renderManager.off(s.default.COMPLETED,this._handleRendererCompletedEvent),this._renderManager.off(s.default.NEXT_BUTTON_CLICKED,this._handleRendererNextButtonEvent),this._renderManager.off(s.default.PREVIOUS_BUTTON_CLICKED,this._handleRendererPreviousButtonEvent)}},{key:"_startStoryEventListener",value:function(){var e=this._reasoner._story.meta&&this._reasoner._story.meta.storyplayer&&this._reasoner._story.meta.storyplayer.taster&&this._reasoner._story.meta.storyplayer.taster.hideDuringExperience||!1;this.emit(h.REASONER_EVENTS.ROMPER_STORY_STARTED,{hide:e})}},{key:"_testForLinearityAndBuildStoryRenderer",value:function(e){var t=this,n=new o.default(this._fetchers.storyFetcher,this._fetchers.representationCollectionFetcher,this._storyReasonerFactory);return new Promise((function(r){n.on(h.REASONER_EVENTS.WALK_COMPLETE,(function(){n.getStoryItemList(t._representationReasoner).then((function(e){t._linearStoryPath=e})).then((function(){r()})).catch((function(e){c.default.warn(e),t._linearStoryPath=[],r()}))})),n.parseStory(e)}))}},{key:"_goBackOneStepInStory",value:function(){var e=this;return Promise.all([this.getIdOfPreviousNode(),this.getVariableValue(d.InternalVariableNames.PATH_HISTORY)]).then((function(t){var n=T(t,2),r=n[0],i=n[1];i.pop(),i.pop(),e._reasoner&&e._reasoner.setVariableValue(d.InternalVariableNames.PATH_HISTORY,i),e._sessionManager&&e._sessionManager.setVariable(d.InternalVariableNames.PATH_HISTORY,i),r?e._jumpToNarrativeElement(r):c.default.error("cannot resolve previous node to go to")}))}},{key:"repeatStep",value:function(){var e=this._currentNarrativeElement;this._reasoner&&e?this._handleNEChange(this._reasoner,e):c.default.error("cannot resolve this node to repeat")}},{key:"_handleNEChange",value:function(e,t,n){return c.default.info({obj:t},"Narrative Element"),this._reasoner&&!n&&(this._reasoner.appendToHistory(t.id),this._logNEChange(this._currentNarrativeElement,t)),this._currentNarrativeElement=t,this._renderManager.handleNEChange(t)}},{key:"_logNEChange",value:function(e,t){var n="null",r="null";e&&(r=e.id,n=e.name);var i={type:u.default.types.STORY_NAVIGATION,name:u.default.names.NARRATIVE_ELEMENT_CHANGE,from:r,to:t.id,data:{fromName:n,toName:t.name}};this._handleAnalytics(i),this.emit(h.REASONER_EVENTS.NARRATIVE_ELEMENT_CHANGED,t)}},{key:"_getNarrativeElement",value:function(e){var t;if(this._allNarrativeElements)t=T(this._allNarrativeElements.filter((function(t){return t.id===e})),1)[0];else if(this._reasoner){var n=this._reasoner.getSubReasonerContainingNarrativeElement(e);n&&(t=n._narrativeElements[e])}return t}},{key:"_jumpToNarrativeElementUsingShadowReasoner",value:function(e,t){var n=this;this._storyReasonerFactory(e).then((function(r){if(n._storyId===e){var i=function(){c.default.warn("shadow reasoner reached story end without meeting target node")};r.on(h.REASONER_EVENTS.STORY_END,i);var o=function(){c.default.warn("Story ended!")};r.on(h.ERROR_EVENTS,(function(e){c.default.warn("Error: ".concat(e))}));var a=[];r.on(h.REASONER_EVENTS.NARRATIVE_ELEMENT_CHANGED,(function s(u){return a.includes(u.id)?(c.default.warn("shadow reasoner looping - exiting without meeting target node"),void i()):(a.push(u.id),u.id===t?(n.reset(),n._storyId=e,r.on(h.REASONER_EVENTS.STORY_END,o),r.removeListener(h.REASONER_EVENTS.NARRATIVE_ELEMENT_CHANGED,s),n._handleNarrativeElementChanged=function(e){n._handleNEChange(r,e)},r.on(h.REASONER_EVENTS.NARRATIVE_ELEMENT_CHANGED,n._handleNarrativeElementChanged),n._reasoner=r,void n._handleNEChange(r,u)):void r.next())})),r.start(),r.chooseBeginning()}}))}},{key:"followLink",value:function(e){var t=this;this._currentNarrativeElement.links.forEach((function(n){if(n.target_narrative_element_id===e&&t._reasoner){var r=t._reasoner.getSubReasonerContainingNarrativeElement(t._currentNarrativeElement.id);r&&r._followLink(n)}}))}},{key:"setVariableValue",value:function(e,t){this._reasoner?(this._reasoner.setVariableValue(e,t),c.default.info("Controller seting variable '".concat(e,"' to ").concat(t)),this.emit(h.VARIABLE_EVENTS.CONTROLLER_CHANGED_VARIABLE,{name:e,value:t}),this._renderManager.refreshLookahead()):c.default.warn("Controller cannot set variable '".concat(e,"' - no reasoner"))}},{key:"getVariableValue",value:function(e){return this._reasoner?this._reasoner.getVariableValue(e):(c.default.warn("Controller cannot get variable '".concat(e,"' - no reasoner")),Promise.resolve(null))}},{key:"getVariableState",value:function(){var e=this,t=this._storyId;return t?this._getAllStories(t).then((function(t){var n=[];return t.forEach((function(t){n.push(e._getVariableStateForStory(t))})),Promise.all(n)})).then((function(e){var t={};return e.forEach((function(e){Object.keys(e).forEach((function(n){t[n]=e[n]}))})),t})):Promise.resolve({})}},{key:"getDefaultInitialState",value:function(){var e=this;return this._storyId?this._getAllStories(this._storyId).then((function(t){return Promise.all(t.map((function(t){return e._getStoryDefaultVariableState(t)})))})).then((function(e){var t;return(t=[]).concat.apply(t,w(e)).reduce((function(e,t){return e[t.name]=t.value,e}),{})})):{}}},{key:"_getStoryDefaultVariableState",value:function(e){return this._fetchers.storyFetcher(e).then((function(e){var t=e.variables;return t?Object.keys(t).map((function(e){return{name:e,value:t[e].default_value}})):Promise.resolve({})}))}},{key:"_getAllStories",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this._fetchers.storyFetcher(e).then((function(e){var n=[];return e.narrative_element_ids.forEach((function(e){n.push(t._fetchers.narrativeElementFetcher(e))})),Promise.all(n)})).then((function(e){var r=[];e.forEach((function(e){"STORY_ELEMENT"!==e.body.type||!e.body.story_target_id||r.includes(e.body.story_target_id)||n.includes(e.body.story_target_id)||(r.push(e.body.story_target_id),n.push(e.body.story_target_id))}));var i=[];return r.forEach((function(e){i.push(t._getAllStories(e,n))})),Promise.all(i)})).then((function(t){var n,r=(n=[]).concat.apply(n,w(t)),i=[];return i.push(e),r.forEach((function(e){return i.push(e)})),Promise.resolve(i)}))}},{key:"_getVariableStateForStory",value:function(e){var t,n=this;return this._fetchers.storyFetcher(e).then((function(e){var r=[];return(t=e.variables)&&Object.keys(t).forEach((function(e){n._reasoner&&r.push(n._reasoner.getVariableValue(e))})),Promise.all(r)})).then((function(e){return t&&e.length>0?(Object.keys(t).forEach((function(n,r){t&&(t[n].value=e[r])})),t):{}}))}},{key:"setDefaultState",value:function(e){e[d.InternalVariableNames.PATH_HISTORY]=[],this._sessionManager?this._sessionManager.setDefaultState(e):this.setVariables(e)}},{key:"setVariables",value:function(e){var t=this;Object.keys(e).forEach((function(n){t._reasoner?t._reasoner.setVariableValue(n,e[n]):c.default.warn("Controller cannot set variable '".concat(n,"' - no reasoner"))})),this.emit(h.VARIABLE_EVENTS.CONTROLLER_CHANGED_VARIABLE,e),this._renderManager.refreshLookahead()}},{key:"_getAllNarrativeElements",value:function(){var e=this;return this._storyId?this._getAllStories(this._storyId).then((function(t){t.push(e._storyId);var n=[];return t.forEach((function(t){return n.push(e._fetchers.storyFetcher(t))})),Promise.all(n)})).then((function(t){var n=[];t.forEach((function(e){e.narrative_element_ids.forEach((function(e){-1===n.indexOf(e)&&n.push(e)}))}));var r=[];return n.forEach((function(t){return r.push(e._fetchers.narrativeElementFetcher(t))})),Promise.all(r)})):Promise.resolve([])}},{key:"_jumpToNarrativeElement",value:function(e){if(this._reasoner){var t=this._reasoner.getSubReasonerContainingNarrativeElement(e);t?(t._setCurrentNarrativeElement(e),t._subStoryReasoner=null,t.hasNextNode().then((function(e){e.length>0&&t._storyEnded&&(c.default.info("Jumped back from finish: resetting storyEnded"),t._storyEnded=!1)}))):this._storyId&&this._jumpToNarrativeElementUsingShadowReasoner(this._storyId,e)}else c.default.error("no reasoner")}},{key:"hasUniqueNextNode",value:function(){return this._reasoner?this._reasoner.hasNextNode().then((function(e){return 1===e.length})):Promise.resolve(!1)}},{key:"getValidNextSteps",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=t;if(null===n&&this._currentNarrativeElement&&(n=this._currentNarrativeElement.id),this._reasoner&&n){var r=this._reasoner.getSubReasonerContainingNarrativeElement(n);if(r)return r.hasNextNode().then((function(t){var n=[];t.forEach((function(t){if(t.target_narrative_element_id){var r=e._getNarrativeElement(t.target_narrative_element_id);r&&n.push(r)}}));var r=[];return n.forEach((function(t){"REPRESENTATION_COLLECTION_ELEMENT"===t.body.type?r.push(Promise.resolve([{ne:t,targetNeId:t.id}])):"STORY_ELEMENT"===t.body.type&&t.body.story_target_id&&r.push(e._fetchers.storyFetcher(t.body.story_target_id).then((function(n){var r=[];return n.beginnings.forEach((function(t){r.push(e._fetchers.narrativeElementFetcher(t.narrative_element_id))})),Promise.all(r).then((function(e){var n=[];return e.forEach((function(e){return n.push({ne:e,targetNeId:t.id})})),n}))})).catch((function(e){return c.default.error("Controller finding next steps, but cannot get substory: ".concat(e)),Promise.resolve([null])})))})),Promise.all(r).then((function(t){var n,r=(n=[]).concat.apply(n,w(t)).map((function(t){return null===t?Promise.resolve(null):e._fetchers.representationCollectionFetcher(t.ne.body.representation_collection_target_id).then((function(n){if(n.representations.length>0)return e._representationReasoner(n);c.default.warn("Found NE with no representations - render description");var r=b({},j,{description:t.ne.description,id:t.ne.id});return Promise.resolve(r)})).then((function(){return t})).catch((function(e){return c.default.warn("No representations are currently valid for Narrative Element ".concat(t.id),e),null}))}));return Promise.all(r)})).then((function(e){return e.filter((function(e){return null!==e}))}))}))}return Promise.resolve([])}},{key:"refreshPlayerNextAndBack",value:function(){this._renderManager.refreshOnwardIcons()}},{key:"getIdOfPreviousNode",value:function(){var e=this,t=null;if(this._linearStoryPath)this._linearStoryPath.forEach((function(n,r){n.narrative_element.id===e._currentNarrativeElement.id&&r>=1&&(t=e._linearStoryPath[r-1].narrative_element.id)}));else if(this._reasoner){var n=this._reasoner.getSubReasonerContainingNarrativeElement(this._currentNarrativeElement.id);n&&(t=n.findPreviousNodeId())}return null!==t?Promise.resolve(t):this.getVariableValue(d.InternalVariableNames.PATH_HISTORY).then((function(t){if(t.length>1){var n=t[t.length-2];return e._fetchers.narrativeElementFetcher(n)}return Promise.resolve()})).then((function(e){return e?e.id:null}))}},{key:"getIdsOfNextNodes",value:function(e){var t=this;return this.getValidNextSteps(e.id).then((function(e){return e&&e.length>0&&t.emit(h.REASONER_EVENTS.NEXT_ELEMENTS,{names:e.map((function(e){return e.ne.name}))}),e.map((function(e){return e.ne.id}))}))}},{key:"getRepresentationForNarrativeElementId",value:function(e){var t=this;return this._fetchers.narrativeElementFetcher(e).then((function(e){return e&&e.body.representation_collection_target_id?t._fetchers.representationCollectionFetcher(e.body.representation_collection_target_id).then((function(n){if(n.representations.length>0)return t._representationReasoner(n);var r=b({},j,{description:e.description,id:e.id});return Promise.resolve(r)})):t._reasoner&&e&&e.body.story_target_id?t._fetchers.storyFetcher(e.body.story_target_id).then((function(e){return t._reasoner?t._reasoner.getBeginning(e):Promise.resolve(null)})).then((function(e){return e?t.getRepresentationForNarrativeElementId(e):Promise.resolve(null)})):Promise.resolve(null)}))}},{key:"reset",value:function(){this._storyId=null,this._reasoner&&this._handleStoryEnd&&this._reasoner.removeListener(h.REASONER_EVENTS.STORY_END,this._handleStoryEnd),this._reasoner&&this._handleLinkChoice&&this._reasoner.removeListener(h.REASONER_EVENTS.MULTIPLE_VALID_LINKS,this._handleLinkChoice),this._reasoner&&this._handleError&&this._reasoner.removeListener(h.ERROR_EVENTS,this._handleError),this._reasoner&&this._handleNarrativeElementChanged&&this._reasoner.removeListener(h.REASONER_EVENTS.NARRATIVE_ELEMENT_CHANGED,this._handleNarrativeElementChanged),this._reasoner=null,this._renderManager.reset()}},{key:"_handleStoryEnd",value:function(){var e={type:u.default.types.STORY_NAVIGATION,name:u.default.names.STORY_END,from:this._currentNarrativeElement.id,to:"STORY_END"};this._handleAnalytics(e),c.default.warn("Story Ended!"),this.emit(h.REASONER_EVENTS.STORY_END)}},{key:"_handleError",value:function(e){c.default.warn(e)}},{key:"walkPathHistory",value:function(e,t,n){var r=this;this._storyReasonerFactory(e).then((function(t){r._storyId===e&&(t.on(h.REASONER_EVENTS.ELEMENT_FOUND,(function(n){r.reset(),r._storyId=e,r._handleNarrativeElementChanged=function(e){r._handleNEChange(t,e)},t.on(h.REASONER_EVENTS.NARRATIVE_ELEMENT_CHANGED,r._handleNarrativeElementChanged),t.on(h.VARIABLE_EVENTS.VARIABLE_CHANGED,r._handleVariableChanged),t.on(h.REASONER_EVENTS.STORY_END,r._handleStoryEnd),t.on(h.ERROR_EVENTS,r._handleError),r._reasoner=t,r._handleNEChange(t,n,!0)})),t.start(),n.forEach((function(e){t._shadowWalkPath(e,n)})))}))}},{key:"setSessionState",value:function(e){this._sessionManager&&this._sessionManager.setSessionState(e)}},{key:"getSessionState",value:function(){return this._sessionManager?this._sessionManager.sessionState:null}},{key:"deleteExistingSession",value:function(){this._storyId&&f.default.deleteExistingSession(this._storyId),this._sessionManager&&this._sessionManager.setSessionState(f.SESSION_STATE.NEW)}},{key:"setExistingSession",value:function(){this._sessionManager&&this._sessionManager.setExistingSession()}},{key:"_handleVariableChanged",value:function(e){this._sessionManager?(c.default.info("Variable stored in session state",e),this._sessionManager.setVariable(e)):c.default.info("Variable not stored in session state",e),this.emit(h.VARIABLE_EVENTS.VARIABLE_CHANGED,e)}}])&&S(n.prototype,r),v&&S(n,v),t}(r.default);t.default=R},"./src/Events.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.array.reduce.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.SHAKA_EVENTS=t.ERROR_EVENTS=t.VARIABLE_EVENTS=t.REASONER_EVENTS=void 0;var r=["romperstorystarted","ROMPER_STORY_STARTED","walkComplete","WALK_COMPLETE","jumpToNarrativeElement","JUMP_TO_NARRATIVE_ELEMENT","storyEnd","STORY_END","narrativeElementChanged","NARRATIVE_ELEMENT_CHANGED","choiceOfBeginnings","CHOICE_OF_BEGINNINGS","choiceOfLinks","CHOICE_OF_LINKS","NEXT_ELEMENTS","MULTIPLE_VALID_LINKS","ELEMENT_FOUND"].reduce((function(e,t){return e[t]=t,e}),{});t.REASONER_EVENTS=r;var i=["VARIABLE_CHANGED","CONTROLLER_CHANGED_VARIABLE"].reduce((function(e,t){return e[t]=t,e}),{});t.VARIABLE_EVENTS=i;t.ERROR_EVENTS="ERROR";var o=["error","buffering","adaptation","adaptation"].reduce((function(e,t){return e[t]=t,e}),{});t.SHAKA_EVENTS=o},"./src/InternalVariables.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.array.concat.js"),n("./node_modules/core-js/modules/es.date.to-string.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.InternalVariableNames=void 0;var r,i=(r=n("./src/logger.js"))&&r.__esModule?r:{default:r};function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a={DAY_OF_WEEK:"_day_of_week",PORTION_OF_DAY:"_portion_of_day",PATH_HISTORY:"_path_history",LONGITUDE:"_location_longitude",LATITUDE:"_location_latitude"};t.InternalVariableNames=a;var s=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._dataResolver=t,n&&n.romper&&n.romper.data_requirements?this._requirements=n.romper.data_requirements:this._requirements={}}var t,n,r;return t=e,(n=[{key:"setAllVariables",value:function(){this._setTodaysDay(),this._setSegmentOfDay(),this._requirements.location&&this._setLocation()}},{key:"_setVariableValue",value:function(e,t){i.default.info("Setting internal variable '".concat(e,"' to ").concat(JSON.stringify(t))),this._dataResolver.set(e,t)}},{key:"_setTodaysDay",value:function(){this._setVariableValue(a.DAY_OF_WEEK,["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][(new Date).getDay()])}},{key:"_setSegmentOfDay",value:function(){var e,t=(new Date).getHours();e=t<12?"Morning":t<17?"Afternoon":"Evening",this._setVariableValue(a.PORTION_OF_DAY,e)}},{key:"_setLocation",value:function(){i.default.info("GeoLocation has been disabled")}}])&&o(t.prototype,n),r&&o(t,r),e}();t.default=s},"./src/Player.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.symbol.js"),n("./node_modules/core-js/modules/es.symbol.description.js"),n("./node_modules/core-js/modules/es.symbol.iterator.js"),n("./node_modules/core-js/modules/es.array.concat.js"),n("./node_modules/core-js/modules/es.array.filter.js"),n("./node_modules/core-js/modules/es.array.for-each.js"),n("./node_modules/core-js/modules/es.array.index-of.js"),n("./node_modules/core-js/modules/es.array.iterator.js"),n("./node_modules/core-js/modules/es.array.reduce.js"),n("./node_modules/core-js/modules/es.array.slice.js"),n("./node_modules/core-js/modules/es.array.some.js"),n("./node_modules/core-js/modules/es.date.to-string.js"),n("./node_modules/core-js/modules/es.function.name.js"),n("./node_modules/core-js/modules/es.number.constructor.js"),n("./node_modules/core-js/modules/es.number.is-nan.js"),n("./node_modules/core-js/modules/es.object.get-prototype-of.js"),n("./node_modules/core-js/modules/es.object.keys.js"),n("./node_modules/core-js/modules/es.object.set-prototype-of.js"),n("./node_modules/core-js/modules/es.object.to-string.js"),n("./node_modules/core-js/modules/es.parse-float.js"),n("./node_modules/core-js/modules/es.parse-int.js"),n("./node_modules/core-js/modules/es.promise.js"),n("./node_modules/core-js/modules/es.regexp.exec.js"),n("./node_modules/core-js/modules/es.regexp.to-string.js"),n("./node_modules/core-js/modules/es.string.iterator.js"),n("./node_modules/core-js/modules/es.string.replace.js"),n("./node_modules/core-js/modules/web.dom-collections.for-each.js"),n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.PlayerEvents=t.default=void 0;var r=f(n("./node_modules/events/events.js")),i=f(n("./src/AnalyticEvents.js")),o=(f(n("./src/Controller.js")),f(n("./src/playoutEngines/BasePlayoutEngine.js")),f(n("./src/playoutEngines/DOMSwitchPlayoutEngine.js"))),a=f(n("./src/playoutEngines/SrcSwitchPlayoutEngine.js")),s=f(n("./src/playoutEngines/iOSPlayoutEngine.js")),u=f(n("./src/logger.js")),l=n("./src/browserCapabilities.js"),c=(f(n("./src/renderers/BaseRenderer.js")),n("./src/SessionManager.js")),d=n("./src/utils.js"),h=n("./src/Events.js");function f(e){return e&&e.__esModule?e:{default:e}}function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _=["VOLUME_CHANGED","VOLUME_MUTE_TOGGLE","ICON_CLICKED","REPRESENTATION_CLICKED","BACK_BUTTON_CLICKED","NEXT_BUTTON_CLICKED","SCRUB_BAR_MOUSE_DOWN","SCRUB_BAR_CHANGED","SCRUB_BAR_MOUSE_UP","PLAY_PAUSE_BUTTON_CLICKED","SEEK_FORWARD_BUTTON_CLICKED","SEEK_BACKWARD_BUTTON_CLICKED","SUBTITLES_BUTTON_CLICKED","FULLSCREEN_BUTTON_CLICKED","REPEAT_BUTTON_CLICKED","LINK_CHOSEN"].reduce((function(e,t){return e[t]=t,e}),{});t.PlayerEvents=_;var b=[];function E(e,t){var n=document.createElement("div");n.classList.add("romper-overlay"),n.classList.add("romper-".concat(e,"-overlay")),n.classList.add("romper-inactive"),n.onclick=function(e){e.stopPropagation()};var r=document.createElement("button");r.setAttribute("type","button");var i=function(){n.classList.contains("romper-inactive")||(t("OVERLAY_DEACTIVATED","".concat(e," visible"),"".concat(e," hidden")),n.classList.add("romper-inactive")),r.classList.contains("romper-button-selected")&&r.classList.remove("romper-button-selected")};b.push({overlay:n,deactivateOverlay:i}),r.setAttribute("title","".concat(e.charAt(0).toUpperCase()+e.slice(1)," Button")),r.setAttribute("aria-label","".concat(e.charAt(0).toUpperCase()+e.slice(1)," Button")),r.classList.add("romper-button"),r.classList.add("romper-".concat(e,"-button")),r.classList.add("romper-inactive");var o=function(){b.filter((function(e){return e.overlay!==n})).forEach((function(e){return e.deactivateOverlay()})),n.parentElement&&(Array.prototype.slice.call(n.parentElement.querySelectorAll(".romper-overlay")).filter((function(e){return e!==n})).forEach((function(e){return e.classList.add("romper-inactive")})),n.classList.contains("romper-inactive")?(t("OVERLAY_BUTTON_CLICKED","".concat(e," hidden"),"".concat(e," visible")),r.classList.add("romper-button-selected")):(t("OVERLAY_BUTTON_CLICKED","".concat(e," visible"),"".concat(e," hidden")),r.classList.remove("romper-button-selected")),n.classList.toggle("romper-inactive"))};r.onclick=o,r.addEventListener("touchend",(0,d.handleButtonTouchEvent)(o));var a=document.createElement("div");a.classList.add("romper-button-icon-div"),a.classList.add("romper-".concat(e,"-button-icon-div")),r.appendChild(a);var s={},u={},l=null,c=function(){return Object.keys(s).length};return{overlay:n,button:r,add:function(e,t,i){n.classList.remove("count-".concat(c())),s[e]=t,i&&(u[i]=e),t.classList.add("romper-control-unselected"),n.appendChild(t),r.classList.remove("romper-inactive"),n.classList.add("count-".concat(c()))},remove:function(e){n.classList.remove("count-".concat(c())),s[e]&&(n.removeChild(s[e]),delete s[e],0===Object.keys(s).length&&r.classList.add("romper-inactive")),n.classList.add("count-".concat(c()))},get:function(e){return s[e]},setActive:function(e){l=e,Object.keys(s).forEach((function(t){t===e?(s[t].setAttribute("data-link-choice","active"),s[t].classList.add("romper-control-selected"),s[t].classList.remove("romper-control-unselected"),s[t].classList.remove("default")):(s[t].setAttribute("data-link-choice","inactive"),s[t].classList.add("romper-control-unselected"),s[t].classList.remove("romper-control-selected"),s[t].classList.remove("default"))}))},getActive:function(){var e=null;return l&&(e=s[l]),e},addClass:function(e,t){Object.keys(s).forEach((function(n){n===e&&s[n].classList.add(t)}))},removeClass:function(e,t){Object.keys(s).forEach((function(n){n===e&&s[n].classList.remove(t)}))},deactivateOverlay:i,getIdForLabel:function(e){return u[e]?u[e]:null},setButtonClass:function(e){r.classList.forEach((function(e){0===e.indexOf("romper-overlay-button-choice-")&&r.classList.remove(e)})),r.classList.add("".concat("romper-overlay-button-choice-").concat(e))},clearAll:function(){n.classList.remove("count-".concat(c())),Object.keys(s).forEach((function(e){n.removeChild(s[e]),delete s[e],delete u[e]})),n.classList.add("count-".concat(c()))},getCount:c}}var w=function(e){function t(e,n,r,i){var c;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(c=function(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?g(e):t}(this,v(t).call(this)))._controller=i,c._numChoices=0,c._choiceIconSet={},c._visibleChoices={},c._volumeEventTimeouts={},c._RomperButtonsShowing=!1,c._countdownTotal=0,c._userInteractionStarted=!1,c._controlsDisabled=!1,c._backNextWaiting=!1,c.showingSubtitles=!1,c._analytics=n,c._assetUrls=r,c._logUserInteraction=c._logUserInteraction.bind(g(c)),c._player=document.createElement("div"),c._player.classList.add("romper-player"),c._player.classList.add("noselect"),c._playerParent=e,c._backgroundLayer=document.createElement("div"),c._backgroundLayer.classList.add("romper-background"),c._mediaLayer=document.createElement("div"),c._mediaLayer.id="media-layer",c._mediaLayer.classList.add("romper-media"),c._loadingLayer=document.createElement("div"),c._loadingLayer.id="loading-layer",c._loadingLayer.classList.add("romper-loading");var h=document.createElement("div");h.classList.add("romper-loading-inner"),c._loadingLayer.appendChild(h),c._mediaLayer.appendChild(c._loadingLayer),c._aspectRatio=16/9,c._guiLayer=document.createElement("div"),c._guiLayer.id="gui-layer",c._guiLayer.classList.add("romper-gui"),c._errorLayer=document.createElement("div");var f=document.createTextNode("Sorry, there's a problem - try skipping ahead");c._errorLayer.appendChild(f),c._errorLayer.classList.add("romper-error"),c._errorLayer.classList.add("hide"),c._continueModalLayer=document.createElement("div"),c._continueModalLayer.id="continue-modal",c._continueModalLayer.classList.add("continue-modal"),c._continueModalContent=document.createElement("div"),c._continueModalContent.classList.add("continue-modal-content"),c._continueModalLayer.appendChild(c._continueModalContent),c._player.appendChild(c._backgroundLayer),c._player.appendChild(c._mediaLayer),c._player.appendChild(c._guiLayer),c._player.appendChild(c._errorLayer),c._guiLayer.appendChild(c._continueModalLayer),c._overlays=document.createElement("div"),c._overlays.classList.add("romper-overlays"),c._overlays.classList.add("buttons-hidden"),c._buttonsActivateArea=document.createElement("div"),c._buttonsActivateArea.classList.add("romper-buttons-activate-area"),c._buttonsActivateArea.classList.add("hide"),c._buttons=document.createElement("div"),c._buttons.classList.add("romper-buttons"),c._buttons.onmousemove=c._activateRomperButtons.bind(g(c)),c._narrativeElementTransport=document.createElement("div"),c._narrativeElementTransport.classList.add("romper-narrative-element-transport"),c._backButton=document.createElement("button"),c._backButton.setAttribute("type","button"),c._backButton.classList.add("romper-button"),c._backButton.classList.add("romper-back-button"),c._backButton.setAttribute("title","Back Button"),c._backButton.setAttribute("aria-label","Back Button"),c._backButton.setAttribute("data-required-controls","false");var m=document.createElement("div");m.classList.add("romper-button-icon-div"),m.classList.add("romper-back-button-icon-div"),c._backButton.appendChild(m),c._narrativeElementTransport.appendChild(c._backButton),c._seekBackButton=document.createElement("button"),c._seekBackButton.setAttribute("type","button"),c._seekBackButton.classList.add("romper-button"),c._seekBackButton.classList.add("romper-seek-back-button"),c._seekBackButton.setAttribute("title","Seek Back Button"),c._seekBackButton.setAttribute("aria-label","Seek Back Button"),c._seekBackButton.setAttribute("data-required-controls","false");var y=document.createElement("div");y.classList.add("romper-button-icon-div"),c._seekBackButton.appendChild(y),c._narrativeElementTransport.appendChild(c._seekBackButton),c._playPauseButton=document.createElement("button"),c._playPauseButton.setAttribute("type","button"),c._playPauseButton.classList.add("romper-button"),c._playPauseButton.classList.add("romper-play-button"),c._playPauseButton.setAttribute("title","Play Pause Button"),c._playPauseButton.setAttribute("aria-label","Play Pause Button"),c._playPauseButton.setAttribute("data-required-controls","true");var _=document.createElement("div");_.classList.add("romper-button-icon-div"),c._playPauseButton.appendChild(_),c._narrativeElementTransport.appendChild(c._playPauseButton),c._seekForwardButton=document.createElement("button"),c._seekForwardButton.setAttribute("type","button"),c._seekForwardButton.classList.add("romper-button"),c._seekForwardButton.classList.add("romper-seek-fwd-button"),c._seekForwardButton.setAttribute("title","Seek Forward Button"),c._seekForwardButton.setAttribute("aria-label","Seek Forward Button"),c._seekForwardButton.setAttribute("data-required-controls","false");var b=document.createElement("div");b.classList.add("romper-button-icon-div"),c._seekForwardButton.appendChild(b),c._narrativeElementTransport.appendChild(c._seekForwardButton),c._nextButton=document.createElement("button"),c._nextButton.setAttribute("type","button"),c._nextButton.classList.add("romper-button"),c._nextButton.classList.add("romper-next-button"),c._nextButton.setAttribute("title","Next Button"),c._nextButton.setAttribute("aria-label","Next Button"),c._nextButton.setAttribute("data-required-controls","false"),c._narrativeElementTransport.appendChild(c._nextButton);var w=document.createElement("div");w.classList.add("romper-button-icon-div"),c._nextButton.appendChild(w),c._guiLayer.appendChild(c._overlays),c._guiLayer.appendChild(c._buttons),c._guiLayer.appendChild(c._buttonsActivateArea),c._scrubBar=document.createElement("input"),c._scrubBar.setAttribute("title","Seek bar"),c._scrubBar.setAttribute("aria-label","Seek bar"),c._scrubBar.setAttribute("data-required-controls","false"),c._scrubBar.type="range",c._scrubBar.id="scrub-bar",c._scrubBar.value="0",c._scrubBar.className="romper-scrub-bar",c._scrubBar.classList.add(d.SLIDER_CLASS),c._buttons.appendChild(c._scrubBar),c._mediaTransport=document.createElement("div"),c._mediaTransport.classList.add("romper-media-transport");var T=document.createElement("div");T.classList.add("left");var S=document.createElement("div");S.classList.add("center"),S.appendChild(c._narrativeElementTransport);var x=document.createElement("div");x.classList.add("right"),c._mediaTransport.appendChild(T),c._mediaTransport.appendChild(S),c._mediaTransport.appendChild(x),c._overlayToggleButtons=document.createElement("div"),c._overlayToggleButtons.classList.add("romper-overlay-controls"),c._overlayToggleButtons.classList.add("romper-inactive"),x.appendChild(c._overlayToggleButtons),c._volume=E("volume",c._logUserInteraction),T.appendChild(c._volume.overlay),T.appendChild(c._volume.button),c._representation=E("representation",c._logUserInteraction),x.appendChild(c._representation.overlay),c._overlayToggleButtons.appendChild(c._representation.button),c._icon=E("icon",c._logUserInteraction),x.appendChild(c._icon.overlay),c._overlayToggleButtons.appendChild(c._icon.button),c._countdownContainer=document.createElement("div"),c._countdownContainer.classList.add("romper-ux-divider"),c._countdowner=document.createElement("div"),c._countdowner.classList.add("romper-ux-countdown"),c._countdownContainer.appendChild(c._countdowner),c._subtitlesButton=document.createElement("button"),c._subtitlesButton.setAttribute("type","button"),c._subtitlesButton.classList.add("romper-button"),c._subtitlesButton.setAttribute("title","Subtitles Button"),c._subtitlesButton.setAttribute("aria-label","Subtitles Button"),c._subtitlesButton.classList.add("romper-subtitles-button"),c.disableSubtitlesControl();var A=document.createElement("div");A.classList.add("romper-button-icon-div"),A.classList.add("romper-subtitles-button-icon-div"),c._subtitlesButton.appendChild(A),x.appendChild(c._subtitlesButton),c._fullscreenButton=document.createElement("button"),c._fullscreenButton.setAttribute("type","button"),c._fullscreenButton.classList.add("romper-button"),c._fullscreenButton.classList.add("romper-fullscreen-button"),c._fullscreenButton.setAttribute("title","Fullscreen Button"),c._fullscreenButton.setAttribute("aria-label","Fullscreen Button");var M=document.createElement("div");M.classList.add("romper-button-icon-div"),M.classList.add("romper-fullscreen-button-icon-div"),c._fullscreenButton.appendChild(M),x.appendChild(c._fullscreenButton),c._buttons.appendChild(c._mediaTransport);var j=l.BrowserUserAgent.facebookWebview()&&l.BrowserUserAgent.iOS(),R=(0,d.checkOverrideFacebookBlock)();if(j&&!R){var L=document.createElement("div");L.className="webview-error",L.innerHTML="<div class=\"webview-error-div\"><h1>Facebook Browser is not supported</h1><p>Please click on the three dots in top right corner and click 'Open in Safari'</p></div>",e.appendChild(L)}else e.appendChild(c._player);c._overlays.classList.add("romper-inactive"),c._buttons.classList.add("romper-inactive"),c._buttonsActivateArea.classList.add("romper-inactive"),c.guiTarget=c._guiLayer,c.mediaTarget=c._mediaLayer,c.backgroundTarget=c._backgroundLayer,c._controller.handleKeys&&document.addEventListener("keydown",c._keyPressHandler.bind(g(c))),c._overlays.onclick=c._handleOverlayClick.bind(g(c)),c._overlays.addEventListener("touchend",(0,d.handleButtonTouchEvent)(c._handleOverlayClick.bind(g(c)))),c._backButton.onclick=c._backButtonClicked.bind(g(c)),c._backButton.addEventListener("touchend",(0,d.handleButtonTouchEvent)(c._backButtonClicked.bind(g(c)))),c._nextButton.onclick=c._nextButtonClicked.bind(g(c)),c._nextButton.addEventListener("touchend",(0,d.handleButtonTouchEvent)(c._nextButtonClicked.bind(g(c)))),c._playPauseButton.onclick=c._playPauseButtonClicked.bind(g(c)),c._playPauseButton.addEventListener("touchend",(0,d.handleButtonTouchEvent)(c._playPauseButtonClicked.bind(g(c)))),c._seekBackButton.onclick=c._seekBackwardButtonClicked.bind(g(c)),c._seekBackButton.addEventListener("touchend",(0,d.handleButtonTouchEvent)(c._seekBackwardButtonClicked.bind(g(c)))),c._seekForwardButton.onclick=c._seekForwardButtonClicked.bind(g(c)),c._seekForwardButton.addEventListener("touchend",(0,d.handleButtonTouchEvent)(c._seekForwardButtonClicked.bind(g(c)))),c._subtitlesButton.onclick=c._subtitlesButtonClicked.bind(g(c)),c._subtitlesButton.addEventListener("touchend",(0,d.handleButtonTouchEvent)(c._subtitlesButtonClicked.bind(g(c)))),c._fullscreenButton.onclick=c._toggleFullScreen.bind(g(c)),c._fullscreenButton.addEventListener("touchend",(0,d.handleButtonTouchEvent)(c._toggleFullScreen.bind(g(c)))),c._handleFullScreenChange=c._handleFullScreenChange.bind(g(c)),c._inFullScreen=!1,c._player.addEventListener("touchend",c._handleTouchEndEvent.bind(g(c))),c._buttonsActivateArea.onmouseenter=c._activateRomperButtons.bind(g(c)),c._buttonsActivateArea.onmousemove=c._activateRomperButtons.bind(g(c)),c._buttonsActivateArea.addEventListener("touchend",(0,d.handleButtonTouchEvent)(c._activateRomperButtons.bind(g(c)))),c._buttonsActivateArea.onclick=c._activateRomperButtons.bind(g(c)),c._buttons.onmouseleave=c._hideRomperButtons.bind(g(c)),c._removeExperienceOverlays=c._removeExperienceOverlays.bind(g(c));var C=l.MediaFormats.getPlayoutEngine(),k=(0,d.checkDebugPlayout)();switch(k&&u.default.info("Playout debugging: ON"),u.default.info("Using playout engine: ",C),C){case l.PLAYOUT_ENGINES.SRC_SWITCH_PLAYOUT:c.playoutEngine=new a.default(g(c),k);break;case l.PLAYOUT_ENGINES.DOM_SWITCH_PLAYOUT:c.playoutEngine=new o.default(g(c),k);break;case l.PLAYOUT_ENGINES.IOS_PLAYOUT:c.playoutEngine=new s.default(g(c),k);break;default:throw u.default.fatal("Invalid Playout Engine"),new Error("Invalid Playout Engine")}return c._showErrorLayer=c._showErrorLayer.bind(g(c)),c._removeErrorLayer=c._removeErrorLayer.bind(g(c)),c._showBufferingLayer=c._showBufferingLayer.bind(g(c)),c._removeBufferingLayer=c._removeBufferingLayer.bind(g(c)),c._addContinueModal=c._addContinueModal.bind(g(c)),c._startButtonHandler=c._startButtonHandler.bind(g(c)),c.createBehaviourOverlay=c.createBehaviourOverlay.bind(g(c)),c._addCountdownToElement=c._addCountdownToElement.bind(g(c)),c}var n,r,f;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(t,e),n=t,f=[{key:"_formatTime",value:function(e){var t=parseInt(e,10);if(Number.isNaN(t))return"0:00";var n=Math.floor(t/60);return t=(t%=60)<10?"0".concat(t):t,"".concat(n,":").concat(t)}},{key:"_isFullScreen",value:function(){var e=!1;return document.fullscreenElement&&(e=null!=document.fullscreenElement),document.webkitFullscreenElement&&(e=e||null!=document.webkitFullscreenElement),document.mozFullScreenElement&&(e=e||null!=document.mozFullScreenElement),document.msFullscreenElement&&(e=e||null!=document.msFullscreenElement),document.getElementsByClassName("romper-target-fullscreen").length>0&&(e=!0),e}}],(r=[{key:"_keyPressHandler",value:function(e){if("KeyF"===e.code&&(this._toggleFullScreen(),e.preventDefault()),this._userInteractionStarted){var t=parseInt(e.key,10);if(!isNaN(t)&&this._visibleChoices[t]){var n=document.createEvent("MouseEvents");n.initEvent("click",!0,!0),n.synthetic=!0,this._visibleChoices[t].dispatchEvent(n,!0)}}}},{key:"setCurrentRenderer",value:function(e){this._currentRenderer=e}},{key:"setAspectRatio",value:function(e){u.default.info("Setting aspect ratio to ".concat(e)),this._aspectRatio=e}},{key:"addDog",value:function(e,t){var n=this;void 0===this._dogImage&&(this._dogImage=document.createElement("div")),window.addEventListener("resize",(function(){n._setDogPosition(t)})),this._dogImage.className="romper-dog",this._dogImage.style.backgroundImage="url(".concat(e,")"),this._player.appendChild(this._dogImage),this._setDogPosition(t)}},{key:"_setDogPosition",value:function(e){var t=e.top,n=e.left,r=e.width,i=e.height;if(this._guiLayer.clientWidth/this._guiLayer.clientHeight>this._aspectRatio){var o=this._aspectRatio*this._guiLayer.clientHeight,a=(this._guiLayer.clientWidth-o)/2;this._dogImage.style.left="".concat(a+n/100*o,"px"),this._dogImage.style.top="".concat(t,"%"),this._dogImage.style.width="".concat(r/100*o,"px"),this._dogImage.style.height="".concat(i,"%")}else{var s=this._guiLayer.clientWidth/this._aspectRatio,u=(this._guiLayer.clientHeight-s)/2;this._dogImage.style.left="".concat(n,"%"),this._dogImage.style.top="".concat(u+t/100*s,"px"),this._dogImage.style.width="".concat(r,"%"),this._dogImage.style.height="".concat(i/100*s,"px")}}},{key:"addDetails",value:function(e,t,n,r){for(this._details||(this._details=document.createElement("div"));this._details.firstChild;)this._details.removeChild(this._details.firstChild);this._details.className="details-overlay";var i=(0,d.addDetail)("NE",e,t);this._details.appendChild(i);var o=(0,d.addDetail)("REP",n,r);this._details.appendChild(o),this._player.appendChild(this._details)}},{key:"addAssetCollectionDetails",value:function(e){if(e){this._details||(this._details=document.createElement("div"),this._player.appendChild(this._details)),this._details.className="details-overlay";var t=(0,d.addDetail)("Asset",e.name,e.id);this._details.appendChild(t)}}},{key:"_addContinueModal",value:function(e){var t=this;this._createResumeExperienceButton(e),this._resumeExperienceButton.setAttribute("title","Resume and accept terms"),this._resumeExperienceButton.setAttribute("aria-label","Resume Button");var n=document.createElement("button");n.setAttribute("type","button"),n.classList.add("romper-reset-button"),n.setAttribute("title","Restart and accept terms"),n.setAttribute("aria-label","Restart Button");var r=document.createElement("div");n.appendChild(r),r.classList.add("romper-reset-button-icon");var o=document.createElement("div");o.classList.add("romper-button-icon-div"),o.classList.add("romper-reset-button-icon-div"),r.appendChild(o);var a=function(){t._narrativeElementTransport.classList.remove("romper-inactive"),t._logUserInteraction(i.default.names.BEHAVIOUR_CANCEL_BUTTON_CLICKED),t._controller.setSessionState(c.SESSION_STATE.RESTART),t._controller.deleteExistingSession(),t._controller.resetStory(t._controller._storyId),t._hideModalLayer(),t._startButtonHandler()};n.onclick=a,n.addEventListener("touchend",(0,d.handleButtonTouchEvent)(a));var s=function(){t.emit(h.REASONER_EVENTS.ROMPER_STORY_STARTED),t._logUserInteraction(i.default.names.BEHAVIOUR_CONTINUE_BUTTON_CLICKED),t._narrativeElementTransport.classList.remove("romper-inactive"),t._controller.setSessionState(c.SESSION_STATE.RESUME),t._controller.restart(t._controller._storyId),t._hideModalLayer(),t._enableUserInteraction()};this._resumeExperienceButton.onclick=s,this._resumeExperienceButton.addEventListener("touchend",(0,d.handleButtonTouchEvent)(s));var u=document.createElement("div");u.className="continue-experience",u.textContent="Restart or Resume?",u.classList.add("modal-inner-content"),this._continueModalContent.appendChild(u),this._continueModalContent.appendChild(n),this._continueModalContent.appendChild(this._resumeExperienceButton),this._continueModalLayer&&(this._continueModalLayer.classList.add("show"),this._continueModalContent.classList.add("show"))}},{key:"_handleTouchEndEvent",value:function(e){var t=this,n=document.elementFromPoint(e.changedTouches[0].pageX,e.changedTouches[0].pageY);if(this._RomperButtonsShowing){var r=[this._overlays,this._narrativeElementTransport],i=[this._buttons];r.some((function(e){return e===n}))?(this._hideRomperButtons(),this._hideAllOverlays(),e.preventDefault()):i.some((function(e){return e===n}))&&e.preventDefault()}else[this._overlays,this._narrativeElementTransport,this._buttonsActivateArea].some((function(e){return e===n}))&&(this._showRomperButtons(),this._hideAllOverlays(),this._showRomperButtonsTimeout=setTimeout((function(){t._hideRomperButtons()}),5e3),e.preventDefault())}},{key:"_activateRomperButtons",value:function(e,t){var n=this;e&&(e.stopPropagation(),e.preventDefault()),!t&&this._controlsDisabled||(this._RomperButtonsShowing||this._showRomperButtons(),t||(this._showRomperButtonsTimeout&&clearTimeout(this._showRomperButtonsTimeout),this._showRomperButtonsTimeout=setTimeout((function(){n._hideRomperButtons()}),5e3)))}},{key:"_showRomperButtons",value:function(){this._logRendererAction(i.default.names.BUTTONS_ACTIVATED),this._RomperButtonsShowing=!0,this._buttons.classList.add("show"),this._narrativeElementTransport.classList.add("show"),this._buttonsActivateArea.classList.add("hide"),this._overlays.classList.remove("buttons-hidden"),this._overlays.classList.add("buttons-showing")}},{key:"_hideRomperButtons",value:function(){this._showRomperButtonsTimeout&&clearTimeout(this._showRomperButtonsTimeout),this._logRendererAction(i.default.names.BUTTONS_DEACTIVATED),this._RomperButtonsShowing=!1,this._buttons.classList.remove("show"),this._narrativeElementTransport.classList.remove("show"),this._buttonsActivateArea.classList.remove("hide"),this._overlays.classList.add("buttons-hidden"),this._overlays.classList.remove("buttons-showing")}},{key:"_hideModalLayer",value:function(){this._continueModalLayer&&(this._guiLayer.removeChild(this._continueModalLayer),this._continueModalLayer=null)}},{key:"_showErrorLayer",value:function(){this._errorLayer.classList.add("show"),this._errorLayer.classList.remove("hide"),this._RomperButtonsShowing||this._showRomperButtons()}},{key:"_showBufferingLayer",value:function(){this._loadingLayer.classList.add("show")}},{key:"_removeBufferingLayer",value:function(){this._loadingLayer.classList.remove("show")}},{key:"_removeErrorLayer",value:function(){this._errorLayer.classList.remove("show"),this._errorLayer.classList.add("hide"),this._RomperButtonsShowing&&this._hideRomperButtons()}},{key:"_createStartExperienceButton",value:function(e){this._startExperienceButton=document.createElement("button"),this._startExperienceButton.setAttribute("type","button"),this._startExperienceButton.classList.add(e.button_class),this._startExperienceButton.setAttribute("title","Play and accept terms"),this._startExperienceButton.setAttribute("aria-label","Start Button");var t=document.createElement("div");this._startExperienceButton.appendChild(t),t.classList.add("romper-start-button-icon");var n=document.createElement("div");n.classList.add("romper-button-icon-div"),n.classList.add("".concat(e.button_class,"-icon-div")),t.appendChild(n)}},{key:"_createStartImage",value:function(e){this._startExperienceImage||(this._startExperienceImage=document.createElement("img"),this._startExperienceImage.className="romper-start-image",this._startExperienceImage.src=e.background_art,this._mediaLayer.appendChild(this._startExperienceImage))}},{key:"_createResumeExperienceButton",value:function(e){this._resumeExperienceButton=document.createElement("button"),this._resumeExperienceButton.setAttribute("type","button"),this._resumeExperienceButton.classList.add(e.button_class),this._resumeExperienceButton.setAttribute("title","Play and accept terms"),this._resumeExperienceButton.setAttribute("aria-label","Start Button");var t=document.createElement("div");this._resumeExperienceButton.appendChild(t),t.classList.add("romper-start-button-icon");var n=document.createElement("div");n.classList.add("romper-button-icon-div"),n.classList.add("".concat(e.button_class,"-icon-div")),t.appendChild(n)}},{key:"setupExperienceOverlays",value:function(e){switch(this._controller.getSessionState()){case c.SESSION_STATE.RESUME:this._narrativeElementTransport.classList.remove("romper-inactive");break;case c.SESSION_STATE.EXISTING:this._createResumeOverlays(e),e.hide_narrative_buttons&&this._narrativeElementTransport.classList.add("romper-inactive");break;case c.SESSION_STATE.RESTART:this._narrativeElementTransport.classList.remove("romper-inactive");break;case c.SESSION_STATE.NEW:this._createStartOverlays(e);break;default:e.hide_narrative_buttons&&this._narrativeElementTransport.classList.add("romper-inactive"),this._createStartOverlays(e)}}},{key:"_createPrivacyNotice",value:function(e){if(null!==e.privacy_notice){var t=document.createElement("p");t.innerHTML=e.privacy_notice.replace("\n","<br/>"),this._privacyDiv=document.createElement("div"),this._privacyDiv.className="romper-privacy-notice",this._privacyDiv.appendChild(t),this._privacyDiv&&this._mediaLayer.appendChild(this._privacyDiv)}}},{key:"_createSharedOverlays",value:function(e){this._createPrivacyNotice(e),this._createStartImage(e),this._mediaLayer.classList.add("romper-prestart")}},{key:"_createResumeOverlays",value:function(e){this._createSharedOverlays(e),this._addContinueModal(e)}},{key:"_createStartOverlays",value:function(e){var t=this;this._createSharedOverlays(e),this._createStartExperienceButton(e),this._guiLayer.appendChild(this._startExperienceButton),this._startExperienceButton.onclick=this._startButtonHandler,this._startExperienceButton.addEventListener("touchend",(function(e){(0,d.handleButtonTouchEvent)(t._startButtonHandler,e)}),!1)}},{key:"_startButtonHandler",value:function(){this.emit(h.REASONER_EVENTS.ROMPER_STORY_STARTED),this._removeExperienceOverlays(),this._enableUserInteraction(),this._narrativeElementTransport.classList.remove("romper-inactive"),this._logUserInteraction(i.default.names.BEHAVIOUR_CONTINUE_BUTTON_CLICKED),this._controller.setExistingSession()}},{key:"_clearOverlays",value:function(){this._icon.clearAll(),this._representation.clearAll(),this._volume.clearAll()}},{key:"prepareForRestart",value:function(){(this._startExperienceButton||this._startExperienceImage)&&this._removeExperienceOverlays(),this.playoutEngine.pause(),this._clearOverlays(),this._disableUserInteraction(),u.default.info("disabling experience before restart")}},{key:"_removeExperienceOverlays",value:function(){try{this._startExperienceButton&&this._guiLayer.removeChild(this._startExperienceButton),this._privacyDiv&&this._mediaLayer.removeChild(this._privacyDiv),this._startExperienceImage&&this._mediaLayer.removeChild(this._startExperienceImage),this._mediaLayer.classList.remove("romper-prestart")}catch(e){u.default.warn(e),u.default.warn("could not remove _startExperienceImage")}}},{key:"_disableUserInteraction",value:function(){this._userInteractionStarted=!1,this._overlays.classList.add("romper-inactive"),this._buttons.classList.add("romper-inactive"),this._buttonsActivateArea.classList.add("romper-inactive"),this._overlayToggleButtons.classList.add("romper-inactive"),this.playoutEngine.setPermissionToPlay(!1)}},{key:"_enableUserInteraction",value:function(){this._userInteractionStarted||(this._userInteractionStarted=!0,this._overlays.classList.remove("romper-inactive"),this._buttons.classList.remove("romper-inactive"),this._buttonsActivateArea.classList.remove("romper-inactive"),this._buttonsActivateArea.classList.remove("hide"),this._overlayToggleButtons.classList.remove("romper-inactive"),this.playoutEngine.setPermissionToPlay(!0),this._logUserInteraction(i.default.names.START_BUTTON_CLICKED),this._playPauseButtonClicked())}},{key:"_playPauseButtonClicked",value:function(){this.emit(_.PLAY_PAUSE_BUTTON_CLICKED),this._logUserInteraction(i.default.names.PLAY_PAUSE_BUTTON_CLICKED)}},{key:"_seekForwardButtonClicked",value:function(){var e=this;this._backNextWaiting||(this.emit(_.SEEK_FORWARD_BUTTON_CLICKED),this._backNextWaiting=!0,setTimeout((function(){e._backNextWaiting=!1}),500))}},{key:"_seekBackwardButtonClicked",value:function(){var e=this;this._backNextWaiting||(this.emit(_.SEEK_BACKWARD_BUTTON_CLICKED),this._backNextWaiting=!0,setTimeout((function(){e._backNextWaiting=!1}),500))}},{key:"_backButtonClicked",value:function(){var e=this;if(this._hideAllOverlays(),!this._backNextWaiting){var t=0;this._currentRenderer&&(t=this._currentRenderer.getCurrentTime().currentTime),t<2?this.emit(_.BACK_BUTTON_CLICKED):this.emit(_.REPEAT_BUTTON_CLICKED),this._backNextWaiting=!0,setTimeout((function(){e._backNextWaiting=!1}),500)}this._logUserInteraction(i.default.names.BACK_BUTTON_CLICKED)}},{key:"_nextButtonClicked",value:function(){var e=this;this._userInteractionStarted||this._enableUserInteraction(),this._backNextWaiting||(this._hideAllOverlays(),this.emit(_.NEXT_BUTTON_CLICKED),this._backNextWaiting=!0,setTimeout((function(){e._backNextWaiting=!1}),500)),this._logUserInteraction(i.default.names.NEXT_BUTTON_CLICKED)}},{key:"_handleOverlayClick",value:function(e){this._RomperButtonsShowing?this._hideRomperButtons():this._activateRomperButtons(e),this._hideAllOverlays()}},{key:"_hideAllOverlays",value:function(){this._representation&&this._representation.deactivateOverlay(),this._volume&&this._volume.deactivateOverlay(),this._icon&&this._icon.deactivateOverlay()}},{key:"_subtitlesButtonClicked",value:function(){this.showingSubtitles=!this.showingSubtitles,this.showingSubtitles?this._subtitlesButton.classList.add("romper-button-selected"):this._subtitlesButton.classList.remove("romper-button-selected");var e=["hidden","showing"];this.emit(_.SUBTITLES_BUTTON_CLICKED),this._logUserInteraction(i.default.names.SUBTITLES_BUTTON_CLICKED,e[+!this.showingSubtitles],e[+this.showingSubtitles])}},{key:"enableSubtitlesControl",value:function(){this._subtitlesButton.classList.remove("romper-control-disabled"),this._subtitlesButton.removeAttribute("disabled")}},{key:"disableSubtitlesControl",value:function(){this._subtitlesButton.classList.add("romper-control-disabled"),this._subtitlesButton.setAttribute("disabled","true")}},{key:"_logUserInteraction",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"not_set",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"not_set",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o={type:i.default.types.USER_ACTION,name:i.default.names[e],from:null==t?"not_set":t,to:null==n?"not_set":n,data:r};this._analytics(o)}},{key:"_logRendererAction",value:function(e){var t={type:i.default.types.RENDERER_ACTION,name:i.default.names[e],from:"not_set",to:"not_set"};this._analytics(t)}},{key:"setVolumeControlLevel",value:function(e,t){var n=this._volume.getIdForLabel(e),r=this._volume.get(n);r&&(r.childNodes[1]&&r.childNodes[1].childNodes[2]&&(r.childNodes[1].childNodes[1].value=t,r.childNodes[1].childNodes[2].textContent="".concat(Math.floor(10*t))),this.emit(_.VOLUME_CHANGED,{id:n,value:t,label:e}))}},{key:"setMuted",value:function(e,t){var n=this._volume.getIdForLabel(e);if(this._volume.get(n)){var r=document.getElementById("mute-button-".concat(n));t&&r?(this._volume.get(n).classList.add("romper-muted"),r.setAttribute("data-muted","true"),r.classList.remove("romper-mute-button"),r.classList.add("romper-muted-button")):this._volume.get(n).classList.remove("romper-muted"),this.emit(_.VOLUME_MUTE_TOGGLE,{id:n,label:e,muted:t})}}},{key:"_setMuteCallBack",value:function(e,t,n){var r=this;return function(){r._volume.get(e).classList.toggle("romper-muted"),n.classList.toggle("romper-mute-button");var o=n.classList.toggle("romper-muted-button");n.setAttribute("data-muted",o),r.emit(_.VOLUME_MUTE_TOGGLE,{id:e,label:t,muted:o}),r._logUserInteraction(i.default.names.VOLUME_MUTE_TOGGLED,"".concat(t,": ").concat(!o),"".concat(t,": ").concat(o))}}},{key:"_setVolumeCallback",value:function(e,t,n,r){var o=this;return function(a){var s=parseFloat(a.target.value);n.textContent="".concat(Math.floor(10*s)),0===s?(r.classList.remove("romper-mute-button"),r.classList.add("romper-muted-button")):(r.classList.contains("romper-muted-button")&&(o.emit(_.VOLUME_MUTE_TOGGLE,{id:e,label:t,muted:!1}),o._volume.get(e).classList.remove("romper-muted")),r.classList.add("romper-mute-button"),r.classList.remove("romper-muted-button")),o.emit(_.VOLUME_CHANGED,{id:e,value:s,label:t}),o._volumeEventTimeouts[t]&&clearTimeout(o._volumeEventTimeouts[t]),o._volumeEventTimeouts[t]=setTimeout((function(){o._logUserInteraction(i.default.names.VOLUME_CHANGED,null,"".concat(t,": ").concat(a.target.value))}),1e3)}}},{key:"addVolumeControl",value:function(e,t){if(!l.BrowserUserAgent.iOS()){var n=document.createElement("div");n.classList.add("romper-volume-control"),n.classList.add("romper-volume-label-".concat(t.toLowerCase()));var r=document.createElement("div");r.classList.add("romper-volume-label"),r.textContent=t;var i=document.createElement("div");i.classList.add("romper-control-line"),i.id="volume-control-".concat(e);var o=document.createElement("div");o.id="mute-button-".concat(e),o.classList.add("romper-mute-button"),o.appendChild(document.createElement("div"));var a=document.createElement("span");a.classList.add("romper-volume-level"),a.textContent="10";var s=document.createElement("input");s.type="range",s.min="0",s.step="0.01",s.max="1",s.defaultValue="1",s.classList.add("romper-volume-range"),s.oninput=this._setVolumeCallback(e,t,a,o).bind(this),s.onchange=this._setVolumeCallback(e,t,a,o).bind(this),o.addEventListener("touchend",(0,d.handleButtonTouchEvent)(this._setMuteCallBack(e,t,o).bind(this))),o.onclick=this._setMuteCallBack(e,t,o).bind(this),i.appendChild(o),i.appendChild(s),i.appendChild(a),n.appendChild(r),n.appendChild(i),this._volume.add(e,n,t)}}},{key:"removeVolumeControl",value:function(e){this._volume.remove(e)}},{key:"clearAllRepresentationControls",value:function(){this._representation.clearAll()}},{key:"addRepresentationControl",value:function(e,t,n){var r=this,o=document.createElement("div");o.classList.add("romper-representation-control"),o.classList.add("romper-representation-choice-".concat(e)),o.setAttribute("title",n),o.setAttribute("aria-label",n);var a=document.createElement("div");a.classList.add("romper-representation-icon-container");var s=document.createElement("img");s.src=""!==t?t:this._assetUrls.noAssetIconUrl,s.classList.add("romper-representation-icon"),s.setAttribute("draggable","false");var u=function(){r.emit(_.REPRESENTATION_CLICKED,{id:e}),r._representation.deactivateOverlay(),r._representation.setActive(e),r._representation.setButtonClass("".concat(e)),r._logUserInteraction(i.default.names.SWITCH_VIEW_BUTTON_CLICKED,null,e)};s.onclick=u,s.addEventListener("touchend",(0,d.handleButtonTouchEvent)(u)),a.appendChild(s),o.appendChild(a),this._representation.add(e,o)}},{key:"createBehaviourOverlay",value:function(e){var t=E("link-choice",this._logUserInteraction),n=t.overlay;return n.id=e.id,this._addCountdownToElement(n),this._overlays.appendChild(n),t}},{key:"_addCountdownToElement",value:function(e){e.appendChild(this._countdownContainer)}},{key:"addTextLinkIconChoice",value:function(e,t,n,r,i){return this._addLinkChoiceContainer(e,t,i,n,r)}},{key:"addLinkChoiceControl",value:function(e,t,n,r){return this._addLinkChoiceContainer(e,t,r,null,n)}},{key:"addTextLinkChoice",value:function(e,t,n,r){return this._addLinkChoiceContainer(e,t,r,n,null)}},{key:"_addLinkChoiceContainer",value:function(e,t,n,r,o){var a=this;this._numChoices+=1,this._numChoices>8?(e.classList.remove("tworow"),e.classList.add("threerow")):this._numChoices>=4?(e.classList.remove("threerow"),e.classList.add("tworow")):(e.classList.remove("tworow"),e.classList.remove("threerow"));var s=document.createElement("div"),u=new Promise((function(u){s.classList.add("romper-link-control"),s.classList.add("noselect"),s.classList.add("romper-link-choice-".concat(t)),s.setAttribute("aria-label",n),s.setAttribute("data-link-choice","inactive");var l=document.createElement("div"),c=function(){a.emit(_.LINK_CHOSEN,{id:t,behaviourId:e.id}),a._logUserInteraction(i.default.names.LINK_CHOICE_CLICKED,null,t,{label:n,text:r})};if(l.onclick=c,l.addEventListener("touchend",c),s.appendChild(l),r&&o){var d=""!==o?o:a._assetUrls.noAssetIconUrl;s.classList.add("icon"),s.classList.add("text");var h=document.createElement("div"),f=document.createElement("img");f.src=d,h.appendChild(f),h.className="romper-link-icon-container";var p=document.createElement("p");p.textContent=r,p.className="romper-link-text-icon",l.appendChild(h),l.appendChild(p)}else if(r){l.className="romper-text-link-container",s.classList.add("text");var m=document.createElement("p");m.textContent=r,m.className="romper-link-text-icon",l.appendChild(m)}else{l.className="romper-link-icon-container",s.classList.add("icon");var v=""!==o?o:a._assetUrls.noAssetIconUrl,g=document.createElement("img");g.src=v,l.appendChild(g)}u({icon:s,uuid:t,container:l})}));return this._choiceIconSet[t]=u,s}},{key:"hideChoiceIcons",value:function(){this._buttons.classList.add("icons-showing"),this._overlays.classList.add("romper-inactive")}},{key:"showChoiceIcons",value:function(e,t,n,r){var i=this;this._hideRomperButtons();var o=n.overlay;this._buttons.classList.add("icons-showing"),o.classList.remove("romper-inactive"),o.classList.add("choices-".concat(r)),o.classList.add("count-".concat(r));var a=[];return Object.keys(this._choiceIconSet).forEach((function(e){a.push(i._choiceIconSet[e])})),t&&!(t in o.classList)&&o.classList.add(t),Promise.all(a).then((function(t){t.forEach((function(t,r){var a=t.icon,s=t.uuid,u=t.container;e&&s===e&&a.classList.add("default");var l=function(){n.setActive("".concat(r))};a.onclick=l,a.addEventListener("touchend",(0,d.handleButtonTouchEvent)(l)),n.add(r,a),o&&o.appendChild(a),i._visibleChoices[r+1]=u}))}))}},{key:"getActiveChoiceIcon",value:function(){return document.querySelectorAll('[data-link-choice="active"]')[0]}},{key:"startChoiceCountdown",value:function(e){var t=this;if(this._choiceCountdownTimeout&&clearTimeout(this._choiceCountdownTimeout),0===this._countdownTotal){var n=e.getCurrentTime().remainingTime;n||(n=3),this._countdownTotal=n}this._choiceCountdownTimeout=setTimeout((function(){t.reflectTimeout(e)}),10),this._countdownContainer.classList.add("show")}},{key:"reflectTimeout",value:function(e){var t=this,n=e.getCurrentTime().remainingTime,r=this._countdowner.style,i=n/this._countdownTotal*100;i>0?(r.width="".concat(i,"%"),r.marginLeft="".concat((100-i)/2,"%"),this._choiceCountdownTimeout=setTimeout((function(){t.reflectTimeout(e)}),10)):(clearTimeout(this._choiceCountdownTimeout),this._choiceCountdownTimeout=null,this._countdownTotal=0,r.width="0",r.marginLeft="49%")}},{key:"activateRepresentationControl",value:function(e){this._representation.removeClass(e,"romper-control-disabled")}},{key:"deactivateRepresentationControl",value:function(e){this._representation.addClass(e,"romper-control-disabled")}},{key:"removeRepresentationControl",value:function(e){this._representation.remove(e)}},{key:"addIconControl",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,s=document.createElement("div");s.classList.add("romper-icon-control");var u=document.createElement("img");u.src=""!==t?t:this._assetUrls.noAssetIconUrl,u.classList.add("romper-icon"),a&&u.classList.add("romper-icon-choice-".concat(a)),u.setAttribute("title",o),u.setAttribute("aria-label",o),u.setAttribute("draggable","false"),r&&u.classList.add("romper-selected");var l=function(){n.emit(_.ICON_CLICKED,{id:e}),n._icon.deactivateOverlay(),n._icon.setButtonClass(e),n._logUserInteraction(i.default.names.CHANGE_CHAPTER_BUTTON_CLICKED,null,e)};if(u.onclick=l,u.addEventListener("touchend",(0,d.handleButtonTouchEvent)(l)),s.appendChild(u),a){var c=document.createElement("span");c.classList.add("romper-icon-label"),c.classList.add("romper-icon-label-".concat(a)),c.textContent=a,s.appendChild(c)}this._icon.add(e,s)}},{key:"setIconControl",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this._icon.get(e);if(r){n?(r.classList.remove("romper-control-unselected"),r.classList.add("romper-control-selected")):(r.classList.add("romper-control-unselected"),r.classList.remove("romper-control-selected"));var i=r.children[0];i.src=""!==t?t:this._assetUrls.noAssetIconUrl}}},{key:"setActiveRepresentationControl",value:function(e){this._representation.setActive(e)}},{key:"enterCompleteBehavourPhase",value:function(){this._logRendererAction(i.default.names.COMPLETE_BEHAVIOUR_PHASE_STARTED),this.disableScrubBar(),this.disablePlayButton(),this.disableRepresentationControl()}},{key:"enterStartBehaviourPhase",value:function(e){this.setCurrentRenderer(e),this._logRendererAction(i.default.names.START_BEHAVIOUR_PHASE_STARTED)}},{key:"exitStartBehaviourPhase",value:function(){this._logRendererAction(i.default.names.START_BEHAVIOUR_PHASE_ENDED),this.enableControls(),this.showSeekButtons(),this.enablePlayButton(),this.enableScrubBar(),this.enableRepresentationControl()}},{key:"enableLinkChoiceControl",value:function(){this.getLinkChoiceElement()[0].classList.remove("romper-inactive")}},{key:"disableLinkChoiceControl",value:function(){this.getLinkChoiceElement()[0].classList.add("romper-inactive")}},{key:"hideScrubBar",value:function(){this._scrubBar.style.display="none"}},{key:"showScrubBar",value:function(){this._scrubBar.style.display="block"}},{key:"resetControls",value:function(){this.enableControls(),this._hideAllOverlays()}},{key:"clearLinkChoices",value:function(){this._numChoices=0,this._choiceIconSet={},this._visibleChoices={},this._choiceCountdownTimeout&&(clearTimeout(this._choiceCountdownTimeout),this._choiceCountdownTimeout=null,this._countdownTotal=0,this._countdownContainer.classList.remove("show")),this._buttons.classList.remove("icons-showing"),this.getLinkChoiceElement(!0).forEach((function(e){e.style.setProperty("animation","none"),e.className="romper-overlay romper-link-choice-overlay romper-inactive"}))}},{key:"getLinkChoiceElement",value:function(e){var t=document.querySelectorAll('[data-behaviour="link-choice"]');return e?t:[t[0]]}},{key:"enableRepresentationControl",value:function(){this._representation.button.removeAttribute("disabled"),this._representation.button.classList.remove("romper-control-disabled")}},{key:"disableRepresentationControl",value:function(){this._representation.button.setAttribute("disabled","true"),this._representation.button.classList.add("romper-control-disabled")}},{key:"disableControls",value:function(){this._controlsDisabled=!0}},{key:"enableControls",value:function(){this._controlsDisabled=!1}},{key:"showSeekButtons",value:function(){document.querySelectorAll('[data-required-controls="false"]').forEach((function(e){e.style.display="block"}))}},{key:"enableScrubBar",value:function(){this._scrubBar.removeAttribute("disabled"),this._scrubBar.classList.remove("romper-control-disabled")}},{key:"disableScrubBar",value:function(){this._scrubBar.setAttribute("disabled","true"),this._scrubBar.classList.add("romper-control-disabled")}},{key:"disconnectScrubBar",value:function(e){if(e===this._currentRenderer){if(this._scrubBar){var t=this._scrubBar,n=t.cloneNode(!0);this._buttons.replaceChild(n,t),this._scrubBar=n}this._scrubTimePoller&&(clearInterval(this._scrubTimePoller),this._scrubTimePoller=null)}}},{key:"connectScrubBar",value:function(e){var t=this,n=this._scrubBar,r=!1,o=function(){var o=e.getCurrentTime().duration*(parseInt(n.value,10)/100);r=!0,e.setCurrentTime(o),t._scrubbedEventTimeout&&clearTimeout(t._scrubbedEventTimeout),t._scrubbedEventTimeout=setTimeout((function(){t._logUserInteraction(i.default.names.VIDEO_SCRUBBED,null,o.toString())}),1e3)};n.oninput=o,n.onchange=o,n.addEventListener("click",(function(t){r=!0;var i=t.offsetX/n.offsetWidth*e.getCurrentTime().duration;e.setCurrentTime(i)}));var a=!1;n.addEventListener("mousedown",(function(){a=!0})),n.addEventListener("mouseup",(function(){a=!1})),this._scrubTimePoller&&clearInterval(this._scrubTimePoller),this._scrubTimePoller=setInterval((function(){var t=e.getCurrentTime(),i=t.currentTime,o=t.duration,s=t.timersSyncing,u=100/o*i;a||r||(n.value=u.toString()),r&&!s&&(r=!1)}),200)}},{key:"disablePlayButton",value:function(){this._playPauseButton.classList.add("romper-control-disabled"),this._playPauseButton.setAttribute("disabled","true")}},{key:"enablePlayButton",value:function(){this._playPauseButton.classList.remove("romper-control-disabled"),this._playPauseButton.removeAttribute("disabled")}},{key:"removeIconControl",value:function(e){this._icon.remove(e)}},{key:"setPlaying",value:function(e){e?(this._playPauseButton.classList.add("romper-pause-button"),this._playPauseButton.classList.remove("romper-play-button")):(this._playPauseButton.classList.add("romper-play-button"),this._playPauseButton.classList.remove("romper-pause-button"))}},{key:"setNextAvailable",value:function(e){e?this._nextButton.classList.remove("romper-unavailable"):this._nextButton.classList.add("romper-unavailable")}},{key:"setBackAvailable",value:function(e){e?this._backButton.classList.remove("romper-unavailable"):this._backButton.classList.add("romper-unavailable")}},{key:"_applyExitFullscreenBehaviour",value:function(e,n){t._isFullScreen()&&this._exitFullScreen(),(0,d.scrollToTop)(),n()}},{key:"_toggleFullScreen",value:function(){t._isFullScreen()?(this._logUserInteraction(i.default.names.FULLSCREEN_BUTTON_CLICKED,"fullscreen","not-fullscreen"),this._exitFullScreen()):(this._logUserInteraction(i.default.names.FULLSCREEN_BUTTON_CLICKED,"not-fullscreen","fullscreen"),this._enterFullScreen())}},{key:"_enterFullScreen",value:function(){this._buttons.classList.add("romper-buttons-fullscreen"),this._player.classList.add("romper-player-fullscreen"),this._playerParent.requestFullscreen?this._playerParent.requestFullscreen():this._playerParent.mozRequestFullScreen?this._playerParent.mozRequestFullScreen():this._playerParent.webkitRequestFullscreen?this._playerParent.webkitRequestFullscreen():(window.scrollTo(0,1),this._playerParent.classList.add("romper-target-fullscreen"));var e=window.innerWidth/window.innerHeight,t=l.BrowserUserAgent.iOS()?.8:1;if(e>this._aspectRatio){var n=100*this._aspectRatio*t;this._player.style.height="".concat(100*t,"vh"),this._player.style.width="".concat(n,"vh"),this._player.style.marginLeft="calc((100vw - ".concat(n,"vh) / 2)")}else{var r=100*t/this._aspectRatio;this._player.style.height="".concat(r,"vw"),this._player.style.width="".concat(100*t,"vw"),this._player.style.marginLeft="".concat((100-100*t)/2,"vw")}this._inFullScreen=!1,l.BrowserUserAgent.iOS()&&(this._playerParent.addEventListener("touchmove",d.preventEventDefault),this._player.classList.add("ios-fullscreen")),document.addEventListener("webkitfullscreenchange",this._handleFullScreenChange),document.addEventListener("mozfullscreenchange",this._handleFullScreenChange),document.addEventListener("fullscreenchange",this._handleFullScreenChange),document.addEventListener("MSFullscreenChange",this._handleFullScreenChange)}},{key:"_handleFullScreenChange",value:function(){t._isFullScreen()||(this._buttons.classList.remove("romper-buttons-fullscreen"),this._player.classList.remove("romper-player-fullscreen"),document.removeEventListener("webkitfullscreenchange",this._handleFullScreenChange),document.removeEventListener("mozfullscreenchange",this._handleFullScreenChange),document.removeEventListener("fullscreenchange",this._handleFullScreenChange),document.removeEventListener("MSFullscreenChange",this._handleFullScreenChange))}},{key:"_exitFullScreen",value:function(){this._buttons.classList.remove("romper-buttons-fullscreen"),this._player.classList.remove("romper-player-fullscreen"),document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen?document.msExitFullscreen():this._playerParent.classList.remove("romper-target-fullscreen"),(0,d.scrollToTop)(),this._player.removeAttribute("style"),l.BrowserUserAgent.iOS()&&(this._playerParent.removeEventListener("touchmove",d.preventEventDefault),this._player.classList.remove("ios-fullscreen")),document.removeEventListener("webkitfullscreenchange",this._handleFullScreenChange),document.removeEventListener("mozfullscreenchange",this._handleFullScreenChange),document.removeEventListener("fullscreenchange",this._handleFullScreenChange),document.removeEventListener("MSFullscreenChange",this._handleFullScreenChange)}}])&&m(n.prototype,r),f&&m(n,f),t}(r.default);t.default=w},"./src/RenderManager.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.symbol.js"),n("./node_modules/core-js/modules/es.symbol.description.js"),n("./node_modules/core-js/modules/es.symbol.iterator.js"),n("./node_modules/core-js/modules/es.array.concat.js"),n("./node_modules/core-js/modules/es.array.filter.js"),n("./node_modules/core-js/modules/es.array.for-each.js"),n("./node_modules/core-js/modules/es.array.includes.js"),n("./node_modules/core-js/modules/es.array.index-of.js"),n("./node_modules/core-js/modules/es.array.iterator.js"),n("./node_modules/core-js/modules/es.array.map.js"),n("./node_modules/core-js/modules/es.array.some.js"),n("./node_modules/core-js/modules/es.date.to-string.js"),n("./node_modules/core-js/modules/es.function.name.js"),n("./node_modules/core-js/modules/es.object.assign.js"),n("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),n("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),n("./node_modules/core-js/modules/es.object.get-prototype-of.js"),n("./node_modules/core-js/modules/es.object.keys.js"),n("./node_modules/core-js/modules/es.object.set-prototype-of.js"),n("./node_modules/core-js/modules/es.object.to-string.js"),n("./node_modules/core-js/modules/es.object.values.js"),n("./node_modules/core-js/modules/es.promise.js"),n("./node_modules/core-js/modules/es.regexp.to-string.js"),n("./node_modules/core-js/modules/es.string.includes.js"),n("./node_modules/core-js/modules/es.string.iterator.js"),n("./node_modules/core-js/modules/web.dom-collections.for-each.js"),n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=y(n("./node_modules/events/events.js")),i=g(n("./src/renderers/BaseRenderer.js")),o=y(n("./src/renderers/RendererFactory.js")),a=y(n("./src/renderers/StoryIconRenderer.js")),s=y(n("./src/renderers/SwitchableRenderer.js")),u=y(n("./src/renderers/BackgroundRendererFactory.js")),l=(y(n("./src/renderers/BackgroundRenderer.js")),g(n("./src/Controller.js"))),c=y(n("./src/renderers/RendererEvents.js")),d=y(n("./src/logger.js")),h=y(n("./src/AnalyticEvents.js")),f=g(n("./src/Player.js")),p=n("./src/Events.js"),m=n("./src/utils.js");function v(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return v=function(){return e},e}function g(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_(e)&&"function"!=typeof e)return{default:e};var t=v();if(t&&t.has(e))return t.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=r?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(n,i,o):n[i]=e[i]}return n.default=e,t&&t.set(e,n),n}function y(e){return e&&e.__esModule?e:{default:e}}function _(e){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e))&&"[object Arguments]"!==Object.prototype.toString.call(e))return;var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach((function(t){T(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function x(e){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function A(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function M(e,t){return(M=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var j=function(e){function t(e,n,r,o,a,s,u){var l;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(l=function(e,t){return!t||"object"!==_(t)&&"function"!=typeof t?A(e):t}(this,x(t).call(this)))._controller=e,l._target=n,l._representationReasoner=r,l._fetchers=o,l._analytics=a,l._assetUrls=s,l._handleVisibilityChange=l._handleVisibilityChange.bind(A(l)),l._handleOrientationChange=l._handleOrientationChange.bind(A(l)),l._setVolumePersistence=l._setVolumePersistence.bind(A(l)),l._privacyNotice=u,l._player=new f.default(l._target,l._analytics,l._assetUrls,l._controller),l._player.on(f.PlayerEvents.BACK_BUTTON_CLICKED,(function(){l._currentRenderer&&l._currentRenderer.emit(c.default.PREVIOUS_BUTTON_CLICKED)})),l._player.on(f.PlayerEvents.NEXT_BUTTON_CLICKED,(function(){if(l._currentRenderer){var e=l._currentRenderer,t=e.getChoiceTime(),n=e.getCurrentTime().currentTime;if(e.getInPause()&&e.phase===i.RENDERER_PHASES.START)d.default.info("Next button clicked during infinite start pause - starting element"),e.setInPause(!1),e.emit(c.default.COMPLETE_START_BEHAVIOURS);else if(t>0&&n<t)d.default.info("Next button clicked on element with choices, skip to them"),e.setCurrentTime(t-.25);else if(e.hasVariablePanelBehaviour()||e.hasShowIconBehaviour()&&t<0){var r=e.getRepresentation().id;d.default.info("Next button ignored due to variable panel/choices, skip to end");var o=l._player.playoutEngine.getDuration(r);if(n&&o)l._player.playoutEngine.setCurrentTime(r,o-.25);else l._currentRenderer&&l._currentRenderer.complete()}else e.emit(c.default.NEXT_BUTTON_CLICKED)}})),l._player.on(f.PlayerEvents.REPEAT_BUTTON_CLICKED,(function(){l._controller._currentNarrativeElement&&l._controller.repeatStep()})),l._player.on(f.PlayerEvents.VOLUME_CHANGED,(function(e){l._rendererState.volumes[e.label]=e.value})),l._player.on(f.PlayerEvents.VOLUME_MUTE_TOGGLE,(function(e){l._rendererState.muted[e.label]=e.muted})),l._player.on(f.PlayerEvents.PLAY_PAUSE_BUTTON_CLICKED,(function(){l._player.playoutEngine.isPlaying()?Object.keys(l._backgroundRenderers).forEach((function(e){return l._backgroundRenderers[e].resumeFade()})):Object.keys(l._backgroundRenderers).forEach((function(e){return l._backgroundRenderers[e].pauseFade()}))})),void 0!==document.hidden?document.addEventListener("visibilitychange",(function(){l._handleVisibilityChange(!document.hidden)})):void 0!==document.webkitHidden&&document.addEventListener("webkitvisibilitychange",(function(){l._handleVisibilityChange(!document.webkitHidden)})),window.addEventListener("orientationchange",l._handleOrientationChange,!1),l._player.on(p.REASONER_EVENTS.ROMPER_STORY_STARTED,(function(){l.emit(p.REASONER_EVENTS.ROMPER_STORY_STARTED)})),l._initialise(),l}var n,r,v;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&M(e,t)}(t,e),n=t,(r=[{key:"_handleOrientationChange",value:function(){this._analytics({type:h.default.types.RENDERER_ACTION,name:h.default.names.WINDOW_ORIENTATION_CHANGE,from:"unset",to:window.orientation})}},{key:"prepareForRestart",value:function(){this._player.prepareForRestart()}},{key:"_handleVisibilityChange",value:function(e){e?(this._isPlaying&&this._currentRenderer&&!this._currentRenderer.hasEnded()&&(this._currentRenderer&&this._currentRenderer.play(),this._player.playoutEngine.play()),this._player.playoutEngine.hasStarted()&&this._player.playoutEngine.playBackgrounds(),this._player._choiceCountdownTimeout&&this._currentRenderer&&this._player.startChoiceCountdown(this._currentRenderer)):(this._isPlaying=this._player.playoutEngine.isPlaying(),this._player.playoutEngine.pause(),this._player.playoutEngine.pauseBackgrounds(),this._currentRenderer&&this._currentRenderer.pause()),this._analytics({type:h.default.types.RENDERER_ACTION,name:h.default.names.BROWSER_VISIBILITY_CHANGE,from:e?"hidden":"visible",to:e?"visible":"hidden"})}},{key:"handleStoryStart",value:function(e){var t=this,n={background_art_asset_collection_id:"",button_class:"romper-start-button",text:"Start",hide_narrative_buttons:!0,background_art:this._assetUrls.noBackgroundAssetUrl,privacy_notice:this._privacyNotice};this._fetchers.storyFetcher(e).then((function(e){if(t._setAspectRatio(e),e.meta&&e.meta.romper&&e.meta.romper.dog){var r=Object.assign(e.meta.romper.dog);t._fetchers.assetCollectionFetcher(r.asset_collection_id).then((function(e){return e.assets.image_src?t._fetchers.mediaFetcher(e.assets.image_src):Promise.reject(new Error("Failed to fetch AC with image_src"))})).then((function(e){return t._player.addDog(e,r.position)})).catch((function(e){return d.default.error("Cannot resolve DOG asset: ".concat(e))}))}return e.meta&&e.meta.romper&&e.meta.romper.onLaunch?(n=Object.assign(n,e.meta.romper.onLaunch),t._fetchers.assetCollectionFetcher(n.background_art_asset_collection_id)):Promise.reject(new Error("No onLaunch options in Story"))})).then((function(e){return e.assets.image_src?t._fetchers.mediaFetcher(e.assets.image_src):Promise.reject(new Error("Could not find Asset Collection"))})).then((function(e){d.default.info("FETCHED FROM MS MEDIA! ".concat(e)),t._player.setupExperienceOverlays(Object.assign(n,{background_art:e}))})).catch((function(e){d.default.error(e,"Could not get url from asset collection uuid"),t._player.setupExperienceOverlays(Object.assign(n,{background_art:t._assetUrls.noBackgroundAssetUrl}))}))}},{key:"_setAspectRatio",value:function(e){var t=16/9;e.meta&&e.meta.storyplayer&&e.meta.storyplayer.aspect_ratio&&(t=e.meta.storyplayer.aspect_ratio),this._player.setAspectRatio(t)}},{key:"handleNEChange",value:function(e){var t=this;return this._player.clearLinkChoices(),e.body.representation_collection_target_id?this._fetchers.representationCollectionFetcher(e.body.representation_collection_target_id).then((function(n){if(n.representations.length>0)return t._representationReasoner(n);var r=w({},l.PLACEHOLDER_REPRESENTATION,{description:e.description,id:e.id});return Promise.resolve(r)})).then((function(n){if(t._currentNarrativeElement&&t._currentNarrativeElement.id===e.id&&t._currentRenderer&&t._currentRenderer._representation.id===n.id)t._restartCurrentRenderer();else{var r=t._getRenderer(e,n);t._rendererLookahead(e),r&&(t._swapRenderers(r,e),t._handleBackgroundRendering(r.getRepresentation())),t._renderStory&&t._renderStory.handleNarrativeElementChanged(n.id)}})):Promise.reject(new Error("No representation_collection_target_id on NE"))}},{key:"getCurrentNarrativeElement",value:function(){return this._currentNarrativeElement}},{key:"getCurrentRenderer",value:function(){return this._currentRenderer}},{key:"_createStoryIconRenderer",value:function(e){var t=this;this._renderStory=new a.default(e,this._fetchers.assetCollectionFetcher,this._fetchers.mediaFetcher,this._player),this._renderStory.on(p.REASONER_EVENTS.JUMP_TO_NARRATIVE_ELEMENT,(function(e){t._controller._jumpToNarrativeElement(e)})),this._currentRenderer&&this._renderStory.start(this._currentRenderer.getRepresentation().id)}},{key:"_handleBackgroundRendering",value:function(e){var t=this,n=[];e&&e.asset_collections.background_ids&&(n=e.asset_collections.background_ids);var r=[];return n.forEach((function(e){return r.push(t._fetchers.assetCollectionFetcher(e))})),Promise.all(r).then((function(e){var t=[];return e.forEach((function(e){e.assets.audio_src&&t.push({src:e.assets.audio_src,acId:e.id})})),Promise.resolve(t)})).then((function(e){Object.keys(t._backgroundRenderers).forEach((function(n){0===e.filter((function(e){return e.src===n})).length&&(Object.values(t._upcomingBackgroundRenderers).includes(t._backgroundRenderers[n])?t._backgroundRenderers[n].end():t._backgroundRenderers[n].destroy(),delete t._backgroundRenderers[n])})),e.forEach((function(e){var n=e.src,r=e.acId;t._backgroundRenderers.hasOwnProperty(n)||t._fetchers.assetCollectionFetcher(r).then((function(e){var r=null;return(r=n in t._upcomingBackgroundRenderers?t._upcomingBackgroundRenderers[n]:(0,u.default)(e.asset_collection_type,e,t._fetchers.mediaFetcher,t._player))&&(r.start(),t._backgroundRenderers[n]=r),Promise.resolve(r)}))}))}))}},{key:"_createNewRenderer",value:function(e){var t=this,n=(0,o.default)(e,this._fetchers.assetCollectionFetcher,this._fetchers.mediaFetcher,this._player,this._analytics,this._controller);return n?(n.on(c.default.COMPLETE_START_BEHAVIOURS,(function(){n.start()})),n.on(c.default.COMPLETED,(function(){t.emit(c.default.COMPLETED)})),n.on(c.default.NEXT_BUTTON_CLICKED,(function(){t.emit(c.default.NEXT_BUTTON_CLICKED)})),n.on(c.default.PREVIOUS_BUTTON_CLICKED,(function(){t.emit(c.default.PREVIOUS_BUTTON_CLICKED)})),n.on(c.default.SWITCHED_REPRESENTATION,(function(e){t._rendererState.lastSwitchableLabel=e.label,e.choice_representation&&t._handleBackgroundRendering(e.choice_representation),Object.keys(t._upcomingRenderers).forEach((function(e){var n=t._upcomingRenderers[e];n instanceof s.default&&n.setChoiceToRepresentationWithLabel(t._rendererState.lastSwitchableLabel)})),t._setVolumePersistence()})),n instanceof s.default&&n.setChoiceToRepresentationWithLabel(this._rendererState.lastSwitchableLabel)):d.default.error("Do not know how to render ".concat(e.representation_type)),n}},{key:"_restartCurrentRenderer",value:function(){if(this._currentRenderer){var e=this._currentRenderer;e.end(),e.willStart(),this.refreshOnwardIcons(),this._setVolumePersistence()}else d.default.error("no current renderer to restart")}},{key:"_swapRenderers",value:function(e,t){var n=this._currentRenderer;this._currentRenderer=e,this._currentNarrativeElement=t,e instanceof s.default&&this._rendererState.lastSwitchableLabel&&e.setChoiceToRepresentationWithLabel(this._rendererState.lastSwitchableLabel),n&&(Object.values(this._upcomingRenderers).some((function(e){return e===n}))?n.end():n.destroy()),this._showBackIcon(),this.refreshOnwardIcons(),e.willStart(t.name,t.id),this._setVolumePersistence()}},{key:"_showBackIcon",value:function(){this._player.setBackAvailable(!0)}},{key:"_setVolumePersistence",value:function(){var e=this;Object.keys(this._rendererState.volumes).forEach((function(t){var n=e._rendererState.volumes[t];e._player.setVolumeControlLevel(t,n)})),Object.keys(this._rendererState.muted).forEach((function(t){var n=e._rendererState.muted[t];e._player.setMuted(t,n)}))}},{key:"refreshOnwardIcons",value:function(){var e=this;return this._currentRenderer&&!this._currentRenderer.inVariablePanel?this._controller.getValidNextSteps().then((function(t){var n=t.length>0;e._player.setNextAvailable(n)})).catch((function(t){d.default.error("Could not get valid next steps to set next button availability",t),e._player.setNextAvailable(!1)})):(this._player.setNextAvailable(!1),Promise.resolve())}},{key:"_getRenderer",value:function(e,t){var n,r=this;return Object.keys(this._upcomingRenderers).forEach((function(t){t===e.id&&(n=r._upcomingRenderers[t])})),n||(n=this._createNewRenderer(t)),n}},{key:"refreshLookahead",value:function(){this._currentNarrativeElement&&this._rendererLookahead(this._currentNarrativeElement)}},{key:"_rendererLookahead",value:function(e){var t=this;return(0,m.checkDisableLookahead)()?Promise.resolve():Promise.all([this._controller.getIdOfPreviousNode(),this._controller.getIdsOfNextNodes(e)]).then((function(n){var r=b(n,2),i=r[0],o=r[1],a=[];i?(t._previousNeId=i,a=o.concat([i])):a=o;var s=a.map((function(e){if(!t._currentRenderer||!t._currentNarrativeElement||t._currentNarrativeElement.id!==e){var n=t._controller._getNarrativeElement(e);return n&&n.body.representation_collection_target_id?t._fetchers.representationCollectionFetcher(n.body.representation_collection_target_id).then((function(e){if(e.representations.length>0)return t._representationReasoner(e);var r=w({},l.PLACEHOLDER_REPRESENTATION,{description:n.description,id:n.id});return Promise.resolve(r)})).then((function(n){if(t._upcomingRenderers[e]){if(t._upcomingRenderers[e]._representation.id!==n.id){var r=t._createNewRenderer(n);r&&(t._upcomingRenderers[e]=r)}}else{var i=t._createNewRenderer(n);i&&(t._upcomingRenderers[e]=i)}})):Promise.resolve()}return t._upcomingRenderers[e]=t._currentRenderer,Promise.resolve()}));return t.refreshOnwardIcons(),Promise.all(s).then((function(){Object.keys(t._upcomingRenderers).filter((function(e){return-1===a.indexOf(e)})).forEach((function(n){e.id!==n&&t._upcomingRenderers[n].destroy(),delete t._upcomingRenderers[n]})),t._runBackgroundLookahead()}))}))}},{key:"_runBackgroundLookahead",value:function(){var e=this,t=[],n=[];Object.keys(this._upcomingRenderers).forEach((function(r){var i=e._upcomingRenderers[r].getRepresentation();i.asset_collections.background_ids&&i.asset_collections.background_ids.forEach((function(i){i in t||(t.push(i),(!e._previousNeId||e._previousNeId&&e._previousNeId!==r)&&n.push(i))}))}));var r=[],i={};t.forEach((function(t){return r.push(e._fetchers.assetCollectionFetcher(t))})),Promise.all(r).then((function(e){var t=[];return e.forEach((function(e){e.assets.audio_src&&t.push({src:e.assets.audio_src,ac:e})})),Promise.resolve(t)})).then((function(t){t.forEach((function(t){var r=t.src,o=t.ac;if(!(r in e._upcomingBackgroundRenderers)){var a=(0,u.default)(o.asset_collection_type,o,e._fetchers.mediaFetcher,e._player);a&&(e._upcomingBackgroundRenderers[r]=a)}n.indexOf(o.id)>=0&&(i[r]=e._upcomingBackgroundRenderers[r])})),Object.keys(e._upcomingBackgroundRenderers).forEach((function(n){0===t.filter((function(e){return e.src===n})).length&&delete e._upcomingBackgroundRenderers[n]})),e._setBackgroundFades(i)}))}},{key:"_setBackgroundFades",value:function(e){var t=this;Object.keys(this._backgroundRenderers).forEach((function(n){if(-1===Object.keys(e).indexOf(n)){if(t._currentRenderer){var r=t._currentRenderer,i=r.getCurrentTime();if(i.remainingTime)if(i.remainingTime<2)t._backgroundRenderers[n].fadeOut(i.remainingTime);else{var o=i.currentTime+(i.remainingTime-2);r.addTimeEventListener(n,o,(function(){return t._backgroundRenderers[n].fadeOut(2)}))}}}else t._backgroundRenderers[n].cancelFade(),t._currentRenderer&&t._currentRenderer.deleteTimeEventListener(n)}))}},{key:"_initialise",value:function(){this._currentRenderer=null,this._upcomingRenderers={},this._upcomingBackgroundRenderers={},this._backgroundRenderers={},this._rendererState={lastSwitchableLabel:"",volumes:{},muted:{}}}},{key:"reset",value:function(){this._currentRenderer&&this._currentRenderer.destroy(),this._currentRenderer=null}}])&&S(n.prototype,r),v&&S(n,v),t}(r.default);t.default=j},"./src/RepresentationReasoner.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.array.for-each.js"),n("./node_modules/core-js/modules/es.array.iterator.js"),n("./node_modules/core-js/modules/es.array.map.js"),n("./node_modules/core-js/modules/es.object.to-string.js"),n("./node_modules/core-js/modules/es.promise.js"),n("./node_modules/core-js/modules/es.string.iterator.js"),n("./node_modules/core-js/modules/web.dom-collections.for-each.js"),n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return function(n){var r;return(0,i.default)(n.representations,t).then((function(t){return t?e(t[0].representation_id):Promise.reject(new Error("no suitable representations found"))})).then((function(t){var n=[];return(r=t).choices?(r.choices.forEach((function(t){n.push(e(t.choice_representation_id))})),Promise.all(n)):[]})).then((function(e){var t={};return e.forEach((function(e){t[e.id]=e})),r.choices&&(r.choices=r.choices.map((function(e){return{label:e.label,choice_representation_id:e.choice_representation_id,choice_representation:t[e.choice_representation_id]}}))),r}))}};var r,i=(r=n("./src/logic.js"))&&r.__esModule?r:{default:r}},"./src/SessionManager.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.symbol.js"),n("./node_modules/core-js/modules/es.symbol.description.js"),n("./node_modules/core-js/modules/es.symbol.iterator.js"),n("./node_modules/core-js/modules/es.array.concat.js"),n("./node_modules/core-js/modules/es.array.filter.js"),n("./node_modules/core-js/modules/es.array.for-each.js"),n("./node_modules/core-js/modules/es.array.includes.js"),n("./node_modules/core-js/modules/es.array.iterator.js"),n("./node_modules/core-js/modules/es.array.reduce.js"),n("./node_modules/core-js/modules/es.function.name.js"),n("./node_modules/core-js/modules/es.object.get-prototype-of.js"),n("./node_modules/core-js/modules/es.object.keys.js"),n("./node_modules/core-js/modules/es.object.set-prototype-of.js"),n("./node_modules/core-js/modules/es.object.to-string.js"),n("./node_modules/core-js/modules/es.promise.js"),n("./node_modules/core-js/modules/es.string.includes.js"),n("./node_modules/core-js/modules/es.string.iterator.js"),n("./node_modules/core-js/modules/web.dom-collections.for-each.js"),n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.SESSION_STATE=t.fetchStateFromStorage=void 0;var r,i=(r=n("./node_modules/events/events.js"))&&r.__esModule?r:{default:r},o=n("./src/InternalVariables.js");function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(e,t){return JSON.parse(localStorage.getItem(e)||t)};t.fetchStateFromStorage=d;var h=["RESUME","RESTART","NEW","EXISTING"].reduce((function(e,t){return e[t]=t,e}),{});t.SESSION_STATE=h;var f=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=u(this,l(t).call(this)))._storyId=e,n.sessionState=n.checkExistingSession()?h.EXISTING:h.NEW,n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,e),n=t,i=[{key:"deleteExistingSession",value:function(e){if(e){localStorage.removeItem(e);var t=d("EXISTING_SESSION","[]");if(t.includes(e)){var n=t.filter((function(t){return t!==e}));localStorage.setItem("EXISTING_SESSION",JSON.stringify(n))}}}}],(r=[{key:"setExistingSession",value:function(){if(this._storyId){var e=d("EXISTING_SESSION","[]");e.includes(this._storyId)||(e.push(this._storyId),localStorage.setItem("EXISTING_SESSION",JSON.stringify(e))),this.setSessionState(h.RESUME)}}},{key:"checkExistingSession",value:function(){if(!this._storyId)return!1;var e=d("EXISTING_SESSION","[]");return e&&e.includes(this._storyId)||!1}},{key:"fetchExistingSessionState",value:function(){if(!this._storyId)return Promise.resolve({});var e=d(this._storyId,"{}");return e?Promise.resolve(e):Promise.resolve({})}},{key:"fetchLastVisitedElement",value:function(){return this.fetchExistingSessionState().then((function(e){if(!e)return null;var t=e[o.InternalVariableNames.PATH_HISTORY];return t?0===t.length?null:t[t.length-1]:null}))}},{key:"fetchPathHistory",value:function(){return this.fetchExistingSessionState().then((function(e){if(!e)return null;var t=e[o.InternalVariableNames.PATH_HISTORY];return t?0===t.length?null:t:null}))}},{key:"setSessionState",value:function(e){this.sessionState=h[e]}},{key:"setVariable",value:function(e){var t=this;this.fetchExistingSessionState().then((function(n){n[e.name]!==e.value&&(n[e.name]=e.value),localStorage.setItem(t._storyId,JSON.stringify(n))}))}},{key:"appendPathHistory",value:function(e){var t=this;this.fetchExistingSessionState().then((function(n){var r=n[o.InternalVariableNames.PATH_HISTORY],i=[];r&&r.length>0?(r.push(e),i=r.concat(e)):i=[e],n[o.InternalVariableNames.PATH_HISTORY]=i,localStorage.setItem(t._storyId,JSON.stringify(n))}))}},{key:"setDefaultState",value:function(e){var t=this;this.fetchExistingSessionState().then((function(n){Object.keys(e).forEach((function(t){n[t]!==e[t]&&(n[t]=e[t])})),localStorage.setItem(t._storyId,JSON.stringify(n))}))}}])&&s(n.prototype,r),i&&s(n,i),t}(i.default);t.default=f},"./src/StoryPathWalker.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.symbol.js"),n("./node_modules/core-js/modules/es.symbol.description.js"),n("./node_modules/core-js/modules/es.symbol.iterator.js"),n("./node_modules/core-js/modules/es.array.concat.js"),n("./node_modules/core-js/modules/es.array.find.js"),n("./node_modules/core-js/modules/es.array.for-each.js"),n("./node_modules/core-js/modules/es.array.iterator.js"),n("./node_modules/core-js/modules/es.object.get-prototype-of.js"),n("./node_modules/core-js/modules/es.object.set-prototype-of.js"),n("./node_modules/core-js/modules/es.object.to-string.js"),n("./node_modules/core-js/modules/es.promise.js"),n("./node_modules/core-js/modules/es.string.iterator.js"),n("./node_modules/core-js/modules/web.dom-collections.for-each.js"),n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n("./node_modules/events/events.js")),i=(a(n("./src/StoryReasoner.js")),a(n("./src/logger.js"))),o=n("./src/Events.js");function a(e){return e&&e.__esModule?e:{default:e}}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var h=function(e){function t(e,n,r){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=l(this,c(t).call(this)))._storyFetcher=e,i._representationCollectionFetcher=n,i._storyReasonerFactory=r,i._linear=!0,i._pathmap=[],i._storyItemMap=[],i}var n,r,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,e),n=t,(r=[{key:"_getRepresentationCollections",value:function(e){var t=this,n=[];return e.forEach((function(e){var r=e.ne.body.representation_collection_target_id;r&&n.push(t._representationCollectionFetcher(r))})),Promise.all(n).then((function(n){return n.forEach((function(n,r){var i=e[r],o={stories:i.stories,narrative_element:i.ne,representation_collection:n};t._pathmap.push(o)})),Promise.resolve(t._pathmap)}))}},{key:"_getStoryArray",value:function(e,t){return t.push(e._currentNarrativeElement.id),e._subStoryReasoner?this._getStoryArray(e._subStoryReasoner,t):t}},{key:"_walkComplete",value:function(e){var t=this;this._getRepresentationCollections(e).then((function(){return t.emit(o.REASONER_EVENTS.WALK_COMPLETE)}))}},{key:"getStoryItemList",value:function(e){var t=this,n=[];return this._pathmap.forEach((function(t){n.push(e(t.representation_collection))})),Promise.all(n).then((function(e){return e.forEach((function(e,n){var r,i,o=(r=t._pathmap[n],i=e,{stories:r.stories,narrative_element:r.narrative_element,representation_collection:r.representation_collection,representation:i});t._storyItemMap.push(o)})),t._storyItemMap}))}},{key:"parseStory",value:function(e){var t=this;this._linear=!0;var n=[];this._storyReasonerFactory(e).then((function(r){r.on(o.REASONER_EVENTS.STORY_END,(function(){t._walkComplete(n)})),r.on(o.ERROR_EVENTS,(function(e){i.default.warn("Error: ".concat(e)),t._pathmap=[],t.emit(o.REASONER_EVENTS.WALK_COMPLETE)}));var a=function(){t._linear=!1,t._walkComplete([])};r.on(o.REASONER_EVENTS.CHOICE_OF_BEGINNINGS,a),r.on(o.REASONER_EVENTS.CHOICE_OF_LINKS,a),r.on(o.REASONER_EVENTS.NARRATIVE_ELEMENT_CHANGED,(function(o){var a={stories:[e].concat(t._getStoryArray(r,[])),ne:o};void 0!==n.find((function(e){return e.ne.id===o.id}))&&(i.default.info("Linearity checker returned to previously visited node; story not linear"),t._linear=!1,t._walkComplete([])),n.push(a),t._linear&&r.next()})),r.start(),r.chooseBeginning()}))}}])&&u(n.prototype,r),a&&u(n,a),t}(r.default);t.default=h},"./src/StoryReasoner.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.symbol.js"),n("./node_modules/core-js/modules/es.symbol.description.js"),n("./node_modules/core-js/modules/es.symbol.iterator.js"),n("./node_modules/core-js/modules/es.array.concat.js"),n("./node_modules/core-js/modules/es.array.filter.js"),n("./node_modules/core-js/modules/es.array.find.js"),n("./node_modules/core-js/modules/es.array.for-each.js"),n("./node_modules/core-js/modules/es.array.index-of.js"),n("./node_modules/core-js/modules/es.array.iterator.js"),n("./node_modules/core-js/modules/es.array.map.js"),n("./node_modules/core-js/modules/es.array.reduce.js"),n("./node_modules/core-js/modules/es.function.name.js"),n("./node_modules/core-js/modules/es.object.get-prototype-of.js"),n("./node_modules/core-js/modules/es.object.keys.js"),n("./node_modules/core-js/modules/es.object.set-prototype-of.js"),n("./node_modules/core-js/modules/es.object.to-string.js"),n("./node_modules/core-js/modules/es.promise.js"),n("./node_modules/core-js/modules/es.string.iterator.js"),n("./node_modules/core-js/modules/web.dom-collections.for-each.js"),n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=c(n("./node_modules/events/events.js")),i=c(n("./src/logic.js")),o=c(n("./src/logger.js")),a=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==d(e)&&"function"!=typeof e)return{default:e};var t=l();if(t&&t.has(e))return t.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=r?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(n,i,o):n[i]=e[i]}n.default=e,t&&t.set(e,n);return n}(n("./src/InternalVariables.js")),s=n("./src/Events.js"),u=c(n("./src/AnalyticEvents.js"));function l(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return l=function(){return e},e}function c(e){return e&&e.__esModule?e:{default:e}}function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var v=function(e){function t(e,n,r,i,o){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=f(this,p(t).call(this)))._story=e,a._dataResolver=r,a._reasonerFactory=i,a._storyStarted=!1,a._storyEnded=!1,a._resolving=!1,a._parent=null,a._analytics=o,a._narrativeElements={},n.forEach((function(e){a._narrativeElements[e.id]=e})),a}var n,r,l;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(t,e),n=t,l=[{key:"_getSubReasonerWithNarrativeElement",value:function(e,n){return n._isInReasoner(e)?n:n._subStoryReasoner?t._getSubReasonerWithNarrativeElement(e,n._subStoryReasoner):null}}],(r=[{key:"getRequirements",value:function(){return void 0!==this._story.meta&&void 0!==this._story.meta.romper&&void 0!==this._story.meta.romper.requirements?this._story.meta.romper.requirements:[]}},{key:"start",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._storyStarted&&o.default.warn("Calling reasoner start on story that has already started"),this._storyStarted=!0,this._applyInitialState(e)}},{key:"_fetchVariablesFromStory",value:function(){var e=this;if(this._story.variables){var t=this._story.variables;return Promise.all(Object.keys(t).map((function(n){var r=t[n].default_value;return e.getVariableValue(n).then((function(e){return null==e?{name:n,value:r}:(o.default.info("Variable ".concat(n," already has value ").concat(e)),null)}))}))).then((function(e){return e.filter(Boolean).reduce((function(e,t){return e[t.name]=t.value,e}),{})}))}return o.default.info("No variables in story"),Promise.resolve(null)}},{key:"_applyInitialState",value:function(e){var t=this;e&&Object.keys(e).length>0&&Object.keys(e).forEach((function(n){t.setVariableValue(n,e[n])})),new a.default(this._dataResolver,this._story.meta).setAllVariables()}},{key:"next",value:function(){if(!this._storyStarted)throw new Error("InvalidState: this story has not yet started");if(this._storyEnded)throw new Error("InvalidState: this story has ended");if(this._resolving)throw new Error("InvalidState: currently resolving an action");this._subStoryReasoner?this._subStoryReasoner.next():this._chooseNextNode()}},{key:"chooseBeginning",value:function(){var e=this;this._resolving=!0,this._story.beginnings.length>1&&this.emit(s.REASONER_EVENTS.CHOICE_OF_BEGINNINGS),(0,i.default)(this._story.beginnings,this._dataResolver).then((function(t){e._resolving=!1,t?e._setCurrentNarrativeElement(t[0].narrative_element_id):e.emit(s.ERROR_EVENTS,new Error("Unable to choose a valid beginning"))}))}},{key:"getBeginning",value:function(e){return(0,i.default)(e.beginnings,this._dataResolver).then((function(e){return e&&e.length>0?e[0].narrative_element_id:null}))}},{key:"_chooseNextNode",value:function(){var e=this;this._resolving=!0,0===this._currentNarrativeElement.links.length?(o.default.info("Reasoner has found NE with no links - story end"),this.emit(s.REASONER_EVENTS.STORY_END)):this._currentNarrativeElement.links.length>1&&this.emit(s.REASONER_EVENTS.CHOICE_OF_LINKS),(0,i.default)(this._currentNarrativeElement.links,this._dataResolver).then((function(t){if(e._resolving=!1,t){t.length>1&&(e.emit(s.REASONER_EVENTS.MULTIPLE_VALID_LINKS,t),o.default.info("StoryReasoner: multiple valid paths"));var n=t.find((function(e){return e.override_as_chosen}));n?e._followLink(n):e._followLink(t[0])}else e.emit(s.ERROR_EVENTS,new Error("There are no possible links"))}))}},{key:"_followLink",value:function(e){"END_STORY"===e.link_type?(this._storyEnded=!0,this.emit(s.REASONER_EVENTS.STORY_END)):"NARRATIVE_ELEMENT"===e.link_type&&e.target_narrative_element_id?this._setCurrentNarrativeElement(e.target_narrative_element_id):"CHOOSE_BEGINNING"===e.link_type?this.chooseBeginning():this.emit(s.ERROR_EVENTS,new Error("Unable to follow a link of type ".concat(e.link_type)))}},{key:"_setCurrentNarrativeElement",value:function(e){var t=this;if(e in this._narrativeElements)if(this._currentNarrativeElement=this._narrativeElements[e],"STORY_ELEMENT"===this._currentNarrativeElement.body.type){if(this.appendToHistory(e),this._resolving=!0,this._currentNarrativeElement.body.story_target_id){var n=this._currentNarrativeElement.body.story_target_id;this._analytics({type:u.default.types.STORY_NAVIGATION,name:u.default.names.ENTER_SUB_STORY,from:this._currentNarrativeElement.id,to:n}),this._reasonerFactory(n,this._analytics).then((function(e){return t._initSubStoryReasoner(e)})).catch((function(e){t.emit(s.ERROR_EVENTS,e)}))}}else this.emit(s.REASONER_EVENTS.NARRATIVE_ELEMENT_CHANGED,this._currentNarrativeElement);else this.emit(s.ERROR_EVENTS,new Error("Link is to an narrative object not in the graph"))}},{key:"createSubStoryReasoner",value:function(e){var t=this;this._currentNarrativeElement=this._narrativeElements[e],this._resolving=!0,this._currentNarrativeElement.body.story_target_id&&this._reasonerFactory(this._currentNarrativeElement.body.story_target_id,this._analytics).then((function(e){return t._initSubStoryReasoner(e)})).catch((function(e){t.emit(s.ERROR_EVENTS,e)}))}},{key:"setVariableValue",value:function(e,t){this.emit(s.VARIABLE_EVENTS.VARIABLE_CHANGED,{name:e,value:t}),o.default.info("Setting variable in story reasoner '".concat(e,"' to ").concat(JSON.stringify(t))),this._dataResolver.set(e,t)}},{key:"getVariableValue",value:function(e){return this._dataResolver.get(e)}},{key:"appendToHistory",value:function(e){var t=this;o.default.info("Storing ".concat(e," in history")),this._dataResolver.get(a.InternalVariableNames.PATH_HISTORY).then((function(n){var r=[];return null!==n&&(r=r.concat(n)),r.push(e),t.setVariableValue(a.InternalVariableNames.PATH_HISTORY,r),n}))}},{key:"_initSubStoryReasoner",value:function(e){this._addSubReasonerListeners(e),this._subStoryReasoner=e,this._resolving=!1,this._subStoryReasoner.setParent(this),e.start(),e.chooseBeginning()}},{key:"_addSubReasonerListeners",value:function(e){var t=this,n=function(e){return t.emit(s.ERROR_EVENTS,e)},r=function(e){t.emit(s.REASONER_EVENTS.NARRATIVE_ELEMENT_CHANGED,e)};e.on(s.REASONER_EVENTS.CHOICE_OF_BEGINNINGS,(function(){return t.emit(s.REASONER_EVENTS.CHOICE_OF_BEGINNINGS)})),e.on(s.REASONER_EVENTS.CHOICE_OF_LINKS,(function(){return t.emit(s.REASONER_EVENTS.CHOICE_OF_LINKS)})),e.on(s.ERROR_EVENTS,n),e.on(s.REASONER_EVENTS.NARRATIVE_ELEMENT_CHANGED,r),e.on(s.REASONER_EVENTS.STORY_END,(function i(){t._subStoryReasoner=null,t._chooseNextNode(),e.removeListener(s.ERROR_EVENTS,n),e.removeListener(s.REASONER_EVENTS.NARRATIVE_ELEMENT_CHANGED,r),e.removeListener(s.REASONER_EVENTS.STORY_END,i)})),e.on(s.VARIABLE_EVENTS.VARIABLE_CHANGED,(function(e){t.emit(s.VARIABLE_EVENTS.VARIABLE_CHANGED,e)}))}},{key:"setParent",value:function(e){this._parent=e}},{key:"getParent",value:function(){return this._parent}},{key:"hasNextNode",value:function(){var e=this;return(0,i.default)(this._currentNarrativeElement.links,this._dataResolver).then((function(t){var n=[];return t&&t.forEach((function(t){"END_STORY"===t.link_type?e._parent&&n.push(e._parent.hasNextNode()):n.push(Promise.resolve([t]))})),Promise.all(n)})).then((function(e){var t=[];return e.forEach((function(e){t=t.concat(e)})),t}))}},{key:"_isFollowedByAnotherNode",value:function(e){if(e._currentNarrativeElement.links.length>1)return!0;if("NARRATIVE_ELEMENT"===e._currentNarrativeElement.links[0].link_type)return!0;var t=e._subStoryReasoner;return!!t&&this._isFollowedByAnotherNode(t)}},{key:"_isInReasoner",value:function(e){return-1!==Object.keys(this._narrativeElements).indexOf(e)}},{key:"getSubReasonerContainingNarrativeElement",value:function(e){return t._getSubReasonerWithNarrativeElement(e,this)}},{key:"findPreviousNodeId",value:function(){var e=this,t=this._currentNarrativeElement.id,n=null;return Object.keys(this._narrativeElements).forEach((function(r){var i=e._narrativeElements[r];i.links.forEach((function(e){e.target_narrative_element_id===t&&(n=i.id)}))})),n}},{key:"_shadowWalkPath",value:function(e,t){var n=this;e in this._narrativeElements&&(this._currentNarrativeElement=this._narrativeElements[e],e!==t[t.length-1]?"STORY_ELEMENT"===this._currentNarrativeElement.body.type&&(this._currentNarrativeElement.body.story_target_id?this._reasonerFactory(this._currentNarrativeElement.body.story_target_id).then((function(r){n._initShadowSubStoryReasoner(r,e,t)})).catch((function(e){n.emit(s.ERROR_EVENTS,e)})):this.emit(s.ERROR_EVENTS,new Error("No Story target id for element ".concat(e)))):this.emit(s.REASONER_EVENTS.ELEMENT_FOUND,this._currentNarrativeElement))}},{key:"_initShadowSubStoryReasoner",value:function(e,t,n){var r=this;this._addSubReasonerListeners(e),e.on(s.REASONER_EVENTS.ELEMENT_FOUND,(function(e){return r.emit(s.REASONER_EVENTS.ELEMENT_FOUND,e)})),this._subStoryReasoner=e,this._resolving=!1,this._subStoryReasoner.setParent(this),e.start(),n.forEach((function(t){e._shadowWalkPath(t,n)}))}}])&&h(n.prototype,r),l&&h(n,l),t}(r.default);t.default=v},"./src/StoryReasonerFactory.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.array.for-each.js"),n("./node_modules/core-js/modules/es.array.iterator.js"),n("./node_modules/core-js/modules/es.object.to-string.js"),n("./node_modules/core-js/modules/es.promise.js"),n("./node_modules/core-js/modules/es.string.iterator.js"),n("./node_modules/core-js/modules/web.dom-collections.for-each.js"),n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){return function r(o){var a,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};return e(o).then((function(e){a=e;var n=[];return e.narrative_element_ids.forEach((function(e){n.push(t(e))})),Promise.all(n)})).then((function(e){return new i.default(a,e,n,r,s)}))}};var r,i=(r=n("./src/StoryReasoner.js"))&&r.__esModule?r:{default:r}},"./src/TimeManager.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.symbol.js"),n("./node_modules/core-js/modules/es.symbol.description.js"),n("./node_modules/core-js/modules/es.symbol.iterator.js"),n("./node_modules/core-js/modules/es.array.for-each.js"),n("./node_modules/core-js/modules/es.array.iterator.js"),n("./node_modules/core-js/modules/es.object.get-prototype-of.js"),n("./node_modules/core-js/modules/es.object.keys.js"),n("./node_modules/core-js/modules/es.object.set-prototype-of.js"),n("./node_modules/core-js/modules/es.object.to-string.js"),n("./node_modules/core-js/modules/es.string.iterator.js"),n("./node_modules/core-js/modules/web.dom-collections.for-each.js"),n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(n("./node_modules/events/events.js")),i=o(n("./src/logger.js"));function o(e){return e&&e.__esModule?e:{default:e}}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=u(this,l(t).call(this)))._timedEvents={},e._paused=!1,e._syncing=!1,e}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,e),n=t,(r=[{key:"start",value:function(){var e=this;this.clear(),this._timer=setInterval((function(){e._paused||e._syncing||(e._timeElapsed+=.01,Object.keys(e._timedEvents).forEach((function(t){var n=e._timedEvents[t],r=n.startTime,o=n.startCallback,a=n.isRunning,s=n.endTime,u=n.clearCallback;if(e._timeElapsed>=r&&e._timeElapsed<s&&!a&&(i.default.info("timer running timed event ".concat(t)),o(),e._timedEvents[t].isRunning=!0),(e._timeElapsed<=r||e._timeElapsed>s)&&a){try{u&&u()}catch(e){i.default.info("couldnt clear up behaviour ".concat(t))}e._timedEvents[t].isRunning=!1}})))}),10)}},{key:"setSyncing",value:function(e){this._syncing=!!e}},{key:"isSyncing",value:function(){return this._syncing}},{key:"pause",value:function(){this._paused||(this._paused=!0)}},{key:"resume",value:function(){this._paused&&(this._paused=!1)}},{key:"clear",value:function(){this._timer&&clearInterval(this._timer),this._timeElapsed=0,this._timedEvents={},this._paused=!1}},{key:"setTime",value:function(e){this._timeElapsed=e}},{key:"getTime",value:function(){return this._timeElapsed}},{key:"addTimeEventListener",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0,i=arguments.length>4?arguments[4]:void 0;this._timedEvents[e]={startTime:t,endTime:r,startCallback:n,isRunning:!1,clearCallback:i}}},{key:"deleteTimeEventListener",value:function(e){e in this._timedEvents&&delete this._timedEvents[e]}}])&&s(n.prototype,r),o&&s(n,o),t}(r.default);t.default=d},"./src/assets/images/media-pause-8x.png":function(e,t,n){e.exports=n.p+"images/media-pause-8x.png"},"./src/assets/images/media-play-8x.png":function(e,t,n){e.exports=n.p+"images/media-play-8x.png"},"./src/assets/images/media-step-backward-8x.png":function(e,t,n){e.exports=n.p+"images/media-step-backward-8x.png"},"./src/assets/images/media-step-forward-8x.png":function(e,t,n){e.exports=n.p+"images/media-step-forward-8x.png"},"./src/assets/images/no-asset.svg":function(e,t,n){e.exports=n.p+"images/no-asset.svg"},"./src/assets/styles/player.scss":function(e,t,n){},"./src/behaviours/BaseBehaviour.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.function.name.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;i(n("./src/renderers/BaseRenderer.js"));var r=i(n("./src/logger.js"));function i(e){return e&&e.__esModule?e:{default:e}}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._behaviourDefinition=t,this._onComplete=n,this._handleDone=this._handleDone.bind(this)}var t,n,i;return t=e,(n=[{key:"start",value:function(e){var t=e.getBehaviourRenderer(this._behaviourDefinition.type);t?t(this._behaviourDefinition,this._handleDone):(r.default.warn("".concat(e.constructor.name," does not support ")+"".concat(this._behaviourDefinition.type," - completing immediately")),this._onComplete())}},{key:"_handleDone",value:function(){this._onComplete()}},{key:"destroy",value:function(){}}])&&o(t.prototype,n),i&&o(t,i),e}();t.default=a},"./src/behaviours/BehaviourFactory.js":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n,s={"urn:x-object-based-media:representation-behaviour:pause/v1.0":r.default,"urn:x-object-based-media:representation-behaviour:exit-fullscreen/v1.0":o.default,"urn:x-object-based-media:representation-behaviour:blur/v1.0":i.default,"urn:x-object-based-media:representation-behaviour:colouroverlay/v1.0":i.default,"urn:x-object-based-media:representation-behaviour:showimage/v1.0":i.default,"urn:x-object-based-media:representation-behaviour:showvariablepanel/v1.0":i.default,"urn:x-object-based-media:representation-behaviour:showlinkchoices/v1.0":i.default,"urn:x-object-based-media:representation-behaviour:socialmodal/v1.0":i.default,"urn:x-object-based-media:representation-behaviour:linkoutmodal/v1.0":i.default};if(e.type in s){var u=s[e.type];n=new u(e,t)}else a.default.warn("Do not know how to handle behaviour ".concat(e.type," - ignoring"));return n};var r=s(n("./src/behaviours/PauseBehaviour.js")),i=s(n("./src/behaviours/BaseBehaviour.js")),o=s(n("./src/behaviours/ExitFullscreenBehaviour.js")),a=s(n("./src/logger.js"));function s(e){return e&&e.__esModule?e:{default:e}}},"./src/behaviours/BehaviourRunner.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.array.for-each.js"),n("./node_modules/core-js/modules/es.object.keys.js"),n("./node_modules/core-js/modules/web.dom-collections.for-each.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=i(n("./src/behaviours/BehaviourFactory.js"));i(n("./src/renderers/BaseRenderer.js"));function i(e){return e&&e.__esModule?e:{default:e}}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.behaviourDefinitions=t,this.eventCounters={},this.behaviours=[],this.baseRenderer=n,this.eventNames=Object.keys(t),this.eventNames.forEach((function(e){r.eventCounters[e]=0}))}var t,n,i;return t=e,(n=[{key:"runBehaviours",value:function(e,t){var n=this;return this.behaviours=[],void 0!==this.behaviourDefinitions[e]&&0!==this.behaviourDefinitions[e].length&&(this.behaviourDefinitions[e].forEach((function(i){var o=(0,r.default)(i,(function(){n.handleCompletion(e,t)}));o&&(n.behaviours.push(o),n.eventCounters[e]+=1)})),0!==this.behaviours.length&&(this.behaviours.forEach((function(e){e.start(n.baseRenderer)})),!0))}},{key:"destroyBehaviours",value:function(){this.behaviours.forEach((function(e){e.destroy()}))}},{key:"handleCompletion",value:function(e,t){void 0!==this.eventCounters[e]&&(this.eventCounters[e]>0&&(this.eventCounters[e]-=1),0===this.eventCounters[e]&&this.baseRenderer.emit(t))}}])&&o(t.prototype,n),i&&o(t,i),e}();t.default=a},"./src/behaviours/BehaviourTimings.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.array.for-each.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={};["started","completed"].forEach((function(e){r[e]=e}));var i=r;t.default=i},"./src/behaviours/ExitFullscreenBehaviour.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.symbol.js"),n("./node_modules/core-js/modules/es.symbol.description.js"),n("./node_modules/core-js/modules/es.symbol.iterator.js"),n("./node_modules/core-js/modules/es.array.iterator.js"),n("./node_modules/core-js/modules/es.object.get-prototype-of.js"),n("./node_modules/core-js/modules/es.object.set-prototype-of.js"),n("./node_modules/core-js/modules/es.object.to-string.js"),n("./node_modules/core-js/modules/es.string.iterator.js"),n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;r(n("./src/renderers/BaseRenderer.js"));function r(e){return e&&e.__esModule?e:{default:e}}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=a(this,s(t).call(this,e,n))).timerHandle=null,r}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,e),n=t,(r=[{key:"start",value:function(e){var t=e._player;t._applyExitFullscreenBehaviour.bind(t)(this._behaviourDefinition,this._handleDone)}},{key:"destroy",value:function(){this.timerHandle&&clearTimeout(this.timerHandle)}}])&&o(n.prototype,r),i&&o(n,i),t}(r(n("./src/behaviours/BaseBehaviour.js")).default);t.default=l},"./src/behaviours/LinkOutBehaviourHelper.js":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.renderLinkoutPopup=void 0;var r,i=n("./src/behaviours/ModalHelper.js"),o=(r=n("./src/AnalyticEvents.js"))&&r.__esModule?r:{default:r};t.renderLinkoutPopup=function(e,t,n,r){var a=document.createElement("div");a.id=e.id;var s=(0,i.createContainer)(t);if(s.appendChild(a),a.className="romper-behaviour-modal link-out",e.css_class&&a.classList.add(e.css_class),e.title){var u=document.createElement("div");u.textContent=e.title,u.className="title",a.appendChild(u)}!function(e,t){t.position?(0,i.setDefinedPosition)(e,t):(e.style.top="30%",e.style.left="30%",e.style.width="40%",e.style.height="6em")}(a,e);var l=document.createElement("div");l.className="romper-close-button";l.onclick=function(){s.removeChild(a),n()},a.appendChild(l);var c=function(e){var t=e.link_text,n=e.link_url,r=document.createElement("a");return r.href=n,r.textContent=t,e.open_in_new_tab&&r.setAttribute("target","_blank"),r}(e);c.onclick=function(){r({type:o.default.types.USER_ACTION,name:o.default.names.OUTWARD_LINK_CLICKED,from:"not_set",to:e.link_url})};var d=document.createElement("div");if(e.before_text){var h=document.createElement("span");h.textContent=e.before_text,d.appendChild(h)}if(d.appendChild(c),e.after_text){var f=document.createElement("span");f.textContent=e.after_text,d.appendChild(f)}return a.appendChild(d),a}},"./src/behaviours/ModalHelper.js":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setDefinedPosition=t.createContainer=void 0;t.setDefinedPosition=function(e,t){var n=t.position,r=n.top,i=n.left,o=n.width,a=n.height,s=n.bottom,u=n.right;null!=r&&(e.style.top="".concat(r,"%")),null!=i&&(e.style.left="".concat(i,"%")),null!=o&&(e.style.width="".concat(o,"%")),null!=a&&(e.style.height="".concat(a,"%")),null!=s&&(e.style.bottom="".concat(s,"%")),null!=u&&(e.style.right="".concat(u,"%"))};t.createContainer=function(e){var t=document.getElementById("modal-container");return t||((t=document.createElement("div")).id="modal-container",t.className="romper-modal-container",e.appendChild(t)),t}},"./src/behaviours/PauseBehaviour.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.symbol.js"),n("./node_modules/core-js/modules/es.symbol.description.js"),n("./node_modules/core-js/modules/es.symbol.iterator.js"),n("./node_modules/core-js/modules/es.array.iterator.js"),n("./node_modules/core-js/modules/es.object.get-prototype-of.js"),n("./node_modules/core-js/modules/es.object.set-prototype-of.js"),n("./node_modules/core-js/modules/es.object.to-string.js"),n("./node_modules/core-js/modules/es.parse-float.js"),n("./node_modules/core-js/modules/es.string.iterator.js"),n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(n("./src/behaviours/BaseBehaviour.js")),i=(o(n("./src/renderers/BaseRenderer.js")),o(n("./src/logger.js")));function o(e){return e&&e.__esModule?e:{default:e}}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=u(this,l(t).call(this,e,n))).timerHandle=null,r}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,e),n=t,(r=[{key:"start",value:function(e){this._renderer=e;var t=parseFloat(this._behaviourDefinition.pauseTime);t<0?(i.default.info("negative pause time: pause behaviour will never complete"),this._renderer.setInPause(!0)):this.timerHandle=setTimeout(this.handleTimeout.bind(this),1e3*t)}},{key:"handleTimeout",value:function(){this.timerHandle=null,this._handleDone()}},{key:"destroy",value:function(){this.timerHandle&&clearTimeout(this.timerHandle)}}])&&s(n.prototype,r),o&&s(n,o),t}(r.default);t.default=d},"./src/behaviours/SocialShareBehaviourHelper.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.array.concat.js"),n("./node_modules/core-js/modules/es.array.for-each.js"),n("./node_modules/core-js/modules/web.dom-collections.for-each.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.renderSocialPopup=void 0;var r,i=n("./src/behaviours/ModalHelper.js"),o=(r=n("./src/AnalyticEvents.js"))&&r.__esModule?r:{default:r},a=n("./src/utils.js");var s=function(e,t){var n=document.createElement("li"),r=document.createElement("div"),i=function(){return window.open("https://twitter.com/intent/tweet?text=".concat(e,"&url=").concat(t),"_blank","toolbar=no,scrollbars=yes,resizable=no,fullscreen=no,top=50,left=50,width=550,height=250")};return r.onclick=i,r.addEventListener("touchend",(0,a.handleButtonTouchEvent)(i)),n.className="twitter",n.appendChild(r),n},u=function(e,t){var n=document.createElement("li"),r=document.createElement("a"),i=document.createElement("div");return r.href="mailto:?Subject=".concat(e,"&body=").concat(t),r.setAttribute("target","_top"),n.appendChild(r),r.appendChild(i),n.className="email",n},l=function(e,t){var n=document.createElement("li"),r=document.createElement("div"),i=function(){return window.open("http://www.facebook.com/dialog/feed?app_id=58567469885&link=".concat(t,"&quote=").concat(e,"&display=popup"),"_blank","toolbar=no,scrollbars=yes,resizable=no,fullscreen=no,top=50,left=50,width=550,height=250")};return r.onclick=i,r.addEventListener("touchend",(0,a.handleButtonTouchEvent)(i)),n.className="facebook",n.appendChild(r),n},c=function(e,t){t.position?(0,i.setDefinedPosition)(e,t):(e.style.top="5%",e.style.right="5%")},d=function(e,t,n){e.addEventListener("click",(function(){n({type:o.default.types.USER_ACTION,name:o.default.names.SOCIAL_SHARE_CLICKED,from:"not_set",to:t})}))};t.renderSocialPopup=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},o=document.createElement("div");o.id=e.id;var h=(0,i.createContainer)(t);if(h.appendChild(o),o.className="romper-behaviour-modal social-share",e.css_class&&o.classList.add(e.css_class),e.title){var f=document.createElement("div");f.textContent=e.title,f.className="title",o.appendChild(f)}c(o,e);var p=document.createElement("div");p.className="romper-close-button";var m=function(){h.removeChild(o),n()};p.onclick=m,p.addEventListener("touchend",(0,a.handleButtonTouchEvent)(m)),o.appendChild(p);var v=encodeURIComponent(e.share_text),g=window.location.href;e.share_url&&(g=encodeURIComponent(e.share_url));var y=document.createElement("ul");return y.className="romper-share-list",e.platforms.forEach((function(e){if("twitter"===e){var t=s(v,g);d(t,e,r),y.appendChild(t)}else if("email"===e){var n=u(v,g);d(n,e,r),y.appendChild(n)}else if("facebook"===e){var i=l(v,g);d(i,e,r),y.appendChild(i)}})),o.appendChild(y),o}},"./src/behaviours/VariablePanelHelper.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.array.concat.js"),n("./node_modules/core-js/modules/es.array.for-each.js"),n("./node_modules/core-js/modules/es.array.iterator.js"),n("./node_modules/core-js/modules/es.object.to-string.js"),n("./node_modules/core-js/modules/es.parse-float.js"),n("./node_modules/core-js/modules/es.regexp.exec.js"),n("./node_modules/core-js/modules/es.string.replace.js"),n("./node_modules/core-js/modules/web.dom-collections.for-each.js"),n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.buildPanel=void 0;i(n("./src/renderers/BaseRenderer.js")),i(n("./src/Player.js"));var r=i(n("./src/AnalyticEvents.js"));function i(e){return e&&e.__esModule?e:{default:e}}var o=function(e,t,n,r){var i=document.createElement("div");i.className="romper-variable-form-item",i.id="romper-var-form-".concat(t.variable_name.replace("_","-"));var o=e.variable_type,a=t.variable_name,s=document.createElement("div");s.className="romper-var-form-label-div";var u=document.createElement("span");u.innerHTML=t.label,s.appendChild(u),i.appendChild(s);var l=document.createElement("div");l.className="romper-var-form-answer-cont-inner";var c=document.createElement("div");if(c.className="romper-var-form-answer-cont",c.appendChild(l),"boolean"===o){var d=function(e,t,n){var r=document.createElement("div");r.classList.add("romper-var-form-input-container");var i=document.createElement("div");i.classList.add("romper-var-form-button-div");var o=document.createElement("button");o.setAttribute("type","button");var a=document.createElement("button");a.setAttribute("type","button");var s=function(e){e?(o.classList.add("selected"),a.classList.remove("selected")):(o.classList.remove("selected"),a.classList.add("selected"))};return o.textContent="Yes",o.onclick=function(){n(e,!0),s(!0)},i.appendChild(o),a.textContent="No",a.onclick=function(){n(e,!1),s(!1)},i.appendChild(a),r.appendChild(i),t(e).then((function(e){return s(e)})),r}(a,n,r);l.append(d)}else if("list"===o){var h=function(e,t,n,r){var i=document.createElement("div");i.classList.add("romper-var-form-input-container");var o=t.values,a=document.createElement("select");return o.forEach((function(e){var t=document.createElement("option");t.setAttribute("value",e),t.textContent=e,a.appendChild(t)})),i.appendChild(a),n(e).then((function(e){a.value=e})),a.onchange=function(){return r(e,a.value)},i}(t.variable_name,e,n,r);h.classList.add("romper-var-form-list-input"),l.append(h)}else if("number"===o){var f;(f=e.hasOwnProperty("range")?function(e,t,n,r,i){var o=document.createElement("div");o.classList.add("romper-var-form-input-container");var a=document.createElement("div");a.style.position="relative";var s=document.createElement("span");s.classList.add("min"),n.hasOwnProperty("min_label")?s.textContent=null===n.min_label?"":n.min_label:s.textContent=t.min_val;var u=document.createElement("span");u.classList.add("max"),n.hasOwnProperty("max_label")?u.textContent=null===n.max_label?"":n.max_label:u.textContent=t.max_val;var l=document.createElement("div");l.className="romper-var-form-range-output";var c=document.createElement("input");c.type="range",c.classList.add("romper-var-form-slider"),c.id="variable-input-".concat(e),a.appendChild(s),a.appendChild(c),a.appendChild(u);var d=document.createElement("input");d.classList.add("romper-var-form-slider-input"),d.classList.add("slider-input"),d.type="number";var h=function(){var e=parseFloat(c.value)/parseFloat(c.max),t=s.clientWidth;t+=1/12*c.clientWidth,t+=e*(10/12)*c.clientWidth,l.style.left="".concat(t,"px")};return c.min=t.min_val,c.max=t.max_val,r(e).then((function(e){c.value=e,d.value=e,l.textContent="".concat(e),h()})),c.onchange=function(){i(e,c.value),d.value=c.value},c.oninput=function(){d.value=c.value,l.textContent="".concat(c.value),h()},d.onchange=function(){i(e,d.value),c.value=d.value},d.oninput=function(){i(e,d.value)},o.appendChild(a),n.hasOwnProperty("precise_entry")&&n.precise_entry?o.appendChild(d):n.hasOwnProperty("min_label")||n.hasOwnProperty("max_label")||(a.appendChild(l),window.onresize=function(){return h()}),o}(a,e.range,t,n,r):function(e,t,n){var r=document.createElement("div");r.classList.add("romper-var-form-input-container");var i=document.createElement("input");return i.type="number",t(e).then((function(e){i.value=e})),i.onchange=function(){return n(e,i.value)},r.appendChild(i),r}(a,n,r)).classList.add("romper-var-form-number-input"),l.append(f)}return i.appendChild(c),i};t.buildPanel=function(e,t,n,i,a,s,u,l,c){u.setNextAvailable(!1),l.inVariablePanel=!0;var d=function(e,t){var n=document.createElement("div");n.className="romper-variable-panel",t&&(n.style.background=t);var r=document.createElement("div");r.innerHTML=e,r.className="romper-var-form-title",n.appendChild(r);var i=document.createElement("div");i.className="romper-var-form-var-containers";var o=document.createElement("div");o.className="romper-var-form-carousel",i.appendChild(o),n.appendChild(o);var a=document.createElement("div");a.className="romper-var-form-button-container";var s=document.createElement("input");s.className="romper-var-form-button",s.type="button",s.classList.add("var-next"),s.value="Next",n.appendChild(a);var u=document.createElement("input");u.type="button",u.value="Back",u.classList.add("var-back"),u.classList.add("romper-var-form-button");var l=document.createElement("span");return l.classList.add("var-count"),l.textContent="",a.appendChild(u),a.appendChild(l),a.appendChild(s),{overlayImageElement:n,carouselDiv:o,backButton:u,okButton:s,statusSpan:l}}(e.panel_label,e.background_colour),h=d.overlayImageElement,f=d.carouselDiv,p=d.backButton,m=d.okButton,v=d.statusSpan;h.id=e.id,l._setBehaviourElementAttribute(h,"variable-panel");var g=e.variables;t().then((function(e){var t=[];g.forEach((function(r,a){var s=e[r.variable_name],u=o(s,r,n,i);a>0&&u.classList.add("right"),t.push(u),f.appendChild(u)}));var d=0,y="".concat(d+1," of ").concat(g.length);v.textContent=y;var _=function(e){!function(e){var t=g[d].variable_name;n(t).then((function(n){var i=e?r.default.names.VARIABLE_PANEL_NEXT_CLICKED:r.default.names.VARIABLE_PANEL_BACK_CLICKED,o={type:r.default.types.USER_ACTION,name:i,from:"unset",to:"".concat(t,": ").concat(n)};c(o)}))}(e);var i=e?d+1:d-1;return e&&d>=g.length-1?(h.classList.remove("active"),l.inVariablePanel=!1,setTimeout((function(){return u.setNextAvailable(!0),a()}),700),!1):(t.forEach((function(e,t){t===i?(e.classList.remove("left"),e.classList.remove("right")):t<i?(e.classList.add("left"),e.classList.remove("right")):(e.classList.remove("left"),e.classList.add("right"))})),(d=i)>0?p.classList.add("active"):p.classList.remove("active"),y="".concat(d+1," of ").concat(g.length),v.textContent=y,!1)};p.onclick=function(){_(!1)},m.onclick=function(){_(!0)},s.appendChild(h),setTimeout((function(){h.classList.add("active")}),200),l._behaviourElements.push(h)}))}},"./src/browserCapabilities.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.array.includes.js"),n("./node_modules/core-js/modules/es.array.index-of.js"),n("./node_modules/core-js/modules/es.date.to-string.js"),n("./node_modules/core-js/modules/es.object.to-string.js"),n("./node_modules/core-js/modules/es.object.values.js"),n("./node_modules/core-js/modules/es.parse-int.js"),n("./node_modules/core-js/modules/es.regexp.to-string.js"),n("./node_modules/core-js/modules/es.string.includes.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.MediaFormats=t.BrowserCapabilities=t.BrowserUserAgent=t.PLAYOUT_ENGINES=void 0;var r=a(n("./node_modules/hls.js/dist/hls.js")),i=n("./src/utils.js"),o=a(n("./src/logger.js"));function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,n){return t&&u(e.prototype,t),n&&u(e,n),e}var c={SRC_SWITCH_PLAYOUT:"src",DOM_SWITCH_PLAYOUT:"dom",IOS_PLAYOUT:"ios"};t.PLAYOUT_ENGINES=c;var d=function(){function e(){s(this,e)}return l(e,null,[{key:"facebookWebview",value:function(){var e=window.navigator.userAgent;return e.indexOf("FBAN")>-1&&e.indexOf("FBDV")>-1&&e.indexOf("FBSV")>-1}},{key:"iOS",value:function(){var e=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"];if(navigator.platform)for(;e.length;)if(navigator.platform===e.pop())return!0;return!1}},{key:"iPhone",value:function(){var e=["iPhone Simulator","iPod Simulator","iPhone","iPod"];if(navigator.platform)for(;e.length;)if(navigator.platform===e.pop())return!0;return!1}},{key:"safari",value:function(){var e=window.navigator.userAgent;return navigator.platform&&"MacIntel"===navigator.platform?e.indexOf("Macintosh")>-1&&e.indexOf("Safari")>-1&&e.indexOf("Chrome")<0:!!this.iOS()&&e.indexOf("Safari")>0}},{key:"isSafariDesktop",value:function(){return"[object SafariRemoteNotification]"===(!window.safari||"undefined"!=typeof safari&&window.safari.pushNotification).toString()}},{key:"ie",value:function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");if(t>0)return parseInt(e.substring(t+5,e.indexOf(".",t)),10);if(e.indexOf("Trident/")>0){var n=e.indexOf("rv:");return parseInt(e.substring(n+3,e.indexOf(".",n)),10)}return!1}},{key:"edge",value:function(){var e=window.navigator.userAgent,t=e.indexOf("Edge/");return t>0&&parseInt(e.substring(t+5,e.indexOf(".",t)),10)}}]),e}();t.BrowserUserAgent=d;var h=function(){function e(){s(this,e)}return l(e,null,[{key:"hlsJsSupport",value:function(){return r.default.isSupported()}},{key:"hlsSupport",value:function(){return void 0!==e.hlsSupported?e.hlsSupported:d.edge()||d.ie()?(e.hlsSupported=!1,!1):e.hlsJsSupport()||document.createElement("video").canPlayType("application/vnd.apple.mpegurl")?(e.hlsSupported=!0,!0):(e.hlsSupported=!1,!1)}},{key:"dashSupport",value:function(){return void 0!==e.dashSupported?e.dashSupported:"function"==typeof(window.MediaSource||window.WebKitMediaSource)?(e.dashSupported=!0,!0):(e.dashSupported=!1,!1)}}]),e}();t.BrowserCapabilities=h;var f=function(){function e(){s(this,e)}return l(e,null,[{key:"getFormat",value:function(){var e=(0,i.getOverrideFormat)(),t=(0,i.checkDebugPlayout)();return e?(o.default.info("Overriding media selector format: , ".concat(e)),e):d.isSafariDesktop()?(t&&o.default.info("getFormat: isSafariDesktop = True"),"dash"):d.safari()&&h.hlsSupport()?(t&&o.default.info("getFormat: safari = True"),"hls"):h.dashSupport()?(t&&o.default.info("getFormat: Dash Support = True"),"dash"):h.hlsSupport()?(t&&o.default.info("getFormat: HLS Support = True"),"hls"):null}},{key:"getPlayoutEngine",value:function(){var e=(0,i.fetchOverridePlayout)(),t=(0,i.checkDebugPlayout)();return e&&Object.values(c).includes(e)?(o.default.info("Overriding playout engine: ",e),"src"===e?(o.default.warn("Cannot use source engine"),"ios"):e):h.dashSupport()?d.isSafariDesktop()?(t&&o.default.info("getPlayoutEngine: DashSupport + isSafariDesktop = True"),"dom"):d.safari()?(t&&o.default.info("getPlayoutEngine: DashSupport + safari = True"),"ios"):(t&&o.default.info("getPlayoutEngine: DashSupport + not safari = True"),"dom"):h.hlsSupport()?(t&&o.default.info("getPlayoutEngine: HlsSupport = True"),"ios"):(t&&o.default.info("getPlayoutEngine: No DashSupport or HlsSupport"),"dom")}}]),e}();t.MediaFormats=f},"./src/fetchers/MediaFetcher.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.object.to-string.js"),n("./node_modules/core-js/modules/es.promise.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return function(e){return new Promise((function(t,n){e?t(e):n(new Error("Invalid URI"))}))}}},"./src/logger.js":function(e,t,n){"use strict";var r,i=n("./node_modules/browser-bunyan/lib/index.m.js"),o=(r=n("./src/logger/logger_formatter.js"))&&r.__esModule?r:{default:r};e.exports=(0,i.createLogger)({name:"romper",streams:[{level:"info",stream:new o.default({logByLevel:!0})}],serializers:i.stdSerializers,src:!0})},"./src/logger/logger_formatter.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.symbol.js"),n("./node_modules/core-js/modules/es.array.concat.js"),n("./node_modules/core-js/modules/es.array.filter.js"),n("./node_modules/core-js/modules/es.array.for-each.js"),n("./node_modules/core-js/modules/es.array.join.js"),n("./node_modules/core-js/modules/es.function.name.js"),n("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),n("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),n("./node_modules/core-js/modules/es.object.keys.js"),n("./node_modules/core-js/modules/web.dom-collections.for-each.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n("./node_modules/browser-bunyan/lib/index.m.js");function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s={levels:{trace:"color: DeepPink",debug:"color: GoldenRod",info:"color: DarkTurquoise",warn:"color: Purple",error:"color: Crimson",fatal:"color: Black"},def:"color: DimGray",msg:"color: SteelBlue",src:"color: DimGray; font-style: italic; font-size: 0.9em"},u={css:s,logByLevel:!1},l=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},u,{},t);this.logByLevel=n.logByLevel,this.css=n.css}var t,n,l;return t=e,l=[{key:"getDefaultCss",value:function(){return s}}],(n=[{key:"write",value:function(e){var t,n,i=this.css.def,o=this.css.msg,a=this.css.src,s=e.childName?"".concat(e.name,"/").concat(e.childName):e.name,u=r.nameFromLevel[e.level],l=(Array(6-u.length).join(" ")+u).toUpperCase();this.logByLevel?(e.level===r.TRACE?u="debug":e.level===r.FATAL&&(u="error"),n="function"==typeof console[u]?console[u]:console.log):n=console.log,t=e.level<r.DEBUG?this.css.levels.trace:e.level<r.INFO?this.css.levels.debug:e.level<r.WARN?this.css.levels.info:e.level<r.ERROR?this.css.levels.warn:e.level<r.FATAL?this.css.levels.error:this.css.levels.fatal;var c=function(e,t){return Array(t+1-"".concat(e).length).join("0")+e},d=[];d.push("[%s:%s:%s:%s] %c%s%c: %s: %c%s ".concat(e.src?"%c%s":"")),d.push(c(e.time.getHours(),2)),d.push(c(e.time.getMinutes(),2)),d.push(c(e.time.getSeconds(),2)),d.push(c(e.time.getMilliseconds(),4)),d.push(t),d.push(l),d.push(i),d.push(s),d.push(o),d.push(e.msg),e.src&&(d.push(a),d.push(e.src)),n.apply(console,d),e.err&&e.err.message&&n.call(console,"%c%s",t,e.err.message),e.err&&e.err.stack&&n.call(console,"%c%s",t,e.err.stack),e.obj&&n.call(console,e.obj)}}])&&a(t.prototype,n),l&&a(t,l),e}();t.default=l},"./src/logic.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.array.filter.js"),n("./node_modules/core-js/modules/es.array.for-each.js"),n("./node_modules/core-js/modules/es.array.iterator.js"),n("./node_modules/core-js/modules/es.array.map.js"),n("./node_modules/core-js/modules/es.array.sort.js"),n("./node_modules/core-js/modules/es.object.to-string.js"),n("./node_modules/core-js/modules/es.promise.js"),n("./node_modules/core-js/modules/es.regexp.exec.js"),n("./node_modules/core-js/modules/es.string.iterator.js"),n("./node_modules/core-js/modules/es.string.split.js"),n("./node_modules/core-js/modules/web.dom-collections.for-each.js"),n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(t,n){var o=[];return t.forEach((function(e){return r.default.uses_data(e.condition).forEach((function(e){return o.push(e)}))})),Promise.all(o.map((function(e){return n.get(e).catch((function(){return null})).then((function(t){return{key:e,value:t}}))}))).then(s).then((function(n){var o=t.map((function(e,t){return{i:t,result:r.default.apply(e.condition,n)}})).filter((function(e){return e.result>0}));if(o.length>0){o.length>1&&i.default.info("LOGIC: choice of ".concat(e.length," conditions"));var s=[];return o.sort(a).forEach((function(e){s.push(t[e.i])})),s}return null}))};var r=o(n("./node_modules/json-logic-js/logic.js")),i=o(n("./src/logger.js"));function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return e.result===t.result?e.i-t.i:!0===e.result?-1:!0===t.result?1:t.result-e.result}function s(e){var t={};return e.forEach((function(e){var n=e.key,r=e.value,i=t,o=n.split(".");o.forEach((function(e,t){e in i||(t===o.length-1?i[e]=r:(i[e]={},i=i[e]))}))})),t}},"./src/playoutEngines/BasePlayoutEngine.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.object.assign.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.MEDIA_TYPES=void 0;(r=n("./src/Player.js"))&&r.__esModule;var r,i=n("./src/utils.js");function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}t.MEDIA_TYPES={FOREGROUND_AV:"foreground_av",FOREGROUND_A:"foreground_a",BACKGROUND_A:"background_a"};var a=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._player=t,this._media={},this._permissionToPlay=!1,this._hasStarted=!1,this._debugPlayout=n,this._debugPlayout&&(window.playoutMedia=this._media,window.playout=this)}var t,n,r;return t=e,(n=[{key:"setPermissionToPlay",value:function(e){this._permissionToPlay=e}},{key:"queuePlayout",value:function(e,t){this._media[e]||(this._media[e]={active:!1}),this._media[e].media?this._media[e].media=Object.assign(this._media[e].media,t):this._media[e].media=t}},{key:"unqueuePlayout",value:function(e){this._media[e]&&delete this._media[e]}},{key:"setPlayoutVisible",value:function(e){if(this._media[e]){var t=this.getMediaElement(e);t&&t.classList.remove("romper-media-element-queued")}}},{key:"getPlayoutActive",value:function(e){return!!this._media[e]&&this._media[e].active}},{key:"setPlayoutActive",value:function(e){var t=this;this._media[e]&&(this._media[e].active=!0);var n=this._player._currentRenderer._representation.asset_collections.foreground_id;(0,i.checkAddDetailsOverride)()&&n&&this._player._currentRenderer._fetchAssetCollection(n).then((function(e){t._player.addAssetCollectionDetails(e)}))}},{key:"setPlayoutInactive",value:function(e){this._media[e]&&(this._media[e].active=!1)}},{key:"play",value:function(){}},{key:"pause",value:function(){}},{key:"isPlaying",value:function(){return!1}},{key:"hasStarted",value:function(){return this._hasStarted}},{key:"pauseBackgrounds",value:function(){}},{key:"playBackgrounds",value:function(){}},{key:"getCurrentTime",value:function(e){var t=this.getMediaElement(e);if(t&&!(t.readyState<t.HAVE_CURRENT_DATA))return t.currentTime}},{key:"getDuration",value:function(e){var t=this.getMediaElement(e);if(t&&!(t.readyState<t.HAVE_CURRENT_DATA))return t.duration}},{key:"setCurrentTime",value:function(e,t){return!1}},{key:"on",value:function(e,t,n){}},{key:"off",value:function(e,t,n){}},{key:"getMediaElement",value:function(e){}},{key:"setLoopAttribute",value:function(e,t,n){var r=n||this.getMediaElement(e);r&&(t?r.loop=!0:r.removeAttribute("loop"))}},{key:"removeLoopAttribute",value:function(e){var t=this.getMediaElement(e);t&&t.removeAttribute("loop")}},{key:"checkIsLooping",value:function(e){var t=this.getMediaElement(e);return t&&t.hasAttribute("loop")}}])&&o(t.prototype,n),r&&o(t,r),e}();t.default=a},"./src/playoutEngines/DOMSwitchPlayoutEngine.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.symbol.js"),n("./node_modules/core-js/modules/es.symbol.description.js"),n("./node_modules/core-js/modules/es.symbol.iterator.js"),n("./node_modules/core-js/modules/es.array.concat.js"),n("./node_modules/core-js/modules/es.array.filter.js"),n("./node_modules/core-js/modules/es.array.find.js"),n("./node_modules/core-js/modules/es.array.for-each.js"),n("./node_modules/core-js/modules/es.array.index-of.js"),n("./node_modules/core-js/modules/es.array.iterator.js"),n("./node_modules/core-js/modules/es.number.to-fixed.js"),n("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),n("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),n("./node_modules/core-js/modules/es.object.get-prototype-of.js"),n("./node_modules/core-js/modules/es.object.keys.js"),n("./node_modules/core-js/modules/es.object.set-prototype-of.js"),n("./node_modules/core-js/modules/es.object.to-string.js"),n("./node_modules/core-js/modules/es.parse-int.js"),n("./node_modules/core-js/modules/es.reflect.get.js"),n("./node_modules/core-js/modules/es.string.iterator.js"),n("./node_modules/core-js/modules/web.dom-collections.for-each.js"),n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=f(n("./node_modules/hls.js/dist/hls.js")),i=f(n("./node_modules/shaka-player/dist/shaka-player.compiled.js")),o=h(n("./src/playoutEngines/BasePlayoutEngine.js")),a=h(n("./src/Player.js")),s=f(n("./src/logger.js")),u=n("./src/playoutEngines/playoutEngineConsts.js"),l=n("./src/Events.js"),c=n("./src/utils.js");function d(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return d=function(){return e},e}function h(e){if(e&&e.__esModule)return e;if(null===e||"object"!==p(e)&&"function"!=typeof e)return{default:e};var t=d();if(t&&t.has(e))return t.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=r?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(n,i,o):n[i]=e[i]}return n.default=e,t&&t.set(e,n),n}function f(e){return e&&e.__esModule?e:{default:e}}function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){g(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function b(e,t,n){return(b="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=E(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function E(e){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var T={};["HLS","DASH","OTHER"].forEach((function(e){T[e]=e}));var S=function(e){function t(e,n){var o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?_(e):t}(this,E(t).call(this,e,n)))._debugPlayout&&o._printActiveMSEBuffers(),r.default.isSupported()?(s.default.info("HLS.js being used"),o._useHlsJs=!0):o._useHlsJs=!1,o._activeConfig={hls:{maxBufferLength:30,maxMaxBufferLength:600,startFragPrefetch:!0,startLevel:3,debug:o._debugPlayout},dash:{bufferingGoal:10}};var u=(0,c.fetchActiveBufferingOverride)();u&&(s.default.info("activeBufferingOverride: ".concat(u)),o._activeConfig.dash.bufferingGoal=parseInt(u,10)),o._inactiveConfig={hls:{maxBufferLength:2,maxMaxBufferLength:4,startFragPrefetch:!0,startLevel:3,debug:o._debugPlayout},dash:{bufferingGoal:2}},o._estimatedBandwidth=1e9;var l=(0,c.fetchInactiveBufferingOverride)();l&&(s.default.info("inactiveBufferingOverride: ".concat(l)),o._inactiveConfig.dash.bufferingGoal=parseInt(l,10));var d=(0,c.fetchShakaDebugLevel)();return i.default.log&&o._debugPlayout&&d&&("vv"===d?i.default.log.setLevel(i.default.log.Level.V2):"v"===d?i.default.log.setLevel(i.default.log.Level.V1):"debug"===d?i.default.log.setLevel(i.default.log.Level.DEBUG):"info"===d&&i.default.log.setLevel(i.default.log.Level.INFO)),i.default.polyfill.installAll(),o._playing=!1,o._subtitlesShowing=!1,o._handlePlayPauseButtonClicked=o._handlePlayPauseButtonClicked.bind(_(o)),o._handleSubtitlesClicked=o._handleSubtitlesClicked.bind(_(o)),o._handleVolumeClicked=o._handleVolumeClicked.bind(_(o)),o._toggleMute=o._toggleMute.bind(_(o)),o._showHideSubtitles=o._showHideSubtitles.bind(_(o)),o._queueSubtitleAttach=o._queueSubtitleAttach.bind(_(o)),o._printActiveMSEBuffers=o._printActiveMSEBuffers.bind(_(o)),o._player.on(a.PlayerEvents.PLAY_PAUSE_BUTTON_CLICKED,o._handlePlayPauseButtonClicked),o._player.on(a.PlayerEvents.SUBTITLES_BUTTON_CLICKED,o._handleSubtitlesClicked),o._player.on(a.PlayerEvents.VOLUME_CHANGED,o._handleVolumeClicked),o._player.on(a.PlayerEvents.VOLUME_MUTE_TOGGLE,o._toggleMute),o}var n,d,h;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(t,e),n=t,(d=[{key:"_shakaUpdateBandwidth",value:function(e){var t=this._media[e];if(t&&t._shaka){var n=t._shaka.getStats().estimatedBandwidth;n&&(this._estimatedBandwidth=n,this._debugPlayout&&console.log("DASH Shaka Bandwidth Update: ",this._estimatedBandwidth.toFixed(2)," ",(this._estimatedBandwidth/1e6).toFixed(2)))}}},{key:"_ShakaAdaptationHandler",value:function(e){var t=this;return function(){t._media[e]&&t._shakaUpdateBandwidth(e)}}},{key:"_shakaCheckBandwidth",value:function(e){var t=this,n=this._media[e];n&&(this._shakaUpdateBandwidth(e),n._shakaCheckBandwidthTimeout=setTimeout((function(){t._shakaCheckBandwidth(e)}),1e3))}},{key:"_hlsCheckBuffers",value:function(e){var t=this,n=this._media[e];if(n&&n.mediaElement){var r,i=n.mediaElement,o=i.buffered.length,a=i.currentTime,u=!1,l=[];if(o>0){for(r=0;r<o;r+=1){var c=i.buffered.start(r),d=i.buffered.end(r);a>c-.1&&a<d+.1&&(u=!0),l.push("HLS Buffers: ".concat(r," ")+"".concat(c,"-").concat(d," (CurrentTime: ").concat(a,")"))}!0!==u&&(s.default.warn("HLS Buffers bad, reset level"),l.forEach((function(e){s.default.warn(e)})),n._hls.currentLevel=n._hls.currentLevel)}}n._hlsCheckBufferTimeout=setTimeout((function(){t._hlsCheckBuffers(e)}),2e3)}},{key:"_printActiveMSEBuffers",value:function(){var e=this;if(this._activePlayer&&this._activePlayer.mediaElement){var t,n=this._activePlayer.mediaElement,r=n.buffered.length,i=n.currentTime,o=!1;for(t=0;t<r;t+=1){var a=n.buffered.start(t),u=n.buffered.end(t);console.log("BUFFER: Buffer Range ".concat(t,": ")+"".concat(a," - ")+"".concat(u)),i>a&&i<u&&(o=!0)}switch(this._activePlayer.mediaType){case T.DASH:var l=this._activePlayer._shaka.getVariantTracks().find((function(e){return e.active}));this._activePlayer._shakaRep!=="".concat(l.width,"x").concat(l.height)&&(this._activePlayer._shakaRep="".concat(l.width,"x").concat(l.height),console.log("Active DASH shaka is using representation: "+"".concat(l.width,"x").concat(l.height)));break;case T.HLS:break;default:s.default.error("Cannot handle this mediaType (_printActiveMSEBuffers)")}console.log("BUFFER: Current Time: ".concat(i)),!0!==o&&console.log("BUFFER WARNING: current playback time outside of buffered range"),console.log("BUFFER ---------")}setTimeout((function(){e._printActiveMSEBuffers()}),1e3)}},{key:"queuePlayout",value:function(e,n){b(E(t.prototype),"queuePlayout",this).call(this,e,n);var r=this._media[e];if(!r.mediaElement)if(r.media.type===o.MEDIA_TYPES.FOREGROUND_AV){var i=document.createElement("video");i.className="romper-video-element romper-media-element-queued",i.crossOrigin="anonymous",r.mediaElement=i,this._player.mediaTarget.appendChild(r.mediaElement)}else if(r.media.type===o.MEDIA_TYPES.FOREGROUND_A){var a=document.createElement("video");a.className="romper-audio-element romper-media-element-queued",a.crossOrigin="anonymous",r.mediaElement=a,this._player.mediaTarget.appendChild(r.mediaElement)}else{var s=document.createElement("audio");s.className="romper-audio-element romper-media-element-queued",s.crossOrigin="anonymous",r.mediaElement=s,this._player.backgroundTarget.appendChild(r.mediaElement)}n.url&&this._loadMedia(e),n.id&&(r.mediaElement.id=n.id),n.loop&&b(E(t.prototype),"setLoopAttribute",this).call(this,e,n.loop,r.mediaElement),n.inTime&&(r.mediaElement.currentTime=n.inTime),n.subs_url&&(this._queueSubtitleAttach(e),this._player.enableSubtitlesControl()),r.active&&this._playing&&this.play()}},{key:"_loadMedia",value:function(e){var t=this._media[e];if(t){var n,o=t.media.url;switch(t.mediaType=-1!==(n=o).indexOf(".m3u8")?T.HLS:-1!==n.indexOf(".mpd")?T.DASH:T.OTHER,t.mediaType){case T.HLS:this._useHlsJs?(t._hls=new r.default(this._inactiveConfig.hls),t._hls.loadSource(o),t._hls.attachMedia(t.mediaElement),this._hlsCheckBuffers(e)):t.mediaElement.src=o;break;case T.DASH:t._shaka=new i.default.Player(t.mediaElement),t._shaka.configure("streaming.bufferingGoal",this._inactiveConfig.dash.bufferingGoal),t._shaka.configure("abr.defaultBandwidthEstimate",this._estimatedBandwidth),t._shaka.configure("abr.bandwidthDowngradeTarget",.9),t._shaka.configure("abr.bandwidthUpgradeTarget",.8),t._shaka.load(o).then((function(){s.default.info("Loaded ".concat(o))})).catch((function(e){s.default.fatal("Could not load manifest ".concat(o),e)}));break;case T.OTHER:t.mediaElement.src=o;break;default:s.default.error("Cannot handle this mediaType (loadSource)")}}}},{key:"unqueuePlayout",value:function(e){var n=this._media[e];if(n){if(n.mediaType)switch(n.mediaType){case T.HLS:this._useHlsJs&&(n._hlsCheckBufferTimeout&&clearTimeout(n._hlsCheckBufferTimeout),n._hls.destroy());break;case T.OTHER:break;case T.DASH:n._shaka.unload(),n._shaka.destroy();break;default:s.default.error("Cannot handle this mediaType (unqueuePlayout)")}n.media.type===o.MEDIA_TYPES.FOREGROUND_AV||n.media.type===o.MEDIA_TYPES.FOREGROUND_A?this._player.mediaTarget.removeChild(n.mediaElement):this._player.backgroundTarget.removeChild(n.mediaElement),b(E(t.prototype),"unqueuePlayout",this).call(this,e)}}},{key:"setPlayoutActive",value:function(e){var n=this,i=this._media[e];if(!0===this._media[e].error&&this._player._showErrorLayer(),i&&!i.active){if(i.mediaType)switch(i.mediaType){case T.HLS:this._useHlsJs&&(i._hls.config=v({},i._hls.config,{},this._activeConfig.hls),this._debugPlayout&&u.allHlsEvents.forEach((function(e){i._hls.on(r.default.Events[e],(function(e){console.log("HLS EVENT: ",e)}))})));break;case T.DASH:i._shaka.configure("streaming.bufferingGoal",this._activeConfig.dash.bufferingGoal),i._shaka.configure("streaming.rebufferingGoal",5),this._shakaCheckBandwidth(e),i._shakaAdaptationHandler=this._ShakaAdaptationHandler(e),i._shaka.addEventListener("adaptation",i._shakaAdaptationHandler),i._shaka.addEventListener("buffering",(function(e){i._shaka.isBuffering()&&n._player._showBufferingLayer(),e.buffering||n._player._removeBufferingLayer()})),i._shaka.addEventListener(l.SHAKA_EVENTS.error,(function(e){if(e.detail&&e.detail.data){if(1001===e.detail.code&&404===e.detail.data[1])return void s.default.info("404 error failed to fetch media");n._player._showErrorLayer()}})),i._shaka.addEventListener("adaptation",this._player._removeErrorLayer),i._shaka.addEventListener("adaptation",this._player._removeBufferingLayer),this._debugPlayout&&u.allShakaEvents.forEach((function(e){i._shaka.addEventListener(e,(function(e){console.log("DASH SHAKA EVENT: ",e)}))}));break;case T.OTHER:break;default:s.default.error("Cannot handle this mediaType (loadSource)")}b(E(t.prototype),"setPlayoutActive",this).call(this,e),i.mediaElement.classList.remove("romper-media-element-queued"),this._debugPlayout&&(this._activePlayer=i,window.activePlayer=i),this._playing&&i.media&&i.media.url&&this.play(),i.media&&i.media.subs_src&&(this._showHideSubtitles(e),this._player.enableSubtitlesControl()),i.media&&i.media.type&&(i.media.type===o.MEDIA_TYPES.FOREGROUND_AV||i.media.type===o.MEDIA_TYPES.FOREGROUND_A?this._player.addVolumeControl(e,"Foreground"):this._player.addVolumeControl(e,"Background"))}}},{key:"setPlayoutInactive",value:function(e){var n=this._media[e];if(n&&n.active){if(n.mediaType)switch(n.mediaType){case T.HLS:this._useHlsJs&&(n._hls.config=v({},n._hls.config,{},this._inactiveConfig.hls));break;case T.DASH:n._shaka.configure("streaming.bufferingGoal",this._inactiveConfig.dash.bufferingGoal),n._shaka.removeEventListener("adaptation",n._shakaAdaptationHandler),n._shakaCheckBandwidthTimeout&&clearTimeout(n._shakaCheckBandwidthTimeout),n._shaka.removeEventListener(l.SHAKA_EVENTS.error,this._player._showErrorLayer),n._shaka.removeEventListener(l.SHAKA_EVENTS.buffering,this._player._showBufferingLayer),n._shaka.removeEventListener(l.SHAKA_EVENTS.adaptation,this._player._removeBufferingLayer),n._shaka.removeEventListener(l.SHAKA_EVENTS.adaptation,this._player._removeErrorLayer);break;case T.OTHER:break;default:s.default.error("Cannot handle this mediaType (setPlayoutInactive)")}this._player.disableSubtitlesControl(),n.mediaElement.pause(),n.mediaElement.classList.add("romper-media-element-queued"),b(E(t.prototype),"setPlayoutInactive",this).call(this,e),b(E(t.prototype),"removeLoopAttribute",this).call(this,e),this._player.removeVolumeControl(e)}}},{key:"_play",value:function(e){var t=this._media[e].mediaElement.play();void 0!==t&&t.then((function(){})).catch((function(e){s.default.warn(e,"DOMSwitchPlayotEngine Not got permission to play")}))}},{key:"play",value:function(){var e=this;this._playing=!0,this._hasStarted=!0,this._player.setPlaying(!0),Object.keys(this._media).filter((function(t){return e._media[t].active})).forEach((function(t){var n=e._media[t].mediaElement;if(n)if(n.readyState>=n.HAVE_CURRENT_DATA)e._play(t);else var r=setInterval((function(){n.play().then((function(){clearInterval(r)})).catch((function(e){s.default.warn(e," DOMSwitchPlayoutEngine set Timer Not got permission to play"),clearInterval(r)}))}),100);else setTimeout((function(){e._play(t)}),500)}))}},{key:"pause",value:function(){var e=this;this._playing=!1,this._player.setPlaying(!1),Object.keys(this._media).filter((function(t){return!(!e._media[t].media||e._media[t].media.type!==o.MEDIA_TYPES.FOREGROUND_AV&&e._media[t].media.type!==o.MEDIA_TYPES.FOREGROUND_A)})).forEach((function(t){e._media[t].mediaElement.pause()}))}},{key:"isPlaying",value:function(){return this._playing}},{key:"pauseBackgrounds",value:function(){var e=this;Object.keys(this._media).filter((function(t){return!(!e._media[t].media||e._media[t].media.type!==o.MEDIA_TYPES.BACKGROUND_A)})).forEach((function(t){e._media[t].mediaElement.pause()}))}},{key:"playBackgrounds",value:function(){var e=this;Object.keys(this._media).filter((function(t){return!(!e._media[t].media||e._media[t].media.type!==o.MEDIA_TYPES.BACKGROUND_A)&&e._media[t].active})).forEach((function(t){var n=e._media[t].mediaElement;n?n.readyState>=n.HAVE_CURRENT_DATA?e._play(t):n.addEventListener("loadeddata",(function r(){n.removeEventListener("loadeddata",r),e._play(t)})):setTimeout((function(){e._play(t)}),500)}))}},{key:"getCurrentTime",value:function(e){var t=this._media[e];if(t&&t.mediaElement){var n=t.mediaElement;if(n&&!(n.readyState<n.HAVE_CURRENT_DATA))return n.currentTime}}},{key:"getDuration",value:function(e){var t=this._media[e];if(t&&t.mediaElement){var n=this.getMediaElement(e);if(n&&!(n.readyState<n.HAVE_CURRENT_DATA))return n.duration}}},{key:"setCurrentTime",value:function(e,t){var n=this._media[e];if(!n||!n.mediaElement)return!1;var r=n.mediaElement;if(r.readyState>=r.HAVE_CURRENT_DATA)r.currentTime=t;else{var i=!1;r.addEventListener("loadeddata",(function(){i||(r.currentTime=t,i=!0)})),r.addEventListener("timeupdate",(function(){i||(r.currentTime=t,i=!0)}))}return!0}},{key:"on",value:function(e,t,n){var r=this._media[e];r&&r.mediaElement&&r.mediaElement.addEventListener(t,n)}},{key:"off",value:function(e,t,n){var r=this._media[e];r&&r.mediaElement&&r.mediaElement.removeEventListener(t,n)}},{key:"getMediaElement",value:function(e){var t=this._media[e];return t&&t.mediaElement?t.mediaElement:document.createElement("video")}},{key:"_handlePlayPauseButtonClicked",value:function(){var e=this;!1===this._playing?this.play():this.pause(),Object.keys(this._media).filter((function(t){return e._media[t].active})).forEach((function(t){e._media[t].media&&e._media[t].media.playPauseHandler&&e._media[t].media.playPauseHandler()}))}},{key:"_handleSubtitlesClicked",value:function(){var e=this;this._subtitlesShowing=!this._subtitlesShowing,Object.keys(this._media).filter((function(t){return!(!e._media[t].media||e._media[t].media.type!==o.MEDIA_TYPES.FOREGROUND_AV&&e._media[t].media.type!==o.MEDIA_TYPES.FOREGROUND_A)})).forEach((function(t){e._showHideSubtitles(t)}))}},{key:"_handleVolumeClicked",value:function(e){var t=this._media[e.id];t&&t.mediaElement&&(t.mediaElement.volume=e.value)}},{key:"_toggleMute",value:function(e){var t=this._media[e.id];t&&t.mediaElement&&(t.mediaElement.muted=e.muted)}},{key:"_queueSubtitleAttach",value:function(e){var t=this,n=this._media[e];if(n){var r=n.mediaElement;r?r.addEventListener("loadedmetadata",(function(){t._showHideSubtitles(e)})):setTimeout((function(){t._queueSubtitleAttach(e)}),1e3)}}},{key:"_cleanUpSubtitles",value:function(e){var t=this._media[e];if(t){var n=t.mediaElement;if(t.mediaSubsTrack){t.mediaSubsTrack.mode="hidden",n.textTracks[0]&&(n.textTracks[0].mode="hidden");var r=t.mediaSubsTrack.parentNode;r&&r.removeChild(t.mediaSubsTrack)}}}},{key:"_showHideSubtitles",value:function(e){var t=this._media[e];if(t){this._cleanUpSubtitles(e);var n=t.mediaElement;t.media.subs_url&&this._subtitlesShowing&&(t.mediaSubsTrack=document.createElement("track"),t.mediaSubsTrack.kind="captions",t.mediaSubsTrack.label="English",t.mediaSubsTrack.srclang="en",t.mediaSubsTrack.src=t.media.subs_url,t.mediaSubsTrack.default=!1,n.appendChild(t.mediaSubsTrack),t.mediaSubsTrack.mode="showing",n.textTracks[0]&&(n.textTracks[0].mode="showing"))}}}])&&y(n.prototype,d),h&&y(n,h),t}(o.default);t.default=S},"./src/playoutEngines/SrcSwitchPlayoutEngine.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.symbol.js"),n("./node_modules/core-js/modules/es.symbol.description.js"),n("./node_modules/core-js/modules/es.symbol.iterator.js"),n("./node_modules/core-js/modules/es.array.filter.js"),n("./node_modules/core-js/modules/es.array.find-index.js"),n("./node_modules/core-js/modules/es.array.for-each.js"),n("./node_modules/core-js/modules/es.array.index-of.js"),n("./node_modules/core-js/modules/es.array.iterator.js"),n("./node_modules/core-js/modules/es.array.splice.js"),n("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),n("./node_modules/core-js/modules/es.object.get-prototype-of.js"),n("./node_modules/core-js/modules/es.object.keys.js"),n("./node_modules/core-js/modules/es.object.set-prototype-of.js"),n("./node_modules/core-js/modules/es.object.to-string.js"),n("./node_modules/core-js/modules/es.reflect.get.js"),n("./node_modules/core-js/modules/es.string.iterator.js"),n("./node_modules/core-js/modules/web.dom-collections.for-each.js"),n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=c(n("./src/playoutEngines/BasePlayoutEngine.js")),i=u(n("./src/playoutEngines/srcSwitchPlayoutEngine/MediaManager.js")),o=c(n("./src/Player.js")),a=n("./src/browserCapabilities.js"),s=u(n("./src/logger.js"));function u(e){return e&&e.__esModule?e:{default:e}}function l(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return l=function(){return e},e}function c(e){if(e&&e.__esModule)return e;if(null===e||"object"!==d(e)&&"function"!=typeof e)return{default:e};var t=l();if(t&&t.has(e))return t.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=r?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(n,i,o):n[i]=e[i]}return n.default=e,t&&t.set(e,n),n}function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e,t,n){return(p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=m(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var g=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?f(e):t}(this,m(t).call(this,e,n)))._foregroundMediaElement=document.createElement("video"),r._foregroundMediaElement.className="romper-video-element",r._foregroundMediaElement.crossOrigin="anonymous",r._backgroundMediaElement=document.createElement("audio"),r._backgroundMediaElement.className="romper-audio-element",r._backgroundMediaElement.crossOrigin="anonymous",(a.BrowserUserAgent.iOS()||a.BrowserUserAgent.isSafari())&&(r._foregroundMediaElement.autoplay=!0,r._backgroundMediaElement.autoplay=!0,r._foregroundMediaElement.setAttribute("disablePictureInPicture","true"),r._foregroundMediaElement.setAttribute("playsinline","true"),r._foregroundMediaElement.setAttribute("webkit-playsinline","true"),r._foregroundMediaElement.setAttribute("controls","false"),r._backgroundMediaElement.setAttribute("disablePictureInPicture","true"),r._backgroundMediaElement.setAttribute("playsinline","true"),r._backgroundMediaElement.setAttribute("webkit-playsinline","true"),r._backgroundMediaElement.setAttribute("controls","false")),r._player.mediaTarget.appendChild(r._foregroundMediaElement),r._player.backgroundTarget.appendChild(r._backgroundMediaElement),r._playing=!1,r._subtitlesShowing=!1,r._mediaManager=new i.default(r._foregroundMediaElement,r._backgroundMediaElement,r._debugPlayout),r._handlePlayPauseButtonClicked=r._handlePlayPauseButtonClicked.bind(f(r)),r._handleSubtitlesClicked=r._handleSubtitlesClicked.bind(f(r)),r._handleVolumeClicked=r._handleVolumeClicked.bind(f(r)),r._toggleMute=r._toggleMute.bind(f(r)),r._showHideSubtitles=r._showHideSubtitles.bind(f(r)),r._queueSubtitleAttach=r._queueSubtitleAttach.bind(f(r)),r._player.on(o.PlayerEvents.PLAY_PAUSE_BUTTON_CLICKED,r._handlePlayPauseButtonClicked),r._player.on(o.PlayerEvents.SUBTITLES_BUTTON_CLICKED,r._handleSubtitlesClicked),r._player.on(o.PlayerEvents.VOLUME_CHANGED,r._handleVolumeClicked),r._player.on(o.PlayerEvents.VOLUME_MUTE_TOGGLE,r._toggleMute),r}var n,u,l;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(t,e),n=t,(u=[{key:"setPermissionToPlay",value:function(e){this._backgroundMediaElement.play(),this._foregroundMediaElement.play(),this._backgroundMediaElement.pause(),this._foregroundMediaElement.pause(),this._mediaManager.setPermissionToPlay(e),p(m(t.prototype),"setPermissionToPlay",this).call(this,e)}},{key:"queuePlayout",value:function(e,n){p(m(t.prototype),"queuePlayout",this).call(this,e,n);var i=this._media[e];if(!i.mediaInstance)if(i.media.type===r.MEDIA_TYPES.FOREGROUND_AV){i.mediaInstance=this._mediaManager.getMediaInstance("foreground");var o=document.createElement("video");o.className="romper-video-element romper-media-element-queued",o.crossOrigin="anonymous",i.mediaInstance.attachMedia(o)}else if(i.media.type===r.MEDIA_TYPES.FOREGROUND_A){i.mediaInstance=this._mediaManager.getMediaInstance("foreground");var a=document.createElement("video");a.className="romper-audio-element romper-media-element-queued",a.crossOrigin="anonymous",i.mediaInstance.attachMedia(a)}else{i.mediaInstance=this._mediaManager.getMediaInstance("background");var s=document.createElement("audio");s.className="romper-audio-element romper-media-element-queued",s.crossOrigin="anonymous",i.mediaInstance.attachMedia(s)}if(n.url&&i.mediaInstance.loadSource(n.url),n.loop&&p(m(t.prototype),"setLoopAttribute",this).call(this,e,n.loop,i.mediaInstance.getMediaElement()),n.id){var u=i.mediaInstance.getMediaElement();u&&(u.id=n.id)}if(n.inTime){var l=i.mediaInstance.getMediaElement();l&&(l.currentTime=n.inTime)}n.subs_url&&(this._player.enableSubtitlesControl(),i.active&&this._queueSubtitleAttach(e)),i.active&&this._playing&&this.play()}},{key:"unqueuePlayout",value:function(e){var n=this._media[e];n&&(this._cleanUpSubtitles(e),this._mediaManager.returnMediaInstance(n.mediaInstance),p(m(t.prototype),"unqueuePlayout",this).call(this,e))}},{key:"setPlayoutActive",value:function(e){var n=this._media[e];if(n&&!n.active&&(n.mediaInstance.start(),p(m(t.prototype),"setPlayoutActive",this).call(this,e),this._playing&&n.media&&n.media.url&&this.play(),n.media&&n.media.subs_url&&(this._queueSubtitleAttach(e),this._player.enableSubtitlesControl()),n.media&&n.media.type&&(n.media.type===r.MEDIA_TYPES.FOREGROUND_AV?this._player.addVolumeControl(e,"Foreground"):this._player.addVolumeControl(e,"Background")),n.queuedEvents&&n.queuedEvents.length>0)){s.default.info("Applying queued events for ".concat(e));var i=n.mediaInstance.getMediaElement();n.queuedEvents.forEach((function(e){i.addEventListener(e.event,e.callback)})),n.queuedEvents=[]}}},{key:"setPlayoutInactive",value:function(e){var n=this._media[e];n&&n.active&&(this._cleanUpSubtitles(e),this._player.disableSubtitlesControl(),n.mediaInstance.pause(),p(m(t.prototype),"setPlayoutInactive",this).call(this,e),p(m(t.prototype),"removeLoopAttribute",this).call(this,e),this._player.removeVolumeControl(e))}},{key:"setPlayoutVisible",value:function(e){}},{key:"play",value:function(){var e=this;this._playing=!0,this._hasStarted=!0,this._player.setPlaying(!0),Object.keys(this._media).filter((function(t){return e._media[t].active})).forEach((function(t){e._media[t].mediaInstance.play()}))}},{key:"pause",value:function(){var e=this;this._playing=!1,this._player.setPlaying(!1),Object.keys(this._media).filter((function(t){return!(!e._media[t].media||e._media[t].media.type!==r.MEDIA_TYPES.FOREGROUND_AV&&e._media[t].media.type!==r.MEDIA_TYPES.FOREGROUND_A)})).forEach((function(t){e._media[t].mediaInstance.pause()}))}},{key:"isPlaying",value:function(){return this._playing}},{key:"pauseBackgrounds",value:function(){var e=this;Object.keys(this._media).filter((function(t){return!(!e._media[t].media||e._media[t].media.type!==r.MEDIA_TYPES.BACKGROUND_A)})).forEach((function(t){e._media[t].mediaInstance.pause()}))}},{key:"playBackgrounds",value:function(){var e=this;Object.keys(this._media).filter((function(t){return!(!e._media[t].media||e._media[t].media.type!==r.MEDIA_TYPES.BACKGROUND_A||!e._media[t].active)})).forEach((function(t){e._media[t].mediaInstance.play()}))}},{key:"getCurrentTime",value:function(e){var t=this._media[e];if(t&&t.mediaInstance){var n=t.mediaInstance.getMediaElement();if(n&&!(n.readyState<n.HAVE_CURRENT_DATA))return n.currentTime}}},{key:"setCurrentTime",value:function(e,t){var n=this._media[e];if(!n||!n.mediaInstance)return!1;var r=n.mediaInstance.getMediaElement();if(r.readyState>=r.HAVE_CURRENT_DATA){r.currentTime=t;var o=function e(){r.currentTime=t,r.removeEventListener("canplay",e),r.removeEventListener("loadeddata",e)};r.addEventListener("canplay",o),r.addEventListener("loadeddata",o)}else if(-1!==r.src.indexOf("m3u8"))n.mediaInstance.on(i.default.Events.MANIFEST_PARSED,(function(){r.currentTime=t;var e=function e(){r.currentTime=t,r.removeEventListener("canplay",e),r.removeEventListener("loadeddata",e)};r.addEventListener("canplay",e),r.addEventListener("loadeddata",e)}));else{var a=!1;r.addEventListener("loadeddata",(function(){if(!a){r.currentTime=t;var e=function e(){r.currentTime=t,r.removeEventListener("canplay",e),r.removeEventListener("loadeddata",e)};r.addEventListener("canplay",e),r.addEventListener("loadeddata",e),a=!0}})),r.addEventListener("timeupdate",(function(){if(!a){r.currentTime=t;var e=function e(){r.currentTime=t,r.removeEventListener("canplay",e),r.removeEventListener("loadeddata",e)};r.addEventListener("canplay",e),r.addEventListener("loadeddata",e),a=!0}}))}return!0}},{key:"on",value:function(e,t,n){var r=this._media[e];if(r&&r.mediaInstance){var i=r.mediaInstance.getMediaElement();r.active?i.addEventListener(t,n):(r.queuedEvents||(r.queuedEvents=[]),r.queuedEvents.push({event:t,callback:n}))}}},{key:"off",value:function(e,t,n){var r=this._media[e];if(r&&r.mediaInstance){var i=r.mediaInstance.getMediaElement();if(r.active)i.removeEventListener(t,n);else if(r.queuedEvents){var o=r.queuedEvents.findIndex((function(e){return e.event===t&&e.callback===n}));-1!==o&&r.queuedEvents.splice(o,1)}}}},{key:"getMediaElement",value:function(e){var t=this._media[e];return t&&t.mediaInstance?t.mediaInstance.getMediaElement():document.createElement("video")}},{key:"_handlePlayPauseButtonClicked",value:function(){var e=this;!1===this._playing?this.play():this.pause(),Object.keys(this._media).filter((function(t){return e._media[t].active})).forEach((function(t){e._media[t].media&&e._media[t].media.playPauseHandler&&e._media[t].media.playPauseHandler()}))}},{key:"_handleSubtitlesClicked",value:function(){var e=this;this._subtitlesShowing=!this._subtitlesShowing,Object.keys(this._media).filter((function(t){return e._media[t].active})).forEach((function(t){e._showHideSubtitles(t)}))}},{key:"_handleVolumeClicked",value:function(e){var t=this._media[e.id];t&&t.mediaInstance&&t.mediaInstance.setVolume(e.value)}},{key:"_toggleMute",value:function(e){var t=this._media[e.id];t&&t.mediaInstance&&t.mediaInstance.toggleMute(e.muted)}},{key:"_queueSubtitleAttach",value:function(e){var t=this,n=this._media[e];if(n){var r=n.mediaInstance.getMediaElement();r?r.addEventListener("loadedmetadata",(function(){t._showHideSubtitles(e)})):setTimeout((function(){t._queueSubtitleAttach(e)}),1e3)}}},{key:"_cleanUpSubtitles",value:function(e){var t=this._media[e];if(t){var n=t.mediaInstance.getMediaElement();if(t.mediaSubsTrack){t.mediaSubsTrack.mode="hidden",n.textTracks[0]&&(n.textTracks[0].mode="hidden");var r=t.mediaSubsTrack.parentNode;r&&r.removeChild(t.mediaSubsTrack)}}}},{key:"_showHideSubtitles",value:function(e){var t=this._media[e];if(t&&(this._cleanUpSubtitles(e),t.active)){var n=t.mediaInstance.getMediaElement();t.media.subs_url&&this._subtitlesShowing&&(t.mediaSubsTrack=document.createElement("track"),t.mediaSubsTrack.kind="captions",t.mediaSubsTrack.label="English",t.mediaSubsTrack.srclang="en",t.mediaSubsTrack.src=t.media.subs_url,t.mediaSubsTrack.default=!1,n.appendChild(t.mediaSubsTrack),t.mediaSubsTrack.mode="showing",n.textTracks[0]&&(n.textTracks[0].mode="showing"))}}}])&&h(n.prototype,u),l&&h(n,l),t}(r.default);t.default=g},"./src/playoutEngines/iOSPlayoutEngine.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.symbol.js"),n("./node_modules/core-js/modules/es.symbol.description.js"),n("./node_modules/core-js/modules/es.symbol.iterator.js"),n("./node_modules/core-js/modules/es.array.filter.js"),n("./node_modules/core-js/modules/es.array.find-index.js"),n("./node_modules/core-js/modules/es.array.for-each.js"),n("./node_modules/core-js/modules/es.array.iterator.js"),n("./node_modules/core-js/modules/es.array.splice.js"),n("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),n("./node_modules/core-js/modules/es.object.get-prototype-of.js"),n("./node_modules/core-js/modules/es.object.keys.js"),n("./node_modules/core-js/modules/es.object.set-prototype-of.js"),n("./node_modules/core-js/modules/es.object.to-string.js"),n("./node_modules/core-js/modules/es.reflect.get.js"),n("./node_modules/core-js/modules/es.string.iterator.js"),n("./node_modules/core-js/modules/web.dom-collections.for-each.js"),n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=u(n("./src/playoutEngines/BasePlayoutEngine.js")),i=(a(n("./src/playoutEngines/srcSwitchPlayoutEngine/MediaManager.js")),u(n("./src/Player.js"))),o=a(n("./src/logger.js"));function a(e){return e&&e.__esModule?e:{default:e}}function s(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return s=function(){return e},e}function u(e){if(e&&e.__esModule)return e;if(null===e||"object"!==l(e)&&"function"!=typeof e)return{default:e};var t=s();if(t&&t.has(e))return t.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=r?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(n,i,o):n[i]=e[i]}return n.default=e,t&&t.set(e,n),n}function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e,t,n){return(h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var m=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?d(e):t}(this,f(t).call(this,e,n)))._foregroundMediaElement=document.createElement("video"),r._foregroundMediaElement.className="romper-video-element",r._foregroundMediaElement.crossOrigin="anonymous",r._backgroundMediaElement=document.createElement("audio"),r._backgroundMediaElement.className="romper-audio-element",r._backgroundMediaElement.crossOrigin="anonymous",r._foregroundMediaElement.autoplay=!0,r._backgroundMediaElement.autoplay=!0,r._foregroundMediaElement.removeAttribute("controls"),r._backgroundMediaElement.removeAttribute("controls"),r._foregroundMediaElement.setAttribute("playsinline","true"),r._backgroundMediaElement.setAttribute("playsinline","true"),r._foregroundMediaElement.setAttribute("webkit-playsinline","true"),r._backgroundMediaElement.setAttribute("webkit-playsinline","true"),r._foregroundMediaElement.setAttribute("disablePictureInPicture","true"),r._backgroundMediaElement.setAttribute("disablePictureInPicture","true"),r._player.mediaTarget.appendChild(r._foregroundMediaElement),r._player.backgroundTarget.appendChild(r._backgroundMediaElement),r._playing=!1,r._subtitlesShowing=!1,r._handlePlayPauseButtonClicked=r._handlePlayPauseButtonClicked.bind(d(r)),r._handleSubtitlesClicked=r._handleSubtitlesClicked.bind(d(r)),r._handleVolumeClicked=r._handleVolumeClicked.bind(d(r)),r._toggleMute=r._toggleMute.bind(d(r)),r._showHideSubtitles=r._showHideSubtitles.bind(d(r)),r._queueSubtitleAttach=r._queueSubtitleAttach.bind(d(r)),r._player.on(i.PlayerEvents.PLAY_PAUSE_BUTTON_CLICKED,r._handlePlayPauseButtonClicked),r._player.on(i.PlayerEvents.SUBTITLES_BUTTON_CLICKED,r._handleSubtitlesClicked),r._player.on(i.PlayerEvents.VOLUME_CHANGED,r._handleVolumeClicked),r._player.on(i.PlayerEvents.VOLUME_MUTE_TOGGLE,r._toggleMute),r}var n,a,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,e),n=t,(a=[{key:"setPermissionToPlay",value:function(e){this._backgroundMediaElement.play(),this._foregroundMediaElement.play(),this._backgroundMediaElement.pause(),this._foregroundMediaElement.pause(),h(f(t.prototype),"setPermissionToPlay",this).call(this,e)}},{key:"attachEverythingToActive",value:function(e){var n,i=this._media[e],a=this._media[e].media;a&&(a.type&&(a.type===r.MEDIA_TYPES.FOREGROUND_AV?(n=this._foregroundMediaElement,a.url&&(n.src=a.url),this._player.addVolumeControl(e,"Foreground")):a.type===r.MEDIA_TYPES.BACKGROUND_A&&(n=this._backgroundMediaElement,a.url&&(n.src=a.url,n.play()),this._player.addVolumeControl(e,"Background")),i.queuedEvents&&i.queuedEvents.length>0&&(o.default.info("Applying queued events for ".concat(e)),i.queuedEvents.forEach((function(e){n.addEventListener(e.event,e.callback)})),i.queuedEvents=[]),a.loop&&h(f(t.prototype),"setLoopAttribute",this).call(this,e,a.loop,n)),a.subs_url&&(this._player.enableSubtitlesControl(),this._queueSubtitleAttach(e)),a.id&&(this._foregroundMediaElement.id=a.id),a.inTime&&(this._foregroundMediaElement.currentTime=a.inTime),a.url&&this._playing&&this.play())}},{key:"removeEverythingFromActive",value:function(e){this._player.removeVolumeControl(e);var t=this._media[e];if(t){var n=t.media;if(n.type===r.MEDIA_TYPES.FOREGROUND_AV){this._cleanUpSubtitles(e),this._player.disableSubtitlesControl();var i=this._foregroundMediaElement;n.url&&n.url===i.src&&this._foregroundMediaElement.pause()}else if(n.type===r.MEDIA_TYPES.BACKGROUND_A){var o=this._backgroundMediaElement;n.url&&n.url===o.src&&this._backgroundMediaElement.pause()}}}},{key:"queuePlayout",value:function(e,n){h(f(t.prototype),"queuePlayout",this).call(this,e,n),this._media[e].active&&this.attachEverythingToActive(e)}},{key:"unqueuePlayout",value:function(e){this._media[e]&&h(f(t.prototype),"unqueuePlayout",this).call(this,e)}},{key:"setPlayoutActive",value:function(e){var n=this._media[e];n&&(n.active||this.attachEverythingToActive(e),h(f(t.prototype),"setPlayoutActive",this).call(this,e))}},{key:"setPlayoutInactive",value:function(e){var n=this._media[e];n&&(n.active&&this.removeEverythingFromActive(e),h(f(t.prototype),"setPlayoutInactive",this).call(this,e),h(f(t.prototype),"removeLoopAttribute",this).call(this,e))}},{key:"setPlayoutVisible",value:function(e){}},{key:"play",value:function(){var e=this;this._player.setPlaying(!0),this._playing=!0,this._hasStarted=!0,Object.keys(this._media).filter((function(t){return e._media[t].active})).filter((function(t){return e._media[t].media&&e._media[t].media.type===r.MEDIA_TYPES.FOREGROUND_AV})).length>0&&this._foregroundMediaElement.play()}},{key:"pause",value:function(){this._playing=!1,this._player.setPlaying(!1),this._foregroundMediaElement.pause()}},{key:"isPlaying",value:function(){return this._playing}},{key:"pauseBackgrounds",value:function(){this._backgroundMediaElement.pause()}},{key:"playBackgrounds",value:function(){var e=this;Object.keys(this._media).filter((function(t){return e._media[t].active})).filter((function(t){return e._media[t].media&&e._media[t].media.type===r.MEDIA_TYPES.BACKGROUND_A})).length>0&&this._backgroundMediaElement.play()}},{key:"getCurrentTime",value:function(e){var t=this._media[e];if(t){if(!t.active)return 0;var n=this.getMediaElement(e);if(n&&!(n.readyState<n.HAVE_CURRENT_DATA))return n.currentTime}}},{key:"setCurrentTime",value:function(e,t){if(!this._media[e])return!1;var n=this.getMediaElement(e);if(!n)return!1;if(n.readyState>=n.HAVE_CURRENT_DATA){n.currentTime=t;var r=function e(){n.currentTime=t,n.removeEventListener("canplay",e),n.removeEventListener("loadeddata",e)};return n.addEventListener("canplay",r),n.addEventListener("loadeddata",r),!0}return!1}},{key:"on",value:function(e,t,n){var r=this._media[e];if(r){var i=n;"ended"===t&&(n=function(e){void 0===e||e.target.duration?i(e):o.default.info("Received ended event with no duration. Assuming event is invalid")},r._endedCallback=n);var a=this.getMediaElement(e);a&&r.active?a.addEventListener(t,n):(r.queuedEvents||(r.queuedEvents=[]),r.queuedEvents.push({event:t,callback:n}))}}},{key:"off",value:function(e,t,n){var r=this._media[e];if(r){"ended"===t&&r._endedCallback&&(n=r._endedCallback);var i=this.getMediaElement(e);if(i&&r.active)i.removeEventListener(t,n);else if(r.queuedEvents){var o=r.queuedEvents.findIndex((function(e){return e.event===t&&e.callback===n}));-1!==o&&r.queuedEvents.splice(o,1)}}}},{key:"getMediaElement",value:function(e){var t=this._media[e];if(t&&t.media&&t.media.type&&t.active)return t.media.type===r.MEDIA_TYPES.FOREGROUND_AV?this._foregroundMediaElement:this._backgroundMediaElement}},{key:"_handlePlayPauseButtonClicked",value:function(){var e=this;!1===this._playing?this.play():this.pause(),Object.keys(this._media).filter((function(t){return e._media[t].active})).forEach((function(t){e._media[t].media&&e._media[t].media.playPauseHandler&&e._media[t].media.playPauseHandler()}))}},{key:"_handleSubtitlesClicked",value:function(){var e=this;this._subtitlesShowing=!this._subtitlesShowing,Object.keys(this._media).filter((function(t){return e._media[t].active})).forEach((function(t){e._showHideSubtitles(t)}))}},{key:"_handleVolumeClicked",value:function(e){if(this._media[e.id]){var t=this.getMediaElement(e.id);t&&(t.volume=e.value)}}},{key:"_toggleMute",value:function(e){if(this._media[e.id]){var t=this.getMediaElement(e.id);t&&(t.muted=e.muted)}}},{key:"_queueSubtitleAttach",value:function(e){var t=this;if(this._media[e]){var n=this.getMediaElement(e);n?n.addEventListener("loadedmetadata",(function(){t._showHideSubtitles(e)})):setTimeout((function(){t._queueSubtitleAttach(e)}),1e3)}}},{key:"_cleanUpSubtitles",value:function(e){var t=this._media[e];if(t){var n=this.getMediaElement(e);if(n&&t.mediaSubsTrack){t.mediaSubsTrack.mode="hidden",n.textTracks[0]&&(n.textTracks[0].mode="hidden");var r=t.mediaSubsTrack.parentNode;r&&r.removeChild(t.mediaSubsTrack)}}}},{key:"_showHideSubtitles",value:function(e){var t=this._media[e];if(t&&(this._cleanUpSubtitles(e),t.active)){var n=this.getMediaElement(e);if(!n)return;t.media.subs_url&&this._subtitlesShowing&&(t.mediaSubsTrack=document.createElement("track"),t.mediaSubsTrack.kind="captions",t.mediaSubsTrack.label="English",t.mediaSubsTrack.srclang="en",t.mediaSubsTrack.src=t.media.subs_url,t.mediaSubsTrack.default=!1,n.appendChild(t.mediaSubsTrack),t.mediaSubsTrack.mode="showing",n.textTracks[0]&&(n.textTracks[0].mode="showing"))}}}])&&c(n.prototype,a),s&&c(n,s),t}(r.default);t.default=m},"./src/playoutEngines/playoutEngineConsts.js":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.allShakaEvents=t.allDashEvents=t.allHlsEvents=void 0;t.allHlsEvents=["MEDIA_ATTACHING","MEDIA_ATTACHED","MEDIA_DETACHING","MEDIA_DETACHED","BUFFER_RESET","BUFFER_CODECS","BUFFER_CREATED","BUFFER_APPENDING","BUFFER_APPENDED","BUFFER_EOS","BUFFER_FLUSHING","BUFFER_FLUSHED","MANIFEST_LOADING","MANIFEST_LOADED","MANIFEST_PARSED","LEVEL_SWITCHING","LEVEL_SWITCHED","LEVEL_LOADING","LEVEL_LOADED","LEVEL_UPDATED","LEVEL_PTS_UPDATED","AUDIO_TRACKS_UPDATED","AUDIO_TRACK_SWITCHING","AUDIO_TRACK_SWITCHED","AUDIO_TRACK_LOADING","AUDIO_TRACK_LOADED","INIT_PTS_FOUND","FRAG_LOADING","FRAG_LOAD_PROGRESS","FRAG_LOAD_EMERGENCY_ABORTED","FRAG_LOADED","FRAG_DECRYPTED","FRAG_PARSING_INIT_SEGMENT","FRAG_PARSING_USERDATA","FRAG_PARSING_METADATA","FRAG_PARSING_DATA","FRAG_PARSED","FRAG_BUFFERED","FRAG_CHANGED","FPS_DROP","FPS_DROP_LEVEL_CAPPING","ERROR","DESTROYING","KEY_LOADING","KEY_LOADED","STREAM_STATE_TRANSITION"];t.allDashEvents=["CAN_PLAY","PLAYBACK_PAUSED","PLAYBACK_TIME_UPDATED","PLAYBACK_PLAYING","PLAYBACK_ENDED","PLAYBACK_ERROR","PLAYBACK_STALLED","PLAYBACK_WAITING","PLAYBACK_NOT_ALLOWED","PLAYBACK_RATE_CHANGED","PLAYBACK_SEEK_ASKED","PLAYBACK_SEEKED","PLAYBACK_SEEKING","PLAYBACK_STARTED","ERROR","STREAM_INITIALIZED","SOURCE_INITIALIZED","STREAM_TEARDOWN_COMPLETE"];t.allShakaEvents=["abrstatuschanged","adaptation","buffering","drmsessionupdate","emsg","error","expirationupdated","largegap","loading","manifestparsed","onstatechange","onstateidle","streaming","textchanged","texttrackvisibility","timelineregionadded","timelineregionenter","timelineregionexit","trackschanged","unloading","variantchanged","retry","caststatuschanged"]},"./src/playoutEngines/srcSwitchPlayoutEngine/MediaInstance.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.symbol.js"),n("./node_modules/core-js/modules/es.array.filter.js"),n("./node_modules/core-js/modules/es.array.for-each.js"),n("./node_modules/core-js/modules/es.array.index-of.js"),n("./node_modules/core-js/modules/es.array.splice.js"),n("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),n("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),n("./node_modules/core-js/modules/es.object.keys.js"),n("./node_modules/core-js/modules/web.dom-collections.for-each.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n("./node_modules/hls.js/dist/hls.js")),i=a(n("./node_modules/shaka-player/dist/shaka-player.compiled.js")),o=a(n("./src/logger.js"));function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var h={};["HLS","DASH","OTHER"].forEach((function(e){h[e]=e}));var f=function(){function e(t,n,r,i,a,s){var u=arguments.length>6&&void 0!==arguments[6]&&arguments[6];c(this,e),this._eventList=[],this._permissionToPlay=t,this._sourceLoaded=!1,this._id=i,this._useHlsJs=a,this._mountedMediaElement=s,this._debug=u,this._activeConfig=n,this._inactiveConfig=r,this._loadSourceQueue=[],this._playCallback=this._playCallback.bind(this),this._debug&&o.default.info("MediaInstance ".concat(this._id,": Created"))}var t,n,a;return t=e,(n=[{key:"_hlsErrorHandler",value:function(e,t){if(t.fatal)switch(t.type){case r.default.ErrorTypes.NETWORK_ERROR:o.default.warn("fatal network error encountered, try to recover"),this._hls.startLoad();break;case r.default.ErrorTypes.MEDIA_ERROR:o.default.warn("fatal media error encountered, try to recover"),this._hls.recoverMediaError();break;default:o.default.fatal("fatal media error, cannot recover"),this._hls.destroy()}}},{key:"getId",value:function(){return this._id}},{key:"getMediaElement",value:function(){return this._mediaElement}},{key:"_playCallback",value:function(){this._mediaElement.removeEventListener("loadeddata",this._playCallback),this._play()}},{key:"_play",value:function(){var e=this._mediaElement.play();void 0!==e&&e.then((function(){})).catch((function(e){o.default.warn(e,"Media Instance Not got permission to play")}))}},{key:"play",value:function(){var e=this;this._sourceLoaded?this._permissionToPlay()?this._mediaElement?this._mediaElement.readyState>=this._mediaElement.HAVE_CURRENT_DATA?this._play():this._mediaElement.addEventListener("loadeddata",this._playCallback):o.default.warn("Trying to play without a HTMLMediaElement"):o.default.info("Not got permission to play"):(o.default.info("Queued method: play"),this._loadSourceQueue.push((function(){return e.play()})))}},{key:"pause",value:function(){var e=this;if(this._sourceLoaded)if(this._mediaElement){var t=this._mediaElement.pause();void 0!==t&&t.then((function(){})).catch((function(e){o.default.warn(e,"Not got permission to pause")}))}else o.default.warn("Trying to pause without a HTMLMediaElement");else o.default.info("Queued method: pause"),this._loadSourceQueue.push((function(){return e.pause()}))}},{key:"start",value:function(){var e=this;if(this._mediaElement=this._mountedMediaElement,this._sourceLoaded)switch(this._mediaType){case h.HLS:this._useHlsJs?(this.detachMedia(),this.attachMedia(this._mediaElement),this._hls.config=u({},this._hls.config,{},this._activeConfig.hls)):this.loadSource(this._mediaSrc);break;case h.DASH:this.attachMedia(this._mediaElement);break;case h.OTHER:this.loadSource(this._mediaSrc),this.play();break;default:o.default.error("Cannot handle this mediaType (loadSource)")}else o.default.info("Queued method: start"),this._loadSourceQueue.push((function(){return e.start()}))}},{key:"end",value:function(){var e=this;if(this._sourceLoaded){switch(this._mediaType){case h.HLS:this._useHlsJs&&(this.detachMedia(),this._hls.config=u({},this._hls.config,{},this._inactiveConfig.hls));break;case h.DASH:case h.OTHER:this.detachMedia();break;default:o.default.error("Cannot handle this mediaType (loadSource)")}this._mediaSrc=""}else o.default.info("Queued method: end"),this._loadSourceQueue.push((function(){return e.end()}))}},{key:"loadSource",value:function(e){var t=this;switch(this._debug&&o.default.info("MediaInstance ".concat(this._id,": loadSource")),this._mediaSrc=e,this._mediaType=function(e){return-1!==e.indexOf(".m3u8")?h.HLS:-1!==e.indexOf(".mpd")?h.DASH:h.OTHER}(this._mediaSrc),this._mediaType){case h.HLS:this._useHlsJs?(this._hls=new r.default(this._inactiveConfig.hls),this.on(r.default.Events.ERROR,this._hlsErrorHandler.bind(this)),this._hls.loadSource(this._mediaSrc),this._mediaElement&&this._hls.attachMedia(this._mediaElement)):this._mediaElement.src=this._mediaSrc;break;case h.DASH:this._shaka=new i.default.Player(this._mediaElement),this._shaka.load(this._mediaSrc).then((function(){o.default.info("Loaded ".concat(t._mediaSrc))})).catch((function(e){o.default.fatal("Could not load manifest ".concat(t._mediaSrc),e)}));break;case h.OTHER:this._mediaElement.src=this._mediaSrc;break;default:o.default.error("Cannot handle this mediaType (loadSource)")}if(this._mediaSrc&&""!==this._mediaSrc)for(this._sourceLoaded=!0;this._loadSourceQueue.length>0;)this._loadSourceQueue.pop()();else o.default.warn("Media source is null or empty string")}},{key:"attachMedia",value:function(e){if(this._debug&&o.default.info("MediaInstance ".concat(this._id,": attachMedia")),this._mediaElement=e,this._sourceLoaded)switch(this._mediaType){case h.HLS:this._useHlsJs&&this._hls.attachMedia(e);break;case h.DASH:try{this._shaka.attach(e)}catch(e){o.default.warning(e,"attachMedia Failed")}break;case h.OTHER:break;default:o.default.error("Cannot handle this mediaType (attachMedia)")}else o.default.info("Attaching HTMLMediaElement before loadSource")}},{key:"detachMedia",value:function(){if(this._debug&&o.default.info("MediaInstance ".concat(this._id,": detachMedia")),this._sourceLoaded)switch(this._mediaType){case h.HLS:if(this._useHlsJs){if(null===this._hls.media||void 0===this._hls.media)return;this._hls.detachMedia()}break;case h.DASH:this._shaka.unload();break;case h.OTHER:this._mountedMediaElement&&this._mountedMediaElement.src===this._mediaSrc&&(this._mountedMediaElement.src="");break;default:o.default.error("Cannot handle this mediaType (attachMedia)")}else o.default.info("Detaching HTMLMediaElement before loadSource")}},{key:"on",value:function(e,t){var n=this;if(this._sourceLoaded){switch(this._mediaType){case h.HLS:this._useHlsJs?this._hls.on(e,t):this._mediaElement.addEventListener(e,t);break;case h.OTHER:this._mediaElement.addEventListener(e,t);break;default:o.default.error("Cannot handle this mediaType (attachMedia)")}this._eventList.push({event:e,callback:t})}else o.default.info("Queued method: on"),this._loadSourceQueue.push((function(){return n.on(e,t)}))}},{key:"off",value:function(e,t){var n=this;if(this._sourceLoaded){switch(this._mediaType){case h.HLS:this._useHlsJs?this._hls.off(e,t):this._mediaElement.removeEventListener(e,t);break;case h.OTHER:this._mediaElement.removeEventListener(e,t);break;default:o.default.error("Cannot handle this mediaType (attachMedia)")}var r=-1;this._eventList.forEach((function(n,i){n.event===e&&n.callback===t&&(r=i)})),r>-1&&this._eventList.splice(r,1)}else o.default.info("Queued method: off"),this._loadSourceQueue.push((function(){return n.off(e,t)}))}},{key:"setVolume",value:function(e){this._mediaElement.volume=e}},{key:"toggleMute",value:function(e){this._mediaElement.muted=e}},{key:"getVolume",value:function(){return this._mediaElement.volume}},{key:"destroy",value:function(){if(this._debug&&o.default.info("MediaInstance ".concat(this._id,": destroy")),this._sourceLoaded)switch(this._mediaType){case h.HLS:this._useHlsJs&&this._hls.destroy();break;case h.OTHER:break;case h.DASH:this._shaka.unload(),this._shaka.destroy();break;default:o.default.error("Cannot handle this mediaType (attachMedia)")}else o.default.info("Destroying before loadSource")}},{key:"clearEvents",value:function(){var e=this;this._debug&&o.default.info("MediaInstance ".concat(this._id,": clearEvents")),this._eventList.forEach((function(t){e.off(t.event,t.callback)})),this._eventList=[]}}])&&d(t.prototype,n),a&&d(t,a),e}();t.default=f},"./src/playoutEngines/srcSwitchPlayoutEngine/MediaManager.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.array.for-each.js"),n("./node_modules/core-js/modules/es.array.splice.js"),n("./node_modules/core-js/modules/web.dom-collections.for-each.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=u(n("./node_modules/hls.js/dist/hls.js")),i=u(n("./node_modules/shaka-player/dist/shaka-player.compiled.js")),o=u(n("./src/logger.js")),a=u(n("./src/playoutEngines/srcSwitchPlayoutEngine/MediaInstance.js")),s=n("./src/utils.js");function u(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var d=function(){function e(t,n){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];l(this,e),this._mediaInstancePool=[],this._foregroundMediaElement=t,this._backgroundMediaElement=n,this._debug=a,this._activeConfig={hls:{maxBufferLength:30,maxMaxBufferLength:600,startFragPrefetch:!0,startLevel:3,debug:!1}},this._inactiveConfig={hls:{maxBufferLength:2,maxMaxBufferLength:4,startFragPrefetch:!0,startLevel:3,debug:!1}},this._idTotal=0,this._permissionToPlay=!1,this._getPermissionToPlay=this._getPermissionToPlay.bind(this);var u=(0,s.fetchShakaDebugLevel)();i.default.log&&this._debug&&u&&("vv"===u?i.default.log.setLevel(i.default.log.Level.V2):"v"===u?i.default.log.setLevel(i.default.log.Level.V1):"debug"===u?i.default.log.setLevel(i.default.log.Level.DEBUG):"info"===u&&i.default.log.setLevel(i.default.log.Level.INFO)),i.default.polyfill.installAll(),r.default.isSupported()?(o.default.info("HLS.js being used"),e._hlsjsSupported=!0):e._hlsjsSupported=!1}var t,n,u;return t=e,u=[{key:"Events",get:function(){return e._hlsjsSupported?{MANIFEST_PARSED:r.default.Events.MANIFEST_PARSED}:{MANIFEST_PARSED:"canplay"}}}],(n=[{key:"_getPermissionToPlay",value:function(){return this._permissionToPlay}},{key:"getMediaInstance",value:function(t){var n;if("foreground"===t)n=new a.default(this._getPermissionToPlay,this._activeConfig,this._inactiveConfig,this._idTotal,e._hlsjsSupported,this._foregroundMediaElement,this._debug);else{if("background"!==t)throw o.default.fatal("invalid hls type"),new Error("invalid hls type");n=new a.default(this._getPermissionToPlay,this._activeConfig,this._inactiveConfig,this._idTotal,e._hlsjsSupported,this._backgroundMediaElement,this._debug)}return this._idTotal+=1,this._mediaInstancePool.push({mediaInstance:n,type:t,active:!0}),this._debug&&o.default.info("New HLS Instance Created. "+"Total HLS Instances: ".concat(this._mediaInstancePool.length,".")),n}},{key:"returnMediaInstance",value:function(e){var t=this;e.clearEvents(),e.detachMedia(),e.destroy();var n=e.getId();this._mediaInstancePool.forEach((function(e,r){e.mediaInstance.getId()===n&&(t._mediaInstancePool.splice(r,1),t._debug&&o.default.info("MediaInstance Returned to Pool. "+"Total MediaInstance Instances: ".concat(t._mediaInstancePool.length,".")))}))}},{key:"setPermissionToPlay",value:function(e){this._permissionToPlay=e}}])&&c(t.prototype,n),u&&c(t,u),e}();t.default=d},"./src/renderers/BackgroundAudioRenderer.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.symbol.js"),n("./node_modules/core-js/modules/es.symbol.description.js"),n("./node_modules/core-js/modules/es.symbol.iterator.js"),n("./node_modules/core-js/modules/es.array.iterator.js"),n("./node_modules/core-js/modules/es.function.name.js"),n("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),n("./node_modules/core-js/modules/es.object.get-prototype-of.js"),n("./node_modules/core-js/modules/es.object.set-prototype-of.js"),n("./node_modules/core-js/modules/es.object.to-string.js"),n("./node_modules/core-js/modules/es.reflect.get.js"),n("./node_modules/core-js/modules/es.string.iterator.js"),n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;u(n("./src/Player.js"));var r=u(n("./src/renderers/BackgroundRenderer.js")),i=n("./src/browserCapabilities.js"),o=n("./src/playoutEngines/BasePlayoutEngine.js"),a=u(n("./src/logger.js")),s=n("./src/utils.js");function u(e){return e&&e.__esModule?e:{default:e}}function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e,t,n){return(h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var m=function(e){function t(e,n,r){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=d(this,f(t).call(this,e,n,r)))._target=i._player.backgroundTarget,i._playoutEngine.queuePlayout(i._rendererId,{type:o.MEDIA_TYPES.BACKGROUND_A}),i._renderBackgroundAudio(),i}var n,r,u;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,e),n=t,(r=[{key:"start",value:function(){var e=this;this._fadedOut=!1,this._fadePaused=!1,this._playoutEngine.getPlayoutActive(this._rendererId)?a.default.info("Continuing background audio ".concat(this._getDescriptionString())):(this._playoutEngine.setPlayoutActive(this._rendererId),a.default.info("Starting new background audio ".concat(this._getDescriptionString())));var t=this._playoutEngine.getMediaElement(this._rendererId);t&&(this._assetCollection&&"urn:x-object-based-media:asset-collection-types:looping-audio/v1.0"===this._assetCollection.asset_collection_type&&t.setAttribute("loop","true"),t.volume=0,this._volFadeInterval=setInterval((function(){t.volume>=.995&&e._volFadeInterval?(clearInterval(e._volFadeInterval),e._volFadeInterval=null):t.volume+=.005}),10))}},{key:"_getDescriptionString",value:function(){return this._assetCollection.name}},{key:"end",value:function(){var e=this;this.fadeOut(.5);var t=function(){e._playoutEngine.setPlayoutInactive(e._rendererId),e._volFadeInterval&&(clearInterval(e._volFadeInterval),e._volFadeInterval=null),e._fadeIntervalId&&(clearInterval(e._fadeIntervalId),e._fadeIntervalId=null)};this._fadedOut?t():setTimeout(t,500)}},{key:"cancelFade",value:function(){this._fadeIntervalId&&(clearInterval(this._fadeIntervalId),this._fadeIntervalId=null)}},{key:"pauseFade",value:function(){this._fadePaused=!0}},{key:"resumeFade",value:function(){this._fadePaused=!1}},{key:"fadeOut",value:function(e){var t=this;a.default.info("Fading out background audio ".concat(this._getDescriptionString())),this._volFadeInterval&&(clearInterval(this._volFadeInterval),this._volFadeInterval=null);var n=this._playoutEngine.getMediaElement(this._rendererId);if(n&&!this._fadeIntervalId){var r=1e3*e/10;this._fadeIntervalId=setInterval((function(){n.volume>=1/r&&t._fadeIntervalId?t._fadePaused||(n.volume-=1/r):t._fadeIntervalId&&(n.volume=0,clearInterval(t._fadeIntervalId),t._fadeIntervalId=null,t._fadedOut=!0)}),10)}}},{key:"_renderBackgroundAudio",value:function(){var e=this;this._assetCollection&&this._assetCollection.assets.audio_src&&this._fetchMedia(this._assetCollection.assets.audio_src,{mediaFormat:i.MediaFormats.getFormat(),mediaType:s.AUDIO}).then((function(t){e._populateAudioElement(t)})).catch((function(e){a.default.error(e,"Notfound")}))}},{key:"_populateAudioElement",value:function(e,t){this._disabled?a.default.warn("trying to populate audio element that has been destroyed"):this._playoutEngine.queuePlayout(this._rendererId,{url:e,loop:t})}},{key:"destroy",value:function(){var e=this;this.end();var n=function(){e._playoutEngine.unqueuePlayout(e._rendererId),h(f(t.prototype),"destroy",e).call(e)};this._fadedOut?n():setTimeout(n,500)}}])&&c(n.prototype,r),u&&c(n,u),t}(r.default);t.default=m},"./src/renderers/BackgroundRenderer.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.symbol.js"),n("./node_modules/core-js/modules/es.symbol.description.js"),n("./node_modules/core-js/modules/es.symbol.iterator.js"),n("./node_modules/core-js/modules/es.array.iterator.js"),n("./node_modules/core-js/modules/es.object.get-prototype-of.js"),n("./node_modules/core-js/modules/es.object.set-prototype-of.js"),n("./node_modules/core-js/modules/es.object.to-string.js"),n("./node_modules/core-js/modules/es.string.iterator.js"),n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(n("./node_modules/events/events.js")),i=o(n("./node_modules/uuid/v4.js"));o(n("./src/Player.js")),o(n("./src/playoutEngines/BasePlayoutEngine.js"));function o(e){return e&&e.__esModule?e:{default:e}}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(e){function t(e,n,r){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=u(this,l(t).call(this)))._fetchMedia=n,o._rendererId=(0,i.default)(),o._player=r,o._playoutEngine=r.playoutEngine,o._assetCollection=e,o._disabled=!1,o}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,e),n=t,(r=[{key:"start",value:function(){}},{key:"end",value:function(){}},{key:"cancelFade",value:function(){}},{key:"fadeOut",value:function(e){}},{key:"pauseFade",value:function(){}},{key:"resumeFade",value:function(){}},{key:"destroy",value:function(){this._disabled=!0}}])&&s(n.prototype,r),o&&s(n,o),t}(r.default);t.default=d},"./src/renderers/BackgroundRendererFactory.js":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,o){var a,s={"urn:x-object-based-media:asset-collection-types:looping-audio/v1.0":r.default,"urn:x-object-based-media:asset-collection-types:simple-audio/v1.0":r.default};if(e in s){a=new(0,s[e])(t,n,o)}else i.default.error("Do not know how to render background ".concat(e));return a};var r=o(n("./src/renderers/BackgroundAudioRenderer.js")),i=(o(n("./src/Player.js")),o(n("./src/logger.js")));function o(e){return e&&e.__esModule?e:{default:e}}},"./src/renderers/BaseRenderer.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.symbol.js"),n("./node_modules/core-js/modules/es.symbol.description.js"),n("./node_modules/core-js/modules/es.symbol.iterator.js"),n("./node_modules/core-js/modules/es.array.concat.js"),n("./node_modules/core-js/modules/es.array.filter.js"),n("./node_modules/core-js/modules/es.array.find.js"),n("./node_modules/core-js/modules/es.array.for-each.js"),n("./node_modules/core-js/modules/es.array.iterator.js"),n("./node_modules/core-js/modules/es.array.map.js"),n("./node_modules/core-js/modules/es.array.some.js"),n("./node_modules/core-js/modules/es.array.sort.js"),n("./node_modules/core-js/modules/es.function.name.js"),n("./node_modules/core-js/modules/es.object.get-prototype-of.js"),n("./node_modules/core-js/modules/es.object.keys.js"),n("./node_modules/core-js/modules/es.object.set-prototype-of.js"),n("./node_modules/core-js/modules/es.object.to-string.js"),n("./node_modules/core-js/modules/es.promise.js"),n("./node_modules/core-js/modules/es.string.iterator.js"),n("./node_modules/core-js/modules/web.dom-collections.for-each.js"),n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.RENDERER_PHASES=void 0;var r=_(n("./node_modules/events/events.js")),i=_(n("./src/behaviours/BehaviourRunner.js")),o=_(n("./src/renderers/RendererEvents.js")),a=_(n("./src/behaviours/BehaviourTimings.js")),s=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==b(e)&&"function"!=typeof e)return{default:e};var t=y();if(t&&t.has(e))return t.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=r?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(n,i,o):n[i]=e[i]}n.default=e,t&&t.set(e,n);return n}(n("./src/Player.js")),u=(_(n("./src/playoutEngines/BasePlayoutEngine.js")),_(n("./src/AnalyticEvents.js"))),l=(_(n("./src/Controller.js")),_(n("./src/logger.js"))),c=n("./src/utils.js"),d=n("./src/Events.js"),h=n("./src/behaviours/VariablePanelHelper.js"),f=n("./src/behaviours/SocialShareBehaviourHelper.js"),p=n("./src/behaviours/LinkOutBehaviourHelper.js"),m=_(n("./src/playoutEngines/iOSPlayoutEngine.js")),v=_(n("./src/playoutEngines/SrcSwitchPlayoutEngine.js")),g=_(n("./src/TimeManager.js"));function y(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return y=function(){return e},e}function _(e){return e&&e.__esModule?e:{default:e}}function b(e){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function T(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var x={CONSTRUCTED:"CONSTRUCTED",START:"START",MAIN:"MAIN",END:"END",ENDED:"ENDED"};t.RENDERER_PHASES=x;var A=function(e){function t(e,n,r,i,o,a){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(s=function(e,t){return!t||"object"!==b(t)&&"function"!=typeof t?T(e):t}(this,w(t).call(this)))._representation=e,s._rendererId=s._representation.id,s._fetchAssetCollection=n,s._fetchMedia=r,s._player=i,s._playoutEngine=i.playoutEngine,s._target=i.mediaTarget,s._controller=a,s._applyColourOverlayBehaviour=s._applyColourOverlayBehaviour.bind(T(s)),s._applyShowImageBehaviour=s._applyShowImageBehaviour.bind(T(s)),s._applyShowVariablePanelBehaviour=s._applyShowVariablePanelBehaviour.bind(T(s)),s._applyShowChoiceBehaviour=s._applyShowChoiceBehaviour.bind(T(s)),s._renderLinkChoices=s._renderLinkChoices.bind(T(s)),s._handleLinkChoiceEvent=s._handleLinkChoiceEvent.bind(T(s)),s._applySocialSharePanelBehaviour=s._applySocialSharePanelBehaviour.bind(T(s)),s._applyLinkOutBehaviour=s._applyLinkOutBehaviour.bind(T(s)),s._seekBack=s._seekBack.bind(T(s)),s._seekForward=s._seekForward.bind(T(s)),s._togglePause=s._togglePause.bind(T(s)),s.seekEventHandler=s.seekEventHandler.bind(T(s)),s.checkIsLooping=s.checkIsLooping.bind(T(s)),s.isSrcIosPlayoutEngine=s.isSrcIosPlayoutEngine.bind(T(s)),s._handlePlayPauseButtonClicked=s._handlePlayPauseButtonClicked.bind(T(s)),s._willHideControls=s._willHideControls.bind(T(s)),s._hideControls=s._hideControls.bind(T(s)),s._showControls=s._showControls.bind(T(s)),s._runDuringBehaviours=s._runDuringBehaviours.bind(T(s)),s._runStartBehaviours=s._runStartBehaviours.bind(T(s)),s._runSingleDuringBehaviour=s._runSingleDuringBehaviour.bind(T(s)),s.addTimeEventListener=s.addTimeEventListener.bind(T(s)),s._addPauseHandlersForTimer=s._addPauseHandlersForTimer.bind(T(s)),s._removePauseHandlersForTimer=s._removePauseHandlersForTimer.bind(T(s)),s._behaviourRendererMap={"urn:x-object-based-media:representation-behaviour:colouroverlay/v1.0":s._applyColourOverlayBehaviour,"urn:x-object-based-media:representation-behaviour:showimage/v1.0":s._applyShowImageBehaviour,"urn:x-object-based-media:representation-behaviour:showvariablepanel/v1.0":s._applyShowVariablePanelBehaviour,"urn:x-object-based-media:representation-behaviour:showlinkchoices/v1.0":s._applyShowChoiceBehaviour,"urn:x-object-based-media:representation-behaviour:socialmodal/v1.0":s._applySocialSharePanelBehaviour,"urn:x-object-based-media:representation-behaviour:linkoutmodal/v1.0":s._applyLinkOutBehaviour},s._behaviourElements=[],s._timer=new g.default,s._setInTime=s._setInTime.bind(T(s)),s._setOutTime=s._setOutTime.bind(T(s)),s._lastSetTime=0,s._inTime=0,s._outTime=-1,s._destroyed=!1,s._analytics=o,s.inVariablePanel=!1,s._preloadedBehaviourAssets=[],s._preloadBehaviourAssets(),s._preloadIconAssets(),s._loopCounter=0,s.phase=x.CONSTRUCTED,s._inPauseBehaviourState=!1,s}var n,r,y;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(t,e),n=t,(r=[{key:"willStart",value:function(e,t){if(this.inVariablePanel=!1,this.phase=x.START,this._runStartBehaviours(),this._player.on(s.PlayerEvents.SEEK_BACKWARD_BUTTON_CLICKED,this._seekBack),this._player.on(s.PlayerEvents.SEEK_FORWARD_BUTTON_CLICKED,this._seekForward),(0,c.checkAddDetailsOverride)()){var n=this._representation,r=n.name,i=n.id;this._player.addDetails(e,t,r,i)}}},{key:"_runStartBehaviours",value:function(){this._behaviourRunner=this._representation.behaviours?new i.default(this._representation.behaviours,this):null,this._player.enterStartBehaviourPhase(this),this._playoutEngine.setPlayoutVisible(this._rendererId),this._behaviourRunner&&this._behaviourRunner.runBehaviours(a.default.started,o.default.COMPLETE_START_BEHAVIOURS)||this.emit(o.default.COMPLETE_START_BEHAVIOURS)}},{key:"start",value:function(){this.phase=x.MAIN,this.emit(o.default.STARTED),this._hasEnded=!1,this._timer.start(),this._playoutEngine.isPlaying()||this._timer.pause(),this._addPauseHandlersForTimer(),this._player.exitStartBehaviourPhase(),this._clearBehaviourElements(),this._player.connectScrubBar(this),this._player.on(s.PlayerEvents.PLAY_PAUSE_BUTTON_CLICKED,this._handlePlayPauseButtonClicked),this.setCurrentTime(this._lastSetTime),this._runDuringBehaviours()}},{key:"end",value:function(){this.phase=x.ENDED,this._player.disconnectScrubBar(this),this._clearBehaviourElements(),this._reapplyLinkConditions(),clearTimeout(this._linkFadeTimeout),this._player.removeListener(s.PlayerEvents.LINK_CHOSEN,this._handleLinkChoiceEvent),this._player.removeListener(s.PlayerEvents.SEEK_BACKWARD_BUTTON_CLICKED,this._seekBack),this._player.removeListener(s.PlayerEvents.SEEK_FORWARD_BUTTON_CLICKED,this._seekForward),this._controller.off(d.VARIABLE_EVENTS.CONTROLLER_CHANGED_VARIABLE,this._renderLinkChoices),this._timer.clear(),this._loopCounter=0,this._player.removeListener(s.PlayerEvents.PLAY_PAUSE_BUTTON_CLICKED,this._handlePlayPauseButtonClicked),this._lastSetTime=0}},{key:"hasEnded",value:function(){return this._hasEnded}},{key:"hasVariablePanelBehaviour",value:function(){var e=!1;return this._representation.behaviours&&this._representation.behaviours.completed&&this._representation.behaviours.completed.forEach((function(t){"urn:x-object-based-media:representation-behaviour:showvariablepanel/v1.0"===t.type&&(e=!0)})),e}},{key:"logRendererAction",value:function(e){var t={type:u.default.types.RENDERER_ACTION,name:u.default.names[e],from:"not_set",to:"not_set"};this._analytics(t)}},{key:"logUserInteraction",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"not_set",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"not_set",r={type:u.default.types.USER_ACTION,name:u.default.names[e],from:null===t?"not_set":t,to:null===n?"not_set":n};this._analytics(r)}},{key:"getRepresentation",value:function(){return this._representation}},{key:"_setInTime",value:function(e){this._inTime=e,this.setCurrentTime(0)}},{key:"_setOutTime",value:function(e){this._outTime=e}},{key:"_getDuration",value:function(){var e=this._representation.duration;return null!=e?(e<0&&(e=1/0),this._duration=e,this._duration):(this._duration&&this._duration!==1/0||(null==e&&(e=1/0,(this.checkIsLooping()||null==(e=this._playoutEngine.getDuration(this._rendererId)))&&(e=1/0)),this._outTime>=0?e=this._outTime-this._inTime:this._inTime&&(e-=this._inTime),this._duration=e),this._duration)}},{key:"getCurrentTime",value:function(){var e=this._getDuration(),t=this._timer.getTime(),n=!1,r=1/0;return e!==1/0&&(n=!0,r=e-t),{timeBased:n,currentTime:t,remainingTime:r,duration:e,timersSyncing:this._timer.isSyncing()}}},{key:"setCurrentTime",value:function(e){var t=this;if(e<0||e===1/0)l.default.warn("Setting time for renderer out of range (".concat(e,").  Ignoring"));else{var n=e,r=this.getChoiceTime();r>=0&&r<e&&(n=r),this._lastSetTime=n,n+=this._inTime;var i=this._playoutEngine.getMediaElement(this._rendererId);if(i&&i.id&&i.src){var o=this._timer._paused;this._timer.setSyncing(!0),i.addEventListener("timeupdate",(function e(){var r=i.currentTime;r>=n+.1&&(t._timer.setTime(r-t._inTime),t._timer.setSyncing(!1),o&&t._timer.pause(),i.removeEventListener("timeupdate",e))})),this._playoutEngine.setCurrentTime(this._rendererId,n)}else this._timer.setTime(e)}}},{key:"_togglePause",value:function(){this._playoutEngine.isPlaying()?this._timer.resume():this._timer.pause()}},{key:"_addPauseHandlersForTimer",value:function(){var e=this;this._timer&&(this._playoutEngine.on(this._rendererId,"pause",(function(){e._timer.pause()})),this._playoutEngine.on(this._rendererId,"play",(function(){e._timer.resume()})))}},{key:"_removePauseHandlersForTimer",value:function(){var e=this;this._timer&&(this._playoutEngine.off(this._rendererId,"pause",(function(){e._timer.pause()})),this._playoutEngine.off(this._rendererId,"play",(function(){e._timer.resume()})))}},{key:"_handlePlayPauseButtonClicked",value:function(){this._timer._paused?this._timer.resume():this._timer.pause(),this._playoutEngine.getPlayoutActive(this._rendererId)&&(this._playoutEngine.isPlaying()?this.logRendererAction(u.default.names.VIDEO_UNPAUSE):this.logRendererAction(u.default.names.VIDEO_PAUSE))}},{key:"pause",value:function(){this._timer.pause(),this._playoutEngine.pause()}},{key:"play",value:function(){this._timer.resume(),this._playoutEngine.play()}},{key:"_seekBack",value:function(){var e=this.getCurrentTime(),t=e.timeBased,n=e.currentTime;if(t){var r=n-10;r<0&&(r=0),this.logUserInteraction(u.default.names.SEEK_BACKWARD_BUTTON_CLICKED,n,"".concat(r)),this.setCurrentTime(r)}}},{key:"_seekForward",value:function(){var e=this.getCurrentTime(),t=e.timeBased,n=e.currentTime;if(t){var r=n+10,i=this.getChoiceTime();i>0&&i<r&&(r=i),this.setCurrentTime(r),this.logUserInteraction(u.default.names.SEEK_FORWARD_BUTTON_CLICKED,n,"".concat(r))}}},{key:"getChoiceTime",value:function(){if(this._representation.behaviours&&this._representation.behaviours.during){var e=this._representation.behaviours.during.filter((function(e){return"urn:x-object-based-media:representation-behaviour:showlinkchoices/v1.0"===e.behaviour.type})).sort((function(e,t){return e.start_time-t.start_time}));if(e.length>0)return e[0].start_time}return-1}},{key:"complete",value:function(){this.phase=x.END,this._hasEnded=!0,this._timer.pause(),(!this._linkBehaviour||this._linkBehaviour&&!this._linkBehaviour.forceChoice)&&(this._player.enterCompleteBehavourPhase(),this.emit(o.default.STARTED_COMPLETE_BEHAVIOURS),this._behaviourRunner&&this._behaviourRunner.runBehaviours(a.default.completed,o.default.COMPLETED)||this.emit(o.default.COMPLETED))}},{key:"switchFrom",value:function(){this.end()}},{key:"cueUp",value:function(){}},{key:"switchTo",value:function(){this.start()}},{key:"_preloadBehaviourAssets",value:function(){var e=this;this._preloadedBehaviourAssets=[],(this._representation.asset_collections.behaviours?this._representation.asset_collections.behaviours:[]).forEach((function(t){e._fetchAssetCollection(t.asset_collection_id).then((function(t){return t.assets.image_src?e._fetchMedia(t.assets.image_src):Promise.resolve()})).then((function(t){if(t){var n=new Image;n.src=t,e._preloadedBehaviourAssets.push(n)}}))}))}},{key:"_preloadIconAssets",value:function(){var e=this;this._preloadedIconAssets=[];var t=[];return this._representation.asset_collections.icon&&(this._representation.asset_collections.icon.default_id&&t.push(this._representation.asset_collections.icon.default_id),this._representation.asset_collections.icon.active_id&&t.push(this._representation.asset_collections.icon.active_id)),Promise.all(t.map((function(t){return e._fetchAssetCollection(t).then((function(t){return t.assets.image_src?e._fetchMedia(t.assets.image_src):Promise.resolve()})).then((function(t){if(t){var n=new Image;n.src=t,l.default.info("Preloading icon ".concat(t)),e._preloadedIconAssets.push(n)}}))})))}},{key:"getBehaviourRenderer",value:function(e){return this._behaviourRendererMap[e]}},{key:"hasShowIconBehaviour",value:function(){if(this._representation.behaviours){if(this._representation.behaviours.started&&this._representation.behaviours.started.filter((function(e){return"urn:x-object-based-media:representation-behaviour:showlinkchoices/v1.0"===e.type})).length>0)return!0;if(this._representation.behaviours.completed&&this._representation.behaviours.completed.filter((function(e){return"urn:x-object-based-media:representation-behaviour:showlinkchoices/v1.0"===e.type})).length>0)return!0;if(this._representation.behaviours.during&&this._representation.behaviours.during.filter((function(e){return"urn:x-object-based-media:representation-behaviour:showlinkchoices/v1.0"===e.behaviour.type})).length>0)return!0}return!1}},{key:"resetPlayer",value:function(){this._player.resetControls(),this._player.removeListener(s.PlayerEvents.LINK_CHOSEN,this._handleLinkChoiceEvent)}},{key:"_willHideControls",value:function(e){return"urn:x-object-based-media:representation-behaviour:showlinkchoices/v1.0"===e.type&&e.disable_controls&&e.show_if_one_choice}},{key:"_hideControls",value:function(e){var t=this,n=function(){t._player.disableControls(),t._player._hideRomperButtons()};e>1?this.addTimeEventListener("prechoice-control-hide",e-.4,n):n()}},{key:"_showControls",value:function(){this._player.enableControls()}},{key:"_runDuringBehaviours",value:function(){var e=this;this._representation.behaviours&&this._representation.behaviours.during&&this._representation.behaviours.during.forEach((function(t){e._runSingleDuringBehaviour(t)}))}},{key:"_runSingleDuringBehaviour",value:function(e){var t=this,n=this.getBehaviourRenderer(e.behaviour.type);if(n){var r=function(){l.default.info("started during behaviour ".concat(e.behaviour.type)),t._analytics({type:u.default.types.RENDERER_ACTION,name:u.default.names.DURING_BEHAVIOUR_STARTED,from:e.behaviour.type,to:""}),n(e.behaviour,(function(){return l.default.info("completed during behaviour ".concat(e.behaviour.type))}))};this._willHideControls(e.behaviour)&&this._hideControls(e.start_time);var i=e.start_time,o=function(e){if(void 0!==e.duration)return e.start_time+e.duration}(e),a=function(){var n=document.getElementById(e.behaviour.id);n&&n.parentNode&&n.parentNode.removeChild(n),t._showControls()},s=e.behaviour.id;0===i?(r(),this.addTimeEventListener(s,o,a)):this.addTimeEventListener(s,i,r,o,a)}else l.default.warn("".concat(this.constructor.name," does not support ")+"".concat(e.behaviour.type," - ignoring"))}},{key:"_applyShowChoiceBehaviour",value:function(e,t){return this._player.on(s.PlayerEvents.LINK_CHOSEN,this._handleLinkChoiceEvent),this._linkChoiceBehaviourOverlay=this._player.createBehaviourOverlay(e),this._setBehaviourElementAttribute(this._linkChoiceBehaviourOverlay.overlay,"link-choice"),this._choiceBehaviourData={choiceIconNEObjects:null,behaviour:e,callback:t},this._controller.on(d.VARIABLE_EVENTS.CONTROLLER_CHANGED_VARIABLE,this._renderLinkChoices),this._renderLinkChoices()}},{key:"_choicesHaveChanged",value:function(e){var t=this._choiceBehaviourData.choiceIconNEObjects;if(t.length!==e.length)return!0;var n=!0;return e.forEach((function(e){t.find((function(t){return t.targetNeId===e.targetNeId}))||(n=!1)})),!n}},{key:"_renderLinkChoices",value:function(){var e=this,t=this._choiceBehaviourData,n=t.behaviour,r=t.callback,i=t.choiceIconNEObjects,o=this._getLinkChoiceBehaviours(n),a=o.showNeToEnd,s=o.countdown,u=o.disableControls,c=o.iconOverlayClass,d=o.forceChoice,h=o.oneShot,f=o.showIfOneLink;this._linkBehaviour={showNeToEnd:a,oneShot:h,forceChoice:d,callback:d?r:function(){}};var p=this._linkChoiceBehaviourOverlay;return this._controller.getValidNextSteps().then((function(t){if(null!==i){if(!e._choicesHaveChanged(t))return l.default.info("Variable state has changed, but same link options valid"),Promise.resolve();l.default.info("Variable state has changed valid links - need to refresh icons"),e._player.clearLinkChoices(),p.clearAll()}if(e._choiceBehaviourData.choiceIconNEObjects=t,0===t.length)return l.default.warn("Show link icons behaviour run, but no links are currently valid"),e._player.enableControls(),r(),Promise.resolve();if(1===t.length&&!f)return l.default.info("Link Choice behaviour ignored - only one link"),e._player.enableControls(),r(),Promise.resolve();var o=e._getIconSourceUrls(t,n),a=e._getDefaultLink(t);return o.then((function(t){e._player.clearLinkChoices(),t.forEach((function(t){e._buildLinkIcon(t,p.overlay)})),t.length>1||f?(e._showChoiceIcons({defaultLinkId:a,forceChoice:d,disableControls:u,countdown:s,iconOverlayClass:c,behaviourOverlay:p,choiceCount:t.length}),d||r()):(l.default.info("Link Choice behaviour ignored - only one link"),e._linkBehaviour.forceChoice=!1,r())}))}))}},{key:"_handleLinkChoiceEvent",value:function(e){this.checkIsLooping()&&this._playoutEngine.removeLoopAttribute(this._rendererId),this._followLink(e.id,e.behaviourId)}},{key:"_getLinkChoiceBehaviours",value:function(e){var t=!1,n=!0,r=null,i=!1,o=!1,a=!0,s=!1;return e.hasOwnProperty("show_ne_to_end")&&(a=e.show_ne_to_end),e.hasOwnProperty("one_shot")&&(o=e.one_shot),e.hasOwnProperty("show_if_one_choice")&&(s=e.show_if_one_choice),e.hasOwnProperty("show_time_remaining")&&(t=e.show_time_remaining),e.hasOwnProperty("disable_controls")&&(n=e.disable_controls),e.hasOwnProperty("overlay_class")&&(r=e.overlay_class),e.hasOwnProperty("force_choice")&&(i=e.force_choice),{showNeToEnd:a,countdown:t,disableControls:n,iconOverlayClass:r,forceChoice:i,oneShot:o,showIfOneLink:s}}},{key:"_getIconSourceUrls",value:function(e,t){var n=this,r=[];return e.forEach((function(e,i){l.default.info("choice ".concat(i+1,": ").concat(e.ne.id));var o={choiceId:i,acId:null,ac:null,resolvedUrl:null,targetNarrativeElementId:e.targetNeId,iconText:null};t.link_icons&&t.link_icons.forEach((function(t){t.target_narrative_element_id===e.targetNeId&&(t.image&&(o.acId=n.resolveBehaviourAssetCollectionMappingId(t.image),Object.keys(t).forEach((function(e){"image"!==e&&(o[e]=t[e])}))),t.text&&(o.iconText=t.text))})),r.push(Promise.resolve(o))})),Promise.all(r).then((function(e){var t=[];return e.forEach((function(e){e.acId?t.push(n._fetchAssetCollection(e.acId)):t.push(Promise.resolve(null))})),Promise.all(t).then((function(t){return t.forEach((function(t,n){e[n].ac=t})),Promise.resolve(e)}))})).then((function(e){var t=[];return e.forEach((function(e){e&&e.ac&&e.ac.assets.image_src?t.push(n._fetchMedia(e.ac.assets.image_src)):t.push(Promise.resolve(""))})),Promise.all(t).then((function(t){var n=[];return t.forEach((function(t,r){var i=e[r];i.resolvedUrl=t,n.push(i)})),n}))}))}},{key:"_buildLinkIcon",value:function(e,t){var n,r=e.targetNarrativeElementId;if(e.iconText&&e.resolvedUrl?n=this._player.addTextLinkIconChoice(t,r,e.iconText,e.resolvedUrl,"Option ".concat(e.choiceId+1)):e.iconText?n=this._player.addTextLinkChoice(t,r,e.iconText,"Option ".concat(e.choiceId+1)):e.resolvedUrl?n=this._player.addLinkChoiceControl(t,r,e.resolvedUrl,"Option ".concat(e.choiceId+1)):l.default.warn("No icon specified for link to ".concat(r," - not rendering")),n&&e.position&&e.position.two_d){var i=e.position.two_d,o=i.left,a=i.top,s=e.position.two_d,u=s.width,c=s.height;void 0===o||void 0===a||void 0===u&&void 0===c||(void 0===u?u=c:void 0===c&&(c=u),n.style.position="absolute",n.style.top="".concat(a,"%"),n.style.left="".concat(o,"%"),n.style.width="".concat(u,"%"),n.style.height="".concat(c,"%"))}}},{key:"_showChoiceIcons",value:function(e){var t=e.defaultLinkId,n=e.forceChoice,r=e.disableControls,i=e.countdown,o=e.iconOverlayClass,a=e.behaviourOverlay,s=e.choiceCount;this._player.showChoiceIcons(n?null:t,o,a,s),this._player.enableLinkChoiceControl(),r&&this._player.disableControls(),i&&this._player.startChoiceCountdown(this)}},{key:"_followLink",value:function(e,t){this._controller.off(d.VARIABLE_EVENTS.CONTROLLER_CHANGED_VARIABLE,this._renderLinkChoices),this._linkBehaviour&&(this._linkBehaviour.forceChoice=!1);var n=this._controller.getCurrentNarrativeElement();this._linkBehaviour&&this._linkBehaviour.showNeToEnd?(n.links.forEach((function(t){t.target_narrative_element_id===e?t.override_as_chosen=!0:t.hasOwnProperty("override_as_chosen")&&(t.override_as_chosen=!1)})),this._hasEnded?this._hideChoiceIcons(e,t):this._linkBehaviour&&this._linkBehaviour.oneShot&&(this._hideChoiceIcons(null,t),this._controller.refreshPlayerNextAndBack(),this._player.enableControls(),this._player.showSeekButtons())):this._hideChoiceIcons(e,t)}},{key:"_getDefaultLink",value:function(e){var t=this._controller.getCurrentNarrativeElement().links.filter((function(t){return e.filter((function(e){return e.targetNeId===t.target_narrative_element_id})).length>0}))[0];return t&&t.target_narrative_element_id}},{key:"_reapplyLinkConditions",value:function(){this._controller.getCurrentNarrativeElement().links.forEach((function(e){e.hasOwnProperty("override_as_chosen")&&(e.override_as_chosen=!1)}))}},{key:"_hideChoiceIcons",value:function(e,t){var n=this;e&&this._reapplyLinkConditions();var r=document.getElementById(t);r&&(this._linkFadeTimeout=setTimeout((function(){r.classList.remove("romper-icon-fade"),n._player.clearLinkChoices(),e?n._controller.followLink(e):n._linkBehaviour.callback()}),1500),r.classList.add("romper-icon-fade"))}},{key:"_applyColourOverlayBehaviour",value:function(e,t){var n=e.colour,r=document.createElement("div");this._setBehaviourElementAttribute(r,"colour-overlay"),r.style.background=n,r.className="romper-image-overlay",this._target.appendChild(r),this._behaviourElements.push(r),t()}},{key:"_applyShowImageBehaviour",value:function(e,t){var n=this,r=e.image,i=this.resolveBehaviourAssetCollectionMappingId(r);i&&this._fetchAssetCollection(i).then((function(e){return e.assets.image_src?n._fetchMedia(e.assets.image_src):Promise.resolve()})).then((function(r){r&&n._overlayImage(r,e.id),t()}))}},{key:"_overlayImage",value:function(e,t){var n=document.createElement("img");n.id=t,this._setBehaviourElementAttribute(n,"image-overlay"),n.src=e,n.className="romper-image-overlay",this._target.appendChild(n),this._behaviourElements.push(n)}},{key:"_applySocialSharePanelBehaviour",value:function(e,t){var n=(0,f.renderSocialPopup)(e,this._player._overlays,t,this._analytics);this._setBehaviourElementAttribute(n,"social-share"),this._behaviourElements.push(n)}},{key:"_applyLinkOutBehaviour",value:function(e,t){var n=(0,p.renderLinkoutPopup)(e,this._player._overlays,t,this._analytics);this._setBehaviourElementAttribute(n,"link-out"),this._behaviourElements.push(n)}},{key:"_setBehaviourElementAttribute",value:function(e,t){e.setAttribute("data-behaviour",t),e.setAttribute("behaviour-renderer",this._rendererId)}},{key:"_setVariableValue",value:function(e,t){var n=this;this._controller.getVariableValue(e).then((function(r){n._controller.setVariableValue(e,t);var i={type:u.default.types.USER_ACTION,name:u.default.names.USER_SET_VARIABLE,from:"".concat(e,": ").concat(r),to:"".concat(e,": ").concat(t)};n._analytics(i)}))}},{key:"_applyShowVariablePanelBehaviour",value:function(e,t){(0,h.buildPanel)(e,this._controller.getVariableState.bind(this._controller),this._controller.getVariableValue.bind(this._controller),this._setVariableValue.bind(this),t,this._target,this._player,this,this._analytics)}},{key:"_clearBehaviourElements",value:function(){document.querySelectorAll('[behaviour-renderer="'.concat(this._rendererId,'"]')).forEach((function(e){try{e&&e.parentNode&&e.parentNode.removeChild(e)}catch(t){l.default.warn("could not remove behaviour element ".concat(e.id," from Renderer"))}}))}},{key:"resolveBehaviourAssetCollectionMappingId",value:function(e){if(this._representation.asset_collections.behaviours){var t=null;return this._representation.asset_collections.behaviours.some((function(n){return n.behaviour_asset_collection_mapping_id===e&&(t=n.asset_collection_id,!0)})),t}return null}},{key:"isVRViewable",value:function(){return!1}},{key:"addTimeEventListener",value:function(e,t,n,r,i){this._timer.addTimeEventListener(e,t,n,r,i)}},{key:"deleteTimeEventListener",value:function(e){this._timer.deleteTimeEventListener(e)}},{key:"setInPause",value:function(e){this._inPauseBehaviourState=e}},{key:"getInPause",value:function(){return this._inPauseBehaviourState}},{key:"seekEventHandler",value:function(e){var t=this._playoutEngine.getCurrentTime(this._rendererId);this.checkIsLooping()&&void 0!==t&&t<=.002&&(0!==e&&this.setCurrentTime(e),this.isSrcIosPlayoutEngine()&&this._playoutEngine._playing&&this._playoutEngine._foregroundMediaElement.paused&&this._playoutEngine.play())}},{key:"checkIsLooping",value:function(){var e=this._playoutEngine.getMediaElement(this._rendererId);return e&&e.hasAttribute("loop")}},{key:"destroy",value:function(){this.end(),this._clearBehaviourElements(),this._behaviourRunner&&this._behaviourRunner.destroyBehaviours(),this.emit(o.default.DESTROYED),this._destroyed=!0}},{key:"isSrcIosPlayoutEngine",value:function(){return this._playoutEngine instanceof m.default||this._playoutEngine instanceof v.default}}])&&E(n.prototype,r),y&&E(n,y),t}(r.default);t.default=A},"./src/renderers/ImageRenderer.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.symbol.js"),n("./node_modules/core-js/modules/es.symbol.description.js"),n("./node_modules/core-js/modules/es.symbol.iterator.js"),n("./node_modules/core-js/modules/es.array.concat.js"),n("./node_modules/core-js/modules/es.array.iterator.js"),n("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),n("./node_modules/core-js/modules/es.object.get-prototype-of.js"),n("./node_modules/core-js/modules/es.object.set-prototype-of.js"),n("./node_modules/core-js/modules/es.object.to-string.js"),n("./node_modules/core-js/modules/es.reflect.get.js"),n("./node_modules/core-js/modules/es.string.iterator.js"),n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(n("./src/renderers/BaseRenderer.js")),i=(o(n("./src/Player.js")),o(n("./src/logger.js")));o(n("./src/Controller.js"));function o(e){return e&&e.__esModule?e:{default:e}}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e,t,n){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=c(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var h=function(e){function t(e,n,r,i,o,a){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(s=u(this,c(t).call(this,e,n,r,i,o,a))).renderImageElement(),s._disablePlayButton=function(){s._player.disablePlayButton()},s._enablePlayButton=function(){s._player.enablePlayButton()},s._disableScrubBar=function(){s._player.disableScrubBar()},s._enableScrubBar=function(){s._player.enableScrubBar()},s._duration=s._representation.duration?s._representation.duration:1/0,s}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,e),n=t,(r=[{key:"willStart",value:function(){l(c(t.prototype),"willStart",this).call(this),this._imageElement||this.renderImageElement(),this._visible=!0,this._setVisibility(!0)}},{key:"start",value:function(){var e=this;l(c(t.prototype),"start",this).call(this),this._hasEnded=!0,this._duration===1/0||this._duration<0?(i.default.info("Image representation ".concat(this._representation.id," persistent")),this._disablePlayButton(),this._disableScrubBar()):0===this._duration?(i.default.warn("Image representation ".concat(this._representation.id," has zero duration")),this.complete()):(i.default.info("Image representation ".concat(this._representation.id," timed for ").concat(this._duration,"s, starting now")),this._enableScrubBar(),this._timer.addTimeEventListener("".concat(this._rendererId,"-complete"),this._duration,(function(){i.default.info("Image representation ".concat(e._representation.id," completed time")),e.complete()})))}},{key:"end",value:function(){var e=this;l(c(t.prototype),"end",this).call(this),this._visible=!1,setTimeout((function(){e._visible||e._setVisibility(!1)}),100)}},{key:"renderImageElement",value:function(){var e=this;this._imageElement=document.createElement("img"),this._imageElement.className="romper-render-image",this._setVisibility(!1),this._representation.asset_collections.foreground_id&&this._fetchAssetCollection(this._representation.asset_collections.foreground_id).then((function(t){t.assets.image_src&&e._fetchMedia(t.assets.image_src).then((function(t){i.default.info("FETCHED FROM MS MEDIA! ".concat(t)),e._imageElement.src=t})).catch((function(e){i.default.error(e,"Notfound")}))})),this._target.appendChild(this._imageElement)}},{key:"switchFrom",value:function(){this.end()}},{key:"switchTo",value:function(){this.start()}},{key:"_setVisibility",value:function(e){this._imageElement&&(this._imageElement.style.opacity=e?"1":"0")}},{key:"destroy",value:function(){this.end(),this._imageElement&&this._target.removeChild(this._imageElement),l(c(t.prototype),"destroy",this).call(this)}}])&&s(n.prototype,r),o&&s(n,o),t}(r.default);t.default=h},"./src/renderers/RendererEvents.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.array.for-each.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={};["STARTED","RENDERER_READY","COMPLETED","DESTROYED","COMPLETE_START_BEHAVIOURS","NEXT_BUTTON_CLICKED","PREVIOUS_BUTTON_CLICKED","ADD_TO_DOM","REMOVE_FROM_DOM","SWITCHED_REPRESENTATION","STARTED_COMPLETE_BEHAVIOURS"].forEach((function(e){r[e]=e}));var i=r;t.default=i},"./src/renderers/RendererFactory.js":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,d,h,f){var p,m={"urn:x-object-based-media:representation-types:image/v1.0":r.default,"urn:x-object-based-media:representation-types:simple-av/v1.0":i.default,"urn:x-object-based-media:representation-types:simple-audio/v1.0":o.default,"urn:x-object-based-media:representation-types:simple-text/v1.0":a.default,"urn:x-object-based-media:representation-types:placeholder/v1.0":a.default,"urn:x-object-based-media:representation-types:switchable/v1.0":s.default,"urn:x-object-based-media:representation-types:immersive/v1.0":u.default,"urn:x-object-based-media:representation-types:image360/v1.0":l.default};if(e.representation_type in m){var v=m[e.representation_type];p=new v(e,t,n,d,h,f)}else c.default.error("Do not know how to render ".concat(e.representation_type));return p};var r=d(n("./src/renderers/ImageRenderer.js")),i=d(n("./src/renderers/SimpleAVRenderer.js")),o=d(n("./src/renderers/SimpleAudioRenderer.js")),a=d(n("./src/renderers/SimpleTextRenderer.js")),s=d(n("./src/renderers/SwitchableRenderer.js")),u=d(n("./src/renderers/ThreeJsVideoRenderer.js")),l=d(n("./src/renderers/ThreeJsImageRenderer.js")),c=(d(n("./src/Player.js")),d(n("./src/logger.js")));d(n("./src/Controller.js"));function d(e){return e&&e.__esModule?e:{default:e}}},"./src/renderers/SimpleAVRenderer.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.symbol.js"),n("./node_modules/core-js/modules/es.symbol.description.js"),n("./node_modules/core-js/modules/es.symbol.iterator.js"),n("./node_modules/core-js/modules/es.array.concat.js"),n("./node_modules/core-js/modules/es.array.filter.js"),n("./node_modules/core-js/modules/es.array.iterator.js"),n("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),n("./node_modules/core-js/modules/es.object.get-prototype-of.js"),n("./node_modules/core-js/modules/es.object.set-prototype-of.js"),n("./node_modules/core-js/modules/es.object.to-string.js"),n("./node_modules/core-js/modules/es.parse-float.js"),n("./node_modules/core-js/modules/es.reflect.get.js"),n("./node_modules/core-js/modules/es.string.iterator.js"),n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;u(n("./src/Player.js"));var r=u(n("./src/renderers/BaseRenderer.js")),i=(u(n("./src/Controller.js")),n("./src/playoutEngines/BasePlayoutEngine.js")),o=u(n("./src/logger.js")),a=n("./src/browserCapabilities.js"),s=n("./src/utils.js");function u(e){return e&&e.__esModule?e:{default:e}}function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e,t,n){return(h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var m=function(e){function t(e,n,r,o,a,s){var u;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(u=function(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?d(e):t}(this,f(t).call(this,e,n,r,o,a,s)))._endedEventListener=u._endedEventListener.bind(d(u)),u._outTimeEventListener=u._outTimeEventListener.bind(d(u)),u._seekEventHandler=u._seekEventHandler.bind(d(u)),u.renderVideoElement(),u._applyBlurBehaviour=u._applyBlurBehaviour.bind(d(u)),u._behaviourRendererMap["urn:x-object-based-media:representation-behaviour:blur/v1.0"]=u._applyBlurBehaviour,u._playoutEngine.queuePlayout(u._rendererId,{type:i.MEDIA_TYPES.FOREGROUND_AV}),u}var n,r,u;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,e),n=t,(r=[{key:"_endedEventListener",value:function(){this._timer.pause(),this._hasEnded||h(f(t.prototype),"complete",this).call(this)}},{key:"_seekEventHandler",value:function(){h(f(t.prototype),"seekEventHandler",this).call(this,this._inTime)}},{key:"_outTimeEventListener",value:function(){var e=this,t=this.getCurrentTime().duration,n=this.getCurrentTime().currentTime,r=this._playoutEngine.getMediaElement(this._rendererId),i=this._playoutEngine.getCurrentTime(this._rendererId);if(this.checkIsLooping()?this._outTime>0&&r&&i>=this._outTime&&(r.currentTime=this._inTime,r.play()):(n=i-this._inTime,this._timer.setTime(n)),n>t&&(r&&r.pause(),this._endedEventListener()),n>t-1){var a=n;this._playoutEngine.isPlaying()&&!this._testEndStallTimeout&&(this._testEndStallTimeout=setTimeout((function(){var t=e._playoutEngine.getCurrentTime(e._rendererId);t&&!e._hasEnded&&(o.default.info("Checked video end for stall, run for 2s at ".concat(a,", reached ").concat(t)),t>=a&&t<=a+1.9&&(o.default.warn("Video end checker failed stall test"),clearTimeout(e._testEndStallTimeout),e.checkIsLooping()?e.setCurrentTime(e._inTime):e._endedEventListener()))}),2e3))}}},{key:"start",value:function(){var e=this;h(f(t.prototype),"start",this).call(this),this._timer.setSyncing(!0),this._playoutEngine.on(this._rendererId,"playing",(function t(){e._playoutEngine.getCurrentTime(e._rendererId)<e._inTime&&(o.default.warn("video not synced to in time, resetting"),e.setCurrentTime(0)),e._timer.setSyncing(!1),e._playoutEngine.off(e._rendererId,"playing",t)})),this._playoutEngine.on(this._rendererId,"ended",this._endedEventListener),this._playoutEngine.on(this._rendererId,"timeupdate",this._outTimeEventListener),this._playoutEngine.on(this._rendererId,"seeked",this._seekEventHandler),this._playoutEngine.setPlayoutActive(this._rendererId),o.default.info("Started: ".concat(this._representation.id)),this._player.enablePlayButton(),this._representation.asset_collections.foreground_id&&this._fetchAssetCollection(this._representation.asset_collections.foreground_id).then((function(t){t.loop?e._representation.duration&&e._representation.duration>0?e._player.enableScrubBar():e._player.disableScrubBar():e._player.enableScrubBar()}))}},{key:"end",value:function(){h(f(t.prototype),"end",this).call(this),this._playoutEngine.setPlayoutInactive(this._rendererId),o.default.info("Ended: ".concat(this._representation.id)),this._playoutEngine.off(this._rendererId,"ended",this._endedEventListener),this._playoutEngine.off(this._rendererId,"timeupdate",this._outTimeEventListener),this._playoutEngine.off(this._rendererId,"seeked",this._seekEventHandler);try{this._clearBehaviourElements()}catch(e){o.default.info(e)}}},{key:"renderVideoElement",value:function(){var e=this;this._representation.asset_collections.foreground_id&&this._fetchAssetCollection(this._representation.asset_collections.foreground_id).then((function(t){if(t.assets.av_src){t.meta&&t.meta.romper&&t.meta.romper.in&&e._setInTime(parseFloat(t.meta.romper.in)),t.meta&&t.meta.romper&&t.meta.romper.out&&e._setOutTime(parseFloat(t.meta.romper.out));var n={mediaFormat:a.MediaFormats.getFormat(),mediaType:s.VIDEO};e._fetchMedia(t.assets.av_src,n).then((function(n){var r=n;if(e._inTime>0||e._outTime>0){var i="#t=".concat(e._inTime);e._outTime>0&&(i="".concat(i,",").concat(e._outTime)),r="".concat(n).concat(i)}e.populateVideoElement(r,t.loop,t.id)})).catch((function(e){o.default.error(e,"Video not found")}))}t.assets.sub_src&&e._fetchMedia(t.assets.sub_src).then((function(t){e.populateVideoSubs(t)})).catch((function(e){o.default.error(e,"Subs not found")}))}))}},{key:"populateVideoElement",value:function(e,t,n){this._destroyed?o.default.warn("trying to populate video element that has been destroyed"):this._playoutEngine.queuePlayout(this._rendererId,{url:e,loop:t,id:n,inTime:this._inTime})}},{key:"populateVideoSubs",value:function(e){this._destroyed?o.default.warn("trying to populate video element that has been destroyed"):this._playoutEngine.queuePlayout(this._rendererId,{subs_url:e})}},{key:"_applyBlurBehaviour",value:function(e,t){var n=this._playoutEngine.getMediaElement(this._rendererId);if(n){var r=e.blur;n.style.filter="blur(".concat(r,"px)")}t()}},{key:"switchFrom",value:function(){this.end()}},{key:"switchTo",value:function(){this.start()}},{key:"_clearBehaviourElements",value:function(){h(f(t.prototype),"_clearBehaviourElements",this).call(this);var e=this._playoutEngine.getMediaElement(this._rendererId);e&&(e.style.filter="")}},{key:"destroy",value:function(){this.end(),this._playoutEngine.unqueuePlayout(this._rendererId),h(f(t.prototype),"destroy",this).call(this)}}])&&c(n.prototype,r),u&&c(n,u),t}(r.default);t.default=m},"./src/renderers/SimpleAudioRenderer.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.symbol.js"),n("./node_modules/core-js/modules/es.symbol.description.js"),n("./node_modules/core-js/modules/es.symbol.iterator.js"),n("./node_modules/core-js/modules/es.array.iterator.js"),n("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),n("./node_modules/core-js/modules/es.object.get-prototype-of.js"),n("./node_modules/core-js/modules/es.object.set-prototype-of.js"),n("./node_modules/core-js/modules/es.object.to-string.js"),n("./node_modules/core-js/modules/es.parse-float.js"),n("./node_modules/core-js/modules/es.promise.js"),n("./node_modules/core-js/modules/es.reflect.get.js"),n("./node_modules/core-js/modules/es.string.iterator.js"),n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;u(n("./src/Player.js"));var r=u(n("./src/renderers/BaseRenderer.js")),i=n("./src/browserCapabilities.js"),o=n("./src/playoutEngines/BasePlayoutEngine.js"),a=(u(n("./src/Controller.js")),u(n("./src/logger.js"))),s=n("./src/utils.js");function u(e){return e&&e.__esModule?e:{default:e}}function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e,t,n){return(h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var m=function(e){function t(e,n,r,i,a,s){var u;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(u=function(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?d(e):t}(this,f(t).call(this,e,n,r,i,a,s)))._handlePlayPauseButtonClicked=u._handlePlayPauseButtonClicked.bind(d(u)),u._outTimeEventListener=u._outTimeEventListener.bind(d(u)),u._endedEventListener=u._endedEventListener.bind(d(u)),u._seekEventHandler=u._seekEventHandler.bind(d(u)),u.renderAudioElement(),u._renderBackgroundImage(),u._lastSetTime=0,u._inTime=0,u._outTime=-1,u._playoutEngine.queuePlayout(u._rendererId,{type:o.MEDIA_TYPES.FOREGROUND_A,id:u._representation.asset_collections.foreground_id,playPauseHandler:u._handlePlayPauseButtonClicked}),u}var n,r,u;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,e),n=t,(r=[{key:"_endedEventListener",value:function(){this._hasEnded||(this._hasEnded=!0,h(f(t.prototype),"complete",this).call(this))}},{key:"_outTimeEventListener",value:function(){var e=this.getCurrentTime().duration,t=this.getCurrentTime().currentTime,n=this._playoutEngine.getMediaElement(this._rendererId),r=this._playoutEngine.getCurrentTime(this._rendererId);this.checkIsLooping()?this._outTime>0&&n&&r>=this._outTime&&(n.currentTime=this._inTime,n.play()):(t=r-this._inTime,this._timer.setTime(t)),t>e&&(n&&n.pause(),this._endedEventListener())}},{key:"_seekEventHandler",value:function(){h(f(t.prototype),"seekEventHandler",this).call(this,this._inTime)}},{key:"_renderBackgroundImage",value:function(){var e=this;if(a.default.info("Rendering background image for audio representation ".concat(this._representation.id)),this._representation.asset_collections.background_image){var t=this._representation.asset_collections.background_image;this._fetchAssetCollection(t).then((function(t){return t.assets.image_src?e._fetchMedia(t.assets.image_src):Promise.resolve()})).then((function(t){e._backgroundImage=document.createElement("img"),e._backgroundImage.className="romper-render-image",e._setImageVisibility(!1),e._backgroundImage.src=t,e._target.appendChild(e._backgroundImage)})).catch((function(e){a.default.error(e,"Notfound")}))}}},{key:"start",value:function(){h(f(t.prototype),"start",this).call(this),this._setImageVisibility(!0),this._playoutEngine.setPlayoutActive(this._rendererId),a.default.info("Started: ".concat(this._representation.id)),this._playoutEngine.on(this._rendererId,"ended",this._endedEventListener),this._playoutEngine.on(this._rendererId,"seeked",this._seekEventHandler),this._playoutEngine.on(this._rendererId,"timeupdate",this._outTimeEventListener);var e=this._playoutEngine.getMediaElement(this._rendererId);e&&e.classList.add("romper-audio-element"),this._player.enablePlayButton(),this._player.enableScrubBar()}},{key:"end",value:function(){h(f(t.prototype),"end",this).call(this),this._setImageVisibility(!1),this._lastSetTime=0,this._playoutEngine.setPlayoutInactive(this._rendererId),a.default.info("Ended: ".concat(this._representation.id)),this._playoutEngine.off(this._rendererId,"ended",this._endedEventListener),this._playoutEngine.off(this._rendererId,"seeked",this._seekEventHandler),this._playoutEngine.off(this._rendererId,"timeupdate",this._outTimeEventListener);try{this._clearBehaviourElements()}catch(e){}var e=this._playoutEngine.getMediaElement(this._rendererId);e&&e.classList.remove("romper-audio-element")}},{key:"renderAudioElement",value:function(){var e=this;this._representation.asset_collections.foreground_id&&this._fetchAssetCollection(this._representation.asset_collections.foreground_id).then((function(t){t.meta&&t.meta.romper&&t.meta.romper.in&&e._setInTime(parseFloat(t.meta.romper.in)),t.meta&&t.meta.romper&&t.meta.romper.out&&e._setOutTime(parseFloat(t.meta.romper.out)),t.assets.audio_src&&e._fetchMedia(t.assets.audio_src,{mediaFormat:i.MediaFormats.getFormat(),mediaType:s.AUDIO}).then((function(n){e.populateAudioElement(n,t.loop)})).catch((function(e){a.default.error(e,"audio not found")})),t.assets.sub_src&&e._fetchMedia(t.assets.sub_src).then((function(t){e.populateAudioSubs(t)})).catch((function(e){a.default.error(e,"Subs not found")}))}))}},{key:"_setImageVisibility",value:function(e){this._backgroundImage&&(this._backgroundImage.style.opacity=e?"1":"0")}},{key:"populateAudioElement",value:function(e,t){this._destroyed?a.default.warn("trying to populate audio element that has been destroyed"):this._playoutEngine.queuePlayout(this._rendererId,{url:e,loop:t})}},{key:"populateAudioSubs",value:function(e){this._destroyed?a.default.warn("trying to populate audio element that has been destroyed"):this._playoutEngine.queuePlayout(this._rendererId,{subs_url:e})}},{key:"switchFrom",value:function(){this.end()}},{key:"switchTo",value:function(){this.start()}},{key:"destroy",value:function(){this.end(),this._playoutEngine.unqueuePlayout(this._rendererId),this._backgroundImage&&this._target.removeChild(this._backgroundImage),h(f(t.prototype),"destroy",this).call(this)}}])&&c(n.prototype,r),u&&c(n,u),t}(r.default);t.default=m},"./src/renderers/SimpleTextRenderer.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.symbol.js"),n("./node_modules/core-js/modules/es.symbol.description.js"),n("./node_modules/core-js/modules/es.symbol.iterator.js"),n("./node_modules/core-js/modules/es.array.concat.js"),n("./node_modules/core-js/modules/es.array.iterator.js"),n("./node_modules/core-js/modules/es.date.to-string.js"),n("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),n("./node_modules/core-js/modules/es.object.get-prototype-of.js"),n("./node_modules/core-js/modules/es.object.set-prototype-of.js"),n("./node_modules/core-js/modules/es.object.to-string.js"),n("./node_modules/core-js/modules/es.promise.js"),n("./node_modules/core-js/modules/es.reflect.get.js"),n("./node_modules/core-js/modules/es.regexp.to-string.js"),n("./node_modules/core-js/modules/es.string.iterator.js"),n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;o(n("./src/Player.js"));var r=o(n("./src/renderers/BaseRenderer.js")),i=(o(n("./src/Controller.js")),o(n("./src/logger.js")));function o(e){return e&&e.__esModule?e:{default:e}}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e,t,n){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=c(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var h=function(e){function t(e,n,r,i,o,a){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(s=u(this,c(t).call(this,e,n,r,i,o,a)))._target=i.mediaTarget,s}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,e),n=t,(r=[{key:"willStart",value:function(){l(c(t.prototype),"willStart",this).call(this),this.renderTextElement(),this._player.disablePlayButton(),this._player.disableScrubBar()}},{key:"start",value:function(){l(c(t.prototype),"start",this).call(this)}},{key:"end",value:function(){l(c(t.prototype),"end",this).call(this),i.default.info("Ended: ".concat(this._representation.id));try{this._target.removeChild(this._textDiv)}catch(e){i.default.warn("could not remove text renderer element")}this._player.enablePlayButton(),this._player.enableScrubBar()}},{key:"renderTextElement",value:function(){var e=this;this._textDiv=document.createElement("div"),this._textDiv.classList.add("romper-text-element"),this._representation.asset_collections.foreground_id?this._fetchAssetCollection(this._representation.asset_collections.foreground_id).then((function(t){t.assets.text_src?e._fetchMedia(t.assets.text_src).then((function(t){e._fetchTextContent(t)})).catch((function(e){i.default.error(e,"text not found")})):i.default.warn("No text content found")})):this._representation.description&&(this.populateTextElement(this._representation.description),i.default.warn("Text Renderer has no asset collection - rendering description"))}},{key:"_fetchTextContent",value:function(e){var t=this;fetch(e).then((function(e){return e.ok?e.text():Promise.reject(new Error("Invalid response: ".concat(e.toString())))})).then((function(e){return t.populateTextElement(e)})).catch((function(t){i.default.error("could not fetch text content ".concat(e,": ").concat(t.status," ").concat(t.statusText))}))}},{key:"populateTextElement",value:function(e){this._textDiv.innerHTML=e,this._target.appendChild(this._textDiv)}},{key:"destroy",value:function(){this.end(),l(c(t.prototype),"destroy",this).call(this)}}])&&s(n.prototype,r),o&&s(n,o),t}(r.default);t.default=h},"./src/renderers/StoryIconRenderer.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.symbol.js"),n("./node_modules/core-js/modules/es.symbol.description.js"),n("./node_modules/core-js/modules/es.symbol.iterator.js"),n("./node_modules/core-js/modules/es.array.find.js"),n("./node_modules/core-js/modules/es.array.for-each.js"),n("./node_modules/core-js/modules/es.array.iterator.js"),n("./node_modules/core-js/modules/es.array.reduce.js"),n("./node_modules/core-js/modules/es.array.slice.js"),n("./node_modules/core-js/modules/es.function.name.js"),n("./node_modules/core-js/modules/es.object.get-prototype-of.js"),n("./node_modules/core-js/modules/es.object.keys.js"),n("./node_modules/core-js/modules/es.object.set-prototype-of.js"),n("./node_modules/core-js/modules/es.object.to-string.js"),n("./node_modules/core-js/modules/es.promise.js"),n("./node_modules/core-js/modules/es.string.iterator.js"),n("./node_modules/core-js/modules/web.dom-collections.for-each.js"),n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,i=(r=n("./node_modules/events/events.js"))&&r.__esModule?r:{default:r},o=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==u(e)&&"function"!=typeof e)return{default:e};var t=s();if(t&&t.has(e))return t.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=r?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(n,i,o):n[i]=e[i]}n.default=e,t&&t.set(e,n);return n}(n("./src/Player.js")),a=n("./src/Events.js");function s(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return s=function(){return e},e}function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=function(e){function t(e,n,r,i){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?d(e):t}(this,c(t).call(this)))._handleIconClicked=o._handleIconClicked.bind(d(o)),o._pathItemList=e,o._fetchAssetCollection=n,o._fetchMedia=r,o._player=i,o._iconUrlMap={},o._preloadedIcons=[],o}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(t,e),n=t,i=[{key:"_buildUrlMap",value:function(e,t){return t.reduce((function(t,n,r){return t[e[r].representation.id]={default:n.default,active:n.active},t}),{})}},{key:"_findLongestCommonList",value:function(e){var t=e[0];return e.forEach((function(e){for(;t.length>e.length;)t.pop();for(var n=t.length-1;n>0;n-=1)t[n]!==e[n]&&t.pop()})),t}}],(r=[{key:"start",value:function(e){var n=this;this._pathItemList.length<=0||(this._currentRepresentationId=this._pathItemList[0].representation.id,this._getIconAssets().then((function(r){n._iconUrlMap=t._buildUrlMap(n._pathItemList,r),n.preloadIcons(),n._deepestCommonSubstory=n._findSubStories(),n._pathItemList.forEach((function(e,t){var r=e.representation.id,i=n._iconUrlMap[r],o=e.representation.name?"".concat(e.representation.name):"Chapter ".concat(t+1);i&&n._player.addIconControl(r,i.default?i.default:"",!1,o,"".concat(t))})),n._showHideTarget(),n.handleNarrativeElementChanged(e)})),this._player.on(o.PlayerEvents.ICON_CLICKED,this._handleIconClicked))}},{key:"preloadIcons",value:function(){var e=this;this._preloadedIcons=[],Object.keys(this._iconUrlMap).forEach((function(t){var n=e._iconUrlMap[t].default,r=e._iconUrlMap[t].active;if(n){var i=new Image;i.src=n,e._preloadedIcons.push(i)}if(r){var o=new Image;o.src=r,e._preloadedIcons.push(o)}}))}},{key:"_handleIconClicked",value:function(e){var t=this._pathItemList.find((function(t){return t.representation&&t.representation.id===e.id}));t&&this.emit(a.REASONER_EVENTS.JUMP_TO_NARRATIVE_ELEMENT,t.narrative_element.id)}},{key:"_getIconAssets",value:function(){var e=this,t=[];return this._pathItemList.forEach((function(n){if(n.representation.asset_collections.icon){var r=n.representation.asset_collections.icon;r.default_id?t.push(e._fetchAssetCollection(r.default_id)):t.push(Promise.resolve(null)),r.active_id?t.push(e._fetchAssetCollection(r.active_id)):t.push(Promise.resolve(null))}else t.push(Promise.resolve(null)),t.push(Promise.resolve(null))})),Promise.all(t).then((function(t){var n=[];return t.forEach((function(t){t&&t.assets.image_src?n.push(e._fetchMedia(t.assets.image_src)):n.push(Promise.resolve(null))})),Promise.all(n)})).then((function(e){for(var t=[],n=0;n<e.length;n+=2){var r={default:e[n],active:e[n+1]};t.push(r)}return t}))}},{key:"handleNarrativeElementChanged",value:function(e){var t=this;this._currentRepresentationId=e,Object.keys(this._iconUrlMap).forEach((function(n){var r=t._iconUrlMap[n];n===e&&r?t._player.setIconControl(n,r.active?r.active:"",!0):n===e&&r?t._player.setIconControl(n,r.default?r.default:"",!0):r&&t._player.setIconControl(n,r.default?r.default:"",!1);var i="chapter".concat(t._getRepresentationIndex(e));t._player._icon.setButtonClass(i)})),this._showHideTarget()}},{key:"_getRepresentationIndex",value:function(e){var t=-1;return this._pathItemList.forEach((function(n,r){n.representation&&n.representation.id===e&&(t=r)})),t}},{key:"_showHideTarget",value:function(){}},{key:"_findSubStories",value:function(){var e=this,n=[];Object.keys(this._iconUrlMap).forEach((function(t,r){if(null!==e._iconUrlMap[t]){var i=e._pathItemList[r];n.push(i.stories.slice(0))}}));var r=t._findLongestCommonList(n);return r[r.length-1]}}])&&l(n.prototype,r),i&&l(n,i),t}(i.default);t.default=f},"./src/renderers/SwitchableRenderer.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.symbol.js"),n("./node_modules/core-js/modules/es.symbol.description.js"),n("./node_modules/core-js/modules/es.symbol.iterator.js"),n("./node_modules/core-js/modules/es.array.filter.js"),n("./node_modules/core-js/modules/es.array.for-each.js"),n("./node_modules/core-js/modules/es.array.iterator.js"),n("./node_modules/core-js/modules/es.array.map.js"),n("./node_modules/core-js/modules/es.array.some.js"),n("./node_modules/core-js/modules/es.date.to-string.js"),n("./node_modules/core-js/modules/es.function.name.js"),n("./node_modules/core-js/modules/es.number.constructor.js"),n("./node_modules/core-js/modules/es.number.is-nan.js"),n("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),n("./node_modules/core-js/modules/es.object.get-prototype-of.js"),n("./node_modules/core-js/modules/es.object.set-prototype-of.js"),n("./node_modules/core-js/modules/es.object.to-string.js"),n("./node_modules/core-js/modules/es.parse-int.js"),n("./node_modules/core-js/modules/es.promise.js"),n("./node_modules/core-js/modules/es.reflect.get.js"),n("./node_modules/core-js/modules/es.regexp.to-string.js"),n("./node_modules/core-js/modules/es.string.iterator.js"),n("./node_modules/core-js/modules/web.dom-collections.for-each.js"),n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==d(e)&&"function"!=typeof e)return{default:e};var t=c();if(t&&t.has(e))return t.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=r?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(n,i,o):n[i]=e[i]}n.default=e,t&&t.set(e,n);return n}(n("./src/Player.js")),i=l(n("./src/renderers/BaseRenderer.js")),o=l(n("./src/renderers/RendererFactory.js")),a=l(n("./src/renderers/RendererEvents.js")),s=l(n("./src/logger.js")),u=l(n("./src/AnalyticEvents.js"));l(n("./src/Controller.js"));function l(e){return e&&e.__esModule?e:{default:e}}function c(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return c=function(){return e},e}function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e,t,n){return(p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=m(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var g=function(e){function t(e,n,r,i,o,a){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(s=function(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?f(e):t}(this,m(t).call(this,e,n,r,i,o,a)))._handleChoiceClicked=s._handleChoiceClicked.bind(f(s)),s._switchableIsQueuedNotPlaying=!0,s._currentRendererIndex=0,s._updateChoiceRenderers(),s._previousRendererPlayheadTime=0,s._nodeCompleted=!1,s._inCompleteBehaviours=!1,s._controller=a,s._preloadSwitchIcons(),s._preloadedSwitchIcons=[],s}var n,i,l;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(t,e),n=t,(i=[{key:"_updateChoiceRenderers",value:function(){var e=this,t=[];if(this._switchableIsQueuedNotPlaying)this._choiceRenderers&&0!==this._choiceRenderers.length?(t=null===this._choiceRenderers[this._currentRendererIndex]?this._getQueuedChoiceRenderer():this._choiceRenderers.map((function(t,n){return n===e._currentRendererIndex?t:null})),this._choiceRenderers.filter((function(t,n){return n!==e._currentRendererIndex})).forEach((function(e){e&&e.destroy()}))):t=this._getQueuedChoiceRenderer();else{var n=(t=this._choiceRenderers).some((function(e){return null===e}));(0===t.length||n)&&this._getRemainingChoiceRenderers().forEach((function(e,n){null!==e&&null===t[n]&&(t[n]=e)}))}this._choiceRenderers=t}},{key:"_getRemainingChoiceRenderers",value:function(){var e=this,t=[];return this._representation.choices&&((t=this._representation.choices.map((function(t,n){return t.choice_representation&&n!==e._currentRendererIndex?(0,o.default)(t.choice_representation,e._fetchAssetCollection,e._fetchMedia,e._player,e._analytics,e._controller):null}))).forEach((function(e){if(e){var t=e;t.on(a.default.COMPLETE_START_BEHAVIOURS,(function(){t.start()}))}})),t.forEach((function(t){if(t){var n=t;n.on(a.default.COMPLETED,(function(){e._nodeCompleted||e.complete(),e._nodeCompleted=!0})),n.on(a.default.STARTED_COMPLETE_BEHAVIOURS,(function(){e._inCompleteBehaviours=!0,e._disableSwitchButtons()}))}}))),t}},{key:"_getQueuedChoiceRenderer",value:function(){var e=this,t=[];return this._representation.choices&&((t=this._representation.choices.map((function(t,n){return t.choice_representation&&n===e._currentRendererIndex?(0,o.default)(t.choice_representation,e._fetchAssetCollection,e._fetchMedia,e._player,e._analytics,e._controller):null}))).forEach((function(e){if(e){var t=e;t.on(a.default.COMPLETE_START_BEHAVIOURS,(function(){t.start()}))}})),t.forEach((function(t){if(t){var n=t;n.on(a.default.COMPLETED,(function(){e._nodeCompleted||e.complete(),e._nodeCompleted=!0})),n.on(a.default.STARTED_COMPLETE_BEHAVIOURS,(function(){e._inCompleteBehaviours=!0,e._disableSwitchButtons()}))}}))),t}},{key:"_preloadSwitchIcons",value:function(){var e=this;this._preloadedSwitchIcons=[],this._representation.choices&&this._representation.choices.forEach((function(t){t.choice_representation&&t.choice_representation.asset_collections&&t.choice_representation.asset_collections.icon&&t.choice_representation.asset_collections.icon.default_id&&e._fetchAssetCollection(t.choice_representation.asset_collections.icon.default_id).then((function(t){return t.assets.image_src?e._fetchMedia(t.assets.image_src):Promise.resolve()})).then((function(t){if(t){var n=new Image;n.src=t,e._preloadedSwitchIcons.push(n)}}))}))}},{key:"_renderSwitchButtons",value:function(){var e=this;this._player.clearAllRepresentationControls(),this._representation.choices&&this._representation.choices.forEach((function(t,n){if(t.choice_representation&&t.choice_representation.asset_collections){var r=t.choice_representation.name,i=function(t){e._player.addRepresentationControl("".concat(n),t,r);var i=e._currentRendererIndex.toString();e._player.setActiveRepresentationControl(i)};t.choice_representation.asset_collections.icon&&t.choice_representation.asset_collections.icon.default_id?e._fetchAssetCollection(t.choice_representation.asset_collections.icon.default_id).then((function(t){t.assets.image_src&&e._fetchMedia(t.assets.image_src).then(i).catch((function(e){s.default.error(e,"Notfound")}))})):i("")}}))}},{key:"setCurrentTime",value:function(e){var t=this._choiceRenderers[this._currentRendererIndex];t?t.setCurrentTime(e):s.default.error("Setting time on switchable but no current choice")}},{key:"getCurrentTime",value:function(){var e=this._choiceRenderers[this._currentRendererIndex];return e?e.getCurrentTime():(s.default.error("Getting time on switchable but no current choice"),p(m(t.prototype),"getCurrentTime",this).call(this))}},{key:"switchToRepresentationAtIndex",value:function(e){if(e>=0&&e<this._choiceRenderers.length){var t=this._choiceRenderers[this._currentRendererIndex];if(t){var n=t.getCurrentTime();n.timeBased&&(this._previousRendererPlayheadTime=n.currentTime),t.switchFrom()}this._currentRendererIndex!==e&&(this._currentRendererIndex=e,this._updateChoiceRenderers());var r=this._choiceRenderers[this._currentRendererIndex];r&&(this._player.setCurrentRenderer(this),this._logSwitch(),r.switchTo(),this._representation.choices&&this._representation.choices[e]&&this.emit(a.default.SWITCHED_REPRESENTATION,this._representation.choices[e]),r.setCurrentTime(this._previousRendererPlayheadTime))}}},{key:"_logSwitch",value:function(){var e="unknown";this._choiceRenderers[this._currentRendererIndex]&&(e=this._choiceRenderers[this._currentRendererIndex]._representation.name);var t={type:u.default.types.RENDERER_ACTION,name:u.default.names.SWITCHABLE_REPRESENTATION_SWITCH,from:this._representation.name,to:e};this._analytics(t)}},{key:"setChoiceToRepresentationWithLabel",value:function(e){var t=this;return this._representation.choices&&this._representation.choices.forEach((function(n,r){e===n.label&&t._currentRendererIndex!==r&&(t._currentRendererIndex=r,t._updateChoiceRenderers())})),this._currentRendererIndex}},{key:"start",value:function(){this._switchableIsQueuedNotPlaying=!1,this._updateChoiceRenderers(),this._previousRendererPlayheadTime=0,this._renderSwitchButtons(),this._player.on(r.PlayerEvents.REPRESENTATION_CLICKED,this._handleChoiceClicked);var e=this._choiceRenderers[this._currentRendererIndex];e&&e.willStart()}},{key:"end",value:function(){var e=this;if(p(m(t.prototype),"end",this).call(this),!1===this._switchableIsQueuedNotPlaying){this._switchableIsQueuedNotPlaying=!0,this._updateChoiceRenderers();var n=this._choiceRenderers[this._currentRendererIndex];n&&n.end(),this._representation.choices&&this._representation.choices.forEach((function(t,n){e._player.removeRepresentationControl("".concat(n))}))}this._player.removeListener(r.PlayerEvents.REPRESENTATION_CLICKED,this._handleChoiceClicked),this._inCompleteBehaviours=!1,this._nodeCompleted=!1}},{key:"_handleChoiceClicked",value:function(e){var t=parseInt(e.id,10);this._inCompleteBehaviours||Number.isNaN(t)||this.switchToRepresentationAtIndex(t)}},{key:"_disableSwitchButtons",value:function(){var e=this;this._representation.choices&&this._representation.choices.forEach((function(t,n){e._player.deactivateRepresentationControl("".concat(n))}))}},{key:"getRepresentation",value:function(){if(this._representation.choices&&this._representation.choices.length>=this._currentRendererIndex){var e=this._representation.choices[this._currentRendererIndex];if(e.choice_representation)return e.choice_representation}return this._representation}},{key:"destroy",value:function(){p(m(t.prototype),"destroy",this).call(this),this._choiceRenderers.forEach((function(e){e&&e.destroy()})),this._choiceRenderers=[]}}])&&h(n.prototype,i),l&&h(n,l),t}(i.default);t.default=g},"./src/renderers/ThreeJsBaseRenderer.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.symbol.js"),n("./node_modules/core-js/modules/es.symbol.description.js"),n("./node_modules/core-js/modules/es.symbol.iterator.js"),n("./node_modules/core-js/modules/es.array.concat.js"),n("./node_modules/core-js/modules/es.array.for-each.js"),n("./node_modules/core-js/modules/es.array.includes.js"),n("./node_modules/core-js/modules/es.array.iterator.js"),n("./node_modules/core-js/modules/es.array.map.js"),n("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),n("./node_modules/core-js/modules/es.object.get-prototype-of.js"),n("./node_modules/core-js/modules/es.object.keys.js"),n("./node_modules/core-js/modules/es.object.set-prototype-of.js"),n("./node_modules/core-js/modules/es.object.to-string.js"),n("./node_modules/core-js/modules/es.object.values.js"),n("./node_modules/core-js/modules/es.parse-int.js"),n("./node_modules/core-js/modules/es.reflect.get.js"),n("./node_modules/core-js/modules/es.string.includes.js"),n("./node_modules/core-js/modules/es.string.iterator.js"),n("./node_modules/core-js/modules/web.dom-collections.for-each.js"),n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;s(n("./src/Player.js"));var r=s(n("./src/renderers/BaseRenderer.js")),i=s(n("./src/AnalyticEvents.js")),o=(s(n("./src/Controller.js")),s(n("./src/logger.js"))),a=n("./src/InternalVariables.js");function s(e){return e&&e.__esModule?e:{default:e}}function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e,t,n){return(h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var m=n("./node_modules/three/build/three.module.js"),v=function(e){function t(e,n,r,i,o,a){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(s=function(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?d(e):t}(this,f(t).call(this,e,n,r,i,o,a)))._setOrientationVariable=s._setOrientationVariable.bind(d(s)),s._onMouseDown=s._onMouseDown.bind(d(s)),s._onMouseMove=s._onMouseMove.bind(d(s)),s._onMouseUp=s._onMouseUp.bind(d(s)),s._onKeyDown=s._onKeyDown.bind(d(s)),s._onKeyUp=s._onKeyUp.bind(d(s)),s._orientationWatcher=null,s._rendered=!1,s._view={onPointerDownPointerX:0,onPointerDownPointerY:0,onPointerDownLon:0,onPointerDownLat:0,lon:0,lat:0,distance:50},s._oldOrientation={phi:0,theta:0},s._userInteracting=!1,s._userDragging=!1,s._icons={},s._readyToShowIcons=!1,s._raycaster=new m.Raycaster,s}var n,r,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,e),n=t,s=[{key:"_isArrowKey",value:function(e){return"ArrowLeft"===e.code||"ArrowRight"===e.code||"ArrowDown"===e.code||"ArrowUp"===e.code}}],(r=[{key:"start",value:function(){h(f(t.prototype),"start",this).call(this),o.default.info("Started: ".concat(this._representation.id)),this._hasEnded=!1,this._started=!0,this._controller.handleKeys&&(document.addEventListener("keydown",this._onKeyDown),document.addEventListener("keyup",this._onKeyUp)),this._createScene()}},{key:"_addReticle",value:function(){var e=new m.CircleGeometry(1,32),t=new m.MeshBasicMaterial({color:3626602,transparent:!0,opacity:.8});this._sceneReticle=new m.Mesh(e,t);var n=Math.PI/2,r=15*Math.sin(n)*Math.cos(0),i=15*Math.cos(n),o=15*Math.sin(n)*Math.sin(0);this._sceneReticle.rotateY(1.5*Math.PI-0),this._sceneReticle.position.set(r,i,o),this._scene.add(this._sceneReticle)}},{key:"_positionReticle",value:function(e,t){var n=15*Math.sin(e)*Math.cos(t),r=15*Math.cos(e),i=15*Math.sin(e)*Math.sin(t);this._sceneReticle.rotation.y=1.5*Math.PI-t,this._sceneReticle.position.set(n,r,i)}},{key:"_createScene",value:function(){var e=this;this._applyPreviousOrientation();var t=this._player.mediaTarget;o.default.info("Starting 3js video scene"),this._scene=new m.Scene,this._camera=new m.PerspectiveCamera(75,16/9,1,1e3),this._camera.layers.enable(1),this._camera.target=new m.Vector3(0,0,0);var n=new m.WebGLRenderer;n.setPixelRatio(window.devicePixelRatio),this._domElement=n.domElement,this._domElement.classList.add("romper-threejs"),this._addReticle();var r=this._player._overlays;r.addEventListener("mousedown",this._onMouseDown,!1),r.addEventListener("mouseup",this._onMouseUp,!1),r.addEventListener("mousemove",this._onMouseMove,!1),r.addEventListener("mouseout",this._onMouseUp,!1),t.appendChild(this._domElement),n.setSize(1600,900),this._update=function(){var t=Math.max(-85,Math.min(85,e._view.lat)),r=m.Math.degToRad(90-t),i=m.Math.degToRad(e._view.lon),o=new m.Vector3(e._view.distance*Math.sin(r)*Math.cos(i),e._view.distance*Math.cos(r),e._view.distance*Math.sin(r)*Math.sin(i));e._positionReticle(r,i),e._camera.lookAt(o),n.render(e._scene,e._camera),e._testIfViewingIcon()}}},{key:"_applyPreviousOrientation",value:function(){var e=this;this._controller.getVariableValue(a.InternalVariableNames.LONGITUDE).then((function(t){null!==t&&(o.default.info("Maintaining 360 orientation at ".concat(t," longitude")),e._view.lon=t)})),this._controller.getVariableValue(a.InternalVariableNames.LATITUDE).then((function(t){null!==t&&(o.default.info("Maintaining 360 orientation at ".concat(t," latitude")),e._view.lat=t)}))}},{key:"_animate",value:function(){var e=this;!function t(){requestAnimationFrame(t),e._update()}(),this._domElement.style.width="100%",this._domElement.style.height="100%",this._orientationWatcher=setInterval(this._setOrientationVariable,2e3)}},{key:"_onKeyDown",value:function(e){var n=this;this._userDragging&&t._isArrowKey(e)?e.preventDefault():(t._isArrowKey(e)&&(this._userInteracting=!0,this._userDragging=!0,e.preventDefault()),"ArrowLeft"===e.code?this._moveInterval=setInterval((function(){n._view.lon-=1,n._view.lon=(360+n._view.lon)%360}),50):"ArrowRight"===e.code?this._moveInterval=setInterval((function(){n._view.lon+=1,n._view.lon=(360+n._view.lon)%360}),50):"ArrowUp"===e.code?this._moveInterval=setInterval((function(){n._view.lat+=.5}),50):"ArrowDown"===e.code&&(this._moveInterval=setInterval((function(){n._view.lat-=.5}),50)))}},{key:"_onKeyUp",value:function(){this._userInteracting=!1,this._userDragging=!1,this._moveInterval&&clearInterval(this._moveInterval)}},{key:"_onMouseDown",value:function(e){this._userInteracting=!0,this._userDragging=!1,this._view.onPointerDownPointerX=e.clientX,this._view.onPointerDownPointerY=e.clientY,this._view.onPointerDownLon=this._view.lon,this._view.onPointerDownLat=this._view.lat}},{key:"_onMouseMove",value:function(e){this._userInteracting&&(this._userDragging=!0,this._view.lon=.1*(this._view.onPointerDownPointerX-e.clientX)+this._view.onPointerDownLon,this._view.lon=(360+this._view.lon)%360,this._view.lat=.1*(e.clientY-this._view.onPointerDownPointerY)+this._view.onPointerDownLat)}},{key:"_onMouseUp",value:function(e){var t=this;if(this._userInteracting=!1,!this._userDragging){var n=new m.Vector3(e.offsetX/this._domElement.clientWidth*2-1,-e.offsetY/this._domElement.clientHeight*2+1,.5),r=new m.Raycaster,i=Object.values(this._icons).map((function(e){return e.iconPlane}));r.setFromCamera(n,this._camera);var a=r.intersectObjects(i);if(a.length>0){var s=a[0].object;Object.keys(this._icons).forEach((function(e){var n=t._icons[e];n&&s===n.iconPlane&&(o.default.info("User has clicked icon for ".concat(e," - following link")),t._followLink(e,n.behaviourId))}))}}}},{key:"_testIfViewingIcon",value:function(){var e=this,t=new m.Vector3(0,0,0),n=new m.Vector3(0,0,0);this._camera.getWorldDirection(n),this._raycaster.set(t,n);var r=Object.values(this._icons).map((function(e){return e.iconPlane})),i=this._raycaster.intersectObjects(r);if(i.length>0){this._sceneReticle.visible=!0;var a=i.map((function(e){return e.object}));Object.keys(this._icons).forEach((function(t){var n=e._icons[t],r=n.iconPlane;if(a.includes(r)){n.viewCount+=1;var i=1-n.viewCount/50;e._sceneReticle.scale.set(i,i,i)}else n.viewCount=0;n.viewCount>50&&(o.default.info("User has viewed icon for ".concat(t," for 2s - following link")),e._followLink(t,n.behaviourId),n.viewCount=0)}))}else this._sceneReticle.visible=!1,this._sceneReticle.scale.set(1,1,1),Object.keys(this._icons).forEach((function(t){e._icons[t].viewCount=0}))}},{key:"_setOrientationVariable",value:function(){var e,t=this._view,n=t.lat,r=t.lon,o=parseInt(r,10),s=parseInt(n,10);if(o!==this._oldOrientation.phi||s!==this._oldOrientation.theta){var u="".concat(this._oldOrientation.phi,", ").concat(this._oldOrientation.theta);this._oldOrientation={phi:o,theta:s},this._controller.setVariables((l(e={},a.InternalVariableNames.LONGITUDE,o),l(e,a.InternalVariableNames.LATITUDE,s),e));var c={type:i.default.types.USER_ACTION,name:i.default.names.VR_ORIENTATION_CHANGED,from:u,to:"".concat(o," ").concat(s)};this._analytics(c)}}},{key:"_addIcon",value:function(e,t,n,r,i){var a=this,s=t.lat,u=t.long,l=t.radius,c=n.width,d=n.height;o.default.info("Adding threejs icon for ".concat(r,", src ").concat(e,", at (").concat(s,", ").concat(u,")"));var h=m.Math.degToRad(90-s),f=m.Math.degToRad(u),p=l*Math.sin(h)*Math.cos(f),v=l*Math.cos(h),g=l*Math.sin(h)*Math.sin(f),y=new m.ImageBitmapLoader,_=new m.PlaneGeometry(c,d);y.load(e,(function(e){var t=new m.CanvasTexture(e),n=new m.MeshBasicMaterial({map:t}),o=new m.Mesh(_,n);o.rotateY(1.5*Math.PI-f),o.position.set(p,v,g),a._icons[r]={iconPlane:o,viewCount:0,behaviourId:i},a._readyToShowIcons&&a._scene.add(o)}))}},{key:"end",value:function(){h(f(t.prototype),"end",this).call(this),this._domElement&&this._domElement.parentNode&&this._domElement.parentNode.removeChild(this._domElement),this._icons={},this._readyToShowIcons=!1;var e=this._player._overlays;e.removeEventListener("mousedown",this._onMouseDown),e.removeEventListener("mouseup",this._onMouseUp),e.removeEventListener("mousemove",this._onMouseMove),this._controller.handleKeys&&(document.removeEventListener("keydown",this._onKeyDown),document.removeEventListener("keyup",this._onKeyUp)),this._orientationWatcher&&clearInterval(this._orientationWatcher),this._started=!1,this._rendered=!1}},{key:"destroy",value:function(){h(f(t.prototype),"destroy",this).call(this)}}])&&c(n.prototype,r),s&&c(n,s),t}(r.default);t.default=v},"./src/renderers/ThreeJsImageRenderer.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.symbol.js"),n("./node_modules/core-js/modules/es.symbol.description.js"),n("./node_modules/core-js/modules/es.symbol.iterator.js"),n("./node_modules/core-js/modules/es.array.concat.js"),n("./node_modules/core-js/modules/es.array.for-each.js"),n("./node_modules/core-js/modules/es.array.iterator.js"),n("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),n("./node_modules/core-js/modules/es.object.get-prototype-of.js"),n("./node_modules/core-js/modules/es.object.keys.js"),n("./node_modules/core-js/modules/es.object.set-prototype-of.js"),n("./node_modules/core-js/modules/es.object.to-string.js"),n("./node_modules/core-js/modules/es.reflect.get.js"),n("./node_modules/core-js/modules/es.string.iterator.js"),n("./node_modules/core-js/modules/web.dom-collections.for-each.js"),n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;o(n("./src/Player.js"));var r=o(n("./src/renderers/ThreeJsBaseRenderer.js")),i=(o(n("./src/Controller.js")),o(n("./src/logger.js")));function o(e){return e&&e.__esModule?e:{default:e}}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e,t,n){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=c(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var h=n("./node_modules/three/build/three.module.js"),f=function(e){function t(e,n,r,i,o,a){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(s=u(this,c(t).call(this,e,n,r,i,o,a)))._disablePlayButton=function(){s._player.disablePlayButton()},s._enablePlayButton=function(){s._player.enablePlayButton()},s._disableScrubBar=function(){s._player.disableScrubBar()},s._enableScrubBar=function(){s._player.enableScrubBar()},s.renderImageElement(),s._timeElapsed=0,s._duration=1/0,s._timedEvents={},s}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,e),n=t,(r=[{key:"start",value:function(){l(c(t.prototype),"start",this).call(this),i.default.info("Starting ThreeJs image"),this._rendered&&this._showImage(),this._representation.duration&&this._representation.duration>0&&(this._duration=this._representation.duration,this._timeElapsed=0,i.default.info("360 Image representation ".concat(this._representation.id," timed for ").concat(this._representation.duration,"s, starting now"))),this._representation.duration&&0===this._representation.duration?this.complete():this._startTimer(),this._disableScrubBar(),this._disablePlayButton()}},{key:"pause",value:function(){clearInterval(this._imageTimer)}},{key:"_startTimer",value:function(){var e=this;this._imageTimer=setInterval((function(){e._timeElapsed+=.1,e._timeElapsed>=e._duration&&(i.default.info("Image representation ".concat(e._representation.id," completed timeout")),e.complete()),Object.keys(e._timedEvents).forEach((function(t){var n=e._timedEvents[t],r=n.time,i=n.callback;e._timeElapsed>=r&&(delete e._timedEvents[t],i())}))}),100)}},{key:"getCurrentTime",value:function(){return this._representation.duration&&this._representation.duration>0?{timeBased:!0,currentTime:this._timeElapsed,remainingTime:this._duration-this._timeElapsed}:l(c(t.prototype),"getCurrentTime",this).call(this)}},{key:"play",value:function(){this._startTimer()}},{key:"addTimeEventListener",value:function(e,t,n){this._timedEvents[e]={time:t,callback:n}}},{key:"deleteTimeEventListener",value:function(e){e in this._timedEvents&&delete this._timedEvents[e]}},{key:"end",value:function(){l(c(t.prototype),"end",this).call(this),this._imageTimer&&clearInterval(this._imageTimer),this._timedEvents={}}},{key:"_showImage",value:function(){this._scene.add(this._imageMesh),this._animate()}},{key:"renderImageElement",value:function(){var e=this;this._representation.asset_collections.foreground_id&&this._fetchAssetCollection(this._representation.asset_collections.foreground_id).then((function(t){t.assets.image_src&&e._fetchMedia(t.assets.image_src).then((function(t){return e.populateImageElement(t)})).catch((function(e){i.default.error(e,"Image not found")}))}))}},{key:"populateImageElement",value:function(e){var t=new h.TextureLoader;t.setCrossOrigin("");var n=t.load(e),r=new h.MeshBasicMaterial({map:n}),i=new h.SphereBufferGeometry(500,60,40);i.scale(-1,1,1),this._imageMesh=new h.Mesh(i,r),this._rendered=!0,this._started&&this._showImage()}}])&&s(n.prototype,r),o&&s(n,o),t}(r.default);t.default=f},"./src/renderers/ThreeJsVideoRenderer.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.symbol.js"),n("./node_modules/core-js/modules/es.symbol.description.js"),n("./node_modules/core-js/modules/es.symbol.iterator.js"),n("./node_modules/core-js/modules/es.array.concat.js"),n("./node_modules/core-js/modules/es.array.iterator.js"),n("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),n("./node_modules/core-js/modules/es.object.get-prototype-of.js"),n("./node_modules/core-js/modules/es.object.set-prototype-of.js"),n("./node_modules/core-js/modules/es.object.to-string.js"),n("./node_modules/core-js/modules/es.parse-float.js"),n("./node_modules/core-js/modules/es.reflect.get.js"),n("./node_modules/core-js/modules/es.string.iterator.js"),n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;u(n("./src/Player.js"));var r=u(n("./src/renderers/ThreeJsBaseRenderer.js")),i=(u(n("./src/Controller.js")),n("./src/playoutEngines/BasePlayoutEngine.js")),o=u(n("./src/logger.js")),a=n("./src/browserCapabilities.js"),s=n("./src/utils.js");function u(e){return e&&e.__esModule?e:{default:e}}function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e,t,n){return(h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var m=n("./node_modules/three/build/three.module.js"),v=function(e){function t(e,n,r,o,a,s){var u;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(u=function(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?d(e):t}(this,f(t).call(this,e,n,r,o,a,s)))._endedEventListener=u._endedEventListener.bind(d(u)),u._handlePlayPauseButtonClicked=u._handlePlayPauseButtonClicked.bind(d(u)),u._outTimeEventListener=u._outTimeEventListener.bind(d(u)),u._playoutEngine.queuePlayout(u._rendererId,{type:i.MEDIA_TYPES.FOREGROUND_AV,playPauseHandler:u._handlePlayPauseButtonClicked}),u._setInTime=u._setInTime.bind(d(u)),u._setOutTime=u._setOutTime.bind(d(u)),u._inTime=0,u._outTime=-1,u._lastSetTime=0,u.renderVideoElement(),u}var n,r,u;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,e),n=t,(r=[{key:"_endedEventListener",value:function(){o.default.info("360 video ended"),this._hasEnded||(this._hasEnded=!0,h(f(t.prototype),"complete",this).call(this))}},{key:"_outTimeEventListener",value:function(){var e=this.getCurrentTime().duration,t=this.getCurrentTime().currentTime,n=this._playoutEngine.getMediaElement(this._rendererId),r=this._playoutEngine.getCurrentTime(this._rendererId);this.checkIsLooping()?this._outTime>0&&n&&r>=this._outTime&&(n.currentTime=this._inTime,n.play()):(t=r-this._inTime,this._timer.setTime(t)),t>e&&(n&&n.pause(),this._endedEventListener())}},{key:"start",value:function(){h(f(t.prototype),"start",this).call(this),this._startThreeSixtyVideo(),this.setCurrentTime(this._lastSetTime),this._player.enablePlayButton(),this._player.enableScrubBar()}},{key:"_startThreeSixtyVideo",value:function(){var e=this._playoutEngine.getMediaElement(this._rendererId),t=new m.VideoTexture(e),n=new m.MeshBasicMaterial({map:t}),r=new m.SphereBufferGeometry(500,60,40);r.scale(-1,1,1);var i=new m.Mesh(r,n);this._scene.add(i),this._playoutEngine.on(this._rendererId,"ended",this._endedEventListener),this._playoutEngine.on(this._rendererId,"timeupdate",this._outTimeEventListener),this._playoutEngine.setPlayoutActive(this._rendererId),e&&(e.style.visibility="hidden"),this._animate()}},{key:"renderVideoElement",value:function(){var e=this;this._representation.asset_collections.foreground_id&&this._fetchAssetCollection(this._representation.asset_collections.foreground_id).then((function(t){if(t.assets.av_src){t.meta&&t.meta.romper&&t.meta.romper.in&&e._setInTime(parseFloat(t.meta.romper.in)),t.meta&&t.meta.romper&&t.meta.romper.out&&e._setOutTime(parseFloat(t.meta.romper.out));var n={mediaFormat:a.MediaFormats.getFormat(),mediaType:s.VIDEO};e._fetchMedia(t.assets.av_src,n).then((function(n){var r=n;if(e._inTime>0||e._outTime>0){var i="#t=".concat(e._inTime);e._outTime>0&&(i="".concat(i,",").concat(e._outTime)),r="".concat(n).concat(i)}e.populateVideoElement(r,t.loop)})).catch((function(e){o.default.error(e,"Video not found")}))}}))}},{key:"populateVideoElement",value:function(e,t){this._destroyed?o.default.warn("trying to populate video element that has been destroyed"):this._playoutEngine.queuePlayout(this._rendererId,{url:e,loop:t})}},{key:"setCurrentTime",value:function(e){var t=e,n=this.getChoiceTime();n>=0&&n<e&&(t=n),this._lastSetTime=t,this._playoutEngine.setCurrentTime(this._rendererId,t+this._inTime),this._timer.setTime(t)}},{key:"_setInTime",value:function(e){this._inTime=e}},{key:"_setOutTime",value:function(e){this._outTime=e}},{key:"switchFrom",value:function(){this._playoutEngine.setPlayoutInactive(this._rendererId)}},{key:"switchTo",value:function(){this._started?this._playoutEngine.setPlayoutActive(this._rendererId):this.start()}},{key:"end",value:function(){h(f(t.prototype),"end",this).call(this),this._playoutEngine.setPlayoutInactive(this._rendererId),this._playoutEngine.off(this._rendererId,"ended",this._endedEventListener),this._playoutEngine.off(this._rendererId,"timeupdate",this._outTimeEventListener)}},{key:"destroy",value:function(){this._playoutEngine.setPlayoutInactive(this._rendererId),this._playoutEngine.off(this._rendererId,"ended",this._endedEventListener),this._playoutEngine.off(this._rendererId,"timeupdate",this._outTimeEventListener),h(f(t.prototype),"destroy",this).call(this)}}])&&c(n.prototype,r),u&&c(n,u),t}(r.default);t.default=v},"./src/resolvers/ObjectDataResolver.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.array.reduce.js"),n("./node_modules/core-js/modules/es.object.to-string.js"),n("./node_modules/core-js/modules/es.promise.js"),n("./node_modules/core-js/modules/es.regexp.exec.js"),n("./node_modules/core-js/modules/es.string.split.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{get:function(t){return Promise.resolve(t.split(".").reduce((function(e,t){return null!==e&&t in e?e[t]:null}),e))},set:function(t,n){e[t]=n}}}},"./src/romper.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.symbol.js"),n("./node_modules/core-js/modules/es.array.concat.js"),n("./node_modules/core-js/modules/es.array.filter.js"),n("./node_modules/core-js/modules/es.array.for-each.js"),n("./node_modules/core-js/modules/es.array.join.js"),n("./node_modules/core-js/modules/es.function.name.js"),n("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),n("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),n("./node_modules/core-js/modules/es.object.keys.js"),n("./node_modules/core-js/modules/web.dom-collections.for-each.js");var r=f(n("./src/resolvers/ObjectDataResolver.js")),i=f(n("./src/Controller.js")),o=f(n("./src/StoryReasonerFactory.js")),a=f(n("./src/RepresentationReasoner.js")),s=f(n("./src/fetchers/MediaFetcher.js")),u=f(n("./src/logger.js")),l=n("./src/browserCapabilities.js"),c=n("./src/utils.js"),d=f(n("./package.json"));n("./src/assets/images/media-play-8x.png"),n("./src/assets/images/media-pause-8x.png"),n("./src/assets/images/media-step-forward-8x.png"),n("./src/assets/images/media-step-backward-8x.png"),n("./src/assets/images/no-asset.svg"),n("./src/assets/styles/player.scss");var h=n("./src/Events.js");function f(e){return e&&e.__esModule?e:{default:e}}function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var v={mediaFetcher:new s.default({}),analyticsLogger:function(e){e.to&&e.from&&e.current_narrative_element&&e.current_representation?u.default.info("ANALYTICS: ".concat(e.type,", ").concat(e.name,": ").concat(e.from," - ").concat(e.to,"; NE: ").concat(e.current_narrative_element,", Rep: ").concat(e.current_representation)):u.default.info("ANALYTICS: ".concat(e.type,", ").concat(e.name))},staticImageBaseUrl:"/dist/images",privacyNotice:null,saveSession:!1,handleKeys:!0};(0,c.checkWebviewDebug)()&&(document.getElementById("debug-div").classList.add("debug-div-shown"),"undefined"!=typeof console&&(void 0!==console.log?console.log=console.log:console.olog=function(){}),console.log=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];console.olog(t),document.getElementById("debug-div").innerHTML+="<p>"+t.join(" | ")+"</p>"},console.error=console.debug=console.info=console.log,window.onerror=function(e,t,n){return document.getElementById("debug-div").innerHTML+="<p> ERROR 1: "+e+"</p>",!1},window.addEventListener("error",(function(e){return document.getElementById("debug-div").innerHTML+="<p> ERROR 2: "+e.error.message+"</p>",!1})),window.addEventListener("unhandledrejection",(function(e){document.getElementById("debug-div").innerHTML+="<p> ERROR 3: "+e.reason.message+"</p>"}))),(0,c.checkDebugUA)()&&(document.getElementById("debug-div").classList.add("debug-div-shown"),document.getElementById("debug-div").innerHTML+="<h3>platform</h3>"+"<p>".concat(window.navigator.platform,"</p>")+"<h3>ua</h3>"+"<p>".concat(window.navigator.userAgent,"</p>")+"<h3>HLS Support</h3>"+"".concat(l.BrowserCapabilities.hlsSupport())+"<h3>HLS.js Support</h3>"+"".concat(l.BrowserCapabilities.hlsJsSupport())+"<h3>Dash Support</h3>"+"".concat(l.BrowserCapabilities.dashSupport())+"<h3>Chosen Format</h3>"+"".concat(l.MediaFormats.getFormat())+"<h3>Chosen Playout</h3>"+"".concat(l.MediaFormats.getPlayoutEngine())),e.exports={RESOLVERS:{FROM_OBJECT:r.default},BrowserUserAgent:l.BrowserUserAgent,BrowserCapabilities:l.BrowserCapabilities,ERROR_EVENTS:h.ERROR_EVENTS,REASONER_EVENTS:h.REASONER_EVENTS,VARIABLE_EVENTS:h.VARIABLE_EVENTS,init:function(e){u.default.info("StoryPlayer Version: ",d.default.version);var t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){m(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},v,{},e);t.dataResolver||(u.default.info("No data resolver passed to romper - creating one"),t.dataResolver=(0,r.default)({}));var n=(0,o.default)(t.storyFetcher,t.narrativeElementFetcher,t.dataResolver),s=(0,a.default)(t.representationFetcher,t.dataResolver),l={noAssetIconUrl:"".concat(t.staticImageBaseUrl,"/no-asset.svg"),noBackgroundAssetUrl:"".concat(t.staticImageBaseUrl,"/no-asset.svg")},c={storyFetcher:t.storyFetcher,narrativeElementFetcher:t.narrativeElementFetcher,representationCollectionFetcher:t.representationCollectionFetcher,representationFetcher:t.representationFetcher,assetCollectionFetcher:t.assetCollectionFetcher,mediaFetcher:t.mediaFetcher};return new i.default(t.target,n,s,c,t.analyticsLogger,l,t.privacyNotice,t.saveSession,t.handleKeys)}}},"./src/utils.js":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.array.concat.js"),n("./node_modules/core-js/modules/es.array.includes.js"),n("./node_modules/core-js/modules/es.array.iterator.js"),n("./node_modules/core-js/modules/es.object.to-string.js"),n("./node_modules/core-js/modules/es.regexp.exec.js"),n("./node_modules/core-js/modules/es.string.includes.js"),n("./node_modules/core-js/modules/es.string.iterator.js"),n("./node_modules/core-js/modules/es.string.search.js"),n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),n("./node_modules/core-js/modules/web.url.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.handleButtonTouchEvent=t.preventEventDefault=t.AUDIO=t.VIDEO=t.SLIDER_CLASS=t.scrollToTop=t.addDetail=t.copySelection=t.getOverrideFormat=t.checkOverrideFormat=t.checkDisableLookahead=t.fetchInactiveBufferingOverride=t.fetchActiveBufferingOverride=t.fetchShakaDebugLevel=t.checkDebugUA=t.checkWebviewDebug=t.checkOverrideFacebookBlock=t.checkDebugPlayout=t.fetchOverridePlayout=t.checkAddDetailsOverride=void 0;var r,i=(r=n("./src/logger.js"))&&r.__esModule?r:{default:r};t.checkAddDetailsOverride=function(){return"true"===new URLSearchParams(window.location.search).get("addDetails")};t.fetchOverridePlayout=function(){return new URLSearchParams(window.location.search).get("overridePlayout")};var o=function(){return"true"===new URLSearchParams(window.location.search).get("debugPlayout")};t.checkDebugPlayout=o;t.checkOverrideFacebookBlock=function(){return"true"===new URLSearchParams(window.location.search).get("overrideFacebookBlock")};t.checkWebviewDebug=function(){return"true"===new URLSearchParams(window.location.search).get("webviewDebug")};t.checkDebugUA=function(){return"true"===new URLSearchParams(window.location.search).get("debugUA")};t.fetchShakaDebugLevel=function(){return new URLSearchParams(window.location.search).get("shakaDebugLevel")};t.fetchActiveBufferingOverride=function(){return new URLSearchParams(window.location.search).get("activeBufferingOverride")};t.fetchInactiveBufferingOverride=function(){return new URLSearchParams(window.location.search).get("inactiveBufferingOverride")};t.checkDisableLookahead=function(){return"true"===new URLSearchParams(window.location.search).get("disableLookahead")};var a=function(e){return e&&("hls"===e||"dash"===e)};t.checkOverrideFormat=a;t.getOverrideFormat=function(){var e=new URLSearchParams(window.location.search).get("overridePlayoutFormat");return a(e)?e:null};var s=function(e){e.target.select(),document.execCommand("copy"),e.target.focus()};t.copySelection=s;t.addDetail=function(e,t,n){var r=document.createElement("div");r.className="detail",r.innerText="".concat(e,": ").concat(t||"");var i=document.createElement("input");return i.value="".concat(n||""),i.readOnly=!0,i.className="detail-input",i.onclick=s,r.appendChild(i),r};t.scrollToTop=function(){window.setTimeout((function(){window.scrollTo(0,0),document.getElementsByClassName("taster-offsite-panel").length>0&&document.getElementsByClassName("taster-offsite-panel")[0].scrollIntoView?document.getElementsByClassName("taster-offsite-panel")[0].scrollIntoView():document.getElementsByClassName("offsite-panel").length>0&&document.getElementsByClassName("offsite-panel")[0].scrollIntoView&&document.getElementsByClassName("offsite-panel")[0].scrollIntoView()}),100)};t.SLIDER_CLASS="slider-input";t.VIDEO="video";t.AUDIO="audio";t.preventEventDefault=function(e){e&&e.target&&e.target.classList&&(e.target.classList.includes("slider-input")||e.preventDefault())};t.handleButtonTouchEvent=function(e,t){return function(n){o()&&(i.default.info("Event Captured:",n),console.log("Touch Event Captured:",t)),void 0!==n.touches&&n.touches&&n.touches.length>1||(n.stopPropagation(),n.preventDefault(),e())}}}})}));
//# sourceMappingURL=romper.js.map