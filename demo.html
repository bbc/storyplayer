<!DOCTYPE html>
<html>
<!-- An example of a minimal wrapper for romper -->
<head>
    <meta charset="utf-8">
    <title>Romper Wrapper Demo</title>
    <link href="dist/romper.css" rel="stylesheet" type="text/css">
    <link href="examples/styles.css" rel="stylesheet" type="text/css">
</head>

<body>
    <div id="romper-target"></div>
    <script src="dist/romper.js"></script>
    <script>
        (function () {

            fetch('./examples/demo1.json')
                .then((response) => {
                    if (response.ok) {
                        return Promise.resolve(response.text());
                    }
                    return Promise.reject(response);
                })
                .then((text) => {
                    const config = JSON.parse(text);

                    let romper = window.Romper.init({
                        target: document.getElementById('romper-target'),
                        staticImageBaseUrl: 'src/assets/images/',
                        analyticsLogger: dataObj => {
                            console.log('ANALYTICS:', dataObj);
                        },
                        storyFetcher: id => Promise.resolve().then(
                            () => config.stories.filter(storyObject => storyObject.id === id)[0]
                        ),
                        mediaFetcher: uri => Promise.resolve(uri).then(resolvedUri => resolvedUri ? resolvedUri : Promise.reject('cannot resolve uri')),
                        representationCollectionFetcher: id => Promise.resolve(
                            config.representation_collections
                                .filter(presentationObject => presentationObject.id === id)[0]
                        ).then(presentationObject => presentationObject ? presentationObject : Promise.reject('no such presentation object: ' + id)),
                        assetCollectionFetcher: id => Promise.resolve(
                            config.asset_collections
                                .filter(assetCollectionObject => assetCollectionObject.id === id)[0]
                        ).then(assetCollectionObject => assetCollectionObject ? assetCollectionObject : Promise.reject('no such asset collection: ' + id)),
                        representationFetcher: id => Promise.resolve(
                            config.representations
                                .filter(representationObject => representationObject.id === id)[0]
                        ).then(representationObject => representationObject ? representationObject : Promise.reject('no such representation: ' + id)),
                        narrativeElementFetcher: id => Promise.resolve(
                            config.narrative_elements
                                .filter(narrativeElementObject => narrativeElementObject.id === id)[0]
                        ).then(narrativeElementObject => narrativeElementObject ? narrativeElementObject : Promise.reject('no such narrative element: ' + id)),
                        subStoryFetcher: id => Promise.resolve(
                            config.stories.find(s => s.narrative_elements.includes(id)[0]
                            )).then(storyObject => storyObject ? storyObject : Promise.reject('no story for narrative element')),
                    });

                    romper.start(config.stories[0].id);
                })
                .catch((rejection) => {
                    // eslint-disable-next-line max-len
                    console.log(`could not fetch story content: ${rejection.status} ${rejection.statusText}`);
                });


        })();
    </script>
</body>

</html>
